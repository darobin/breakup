<html lang="en"><head>
    <meta charset="utf-8">
    <title>Browsing the Web</title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common" class="remove"></script>
    <script class="remove">
      var respecConfig = {
              specStatus:     "ED"
          ,   shortName:      "browsing"
          ,   editors:      [{ name: "Up for the taking" }]
          ,   wg:             "HTML Working Group"
          ,   wgURI:          "http://www.w3.org/html/wg/"
          ,   wgPublicList:   "public-html"
          ,   wgPatentURI:    "http://www.w3.org/2004/01/pp-impl/40318/status"
          ,   license:        "cc-by"
          ,   processVersion: "2014"
        };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
        How navigation works.
      </p>
    </section>
    <section id="sotd">
      <p>
        This specification is an experimental breakup of the
        <a href="http://www.w3.org/TR/html51/">HTML specification</a>. You can see the full list on
        <a href="https://darobin.github.io/breakup/specs/">the index page</a> and take part in the
        discussion in <a href="https://github.com/darobin/breakup/">the repository</a>.
      </p>
    </section>
  

<section><h2>Navigating across documents</h2>

  <p>Certain actions cause the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context">browsing context</a> to <i id="navigating-across-documents:navigate"><a href="/breakup/specs/browsing/#navigate">navigate</a></i> to
  a new resource. A user agent may provide various ways for the user to explicitly cause a browsing
  context to navigate, in addition to those defined in this specification.</p>

  <p class="example">For example, <a href="/breakup/specs/html-linking/#following-hyperlinks-2" id="navigating-across-documents:following-hyperlinks-2">following a hyperlink</a>,
  <a href="/breakup/specs/html-forms/#concept-form-submit" id="navigating-across-documents:concept-form-submit">form submission</a>, and the <code id="navigating-across-documents:dom-open"><a href="/breakup/specs/browser-dom/#dom-open">window.open()</a></code> and <code id="navigating-across-documents:dom-location-assign"><a href="/breakup/specs/browser-dom/#dom-location-assign">location.assign()</a></code> methods can all cause a browsing context to
  navigate.</p>

  <p class="note">A <i>resource</i> has a URL, but that might not be the only information necessary
  to identify it. For example, a form submission that uses HTTP POST would also have the HTTP method
  and payload. Similarly, <a href="#an-iframe-srcdoc-document" id="navigating-across-documents:an-iframe-srcdoc-document">an <code>iframe</code> <code>srcdoc</code> document</a> needs to know the data it is to use.</p>

  <p>Navigation always involves <dfn id="source-browsing-context">source browsing context</dfn>, which is the browsing context which
  was responsible for starting the navigation.</p>

  
  
  <p>When a browsing context is <dfn id="navigate">navigated</dfn> to a new resource, the user
  agent must run the following steps:</p>

  <ol><li><p>Release the <a href="/breakup/specs/browser-dom/#storage-mutex" id="navigating-across-documents:storage-mutex">storage mutex</a>.</p></li><li id="sandboxLinks">

    <p>If the <a href="/breakup/specs/browsing/#source-browsing-context" id="navigating-across-documents:source-browsing-context">source browsing context</a> is not <a href="/breakup/specs/browser-dom/#allowed-to-navigate" id="navigating-across-documents:allowed-to-navigate">allowed to navigate</a> the
    <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-2">browsing context</a> being navigated, then abort these steps.</p>

    <p>If these steps are aborted here, the user agent may instead offer to open the new resource in
    a new <a href="/breakup/specs/browser-dom/#top-level-browsing-context" id="navigating-across-documents:top-level-browsing-context">top-level browsing context</a> or in the <a href="/breakup/specs/browser-dom/#top-level-browsing-context" id="navigating-across-documents:top-level-browsing-context-2">top-level browsing context</a>
    of the <a href="/breakup/specs/browsing/#source-browsing-context" id="navigating-across-documents:source-browsing-context-2">source browsing context</a>, at the user's option, in which case the user agent
    must <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-2">navigate</a> that designated <a href="/breakup/specs/browser-dom/#top-level-browsing-context" id="navigating-across-documents:top-level-browsing-context-3">top-level
    browsing context</a> to the new resource as if the user had requested it independently.</p>

    <p class="note">Doing so, however, can be dangerous, as it means that the user is overriding the
    author's explicit request to sandbox the content.</p>

    <p>If the <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-3">navigate</a> algorithm was invoked with <dfn id="exceptions-enabled">exceptions enabled</dfn>, and it
    is aborted on this step, then in addition to aborting this algorithm, the user agent must also
    throw a <code id="navigating-across-documents:securityerror"><a href="/breakup/specs/core-algorithms/#securityerror">SecurityError</a></code> exception.</p>

   </li><li id="seamlessLinks"><p>If the <a href="/breakup/specs/browsing/#source-browsing-context" id="navigating-across-documents:source-browsing-context-3">source browsing context</a> is the same as the
   <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-3">browsing context</a> being navigated, and this browsing context has its <a href="#seamless-browsing-context-flag" id="navigating-across-documents:seamless-browsing-context-flag">seamless
   browsing context flag</a> set, and the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-4">browsing context</a> being navigated was not
   chosen using an <dfn id="explicit-self-navigation-override">explicit self-navigation override</dfn>, then find the nearest
   <a href="/breakup/specs/browser-dom/#ancestor-browsing-context" id="navigating-across-documents:ancestor-browsing-context">ancestor browsing context</a> that does not have its <a href="#seamless-browsing-context-flag" id="navigating-across-documents:seamless-browsing-context-flag-2">seamless browsing context
   flag</a> set, and continue these steps as if <em>that</em> <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-5">browsing context</a> was
   the one that was going to be <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-4">navigated</a> instead.</p></li><li><p>If there is a preexisting attempt to navigate the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-6">browsing context</a>, and the
   <a href="/breakup/specs/browsing/#source-browsing-context" id="navigating-across-documents:source-browsing-context-4">source browsing context</a> is the same as the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-7">browsing context</a> being
   navigated, and that attempt is currently running the <a href="/breakup/specs/browsing/#unload-a-document" id="navigating-across-documents:unload-a-document">unload a document</a> algorithm,
   and the <a href="/breakup/specs/browser-dom/#origin-2" id="navigating-across-documents:origin-2">origin</a> of the <a href="/breakup/specs/core-algorithms/#url" id="navigating-across-documents:url">URL</a> of the resource being loaded in that
   navigation is not the <a href="/breakup/specs/browser-dom/#same-origin" id="navigating-across-documents:same-origin">same origin</a> as the <a href="/breakup/specs/browser-dom/#origin-2" id="navigating-across-documents:origin-2-2">origin</a> of the <a href="/breakup/specs/core-algorithms/#url" id="navigating-across-documents:url-2">URL</a>
   of the resource being loaded in <em>this</em> navigation, then abort these steps without
   affecting the preexisting attempt to navigate the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-8">browsing context</a>.</p></li><li><p>If a <a href="/breakup/specs/browser-dom/#concept-task" id="navigating-across-documents:concept-task">task</a> queued by the <a href="/breakup/specs/browser-dom/#traverse-the-history-by-a-delta" id="navigating-across-documents:traverse-the-history-by-a-delta">traverse the history by a
   delta</a> algorithm is running the <a href="/breakup/specs/browsing/#unload-a-document" id="navigating-across-documents:unload-a-document-2">unload a document</a> algorithm for the
   <a href="/breakup/specs/browser-dom/#active-document" id="navigating-across-documents:active-document">active document</a> of the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-9">browsing context</a> being navigated, then abort
   these steps without affecting the <a href="/breakup/specs/browsing/#unload-a-document" id="navigating-across-documents:unload-a-document-3">unload a document</a> algorithm or the aforementioned
   history traversal task.</p></li><li><p>If the <a href="/breakup/specs/browsing/#prompt-to-unload-a-document" id="navigating-across-documents:prompt-to-unload-a-document">prompt to unload a document</a> algorithm is being run for the
   <a href="/breakup/specs/browser-dom/#active-document" id="navigating-across-documents:active-document-2">active document</a> of the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-10">browsing context</a> being navigated, then abort
   these steps without affecting the <a href="/breakup/specs/browsing/#prompt-to-unload-a-document" id="navigating-across-documents:prompt-to-unload-a-document-2">prompt to unload a document</a> algorithm.</p></li><li>

    <p>Let <var>gone async</var> be false.</p>

    <p class="note">The <a href="/breakup/specs/browsing/#navigate-redirect-step"><i>handle redirects</i></a> step later in
    this algorithm can in certain cases jump back to the step labeled <a href="/breakup/specs/browsing/#navigate-fragid-step"><i>fragment identifiers</i></a>. Since, between those two steps,
    this algorithm goes from operating synchronously in the context of the calling <a href="/breakup/specs/browser-dom/#concept-task" id="navigating-across-documents:concept-task-2">task</a> to operating <a href="/breakup/specs/core-algorithms/#in-parallel" id="navigating-across-documents:in-parallel">in parallel</a> independent of the <a href="/breakup/specs/browser-dom/#event-loop" id="navigating-across-documents:event-loop">event
    loop</a>, some of the intervening steps need to be able to handle both being run as part of a <a href="/breakup/specs/browser-dom/#concept-task" id="navigating-across-documents:concept-task-3">task</a> and
    running <a href="/breakup/specs/core-algorithms/#in-parallel" id="navigating-across-documents:in-parallel-2">in parallel</a>. The <var>gone async</var> flag is thus used to make these steps
    aware of which mode they are operating in.</p>

   </li><li id="navigate-fragid-step"><p><i>Fragment identifiers</i>: If this is not a
   <dfn id="reload-triggered-navigation">reload-triggered navigation</dfn>: apply the <a href="/breakup/specs/core-algorithms/#url-parser" id="navigating-across-documents:url-parser">URL parser</a> algorithm to the
   <a href="/breakup/specs/core-algorithms/#absolute-url" id="navigating-across-documents:absolute-url">absolute URL</a> of the new resource and the <a href="https://dom.spec.whatwg.org/#concept-document-url" id="navigating-across-documents:the-document's-address" data-x-internal="the-document's-address">address</a> of the <a href="/breakup/specs/browser-dom/#active-document" id="navigating-across-documents:active-document-3">active document</a> of the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-11">browsing context</a>
   being navigated; if all the components of the resulting <a href="/breakup/specs/core-algorithms/#parsed-url" id="navigating-across-documents:parsed-url">parsed
   URLs</a>, ignoring any <a href="/breakup/specs/core-algorithms/#concept-url-fragment" id="navigating-across-documents:concept-url-fragment">fragment</a> components, are
   identical, and the new resource is to be fetched using HTTP GET <a href="/breakup/specs/core-algorithms/#concept-http-equivalent-get" id="navigating-across-documents:concept-http-equivalent-get">or equivalent</a>, and the <a href="/breakup/specs/core-algorithms/#parsed-url" id="navigating-across-documents:parsed-url-2">parsed URL</a> of the
   new resource has a <a href="/breakup/specs/core-algorithms/#concept-url-fragment" id="navigating-across-documents:concept-url-fragment-2">fragment</a> component that is not null
   (even if it is empty), then <a href="/breakup/specs/browsing/#scroll-to-fragid" id="navigating-across-documents:scroll-to-fragid">navigate to that fragment
   identifier</a> and abort these steps.</p></li><li><p>If <var>gone async</var> is false, cancel any preexisting but not yet <a href="/breakup/specs/browsing/#concept-navigate-mature" id="navigating-across-documents:concept-navigate-mature">mature</a> attempt to navigate the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-12">browsing
   context</a>, including canceling any instances of the <a href="/breakup/specs/core-algorithms/#fetch" id="navigating-across-documents:fetch">fetch</a> algorithm started by
   those attempts. If one of those attempts has already created and <a href="/breakup/specs/browsing/#initialise-the-document-object" id="navigating-across-documents:initialise-the-document-object">initialised a new <code>Document</code> object</a>, <a href="/breakup/specs/browsing/#abort-a-document" id="navigating-across-documents:abort-a-document">abort</a> that <code id="navigating-across-documents:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code> also. (Navigation attempts that have <a href="/breakup/specs/browsing/#concept-navigate-mature" id="navigating-across-documents:concept-navigate-mature-2">matured</a> already have session history entries, and are
   therefore handled during the <a href="/breakup/specs/browsing/#update-the-session-history-with-the-new-page" id="navigating-across-documents:update-the-session-history-with-the-new-page">update the session history with the new page</a> algorithm,
   later.)</p></li><li><p>If the new resource is to be handled using a mechanism that does not affect the browsing
   context, e.g. ignoring the navigation request altogether because the specified scheme is not one
   of the supported protocols, then abort these steps and <a href="/breakup/specs/browsing/#hand-off-to-external-software" id="navigating-across-documents:hand-off-to-external-software">proceed with that mechanism instead</a>.</p></li><li>

    <p>If <var>gone async</var> is false, <a href="/breakup/specs/browsing/#prompt-to-unload-a-document" id="navigating-across-documents:prompt-to-unload-a-document-3">prompt
    to unload</a> the <code id="navigating-across-documents:document-2"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object. If the user <a href="/breakup/specs/browsing/#refused-to-allow-the-document-to-be-unloaded" id="navigating-across-documents:refused-to-allow-the-document-to-be-unloaded">refused to allow the
    document to be unloaded</a>, then abort these steps.</p>

    <p>If this instance of the <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-5">navigation</a> algorithm gets canceled
    while this step is running, the <a href="/breakup/specs/browsing/#prompt-to-unload-a-document" id="navigating-across-documents:prompt-to-unload-a-document-4">prompt to unload a document</a> algorithm must
    nonetheless be run to completion.</p>

   </li><li><p>If <var>gone async</var> is false, <a href="/breakup/specs/browsing/#abort-a-document" id="navigating-across-documents:abort-a-document-2">abort</a>
   the <a href="/breakup/specs/browser-dom/#active-document" id="navigating-across-documents:active-document-4">active document</a> of the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-13">browsing context</a>.</p></li><li>

    <p>If the new resource is to be handled by displaying some sort of inline content, e.g. an error
    message because the specified scheme is not one of the supported protocols, or an inline prompt
    to allow the user to select <a href="/breakup/specs/browser-dom/#dom-navigator-registerprotocolhandler" id="navigating-across-documents:dom-navigator-registerprotocolhandler">a registered
    handler</a> for the given scheme, then <a href="/breakup/specs/browsing/#read-ua-inline" id="navigating-across-documents:read-ua-inline">display the inline
    content</a> and abort these steps.</p>

    <p class="note">In the case of a registered handler being used, the algorithm will be reinvoked
    with a new URL to handle the request.</p>

   </li><li>

    <p>If the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-14">browsing context</a> being navigated is a <a href="/breakup/specs/browser-dom/#nested-browsing-context" id="navigating-across-documents:nested-browsing-context">nested browsing
    context</a>, then put it in the <a href="/breakup/specs/browser-dom/#delaying-load-events-mode" id="navigating-across-documents:delaying-load-events-mode">delaying <code>load</code> events
    mode</a>.</p>

    <p>The user agent must take this <a href="/breakup/specs/browser-dom/#nested-browsing-context" id="navigating-across-documents:nested-browsing-context-2">nested browsing context</a> out of the <a href="/breakup/specs/browser-dom/#delaying-load-events-mode" id="navigating-across-documents:delaying-load-events-mode-2">delaying
    <code>load</code> events mode</a> when this <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-6">navigation</a> algorithm later <a href="/breakup/specs/browsing/#concept-navigate-mature" id="navigating-across-documents:concept-navigate-mature-3">matures</a>, or when it terminates (whether due to having
    run all the steps, or being canceled, or being aborted), whichever happens first.</p>

    

   </li><li>

    <p>This is the step that attempts to obtain the resource, if necessary. Jump to the first
    appropriate substep:</p>

    <dl><dt>If the resource has already been obtained (e.g. because it is being used to populate an
     <code id="navigating-across-documents:the-object-element"><a href="#the-object-element">object</a></code> element's new <a href="/breakup/specs/browser-dom/#child-browsing-context" id="navigating-across-documents:child-browsing-context">child browsing context</a>)</dt><dd><p>Skip this step. The data is already available.</p></dd><dt>If the new resource is a <a href="/breakup/specs/core-algorithms/#url" id="navigating-across-documents:url-3">URL</a> whose <a href="/breakup/specs/core-algorithms/#concept-url-scheme" id="navigating-across-documents:concept-url-scheme">scheme</a> is <code id="navigating-across-documents:javascript-protocol"><a href="/breakup/specs/browsing/#javascript-protocol">javascript</a></code></dt><dd>

      

      <p><a href="/breakup/specs/browser-dom/#queue-a-task" id="navigating-across-documents:queue-a-task">Queue a task</a> to run <dfn id="javascript-protocol">these
      "<code>javascript:</code> URL" steps</dfn>, associated with the <a href="/breakup/specs/browser-dom/#active-document" id="navigating-across-documents:active-document-5">active document</a>
      of the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-15">browsing context</a> being navigated:</p>

      <ol id="concept-js-deref"><li><p>If the <a href="/breakup/specs/browser-dom/#origin-2" id="navigating-across-documents:origin-2-3">origin</a> of the <a href="/breakup/specs/browsing/#source-browsing-context" id="navigating-across-documents:source-browsing-context-5">source browsing context</a> is not the
       <a href="/breakup/specs/browser-dom/#same-origin" id="navigating-across-documents:same-origin-2">same origin</a> as the <a href="/breakup/specs/browser-dom/#origin-2" id="navigating-across-documents:origin-2-4">origin</a> of the <a href="/breakup/specs/browser-dom/#active-document" id="navigating-across-documents:active-document-6">active document</a> of
       the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-16">browsing context</a> being navigated, then act as if the result of evaluating
       the script was the void value, and jump to the step labeled <i>process results</i>
       below.</p></li><li><p>Apply the <a href="/breakup/specs/core-algorithms/#url-parser" id="navigating-across-documents:url-parser-2">URL parser</a> to the <a href="/breakup/specs/core-algorithms/#url" id="navigating-across-documents:url-4">URL</a> being navigated.</p></li><li><p>Let <var>parsed URL</var> be the result of the <a href="/breakup/specs/core-algorithms/#url-parser" id="navigating-across-documents:url-parser-3">URL
       parser</a>.</p></li><li><p>Let <var>script source</var> be the empty string.</p></li><li><p>Append <var>parsed URL</var>'s <a href="/breakup/specs/core-algorithms/#concept-url-scheme-data" id="navigating-across-documents:concept-url-scheme-data">scheme
       data</a> component to <var>script source</var>.</p></li><li><p>If <var>parsed URL</var>'s <a href="/breakup/specs/core-algorithms/#concept-url-query" id="navigating-across-documents:concept-url-query">query</a>
       component is not null, then first append a U+003F QUESTION MARK character (?) to <var>script source</var>, and then append <var>parsed URL</var>'s <a href="/breakup/specs/core-algorithms/#concept-url-query" id="navigating-across-documents:concept-url-query-2">query</a> component to <var>script
       source</var>.</p></li><li><p>If <var>parsed URL</var>'s <a href="/breakup/specs/core-algorithms/#concept-url-fragment" id="navigating-across-documents:concept-url-fragment-3">fragment</a> component is not null, then first append a
       U+0023 NUMBER SIGN character (#) to <var>script source</var>, and then append <var>parsed URL</var>'s <a href="/breakup/specs/core-algorithms/#concept-url-fragment" id="navigating-across-documents:concept-url-fragment-4">fragment</a> component to
       <var>script source</var>.</p></li><li><p>Replace <var>script source</var> with the result of applying the
       <a href="/breakup/specs/core-algorithms/#percent-decode" id="navigating-across-documents:percent-decode">percent decode</a> algorithm to <var>script source</var>.</p></li><li><p>Replace <var>script source</var> with the result of applying the <a href="/breakup/specs/core-algorithms/#utf-8-decode" id="navigating-across-documents:utf-8-decode">UTF-8
       decode</a> algorithm to <var>script source</var>.</p></li><li><p>Let <var>address</var> be the <a href="https://dom.spec.whatwg.org/#concept-document-url" id="navigating-across-documents:the-document's-address-2" data-x-internal="the-document's-address">address</a> of the <a href="/breakup/specs/browser-dom/#active-document" id="navigating-across-documents:active-document-7">active document</a> of the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-17">browsing
       context</a> being navigated.</p></li><li>

        <p><a href="/breakup/specs/browser-dom/#create-a-script" id="navigating-across-documents:create-a-script">Create a script</a>, using <var>script source</var> as the script
        source, <var>address</var> as the script source URL, JavaScript as the scripting
        language, and the <a href="/breakup/specs/browser-dom/#environment-settings-object" id="navigating-across-documents:environment-settings-object">environment settings object</a> of the <code id="navigating-across-documents:window"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object of
        the <a href="/breakup/specs/browser-dom/#active-document" id="navigating-across-documents:active-document-8">active document</a> of the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-18">browsing context</a> being navigated.</p>

        <p>Let <var>result</var> be the return value of the <a href="/breakup/specs/browser-dom/#code-entry-point" id="navigating-across-documents:code-entry-point">code entry-point</a>
        of this <a href="/breakup/specs/browser-dom/#concept-script" id="navigating-across-documents:concept-script">script</a>. If an exception was thrown, let <var>result</var> be void instead. (The result will be void also if <a href="/breakup/specs/browser-dom/#concept-bc-noscript" id="navigating-across-documents:concept-bc-noscript">scripting is disabled</a>.)</p>

       </li><li>

        <p><i>Process results</i>: If the result of executing the script is void (there is no return
        value), then the result of obtaining the resource for the URL is <a href="/breakup/specs/core-algorithms/#concept-http-equivalent-codes" id="navigating-across-documents:concept-http-equivalent-codes">equivalent to</a> an HTTP resource with an HTTP
        204 No Content response.</p>

        <p>Otherwise, the result of obtaining the resource for the URL is <a href="/breakup/specs/core-algorithms/#concept-http-equivalent-codes" id="navigating-across-documents:concept-http-equivalent-codes-2">equivalent</a> to an HTTP resource with a 200 OK
        response whose <a href="/breakup/specs/core-algorithms/#content-type" id="navigating-across-documents:content-type">Content-Type metadata</a> is
        <code id="navigating-across-documents:text/html"><a href="#text/html">text/html</a></code> and whose response body is the return value converted to a string
        value.</p>

        <p>When it comes time to <a href="/breakup/specs/browsing/#set-the-document's-address" id="navigating-across-documents:set-the-document's-address">set the document's address</a> in the <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-7">navigation algorithm</a>, use <var>address</var> as the
        <a href="/breakup/specs/browsing/#override-url" id="navigating-across-documents:override-url">override URL</a>.</p>

       </li></ol>

      <p>The <a href="/breakup/specs/browser-dom/#task-source" id="navigating-across-documents:task-source">task source</a> for this <a href="/breakup/specs/browser-dom/#concept-task" id="navigating-across-documents:concept-task-4">task</a> is the
      <a href="/breakup/specs/browser-dom/#dom-manipulation-task-source" id="navigating-across-documents:dom-manipulation-task-source">DOM manipulation task source</a>.</p>

      <div class="example">

       <p>So for example a <a href="/breakup/specs/browsing/#javascript-protocol" id="navigating-across-documents:javascript-protocol-2"><code>javascript:</code> URL</a> in
       an <code id="navigating-across-documents:attr-hyperlink-href"><a href="/breakup/specs/html-linking/#attr-hyperlink-href">href</a></code> attribute of an <code id="navigating-across-documents:the-a-element"><a href="/breakup/specs/html-linking/#the-a-element">a</a></code> element
       would only be evaluated when the link was <a href="/breakup/specs/html-linking/#following-hyperlinks-2" id="navigating-across-documents:following-hyperlinks-2-2">followed</a>, while such a URL in the <code id="navigating-across-documents:attr-iframe-src"><a href="#attr-iframe-src">src</a></code> attribute of an <code id="navigating-across-documents:the-iframe-element"><a href="#the-iframe-element">iframe</a></code> element would be
       evaluated in the context of the <code id="navigating-across-documents:the-iframe-element-2"><a href="#the-iframe-element">iframe</a></code>'s own <a href="/breakup/specs/browser-dom/#nested-browsing-context" id="navigating-across-documents:nested-browsing-context-3">nested browsing
       context</a> when the <code id="navigating-across-documents:the-iframe-element-3"><a href="#the-iframe-element">iframe</a></code> is being set up; once evaluated, its return value
       (if it was not void) would replace that <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-19">browsing context</a>'s <code id="navigating-across-documents:document-3"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, thus also
       changing the <code id="navigating-across-documents:window-2"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object of that <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-20">browsing context</a>.</p>

      </div>

     </dd><dt>If the new resource is to be fetched using HTTP GET <a href="/breakup/specs/core-algorithms/#concept-http-equivalent-get" id="navigating-across-documents:concept-http-equivalent-get-2">or equivalent</a>, and there are <a href="/breakup/specs/appcache/#relevant-application-cache" id="navigating-across-documents:relevant-application-cache">relevant application caches</a> that are identified by a URL with the
     <a href="/breakup/specs/browser-dom/#same-origin" id="navigating-across-documents:same-origin-3">same origin</a> as the URL in question, and that have this URL as one of their
     entries, excluding entries marked as <a href="/breakup/specs/appcache/#concept-appcache-foreign" id="navigating-across-documents:concept-appcache-foreign">foreign</a>,
     and whose <a href="/breakup/specs/appcache/#concept-appcache-mode" id="navigating-across-documents:concept-appcache-mode">mode</a> is <a href="/breakup/specs/appcache/#concept-appcache-mode-fast" id="navigating-across-documents:concept-appcache-mode-fast">fast</a>, and the user agent is not in a mode where it
     will avoid using <a href="/breakup/specs/appcache/#application-cache" id="navigating-across-documents:application-cache">application caches</a></dt><dd>

      <p><a href="/breakup/specs/core-algorithms/#fetch" id="navigating-across-documents:fetch-2">Fetch</a> the resource from the <a href="/breakup/specs/appcache/#concept-appcache-selection" id="navigating-across-documents:concept-appcache-selection">most
      appropriate application cache</a> of those that match.</p>

      <p class="example">For example, imagine an HTML page with an associated application cache
      displaying an image and a form, where the image is also used by several other application
      caches. If the user right-clicks on the image and chooses "View Image", then the user agent
      could decide to show the image from any of those caches, but it is likely that the most useful
      cache for the user would be the one that was used for the aforementioned HTML page. On the
      other hand, if the user submits the form, and the form does a POST submission, then the user
      agent will not use an application cache at all; the submission will be made to the
      network.</p>

     </dd><dt>Otherwise</dt><dd>

      <p><a href="/breakup/specs/core-algorithms/#fetch" id="navigating-across-documents:fetch-3">Fetch</a> the new resource, with the <i>manual redirect flag</i>
      set.</p>

     </dd></dl>

    <p>If the steps above invoked the <a href="/breakup/specs/core-algorithms/#fetch" id="navigating-across-documents:fetch-4">fetch</a> algorithm, the following requirements also
    apply:</p>

    <p>If the resource is being fetched using a method other than one <a href="/breakup/specs/core-algorithms/#concept-http-equivalent-get" id="navigating-across-documents:concept-http-equivalent-get-3">equivalent to</a> HTTP's GET, or, if the <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-8">navigation algorithm</a> was invoked as a
    result of the <a href="/breakup/specs/html-forms/#concept-form-submit" id="navigating-across-documents:concept-form-submit-2">form submission algorithm</a>, then the
    <a href="/breakup/specs/core-algorithms/#fetch" id="navigating-across-documents:fetch-5">fetching algorithm</a> must be invoked from the <a href="/breakup/specs/browser-dom/#origin-2" id="navigating-across-documents:origin-2-5">origin</a> of
    the <a href="/breakup/specs/browser-dom/#active-document" id="navigating-across-documents:active-document-9">active document</a> of the <a href="/breakup/specs/browsing/#source-browsing-context" id="navigating-across-documents:source-browsing-context-6">source browsing context</a>, if any.</p> 

    <p>Otherwise, if the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-21">browsing context</a> being navigated is a <a href="/breakup/specs/browser-dom/#child-browsing-context" id="navigating-across-documents:child-browsing-context-2">child browsing
    context</a>, then the <a href="/breakup/specs/core-algorithms/#fetch" id="navigating-across-documents:fetch-6">fetching algorithm</a> must be invoked from the
    <a href="/breakup/specs/browser-dom/#browsing-context-scope-origin" id="navigating-across-documents:browsing-context-scope-origin">browsing context scope origin</a> of the <a href="/breakup/specs/browser-dom/#browsing-context-container" id="navigating-across-documents:browsing-context-container">browsing context container</a> of the
    <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-22">browsing context</a> being navigated, if it has one.</p> 

   </li><li>

    

    <p>If <var>gone async</var> is false, return to whatever algorithm invoked the
    navigation steps and continue running these steps asynchronously.</p>

   </li><li><p>Let <var>gone async</var> be true.</p></li><li><p>Wait for one or more bytes to be available or for the user agent to establish that the
   resource in question is empty. During this time, the user agent may allow the user to cancel this
   navigation attempt or start other navigation attempts.</p></li><li id="navigate-redirect-step">

    <p><i>Handle redirects</i>: If fetching the resource results in a redirect, and either the
    <a href="/breakup/specs/core-algorithms/#url" id="navigating-across-documents:url-5">URL</a> of the target of the redirect has the <a href="/breakup/specs/browser-dom/#same-origin" id="navigating-across-documents:same-origin-4">same origin</a> as the original
    resource, or the resource is being obtained using the POST method or a safe method (in HTTP
    terms), return to <a href="/breakup/specs/browsing/#navigate-fragid-step">the step labeled <i>fragment
    identifiers</i></a> with the new resource, except that if the <a href="/breakup/specs/core-algorithms/#url" id="navigating-across-documents:url-6">URL</a> of the target of
    the redirect does not have a fragment identifier and the <a href="/breakup/specs/core-algorithms/#url" id="navigating-across-documents:url-7">URL</a> of the resource that
    led to the redirect does, then the fragment identifier of the resource that led to the redirect
    must be propagated to the <a href="/breakup/specs/core-algorithms/#url" id="navigating-across-documents:url-8">URL</a> of the target of the redirect.</p>

    <p class="example">So for instance, if the original URL was "<code>http://example.com/#!sample</code>" and "<code>http://example.com/</code>" is
    found to redirect to "<code>https://example.com/</code>", the URL of the new resource
    will be "<code>https://example.com/#!sample</code>".</p>

    <p>Otherwise, if fetching the resource results in a redirect but the <a href="/breakup/specs/core-algorithms/#url" id="navigating-across-documents:url-9">URL</a> of the
    target of the redirect does not have the <a href="/breakup/specs/browser-dom/#same-origin" id="navigating-across-documents:same-origin-5">same origin</a> as the original resource and
    the resource is being obtained using a method that is neither the POST method nor a safe method
    (in HTTP terms), then abort these steps. The user agent may indicate to the user that the
    navigation has been aborted for security reasons.</p>

   </li><li>

    <p><strong>Fallback in prefer-online mode</strong>: If the resource was not fetched from an
    <a href="/breakup/specs/appcache/#application-cache" id="navigating-across-documents:application-cache-2">application cache</a>, and was to be fetched using HTTP GET <a href="/breakup/specs/core-algorithms/#concept-http-equivalent-get" id="navigating-across-documents:concept-http-equivalent-get-4">or equivalent</a>, and there are <a href="/breakup/specs/appcache/#relevant-application-cache" id="navigating-across-documents:relevant-application-cache-2">relevant application caches</a> that are identified by a URL with the
    <a href="/breakup/specs/browser-dom/#same-origin" id="navigating-across-documents:same-origin-6">same origin</a> as the URL in question, and that have this URL as one of their entries,
    excluding entries marked as <a href="/breakup/specs/appcache/#concept-appcache-foreign" id="navigating-across-documents:concept-appcache-foreign-2">foreign</a>, and whose
    <a href="/breakup/specs/appcache/#concept-appcache-mode" id="navigating-across-documents:concept-appcache-mode-2">mode</a> is <a href="/breakup/specs/appcache/#concept-appcache-mode-prefer-online" id="navigating-across-documents:concept-appcache-mode-prefer-online">prefer-online</a>, and the user didn't cancel the
    navigation attempt during the earlier step, and the navigation attempt failed (e.g. the server
    returned a 4xx or 5xx status code <a href="/breakup/specs/core-algorithms/#concept-http-equivalent-codes" id="navigating-across-documents:concept-http-equivalent-codes-3">or
    equivalent</a>, or there was a DNS error), then:</p>

    <p>Let <var>candidate</var> be the resource identified by the URL in question from the
    <a href="/breakup/specs/appcache/#concept-appcache-selection" id="navigating-across-documents:concept-appcache-selection-2">most appropriate application cache</a> of those that
    match.</p> 

    <p>If <var>candidate</var> is not marked as <a href="/breakup/specs/appcache/#concept-appcache-foreign" id="navigating-across-documents:concept-appcache-foreign-3">foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as the resource.
    The user agent may indicate to the user that the original page load failed, and that the page
    used was a previously cached resource.</p>

    <p class="note">This does not affect the <i>address of the resource from which Request-URIs are
    obtained</i>, as used to set <a href="/breakup/specs/browser-dom/#the-document's-referrer" id="navigating-across-documents:the-document's-referrer">the document's referrer</a> in the <a href="/breakup/specs/browsing/#initialise-the-document-object" id="navigating-across-documents:initialise-the-document-object-2">initialise the
    <code>Document</code> object</a> steps below; they still use the value as computed by the
    original <a href="/breakup/specs/core-algorithms/#fetch" id="navigating-across-documents:fetch-7">fetch</a> algorithm.</p>

   </li><li>

    <p><strong>Fallback for fallback entries</strong>: If the resource was not fetched from an
    <a href="/breakup/specs/appcache/#application-cache" id="navigating-across-documents:application-cache-3">application cache</a>, and was to be fetched using HTTP GET <a href="/breakup/specs/core-algorithms/#concept-http-equivalent-get" id="navigating-across-documents:concept-http-equivalent-get-5">or equivalent</a>, and its URL <a href="/breakup/specs/appcache/#concept-appcache-matches-fallback" id="navigating-across-documents:concept-appcache-matches-fallback">matches the fallback namespace</a> of one or more
    <a href="/breakup/specs/appcache/#relevant-application-cache" id="navigating-across-documents:relevant-application-cache-3">relevant application caches</a>, and the <a href="/breakup/specs/appcache/#concept-appcache-selection" id="navigating-across-documents:concept-appcache-selection-3">most appropriate application cache</a> of those that match
    does not have an entry in its <a href="/breakup/specs/appcache/#concept-appcache-onlinewhitelist" id="navigating-across-documents:concept-appcache-onlinewhitelist">online
    whitelist</a> that has the <a href="/breakup/specs/browser-dom/#same-origin" id="navigating-across-documents:same-origin-7">same origin</a> as the resource's URL and that is a
    <a href="/breakup/specs/core-algorithms/#prefix-match" id="navigating-across-documents:prefix-match">prefix match</a> for the resource's URL, and the user didn't cancel the navigation
    attempt during the earlier step, and the navigation attempt failed (e.g. the server returned a
    4xx or 5xx status code <a href="/breakup/specs/core-algorithms/#concept-http-equivalent-codes" id="navigating-across-documents:concept-http-equivalent-codes-4">or equivalent</a>, or
    there was a DNS error), then:</p> 

    <p>Let <var>candidate</var> be the <a href="/breakup/specs/appcache/#concept-appcache-fallback" id="navigating-across-documents:concept-appcache-fallback">fallback
    resource</a> specified for the <a href="/breakup/specs/appcache/#concept-appcache-fallback-ns" id="navigating-across-documents:concept-appcache-fallback-ns">fallback
    namespace</a> in question. If multiple application caches match, the user agent must use the
    fallback of the <a href="/breakup/specs/appcache/#concept-appcache-selection" id="navigating-across-documents:concept-appcache-selection-4">most appropriate application
    cache</a> of those that match.</p>

    <p>If <var>candidate</var> is not marked as <a href="/breakup/specs/appcache/#concept-appcache-foreign" id="navigating-across-documents:concept-appcache-foreign-4">foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as the resource.
    <a id="navigating-across-documents:the-document's-address-3" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">The document's address</a>, if appropriate, will still be the originally requested URL,
    not the fallback URL, but the user agent may indicate to the user that the original page load
    failed, that the page used was a fallback resource, and what the URL of the fallback resource
    actually is.</p>

    <p class="note">This does not affect the <i>address of the resource from which Request-URIs are
    obtained</i>, as used to set <a href="/breakup/specs/browser-dom/#the-document's-referrer" id="navigating-across-documents:the-document's-referrer-2">the document's referrer</a> in the <a href="/breakup/specs/browsing/#initialise-the-document-object" id="navigating-across-documents:initialise-the-document-object-3">initialise the
    <code>Document</code> object</a> steps below; they still use the value as computed by the
    original <a href="/breakup/specs/core-algorithms/#fetch" id="navigating-across-documents:fetch-8">fetch</a> algorithm.</p>

   </li><li>

    <p><i>Resource handling</i>: If the resource's out-of-band metadata (e.g. HTTP headers), not
    counting any <a href="/breakup/specs/core-algorithms/#content-type" id="navigating-across-documents:content-type-2">type information</a> (such as the Content-Type HTTP
    header), requires some sort of processing that will not affect the browsing context, then
    perform that processing and abort these steps.</p>

    <div class="note">
     <p>Such processing might be triggered by, amongst other things, the following:</p>
     <ul class="brief"><li>HTTP status codes (e.g. 204 No Content or 205 Reset Content)</li><li>Network errors (e.g. the network interface being unavailable)</li><li>Cryptographic protocol failures (e.g. an incorrect TLS certificate)</li></ul>
    </div>

    <p>Responses with HTTP <code id="navigating-across-documents:http-content-disposition"><a href="/breakup/specs/core-algorithms/#http-content-disposition">Content-Disposition</a></code> headers
    specifying the <code>attachment</code> disposition type must be handled <a href="/breakup/specs/html-linking/#as-a-download" id="navigating-across-documents:as-a-download">as a
    download</a>.</p>

    

    <p>HTTP 401 responses that do not include a challenge recognised by the user agent must be
    processed as if they had no challenge, e.g. rendering the entity body as if the response had
    been 200 OK.</p>

    <p>User agents may show the entity body of an HTTP 401 response even when the response does
    include a recognised challenge, with the option to login being included in a non-modal fashion,
    to enable the information provided by the server to be used by the user before authenticating.
    Similarly, user agents should allow the user to authenticate (in a non-modal fashion) against
    authentication challenges included in other responses such as HTTP 200 OK responses, effectively
    allowing resources to present HTTP login forms without requiring their use.</p>

   </li><li><p>Let <var>type</var> be <a href="https://mimesniff.spec.whatwg.org/#sniffed-mime-type" id="navigating-across-documents:content-type-sniffing-2" data-x-internal="content-type-sniffing-2">the sniffed type of
   the resource</a>.</p></li><li><p>If the user agent has been configured to process resources of the given <var>type</var> using some mechanism other than rendering the content in a <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-23">browsing
   context</a>, then skip this step. Otherwise, if the <var>type</var> is one of the
   following types, jump to the appropriate entry in the following list, and process the resource as
   described there:</p>

    <dl class="switch"><dt>"<code id="navigating-across-documents:text/html-2"><a href="#text/html">text/html</a></code>"</dt><dd>Follow the steps given in the <a href="/breakup/specs/browsing/#read-html" id="navigating-across-documents:read-html">HTML document</a> section,
     and then, once they have completed, abort this <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-9">navigate</a> algorithm.</dd><dt>"<code id="navigating-across-documents:application/xml"><a href="#application/xml">application/xml</a></code>"</dt><dt>"<code id="navigating-across-documents:text/xml"><a href="#text/xml">text/xml</a></code>"</dt><dt>"<code id="navigating-across-documents:image/svg+xml"><a href="#image/svg+xml">image/svg+xml</a></code>"</dt><dt>"<code id="navigating-across-documents:application/xhtml+xml"><a href="#application/xhtml+xml">application/xhtml+xml</a></code>"</dt><dt>Any other type ending in "<code>+xml</code>" that is not an <a href="/breakup/specs/browsing/#explicitly-supported-xml-type" id="navigating-across-documents:explicitly-supported-xml-type">explicitly
     supported XML type</a></dt><dd>Follow the steps given in the <a href="/breakup/specs/browsing/#read-xml" id="navigating-across-documents:read-xml">XML document</a> section. If
     that section determines that the content is <em>not</em> to be displayed as a generic XML
     document, then proceed to the next step in this overall set of steps. Otherwise, once the steps
     given in the <a href="/breakup/specs/browsing/#read-xml" id="navigating-across-documents:read-xml-2">XML document</a> section have completed, abort this
     <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-10">navigate</a> algorithm.</dd><dt>"<code id="navigating-across-documents:text/plain"><a data-x-internal="text/plain" href="http://tools.ietf.org/html/rfc2046#section-4.1.3">text/plain</a></code>"</dt><dd>Follow the steps given in the <a href="/breakup/specs/browsing/#read-text" id="navigating-across-documents:read-text">plain text file</a> section,
     and then, once they have completed, abort this <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-11">navigate</a> algorithm.</dd><dt>"<code id="navigating-across-documents:multipart/x-mixed-replace"><a href="#multipart/x-mixed-replace">multipart/x-mixed-replace</a></code>"</dt><dd>Follow the steps given in the <a href="/breakup/specs/browsing/#read-multipart-x-mixed-replace" id="navigating-across-documents:read-multipart-x-mixed-replace">multipart/x-mixed-replace</a> section, and then,
     once they have completed, abort this <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-12">navigate</a> algorithm.</dd><dt>A supported image, video, or audio type</dt><dd>Follow the steps given in the <a href="/breakup/specs/browsing/#read-media" id="navigating-across-documents:read-media">media</a> section, and then,
     once they have completed, abort this <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-13">navigate</a> algorithm.</dd><dt>A type that will use an external application to render the content in the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-24">browsing
     context</a></dt><dd>Follow the steps given in the <a href="/breakup/specs/browsing/#read-plugin" id="navigating-across-documents:read-plugin">plugin</a> section, and then,
     once they have completed, abort this <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-14">navigate</a> algorithm.</dd></dl>

    <p>An <dfn id="explicitly-supported-xml-type">explicitly supported XML type</dfn> is one for which the user agent is configured to
    use an external application to render the content (either a <a href="/breakup/specs/core-algorithms/#plugin" id="navigating-across-documents:plugin">plugin</a> rendering
    directly in the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-25">browsing context</a>, or a separate application), or one for which the
    user agent has dedicated processing rules (e.g. a Web browser with a built-in Atom feed viewer
    would be said to explicitly support the <code id="navigating-across-documents:application/atom+xml"><a href="#application/atom+xml">application/atom+xml</a></code> MIME type), or one for
    which the user agent has a dedicated handler (e.g. one registered using <code id="navigating-across-documents:dom-navigator-registercontenthandler"><a href="/breakup/specs/browser-dom/#dom-navigator-registercontenthandler">registerContentHandler()</a></code>).</p>

    <p><dfn id="set-the-document's-address">Setting the document's address</dfn>: If there is no
    <dfn id="override-url">override URL</dfn>, then any <code id="navigating-across-documents:document-4"><a href="/breakup/specs/browser-dom/#document">Document</a></code> created by these steps must have its
    <a href="https://dom.spec.whatwg.org/#concept-document-url" id="navigating-across-documents:the-document's-address-4" data-x-internal="the-document's-address">address</a> set to the <a href="/breakup/specs/core-algorithms/#url" id="navigating-across-documents:url-10">URL</a> that was
    originally to be <a href="/breakup/specs/core-algorithms/#fetch" id="navigating-across-documents:fetch-9">fetched</a>, ignoring any other data that was used to
    obtain the resource (e.g. the entity body in the case of a POST submission is not part of
    <a id="navigating-across-documents:the-document's-address-5" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">the document's address</a>, nor is the URL of the fallback resource in the case of the
    original load having failed and that URL having been found to match a <a href="/breakup/specs/appcache/#concept-appcache-fallback-ns" id="navigating-across-documents:concept-appcache-fallback-ns-2">fallback namespace</a>). However, if there <em>is</em>
    an <a href="/breakup/specs/browsing/#override-url" id="navigating-across-documents:override-url-2">override URL</a>, then any <code id="navigating-across-documents:document-5"><a href="/breakup/specs/browser-dom/#document">Document</a></code> created by these steps must have
    its <a href="https://dom.spec.whatwg.org/#concept-document-url" id="navigating-across-documents:the-document's-address-6" data-x-internal="the-document's-address">address</a> set to that <a href="/breakup/specs/core-algorithms/#url" id="navigating-across-documents:url-11">URL</a>
    instead.</p>

    <p class="note">An <a href="/breakup/specs/browsing/#override-url" id="navigating-across-documents:override-url-3">override URL</a> is set when <a href="/breakup/specs/browsing/#javascript-protocol" id="navigating-across-documents:javascript-protocol-3">dereferencing a <code>javascript:</code> URL</a> and when
    performing <a href="/breakup/specs/browser-dom/#an-overridden-reload" id="navigating-across-documents:an-overridden-reload">an overridden reload</a>.</p>

    <p><dfn id="initialise-the-document-object">Initialising a new <code>Document</code>
    object</dfn>: when a <code id="navigating-across-documents:document-6"><a href="/breakup/specs/browser-dom/#document">Document</a></code> is created as part of the above steps, the user agent
    will be required to additionally run the following algorithm after creating the new object:</p>

    <ol><li><p>Create a new <code id="navigating-across-documents:window-3"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object, and associate it with the
     <code id="navigating-across-documents:document-7"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, with one exception: if the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-26">browsing context</a>'s only entry in
     its <a href="/breakup/specs/browser-dom/#session-history" id="navigating-across-documents:session-history">session history</a> is the <code id="navigating-across-documents:about:blank"><a href="/breakup/specs/core-algorithms/#about:blank">about:blank</a></code> <code id="navigating-across-documents:document-8"><a href="/breakup/specs/browser-dom/#document">Document</a></code> that was
     added when the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-27">browsing context</a> was created, and navigation is occurring with
     <a href="/breakup/specs/browsing/#replacement-enabled" id="navigating-across-documents:replacement-enabled">replacement enabled</a>, and that <code id="navigating-across-documents:document-9"><a href="/breakup/specs/browser-dom/#document">Document</a></code> has the <a href="/breakup/specs/browser-dom/#same-origin" id="navigating-across-documents:same-origin-8">same
     origin</a> as the new <code id="navigating-across-documents:document-10"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, then use the <code id="navigating-across-documents:window-4"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object of that
     <code id="navigating-across-documents:document-11"><a href="/breakup/specs/browser-dom/#document">Document</a></code> instead, and change the <code id="navigating-across-documents:dom-document-2"><a href="/breakup/specs/browser-dom/#dom-document-2">document</a></code>
     attribute of the <code id="navigating-across-documents:window-5"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object to point to the new <code id="navigating-across-documents:document-12"><a href="/breakup/specs/browser-dom/#document">Document</a></code>.</p>

     </li><li><p>Set <a href="/breakup/specs/browser-dom/#the-document's-referrer" id="navigating-across-documents:the-document's-referrer-3">the document's referrer</a> to the <i>address of the resource from which
     Request-URIs are obtained</i> as determined when the <a href="/breakup/specs/core-algorithms/#fetch" id="navigating-across-documents:fetch-10">fetch</a> algorithm obtained the
     resource, if that algorithm was used and determined such a value; otherwise, set it to the
     empty string.</p></li><li><p><a href="/breakup/specs/browser-dom/#implement-the-sandboxing" id="navigating-across-documents:implement-the-sandboxing">Implement the sandboxing</a> for the <code id="navigating-across-documents:document-13"><a href="/breakup/specs/browser-dom/#document">Document</a></code>.</p></li><li id="fullscreen-logic">

      <p>If the <a href="/breakup/specs/browser-dom/#active-sandboxing-flag-set" id="navigating-across-documents:active-sandboxing-flag-set">active sandboxing flag set</a> of the <code id="navigating-across-documents:document-14"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s
      <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-28">browsing context</a> or any of its <a href="/breakup/specs/browser-dom/#ancestor-browsing-context" id="navigating-across-documents:ancestor-browsing-context-2">ancestor
      browsing contexts</a> (if any) have the <a href="/breakup/specs/browser-dom/#sandboxed-fullscreen-browsing-context-flag" id="navigating-across-documents:sandboxed-fullscreen-browsing-context-flag">sandboxed fullscreen browsing context
      flag</a> set, then skip this step.</p>

      <p>If the <code id="navigating-across-documents:document-15"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-29">browsing context</a> has a <a href="/breakup/specs/browser-dom/#browsing-context-container" id="navigating-across-documents:browsing-context-container-2">browsing context
      container</a> and either it is not an <code id="navigating-across-documents:the-iframe-element-4"><a href="#the-iframe-element">iframe</a></code> element, or it does not have the
      <code id="navigating-across-documents:attr-iframe-allowfullscreen"><a href="#attr-iframe-allowfullscreen">allowfullscreen</a></code> attribute specified, or its
      <code id="navigating-across-documents:document-16"><a href="/breakup/specs/browser-dom/#document">Document</a></code> does not have the <a href="/breakup/specs/core-algorithms/#fullscreen-enabled-flag" id="navigating-across-documents:fullscreen-enabled-flag">fullscreen enabled flag</a> set, then also
      skip this step.</p>

      <p>Otherwise, set the <code id="navigating-across-documents:document-17"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/core-algorithms/#fullscreen-enabled-flag" id="navigating-across-documents:fullscreen-enabled-flag-2">fullscreen enabled flag</a>.</p>

    </li></ol>

   </li><li id="navigate-non-Document">

    <p><i>Non-document content</i>: If, given <var>type</var>, the new resource is to be
    handled by displaying some sort of inline content, e.g. a native rendering of the content, an
    error message because the specified type is not supported, or an inline prompt to allow the user
    to select <a href="/breakup/specs/browser-dom/#dom-navigator-registercontenthandler" id="navigating-across-documents:dom-navigator-registercontenthandler-2">a registered handler</a> for
    the given type, then <a href="/breakup/specs/browsing/#read-ua-inline" id="navigating-across-documents:read-ua-inline-2">display the inline content</a>, and
    then abort these steps.</p>

    <p class="note">In the case of a registered handler being used, the algorithm will be reinvoked
    with a new URL to handle the request.</p>

   </li><li><p>Otherwise, the document's <var>type</var> is such that the resource will not
   affect the browsing context, e.g. because the resource is to be handed to an external application
   or because it is an unknown type that will be processed <a href="/breakup/specs/html-linking/#as-a-download" id="navigating-across-documents:as-a-download-2">as a download</a>. <a href="/breakup/specs/browsing/#hand-off-to-external-software" id="navigating-across-documents:hand-off-to-external-software-2">Process the resource appropriately</a>.</p>

  </li></ol>

  <p>When a resource is handled by <dfn id="hand-off-to-external-software">passing its URL or
  data to an external software package</dfn> separate from the user agent (e.g. handing a <code id="navigating-across-documents:mailto-protocol"><a data-x-internal="mailto-protocol" href="http://tools.ietf.org/html/rfc6068#section-2">mailto:</a></code> URL to a mail client, or a Word document to a word
  processor), user agents should attempt to mitigate the risk that this is an attempt to exploit the
  target software, e.g. by prompting the user to confirm that the <a href="/breakup/specs/browsing/#source-browsing-context" id="navigating-across-documents:source-browsing-context-7">source browsing
  context</a>'s <a href="/breakup/specs/browser-dom/#active-document" id="navigating-across-documents:active-document-10">active document</a>'s <a href="/breakup/specs/browser-dom/#origin-2" id="navigating-across-documents:origin-2-6">origin</a> is to be allowed to invoke the
  specified software. In particular, if the <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-15">navigate</a> algorithm, when it was invoked,
  was not <a href="/breakup/specs/browser-dom/#allowed-to-show-a-popup" id="navigating-across-documents:allowed-to-show-a-popup">allowed to show a popup</a>, the user agent should not invoke the external
  software package without prior user confirmation.</p>

  <p class="example">For example, there could be a vulnerability in the target software's URL
  handler which a hostile page would attempt to exploit by tricking a user into clicking a link.</p>

  <hr>

  <p>Some of the sections below, to which the above algorithm defers in certain cases, require the
  user agent to <dfn id="update-the-session-history-with-the-new-page">update the session history with the new page</dfn>. When a user agent is
  required to do this, it must <a href="/breakup/specs/browser-dom/#queue-a-task" id="navigating-across-documents:queue-a-task-2">queue a task</a> (associated with the <code id="navigating-across-documents:document-18"><a href="/breakup/specs/browser-dom/#document">Document</a></code>
  object of the <a href="/breakup/specs/browser-dom/#current-entry" id="navigating-across-documents:current-entry">current entry</a>, not the new one) to run the following steps:</p>

  <ol><li>

    

    <p><a href="/breakup/specs/browsing/#unload-a-document" id="navigating-across-documents:unload-a-document-4">Unload</a> the <code id="navigating-across-documents:document-19"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object of the
    <a href="/breakup/specs/browser-dom/#current-entry" id="navigating-across-documents:current-entry-2">current entry</a>, with the <var>recycle</var> parameter set to false.</p>

    <p>If this instance of the <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-16">navigation</a> algorithm is canceled while
    this step is running the <a href="/breakup/specs/browsing/#unload-a-document" id="navigating-across-documents:unload-a-document-5">unload a document</a> algorithm, then the <a href="/breakup/specs/browsing/#unload-a-document" id="navigating-across-documents:unload-a-document-6">unload a
    document</a> algorithm must be allowed to run to completion, but this instance of the <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-17">navigation</a> algorithm must not run beyond this step. (In particular, for
    instance, the cancelation of this algorithm does not abort any event dispatch or script
    execution occurring as part of unloading the document or its descendants.)</p>

   </li><li>

    <dl><dt>If the navigation was initiated for <dfn id="entry-update">entry update</dfn> of an entry</dt><dd>

      <ol><li><p>Replace the <code id="navigating-across-documents:document-20"><a href="/breakup/specs/browser-dom/#document">Document</a></code> of the entry being updated, and any other entries
       that referenced the same document as that entry, with the new <code id="navigating-across-documents:document-21"><a href="/breakup/specs/browser-dom/#document">Document</a></code>.</p></li><li><p><a href="/breakup/specs/browsing/#traverse-the-history" id="navigating-across-documents:traverse-the-history">Traverse the history</a> to the new entry.</p></li></ol>

      <p class="note">This can only happen if the entry being updated is not the <a href="/breakup/specs/browser-dom/#current-entry" id="navigating-across-documents:current-entry-3">current
      entry</a>, and can never happen with <a href="/breakup/specs/browsing/#replacement-enabled" id="navigating-across-documents:replacement-enabled-2">replacement enabled</a>. (It happens when the
      user tried to traverse to a session history entry that no longer had a <code id="navigating-across-documents:document-22"><a href="/breakup/specs/browser-dom/#document">Document</a></code>
      object.)</p>

     </dd><dt>Otherwise</dt><dd>

      <ol><li>

        <p>Remove all the entries in the <a href="/breakup/specs/browser-dom/#browsing-context" id="navigating-across-documents:browsing-context-30">browsing context</a>'s <a href="/breakup/specs/browser-dom/#session-history" id="navigating-across-documents:session-history-2">session
        history</a> after the <a href="/breakup/specs/browser-dom/#current-entry" id="navigating-across-documents:current-entry-4">current entry</a>. If the <a href="/breakup/specs/browser-dom/#current-entry" id="navigating-across-documents:current-entry-5">current entry</a> is
        the last entry in the session history, then no entries are removed.</p>

        <p class="note">This <a href="/breakup/specs/browser-dom/#history-notes">doesn't necessarily have to affect</a> the
        user agent's user interface.</p>

       </li><li><p>Append a new entry at the end of the <code id="navigating-across-documents:history-3"><a href="/breakup/specs/browser-dom/#history-3">History</a></code> object representing the new
       resource and its <code id="navigating-across-documents:document-23"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object and related state.</p></li><li><p><a href="/breakup/specs/browsing/#traverse-the-history" id="navigating-across-documents:traverse-the-history-2">Traverse the history</a> to the new entry. If the navigation was initiated
       with <a href="/breakup/specs/browsing/#replacement-enabled" id="navigating-across-documents:replacement-enabled-3">replacement enabled</a>, then the traversal must itself be initiated with
       <a href="/breakup/specs/browsing/#replacement-enabled" id="navigating-across-documents:replacement-enabled-4">replacement enabled</a>.</p>

       </li></ol>

     </dd></dl>

   </li><li><p>The <a href="/breakup/specs/browsing/#navigate" id="navigating-across-documents:navigate-18">navigation algorithm</a> has now <dfn id="concept-navigate-mature">matured</dfn>.</p></li><li><p><i>Fragment identifier loop</i>: <a href="/breakup/specs/browser-dom/#spin-the-event-loop" id="navigating-across-documents:spin-the-event-loop">Spin the event loop</a> for a user-agent-defined
   amount of time, as desired by the user agent implementor. (This is intended to allow the user
   agent to optimise the user experience in the face of performance concerns.)</p></li><li><p>If the <code id="navigating-across-documents:document-24"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object has no parser, or its parser has <a href="/breakup/specs/html-syntax/#stop-parsing" id="navigating-across-documents:stop-parsing">stopped parsing</a>, or the user agent has reason to believe the user is no longer
   interested in scrolling to the fragment identifier, then abort these steps.</p></li><li><p><a href="/breakup/specs/browsing/#scroll-to-the-fragment-identifier" id="navigating-across-documents:scroll-to-the-fragment-identifier">Scroll to the fragment identifier</a> given in <a id="navigating-across-documents:the-document's-address-7" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">the document's
   address</a>. If this fails to find <a href="/breakup/specs/browsing/#the-indicated-part-of-the-document" id="navigating-across-documents:the-indicated-part-of-the-document">an
   indicated part of the document</a>, then return to the <i>fragment identifier loop</i>
   step.</p></li></ol>

  <p>The <a href="/breakup/specs/browser-dom/#task-source" id="navigating-across-documents:task-source-2">task source</a> for this <a href="/breakup/specs/browser-dom/#concept-task" id="navigating-across-documents:concept-task-5">task</a> is the
  <a href="/breakup/specs/browser-dom/#networking-task-source" id="navigating-across-documents:networking-task-source">networking task source</a>.</p></section><section><h2><dfn>Page load processing model for HTML files</dfn></h2>

  <p>When an HTML document is to be loaded in a <a href="/breakup/specs/browser-dom/#browsing-context" id="read-html:browsing-context">browsing context</a>, the user agent must
  <a href="/breakup/specs/browser-dom/#queue-a-task" id="read-html:queue-a-task">queue a task</a> to create a <code id="read-html:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, mark it as being an <a href="/breakup/specs/core-algorithms/#html-documents" id="read-html:html-documents">HTML document</a>, set its <a href="/breakup/specs/core-algorithms/#concept-document-content-type" id="read-html:concept-document-content-type">content type</a> to "<code>text/html</code>",
  <a href="/breakup/specs/browsing/#initialise-the-document-object" id="read-html:initialise-the-document-object">initialise the <code>Document</code> object</a>, and finally create an <a href="/breakup/specs/html-syntax/#html-parser" id="read-html:html-parser">HTML
  parser</a> and associate it with the <code id="read-html:document-2"><a href="/breakup/specs/browser-dom/#document">Document</a></code>. Each <a href="/breakup/specs/browser-dom/#concept-task" id="read-html:concept-task">task</a> that the <a href="/breakup/specs/browser-dom/#networking-task-source" id="read-html:networking-task-source">networking task source</a> places on the
  <a href="/breakup/specs/browser-dom/#task-queue" id="read-html:task-queue">task queue</a> while the <a href="/breakup/specs/core-algorithms/#fetch" id="read-html:fetch">fetching algorithm</a> runs must then
  fill the parser's <a href="/breakup/specs/html-syntax/#the-input-byte-stream" id="read-html:the-input-byte-stream">input byte stream</a> with the fetched bytes and cause the <a href="/breakup/specs/html-syntax/#html-parser" id="read-html:html-parser-2">HTML
  parser</a> to perform the appropriate processing of the input stream.</p>

  <p class="note">The <a href="/breakup/specs/html-syntax/#the-input-byte-stream" id="read-html:the-input-byte-stream-2">input byte stream</a> converts bytes into characters for use in the
  <a href="/breakup/specs/html-syntax/#tokenization" id="read-html:tokenization">tokenizer</a>. This process relies, in part, on character encoding
  information found in the real <a href="/breakup/specs/core-algorithms/#content-type" id="read-html:content-type">Content-Type metadata</a> of the
  resource; the "sniffed type" is not used for this purpose.</p>

  

  <p>When no more bytes are available, the user agent must <a href="/breakup/specs/browser-dom/#queue-a-task" id="read-html:queue-a-task-2">queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code id="read-html:event-load"><a href="/breakup/specs/html/#event-load">load</a></code> event to be fired.</p>

  <p>After creating the <code id="read-html:document-3"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, but before any script execution, certainly
  before the parser <a href="/breakup/specs/html-syntax/#stop-parsing" id="read-html:stop-parsing">stops</a>, the user agent must <a href="/breakup/specs/browsing/#update-the-session-history-with-the-new-page" id="read-html:update-the-session-history-with-the-new-page">update the
  session history with the new page</a>.</p>

  <p class="note"><a href="/breakup/specs/appcache/#concept-appcache-init" id="read-html:concept-appcache-init">Application cache selection</a> happens <a href="/breakup/specs/html-syntax/#parser-appcache">in the HTML parser</a>.</p>

  <p>The <a href="/breakup/specs/browser-dom/#task-source" id="read-html:task-source">task source</a> for the two tasks mentioned in this section must be the
  <a href="/breakup/specs/browser-dom/#networking-task-source" id="read-html:networking-task-source-2">networking task source</a>.</p></section><section><h2><dfn>Page load processing model for XML files</dfn></h2>

  <p>When faced with displaying an XML file inline, user agents must follow the requirements defined
  in the XML and Namespaces in XML recommendations, RFC 7303, DOM, and other relevant specifications
  to create a <code id="read-xml:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object and a corresponding <a href="/breakup/specs/xhtml-syntax/#xml-parser" id="read-xml:xml-parser">XML parser</a>. [[!XML]] [[!XMLNS]] [[!RFC7303]] [[!DOM]]</p>

  <p class="note">At the time of writing, the XML specification community had not actually yet
  specified how XML and the DOM interact.</p> 

  <p>After the <code id="read-xml:document-2"><a href="/breakup/specs/browser-dom/#document">Document</a></code> is created, the user agent must <a href="/breakup/specs/browsing/#initialise-the-document-object" id="read-xml:initialise-the-document-object">initialise the
  <code>Document</code> object</a>.</p>

  <p>The actual HTTP headers and other metadata, not the headers as mutated or implied by the
  algorithms given in this specification, are the ones that must be used when determining the
  character encoding according to the rules given in the above specifications. Once the character
  encoding is established, the <a href="/breakup/specs/core-algorithms/#document's-character-encoding" id="read-xml:document's-character-encoding">document's character encoding</a> must be set to that
  character encoding.</p>

  <p>If the root element, as parsed according to the XML specifications cited above, is found to be
  an <code id="read-xml:the-html-element"><a href="/breakup/specs/html-structure/#the-html-element">html</a></code> element with an attribute <code id="read-xml:attr-html-manifest"><a href="/breakup/specs/html-structure/#attr-html-manifest">manifest</a></code>
  whose value is not the empty string, then, as soon as the element is <a href="/breakup/specs/core-algorithms/#insert-an-element-into-a-document" id="read-xml:insert-an-element-into-a-document">inserted into the document</a>, the user agent must <a href="/breakup/specs/core-algorithms/#resolve-a-url" id="read-xml:resolve-a-url">resolve</a> the value of that attribute relative to that element, and if
  that is successful, must apply the <a href="/breakup/specs/core-algorithms/#concept-url-serialiser" id="read-xml:concept-url-serialiser">URL serialiser</a>
  algorithm to the resulting <a href="/breakup/specs/core-algorithms/#parsed-url" id="read-xml:parsed-url">parsed URL</a> with the <i>exclude fragment flag</i> set to
  obtain <var>manifest URL</var>, and then run the <a href="/breakup/specs/appcache/#concept-appcache-init" id="read-xml:concept-appcache-init">application
  cache selection algorithm</a> with <var>manifest URL</var> as the manifest URL, passing in the
  newly-created <code id="read-xml:document-3"><a href="/breakup/specs/browser-dom/#document">Document</a></code>. Otherwise, if the attribute is absent, its value is the empty
  string, or resolving its value fails, then as soon as the root element is <a href="/breakup/specs/core-algorithms/#insert-an-element-into-a-document" id="read-xml:insert-an-element-into-a-document-2">inserted into the document</a>, the user agent must run the <a href="/breakup/specs/appcache/#concept-appcache-init" id="read-xml:concept-appcache-init-2">application cache selection algorithm</a> with no manifest, and
  passing in the <code id="read-xml:document-4"><a href="/breakup/specs/browser-dom/#document">Document</a></code>.</p>

  <p class="note">Because the processing of the <code id="read-xml:attr-html-manifest-2"><a href="/breakup/specs/html-structure/#attr-html-manifest">manifest</a></code>
  attribute happens only once the root element is parsed, any URLs referenced by processing
  instructions before the root element (such as <code>&lt;?xml-stylesheet?&gt;</code> PIs)
  will be fetched from the network and cannot be cached.</p>

  <p>User agents may examine the namespace of the root <code id="read-xml:element"><a href="/breakup/specs/core-algorithms/#element">Element</a></code> node of this
  <code id="read-xml:document-5"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object to perform namespace-based dispatch to alternative processing tools,
  e.g. determining that the content is actually a syndication feed and passing it to a feed handler.
  If such processing is to take place, abort the steps in this section, and jump to <a href="/breakup/specs/browsing/#navigate-non-Document">the next step</a> (labeled <i>non-document content</i>) in the
  <a href="/breakup/specs/browsing/#navigate" id="read-xml:navigate">navigate</a> steps above.</p>

  <p>Otherwise, then, with the newly created <code id="read-xml:document-6"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, the user agent must <a href="/breakup/specs/browsing/#update-the-session-history-with-the-new-page" id="read-xml:update-the-session-history-with-the-new-page">update
  the session history with the new page</a>. User agents may do this before the complete document
  has been parsed (thus achieving <i>incremental rendering</i>), and must do this before any scripts
  are to be executed.</p>

  <p>Error messages from the parse process (e.g. XML namespace well-formedness errors) may be
  reported inline by mutating the <code id="read-xml:document-7"><a href="/breakup/specs/browser-dom/#document">Document</a></code>.</p></section><section><h2><dfn>Page load processing model for text files</dfn></h2>

  <p>When a plain text document is to be loaded in a <a href="/breakup/specs/browser-dom/#browsing-context" id="read-text:browsing-context">browsing context</a>, the user agent
  must <a href="/breakup/specs/browser-dom/#queue-a-task" id="read-text:queue-a-task">queue a task</a> to create a <code id="read-text:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, mark it as being an <a href="/breakup/specs/core-algorithms/#html-documents" id="read-text:html-documents">HTML document</a>, set its <a href="/breakup/specs/core-algorithms/#concept-document-content-type" id="read-text:concept-document-content-type">content type</a> to "<code>text/plain</code>",
  <a href="/breakup/specs/browsing/#initialise-the-document-object" id="read-text:initialise-the-document-object">initialise the <code>Document</code> object</a>, create an <a href="/breakup/specs/html-syntax/#html-parser" id="read-text:html-parser">HTML parser</a>,
  associate it with the <code id="read-text:document-2"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, act as if the tokenizer had emitted a start tag token
  with the tag name "pre" followed by a single U+000A LINE FEED (LF) character, and switch the <a href="/breakup/specs/html-syntax/#html-parser" id="read-text:html-parser-2">HTML
  parser</a>'s tokenizer to the <a href="/breakup/specs/html-syntax/#plaintext-state" id="read-text:plaintext-state">PLAINTEXT state</a>. Each <a href="/breakup/specs/browser-dom/#concept-task" id="read-text:concept-task">task</a> that the <a href="/breakup/specs/browser-dom/#networking-task-source" id="read-text:networking-task-source">networking task source</a> places on the
  <a href="/breakup/specs/browser-dom/#task-queue" id="read-text:task-queue">task queue</a> while the <a href="/breakup/specs/core-algorithms/#fetch" id="read-text:fetch">fetching algorithm</a> runs must then
  fill the parser's <a href="/breakup/specs/html-syntax/#the-input-byte-stream" id="read-text:the-input-byte-stream">input byte stream</a> with the fetched bytes and cause the <a href="/breakup/specs/html-syntax/#html-parser" id="read-text:html-parser-3">HTML
  parser</a> to perform the appropriate processing of the input stream.</p>

  <p>The rules for how to convert the bytes of the plain text document into actual characters, and
  the rules for actually rendering the text to the user, are defined in RFC 2046, RFC 3676, and
  subsequent versions thereof. [[!RFC2046]] [[!RFC3676]]</p>

  <p>The <a href="/breakup/specs/core-algorithms/#document's-character-encoding" id="read-text:document's-character-encoding">document's character encoding</a> must be set to the character encoding used to
  decode the document.</p>

  <p>Upon creation of the <code id="read-text:document-3"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, the user agent must run the <a href="/breakup/specs/appcache/#concept-appcache-init" id="read-text:concept-appcache-init">application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id="read-text:document-4"><a href="/breakup/specs/browser-dom/#document">Document</a></code>.</p>

  

  <p>When no more bytes are available, the user agent must <a href="/breakup/specs/browser-dom/#queue-a-task" id="read-text:queue-a-task-2">queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code id="read-text:event-load"><a href="/breakup/specs/html/#event-load">load</a></code> event to be fired.</p>

  <p>After creating the <code id="read-text:document-5"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, but potentially before the page has finished
  parsing, the user agent must <a href="/breakup/specs/browsing/#update-the-session-history-with-the-new-page" id="read-text:update-the-session-history-with-the-new-page">update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id="read-text:the-head-element"><a href="/breakup/specs/html-structure/#the-head-element">head</a></code> element of the <code id="read-text:document-6"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, e.g.
  linking to a style sheet or a binding, providing script, giving the document a
  <code id="read-text:the-title-element"><a href="/breakup/specs/html-structure/#the-title-element">title</a></code>, etc.</p>

  <p class="note">In particular, if the user agent supports the <code>Format=Flowed</code>
  feature of RFC 3676 then the user agent would need to apply extra styling to cause the text to
  wrap correctly and to handle the quoting feature. This could be performed using, e.g., a
  binding or a CSS extension.</p>

  <p>The <a href="/breakup/specs/browser-dom/#task-source" id="read-text:task-source">task source</a> for the two tasks mentioned in this section must be the
  <a href="/breakup/specs/browser-dom/#networking-task-source" id="read-text:networking-task-source-2">networking task source</a>.</p></section><section><h2><dfn>Page load processing model for <code>multipart/x-mixed-replace</code> resources</dfn></h2>

  <p>When a resource with the type <code id="read-multipart-x-mixed-replace:multipart/x-mixed-replace"><a href="#multipart/x-mixed-replace">multipart/x-mixed-replace</a></code> is to be loaded in a
  <a href="/breakup/specs/browser-dom/#browsing-context" id="read-multipart-x-mixed-replace:browsing-context">browsing context</a>, the user agent must parse the resource using the rules for
  multipart types. [[!RFC2046]]</p>

  <p>For each body part obtained from the resource, the user agent must run a new instance of the
  <a href="/breakup/specs/browsing/#navigate" id="read-multipart-x-mixed-replace:navigate">navigate</a> algorithm, starting from the <i>resource handling</i> step, using the new
  body part as the resource being navigated, with <a href="/breakup/specs/browsing/#replacement-enabled" id="read-multipart-x-mixed-replace:replacement-enabled">replacement enabled</a> if a previous
  body part from the same resource resulted in a <code id="read-multipart-x-mixed-replace:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object being created and
  <a href="/breakup/specs/browsing/#initialise-the-document-object" id="read-multipart-x-mixed-replace:initialise-the-document-object">initialised</a>, and otherwise using the same
  setup as the <a href="/breakup/specs/browsing/#navigate" id="read-multipart-x-mixed-replace:navigate-2">navigate</a> attempt that caused this section to be invoked in the first
  place.</p>

  <p>For the purposes of algorithms processing these body parts as if they were complete stand-alone
  resources, the user agent must act as if there were no more bytes for those resources whenever the
  boundary following the body part is reached.</p>

  <p class="note">Thus, <code id="read-multipart-x-mixed-replace:event-load"><a href="/breakup/specs/html/#event-load">load</a></code> events (and for that matter <code id="read-multipart-x-mixed-replace:event-unload"><a href="/breakup/specs/html/#event-unload">unload</a></code> events) do fire for each body part loaded.</p></section><section><h2><dfn>Page load processing model for media</dfn></h2>

  <p>When an image, video, or audio resource is to be loaded in a <a href="/breakup/specs/browser-dom/#browsing-context" id="read-media:browsing-context">browsing context</a>, the
  user agent should create a <code id="read-media:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, mark it as being an <a href="/breakup/specs/core-algorithms/#html-documents" id="read-media:html-documents">HTML document</a>, set its <a href="/breakup/specs/core-algorithms/#concept-document-content-type" id="read-media:concept-document-content-type">content
  type</a> to the sniffed MIME type of the resource (<var>type</var> in the
  <a href="/breakup/specs/browsing/#navigate" id="read-media:navigate">navigate</a> algorithm), <a href="/breakup/specs/browsing/#initialise-the-document-object" id="read-media:initialise-the-document-object">initialise the <code>Document</code> object</a>, append
  an <code id="read-media:the-html-element"><a href="/breakup/specs/html-structure/#the-html-element">html</a></code> element to the <code id="read-media:document-2"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, append a <code id="read-media:the-head-element"><a href="/breakup/specs/html-structure/#the-head-element">head</a></code> element and
  a <code id="read-media:the-body-element"><a href="/breakup/specs/html-structure/#the-body-element">body</a></code> element to the <code id="read-media:the-html-element-2"><a href="/breakup/specs/html-structure/#the-html-element">html</a></code> element, append an element <var>host element</var> for the media, as described below, to the <code id="read-media:the-body-element-2"><a href="/breakup/specs/html-structure/#the-body-element">body</a></code> element,
  and set the appropriate attribute of the element <var>host element</var>, as described
  below, to the address of the image, video, or audio resource.</p>

  <p>The element <var>host element</var> to create for the media is the element given in
  the table below in the second cell of the row whose first cell describes the media. The
  appropriate attribute to set is the one given by the third cell in that same row.</p>

  <table><thead><tr><th> Type of media
         </th><th> Element for the media
         </th><th> Appropriate attribute
    </th></tr><tr><td> Image
         </td><td> <code id="read-media:the-img-element"><a href="/breakup/specs/html-images/#the-img-element">img</a></code>
         </td><td> <code id="read-media:attr-img-src"><a href="/breakup/specs/html-images/#attr-img-src">src</a></code>
    </td></tr><tr><td> Video
         </td><td> <code id="read-media:the-video-element"><a href="#the-video-element">video</a></code>
         </td><td> <code id="read-media:attr-media-src"><a href="#attr-media-src">src</a></code>
    </td></tr><tr><td> Audio
         </td><td> <code id="read-media:the-audio-element"><a href="#the-audio-element">audio</a></code>
         </td><td> <code id="read-media:attr-media-src-2"><a href="#attr-media-src">src</a></code>
  </td></tr></thead></table>

  

  <p>Then, the user agent must act as if it had <a href="/breakup/specs/html-syntax/#stop-parsing" id="read-media:stop-parsing">stopped
  parsing</a>.</p>

  <p>Upon creation of the <code id="read-media:document-3"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, the user agent must run the <a href="/breakup/specs/appcache/#concept-appcache-init" id="read-media:concept-appcache-init">application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id="read-media:document-4"><a href="/breakup/specs/browser-dom/#document">Document</a></code>.</p>

  <p>After creating the <code id="read-media:document-5"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href="/breakup/specs/browsing/#update-the-session-history-with-the-new-page" id="read-media:update-the-session-history-with-the-new-page">update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id="read-media:the-head-element-2"><a href="/breakup/specs/html-structure/#the-head-element">head</a></code> element of the <code id="read-media:document-6"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, or
  attributes to the element <var>host element</var>, e.g. to link to a style sheet or a
  binding, to provide a script, to give the document a <code id="read-media:the-title-element"><a href="/breakup/specs/html-structure/#the-title-element">title</a></code>, to make the media
  <a href="#attr-media-autoplay" id="read-media:attr-media-autoplay">autoplay</a>, etc.</p></section><section><h2><dfn>Page load processing model for content that uses plugins</dfn></h2>

  <p>When a resource that requires an external resource to be rendered is to be loaded in a
  <a href="/breakup/specs/browser-dom/#browsing-context" id="read-plugin:browsing-context">browsing context</a>, the user agent should create a <code id="read-plugin:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, mark
  it as being an <a href="/breakup/specs/core-algorithms/#html-documents" id="read-plugin:html-documents">HTML document</a> and mark it as being a
  <dfn id="plugin-document">plugin document</dfn>, set its <a href="/breakup/specs/core-algorithms/#concept-document-content-type" id="read-plugin:concept-document-content-type">content
  type</a> to the sniffed MIME type of the resource (<var>type</var> in the
  <a href="/breakup/specs/browsing/#navigate" id="read-plugin:navigate">navigate</a> algorithm), <a href="/breakup/specs/browsing/#initialise-the-document-object" id="read-plugin:initialise-the-document-object">initialise the <code>Document</code> object</a>, append
  an <code id="read-plugin:the-html-element"><a href="/breakup/specs/html-structure/#the-html-element">html</a></code> element to the <code id="read-plugin:document-2"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, append a <code id="read-plugin:the-head-element"><a href="/breakup/specs/html-structure/#the-head-element">head</a></code> element and
  a <code id="read-plugin:the-body-element"><a href="/breakup/specs/html-structure/#the-body-element">body</a></code> element to the <code id="read-plugin:the-html-element-2"><a href="/breakup/specs/html-structure/#the-html-element">html</a></code> element, append an <code id="read-plugin:the-embed-element"><a href="#the-embed-element">embed</a></code> to the
  <code id="read-plugin:the-body-element-2"><a href="/breakup/specs/html-structure/#the-body-element">body</a></code> element, and set the <code id="read-plugin:attr-embed-src"><a href="#attr-embed-src">src</a></code> attribute of the
  <code id="read-plugin:the-embed-element-2"><a href="#the-embed-element">embed</a></code> element to the address of the resource.</p>

  <p class="note">The term <a href="/breakup/specs/browsing/#plugin-document" id="read-plugin:plugin-document">plugin document</a> is used by the Content Security Policy
  specification as part of the mechanism that ensures <code id="read-plugin:the-iframe-element"><a href="#the-iframe-element">iframe</a></code>s can't be used to evade
  <code>plugin-types</code> directives. [[CSP]]</p>

  

  <p>Then, the user agent must act as if it had <a href="/breakup/specs/html-syntax/#stop-parsing" id="read-plugin:stop-parsing">stopped
  parsing</a>.</p>

  <p>Upon creation of the <code id="read-plugin:document-3"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, the user agent must run the <a href="/breakup/specs/appcache/#concept-appcache-init" id="read-plugin:concept-appcache-init">application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id="read-plugin:document-4"><a href="/breakup/specs/browser-dom/#document">Document</a></code>.</p>

  <p>After creating the <code id="read-plugin:document-5"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href="/breakup/specs/browsing/#update-the-session-history-with-the-new-page" id="read-plugin:update-the-session-history-with-the-new-page">update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id="read-plugin:the-head-element-2"><a href="/breakup/specs/html-structure/#the-head-element">head</a></code> element of the <code id="read-plugin:document-6"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, or
  attributes to the <code id="read-plugin:the-embed-element-3"><a href="#the-embed-element">embed</a></code> element, e.g. to link to a style sheet or a binding, or
  to give the document a <code id="read-plugin:the-title-element"><a href="/breakup/specs/html-structure/#the-title-element">title</a></code>.</p>

  <p id="sandboxPluginNavigate" class="note">If the <code id="read-plugin:document-7"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browser-dom/#active-sandboxing-flag-set" id="read-plugin:active-sandboxing-flag-set">active sandboxing
  flag set</a> has its <a href="/breakup/specs/browser-dom/#sandboxed-plugins-browsing-context-flag" id="read-plugin:sandboxed-plugins-browsing-context-flag">sandboxed plugins browsing context flag</a> set, the synthesized
  <code id="read-plugin:the-embed-element-4"><a href="#the-embed-element">embed</a></code> element will <a href="#sandboxPluginEmbed">fail to render the content</a> if
  the relevant <a href="/breakup/specs/core-algorithms/#plugin" id="read-plugin:plugin">plugin</a> cannot be <a href="/breakup/specs/core-algorithms/#concept-plugin-secure" id="read-plugin:concept-plugin-secure">secured</a>.</p></section><section><h2><dfn>Page load processing model for inline
  content that doesn't have a DOM</dfn></h2>

  <p>When the user agent is to display a user agent page inline in a <a href="/breakup/specs/browser-dom/#browsing-context" id="read-ua-inline:browsing-context">browsing context</a>,
  the user agent should create a <code id="read-ua-inline:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, mark it as being an <a href="/breakup/specs/core-algorithms/#html-documents" id="read-ua-inline:html-documents">HTML document</a>, set its <a href="/breakup/specs/core-algorithms/#concept-document-content-type" id="read-ua-inline:concept-document-content-type">content type</a> to "<code>text/html</code>",
  <a href="/breakup/specs/browsing/#initialise-the-document-object" id="read-ua-inline:initialise-the-document-object">initialise the <code>Document</code> object</a>, and then either associate that
  <code id="read-ua-inline:document-2"><a href="/breakup/specs/browser-dom/#document">Document</a></code> with a custom rendering that is not rendered using the normal
  <code id="read-ua-inline:document-3"><a href="/breakup/specs/browser-dom/#document">Document</a></code> rendering rules, or mutate that <code id="read-ua-inline:document-4"><a href="/breakup/specs/browser-dom/#document">Document</a></code> until it represents
  the content the user agent wants to render.</p>

  

  <p>Once the page has been set up, the user agent must act as if it had <a href="/breakup/specs/html-syntax/#stop-parsing" id="read-ua-inline:stop-parsing">stopped parsing</a>.</p>

  <p>Upon creation of the <code id="read-ua-inline:document-5"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, the user agent must run the <a href="/breakup/specs/appcache/#concept-appcache-init" id="read-ua-inline:concept-appcache-init">application cache selection algorithm</a> with no manifest,
  passing in the newly-created <code id="read-ua-inline:document-6"><a href="/breakup/specs/browser-dom/#document">Document</a></code>.</p>

  <p>After creating the <code id="read-ua-inline:document-7"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, but potentially before the page has been
  completely set up, the user agent must <a href="/breakup/specs/browsing/#update-the-session-history-with-the-new-page" id="read-ua-inline:update-the-session-history-with-the-new-page">update the session history with the new
  page</a>.</p></section><section><h2><dfn>Navigating to a fragment identifier</dfn></h2>

  <p>When a user agent is supposed to navigate to a fragment identifier, then the user agent must
  run the following steps:</p>

  <ol><li>

    <p>Remove all the entries in the <a href="/breakup/specs/browser-dom/#browsing-context" id="scroll-to-fragid:browsing-context">browsing context</a>'s <a href="/breakup/specs/browser-dom/#session-history" id="scroll-to-fragid:session-history">session history</a>
    after the <a href="/breakup/specs/browser-dom/#current-entry" id="scroll-to-fragid:current-entry">current entry</a>. If the <a href="/breakup/specs/browser-dom/#current-entry" id="scroll-to-fragid:current-entry-2">current entry</a> is the last entry in the
    session history, then no entries are removed.</p>

    <p class="note">This <a href="/breakup/specs/browser-dom/#history-notes">doesn't necessarily have to affect</a> the user
    agent's user interface.</p>

   </li><li><p>Remove any <a href="/breakup/specs/browser-dom/#concept-task" id="scroll-to-fragid:concept-task">tasks</a> queued by the <a href="/breakup/specs/browser-dom/#history-traversal-task-source" id="scroll-to-fragid:history-traversal-task-source">history traversal
   task source</a> that are associated with any <code id="scroll-to-fragid:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code> objects in the
   <a href="/breakup/specs/browser-dom/#top-level-browsing-context" id="scroll-to-fragid:top-level-browsing-context">top-level browsing context</a>'s <a href="/breakup/specs/browser-dom/#document-family" id="scroll-to-fragid:document-family">document family</a>.</p></li><li><p>Append a new entry at the end of the <code id="scroll-to-fragid:history-3"><a href="/breakup/specs/browser-dom/#history-3">History</a></code> object representing the new
   resource and its <code id="scroll-to-fragid:document-2"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object and related state. Its <a href="/breakup/specs/core-algorithms/#url" id="scroll-to-fragid:url">URL</a> must be set
   to the address to which the user agent was <a href="/breakup/specs/browsing/#navigate" id="scroll-to-fragid:navigate">navigating</a>. The title
   must be left unset.</p></li><li><p><a href="/breakup/specs/browsing/#traverse-the-history" id="scroll-to-fragid:traverse-the-history">Traverse the history</a> to the new entry, with the <i>non-blocking events</i> flag
   set. This will <a href="/breakup/specs/browsing/#scroll-to-the-fragment-identifier" id="scroll-to-fragid:scroll-to-the-fragment-identifier">scroll to the fragment
   identifier</a> given in what is now <a id="scroll-to-fragid:the-document's-address" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">the document's address</a>.</p></li></ol>

  <p class="note">If the scrolling fails because the relevant <a href="/breakup/specs/core-algorithms/#concept-id" id="scroll-to-fragid:concept-id">ID</a> has
  not yet been parsed, then the original <a href="/breakup/specs/browsing/#navigate" id="scroll-to-fragid:navigate-2">navigation</a> algorithm will
  take care of the scrolling instead, as the last few steps of its <a href="/breakup/specs/browsing/#update-the-session-history-with-the-new-page" id="scroll-to-fragid:update-the-session-history-with-the-new-page">update the session history
  with the new page</a> algorithm.</p>

  <hr>

  <p>When the user agent is required to <dfn id="scroll-to-the-fragment-identifier">scroll to the fragment identifier</dfn> and <a href="/breakup/specs/browsing/#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document">the
  indicated part of the document</a>, if any, is <a href="/breakup/specs/rendering-html/#being-rendered" id="scroll-to-fragid:being-rendered">being rendered</a>, the user agent must
  either change the scrolling position of the document using the following algorithm, or perform
  some other action such that <a href="/breakup/specs/browsing/#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-2">the indicated part of the document</a> is brought to the
  user's attention. If there is no indicated part, or if the indicated part is not <a href="/breakup/specs/rendering-html/#being-rendered" id="scroll-to-fragid:being-rendered-2">being
  rendered</a>, then the user agent must do nothing. The aforementioned algorithm is as
  follows:</p>

  <ol><li><p>Let <var>target</var> be <a href="/breakup/specs/browsing/#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-3">the indicated part of the
   document</a>, as defined below.</p></li><li><p>If <var>target</var> is the top of the document, then <a href="/breakup/specs/core-algorithms/#scroll-to-the-beginning-of-the-document" id="scroll-to-fragid:scroll-to-the-beginning-of-the-document">scroll to the
   beginning of the document</a> for the <code id="scroll-to-fragid:document-3"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, and abort these steps. [[!CSSOMVIEW]]</p></li><li><p>Use the <a href="/breakup/specs/core-algorithms/#scroll-an-element-into-view" id="scroll-to-fragid:scroll-an-element-into-view">scroll an element into view</a> algorithm to scroll <var>target</var> into view, with the <var>align to top flag</var> set. [[!CSSOMVIEW]]</p></li><li><p>Run the <a href="/breakup/specs/html-interacton-attr/#focusing-steps" id="scroll-to-fragid:focusing-steps">focusing steps</a> for that element, with the <code id="scroll-to-fragid:document-4"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s
   viewport as the <i>fallback target</i>.</p></li><li><p>Optionally, move the <a href="/breakup/specs/html-interacton-attr/#sequential-focus-navigation-starting-point" id="scroll-to-fragid:sequential-focus-navigation-starting-point">sequential focus navigation starting point</a> to
   <var>target</var>.</p>

  </li></ol>

  <p><dfn id="the-indicated-part-of-the-document">The indicated part of the document</dfn> is the one that the fragment identifier, if any,
  identifies. The semantics of the fragment identifier in terms of mapping it to a specific DOM Node
  is defined by the specification that defines the <a href="/breakup/specs/core-algorithms/#mime-type" id="scroll-to-fragid:mime-type">MIME type</a> used by the
  <code id="scroll-to-fragid:document-5"><a href="/breakup/specs/browser-dom/#document">Document</a></code> (for example, the processing of fragment identifiers for <a href="/breakup/specs/core-algorithms/#xml-mime-type" id="scroll-to-fragid:xml-mime-type">XML MIME types</a> is the responsibility of RFC7303). [[!RFC7303]]</p>

  <p>For HTML documents (and <a href="/breakup/specs/core-algorithms/#html-mime-type" id="scroll-to-fragid:html-mime-type">HTML MIME types</a>), the following
  processing model must be followed to determine what <a href="/breakup/specs/browsing/#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-4">the indicated part of the
  document</a> is.</p>

  <ol><li><p>Apply the <a href="/breakup/specs/core-algorithms/#url-parser" id="scroll-to-fragid:url-parser">URL parser</a> algorithm to the <a href="/breakup/specs/core-algorithms/#url" id="scroll-to-fragid:url-2">URL</a>, and let <var>fragid</var> be the <a href="/breakup/specs/core-algorithms/#concept-url-fragment" id="scroll-to-fragid:concept-url-fragment">fragment</a> component of the
   resulting <a href="/breakup/specs/core-algorithms/#parsed-url" id="scroll-to-fragid:parsed-url">parsed URL</a>.</p></li><li><p>If <var>fragid</var> is the empty string, then <a href="/breakup/specs/browsing/#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-5">the indicated part of the
   document</a> is the top of the document; stop the algorithm here.</p></li><li><p>Let <var>fragid bytes</var> be the result of <a href="/breakup/specs/core-algorithms/#percent-decode" id="scroll-to-fragid:percent-decode">percent-decoding</a> <var>fragid</var>.</p></li><li><p>Let <var>decoded fragid</var> be the result of applying the <a href="/breakup/specs/core-algorithms/#utf-8-decoder" id="scroll-to-fragid:utf-8-decoder">UTF-8
   decoder</a> algorithm to <var>fragid bytes</var>. If the <a href="/breakup/specs/core-algorithms/#utf-8-decoder" id="scroll-to-fragid:utf-8-decoder-2">UTF-8 decoder</a>
   emits a <a href="/breakup/specs/core-algorithms/#decoder-error" id="scroll-to-fragid:decoder-error">decoder error</a>, abort the decoder and instead jump to the step labeled <i>no
   decoded fragid</i>.</p></li><li><p>If there is an element in the DOM that has an <a href="/breakup/specs/core-algorithms/#concept-id" id="scroll-to-fragid:concept-id-2">ID</a> exactly
   equal to <var>decoded fragid</var>, then the first such element in <a href="/breakup/specs/core-algorithms/#tree-order" id="scroll-to-fragid:tree-order">tree order</a> is
   <a href="/breakup/specs/browsing/#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-6">the indicated part of the document</a>; stop the algorithm here.</p></li><li><p><i>No decoded fragid</i>: If there is an <code id="scroll-to-fragid:the-a-element"><a href="/breakup/specs/html-linking/#the-a-element">a</a></code> element in the DOM that has a <code id="scroll-to-fragid:attr-a-name"><a href="#attr-a-name">name</a></code> attribute whose value is exactly equal to <var>fragid</var> (<em>not</em> <var>decoded fragid</var>), then the first such
   element in <a href="/breakup/specs/core-algorithms/#tree-order" id="scroll-to-fragid:tree-order-2">tree order</a> is <a href="/breakup/specs/browsing/#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-7">the indicated part of the document</a>; stop the algorithm
   here.</p></li><li><p>If <var>fragid</var> is an <a href="/breakup/specs/core-algorithms/#ascii-case-insensitive" id="scroll-to-fragid:ascii-case-insensitive">ASCII case-insensitive</a> match for the
   string <code>top</code>, then <a href="/breakup/specs/browsing/#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-8">the indicated part of the document</a> is the top
   of the document; stop the algorithm here.</p></li><li><p>Otherwise, there is no <a href="/breakup/specs/browsing/#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-9">indicated part of
   the document</a>.</p></li></ol>

  <p>For the purposes of the interaction of HTML with Selectors' <dfn id="selector-target"><code>:target</code></dfn> pseudo-class, the <dfn id="target-element"><i>target element</i></dfn>
  is <a href="/breakup/specs/browsing/#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-10">the indicated part of the document</a>, if that is an element; otherwise there is no
  <i id="scroll-to-fragid:target-element"><a href="/breakup/specs/browsing/#target-element">target element</a></i>. [[!SELECTORS]]</p>

  <p>The <a href="/breakup/specs/browser-dom/#task-source" id="scroll-to-fragid:task-source">task source</a> for the task mentioned in this section must be the <a href="/breakup/specs/browser-dom/#dom-manipulation-task-source" id="scroll-to-fragid:dom-manipulation-task-source">DOM
  manipulation task source</a>.</p></section><section><h2>History traversal</h2> 

  

  <p>When a user agent is required to <dfn id="traverse-the-history">traverse the history</dfn> to a <var>specified
  entry</var>, optionally with <a href="/breakup/specs/browsing/#replacement-enabled" id="history-traversal:replacement-enabled">replacement enabled</a>, and optionally with the
  <i>non-blocking events</i> flag set, the user agent must act as follows.</p>

  <p class="note">This algorithm is not just invoked when <a href="/breakup/specs/browser-dom/#traverse-the-history-by-a-delta" id="history-traversal:traverse-the-history-by-a-delta">explicitly going back or forwards in the session history</a>  it is also invoked
  in other situations, for example when <a href="/breakup/specs/browsing/#navigate" id="history-traversal:navigate">navigating a browsing context</a>,
  as part of <a href="/breakup/specs/browsing/#update-the-session-history-with-the-new-page" id="history-traversal:update-the-session-history-with-the-new-page">updating the session history
  with the new page</a>.</p>

  <ol><li>

    <p>If there is no longer a <code id="history-traversal:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object for the entry in question,
    <a href="/breakup/specs/browsing/#navigate" id="history-traversal:navigate-2">navigate</a> the <a href="/breakup/specs/browser-dom/#browsing-context" id="history-traversal:browsing-context">browsing
    context</a> to the resource for that entry to perform an <a href="/breakup/specs/browsing/#entry-update" id="history-traversal:entry-update">entry update</a> of that
    entry, and abort these steps. The "<a href="/breakup/specs/browsing/#navigate" id="history-traversal:navigate-3">navigate</a>" algorithm reinvokes this "traverse"
    algorithm to complete the traversal, at which point there <em>is</em> a <code id="history-traversal:document-2"><a href="/breakup/specs/browser-dom/#document">Document</a></code>
    object and so this step gets skipped. The navigation must be done using the same <a href="/breakup/specs/browsing/#source-browsing-context" id="history-traversal:source-browsing-context">source
    browsing context</a> as was used the first time this entry was created. (This can never
    happen with <a href="/breakup/specs/browsing/#replacement-enabled" id="history-traversal:replacement-enabled-2">replacement enabled</a>.)</p>

    <p class="note">If the resource was obtained usign a non-idempotent action, for example a POST
    form submission, or if the resource is no longer available, for example because the computer is
    now offline and the page wasn't cached, navigating to it again might not be possible. In this
    case, the navigation will result in a different page than previously; for example, it might be
    an error message explaining the problem or offering to resubmit the form.</p>

   </li><li><p>If the <a href="/breakup/specs/browser-dom/#current-entry" id="history-traversal:current-entry">current entry</a>'s title was not set by the <code id="history-traversal:dom-history-pushstate"><a href="/breakup/specs/browser-dom/#dom-history-pushstate">pushState()</a></code> or <code id="history-traversal:dom-history-replacestate"><a href="/breakup/specs/browser-dom/#dom-history-replacestate">replaceState()</a></code> methods, then set its title to the value
   returned by the <code id="history-traversal:document.title"><a href="/breakup/specs/browser-dom/#document.title">document.title</a></code> IDL attribute.</p></li><li><p>If appropriate, update the <a href="/breakup/specs/browser-dom/#current-entry" id="history-traversal:current-entry-2">current entry</a> in the <a href="/breakup/specs/browser-dom/#browsing-context" id="history-traversal:browsing-context-2">browsing
   context</a>'s <code id="history-traversal:document-3"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object's <code id="history-traversal:history-3"><a href="/breakup/specs/browser-dom/#history-3">History</a></code> object to reflect any state
   that the user agent wishes to persist. The entry is then said to be <a href="/breakup/specs/browser-dom/#an-entry-with-persisted-user-state" id="history-traversal:an-entry-with-persisted-user-state">an entry with persisted
   user state</a>.</p></li><li><p>If the <var>specified entry</var> has a different <code id="history-traversal:document-4"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object
   than the <a href="/breakup/specs/browser-dom/#current-entry" id="history-traversal:current-entry-3">current entry</a>, then run the following substeps:</p>

    <ol><li><p>Remove any <a href="/breakup/specs/browser-dom/#concept-task" id="history-traversal:concept-task">tasks</a> queued by the <a href="/breakup/specs/browser-dom/#history-traversal-task-source" id="history-traversal:history-traversal-task-source">history traversal
     task source</a> that are associated with any <code id="history-traversal:document-5"><a href="/breakup/specs/browser-dom/#document">Document</a></code> objects in the
     <a href="/breakup/specs/browser-dom/#top-level-browsing-context" id="history-traversal:top-level-browsing-context">top-level browsing context</a>'s <a href="/breakup/specs/browser-dom/#document-family" id="history-traversal:document-family">document family</a>.</p></li><li>

      <p>If the <a href="/breakup/specs/browser-dom/#origin-2" id="history-traversal:origin-2">origin</a> of the <code id="history-traversal:document-6"><a href="/breakup/specs/browser-dom/#document">Document</a></code> of the <var>specified
      entry</var> is not the <a href="/breakup/specs/browser-dom/#same-origin" id="history-traversal:same-origin">same</a> as the <a href="/breakup/specs/browser-dom/#origin-2" id="history-traversal:origin-2-2">origin</a> of the
      <code id="history-traversal:document-7"><a href="/breakup/specs/browser-dom/#document">Document</a></code> of the <a href="/breakup/specs/browser-dom/#current-entry" id="history-traversal:current-entry-4">current entry</a>, then run the following
      sub-sub-steps:</p>

      <ol><li><p>The current <a href="/breakup/specs/browser-dom/#browsing-context-name" id="history-traversal:browsing-context-name">browsing context name</a> must be stored with all the entries in
       the history that are associated with <code id="history-traversal:document-8"><a href="/breakup/specs/browser-dom/#document">Document</a></code> objects with the <a href="/breakup/specs/browser-dom/#same-origin" id="history-traversal:same-origin-2">same
       origin</a> as the <a href="/breakup/specs/browser-dom/#active-document" id="history-traversal:active-document">active document</a> <em>and</em> that are contiguous with the
       <a href="/breakup/specs/browser-dom/#current-entry" id="history-traversal:current-entry-5">current entry</a>.</p></li><li id="resetBCName"><p>If the browsing context is a <a href="/breakup/specs/browser-dom/#top-level-browsing-context" id="history-traversal:top-level-browsing-context-2">top-level browsing context</a>,
       but not an <a href="/breakup/specs/browser-dom/#auxiliary-browsing-context" id="history-traversal:auxiliary-browsing-context">auxiliary browsing context</a>, then the browsing context's
       <a href="/breakup/specs/browser-dom/#browsing-context-name" id="history-traversal:browsing-context-name-2">browsing context name</a> must be unset.</p></li></ol>

     </li><li id="appcache-history-2"><p>Make the <var>specified entry</var>'s
     <code id="history-traversal:document-9"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object the <a href="/breakup/specs/browser-dom/#active-document" id="history-traversal:active-document-2">active document</a> of the <a href="/breakup/specs/browser-dom/#browsing-context" id="history-traversal:browsing-context-3">browsing
     context</a>.</p></li><li>

      <p>If the <var>specified entry</var> has a <a href="/breakup/specs/browser-dom/#browsing-context-name" id="history-traversal:browsing-context-name-3">browsing context name</a> stored
      with it, then run the following sub-sub-steps:</p>

      <ol><li><p>Set the browsing context's <a href="/breakup/specs/browser-dom/#browsing-context-name" id="history-traversal:browsing-context-name-4">browsing context name</a> to the name stored with
       the specified entry.</p></li><li><p>Clear any <a href="/breakup/specs/browser-dom/#browsing-context-name" id="history-traversal:browsing-context-name-5">browsing context names</a> stored
       with all entries in the history that are associated with <code id="history-traversal:document-10"><a href="/breakup/specs/browser-dom/#document">Document</a></code> objects with
       the <a href="/breakup/specs/browser-dom/#same-origin" id="history-traversal:same-origin-3">same origin</a> as the new <a href="/breakup/specs/browser-dom/#active-document" id="history-traversal:active-document-3">active document</a> and that are contiguous
       with the specified entry.</p></li></ol>

     </li><li id="history-autocomplete"><p>If the <var>specified entry</var>'s
     <code id="history-traversal:document-11"><a href="/breakup/specs/browser-dom/#document">Document</a></code> has any form controls whose <a href="/breakup/specs/html-forms/#autofill-field-name" id="history-traversal:autofill-field-name">autofill field name</a> is "<code id="history-traversal:attr-fe-autocomplete-off"><a href="/breakup/specs/html-forms/#attr-fe-autocomplete-off">off</a></code>", invoke the <a href="/breakup/specs/html-forms/#concept-form-reset-control" id="history-traversal:concept-form-reset-control">reset algorithm</a> of each of those elements.</p></li><li>

      <p>If the <a href="/breakup/specs/browser-dom/#current-document-readiness" id="history-traversal:current-document-readiness">current document readiness</a> of the <var>specified entry</var>'s
      <code id="history-traversal:document-12"><a href="/breakup/specs/browser-dom/#document">Document</a></code> is "<code>complete</code>", <a href="/breakup/specs/browser-dom/#queue-a-task" id="history-traversal:queue-a-task">queue a task</a> to run
      the following sub-sub-steps:</p>

      <ol><li><p>If the <code id="history-traversal:document-13"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browsing/#page-showing" id="history-traversal:page-showing">page showing</a> flag is true, then abort this
       task (i.e. don't fire the event below).</p></li><li><p>Set the <code id="history-traversal:document-14"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browsing/#page-showing" id="history-traversal:page-showing-2">page showing</a> flag to true.</p></li><li>

        <p>Run any <dfn id="session-history-document-visibility-change-steps">session history document visibility change steps</dfn> for <code id="history-traversal:document-15"><a href="/breakup/specs/browser-dom/#document">Document</a></code> that
        are defined by <a href="/breakup/specs/core-algorithms/#other-applicable-specifications" id="history-traversal:other-applicable-specifications">other applicable specifications</a>.</p>

        <p class="note">This is specifically intended for use by the Page Visibility specification. [[PAGEVIS]]</p>

       </li><li><p><a href="/breakup/specs/core-algorithms/#concept-event-fire" id="history-traversal:concept-event-fire">Fire</a> a <a href="/breakup/specs/core-algorithms/#concept-events-trusted" id="history-traversal:concept-events-trusted">trusted</a> event with the name <code id="history-traversal:event-pageshow"><a href="/breakup/specs/html/#event-pageshow">pageshow</a></code> at the <code id="history-traversal:window"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object of that
       <code id="history-traversal:document-16"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, with <i id="history-traversal:concept-event-target-override"><a href="/breakup/specs/core-algorithms/#concept-event-target-override">target override</a></i> set to the <code id="history-traversal:document-17"><a href="/breakup/specs/browser-dom/#document">Document</a></code>
       object,
       using the <code id="history-traversal:pagetransitionevent"><a href="/breakup/specs/browsing/#pagetransitionevent">PageTransitionEvent</a></code> interface, with the <code id="history-traversal:dom-pagetransitionevent-persisted"><a href="/breakup/specs/browsing/#dom-pagetransitionevent-persisted">persisted</a></code> attribute initialised to true.
       This event must not bubble, must not be cancelable, and has no default action.</p></li></ol>

      

     </li></ol>

   </li><li><p>Set <a id="history-traversal:the-document's-address" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">the document's address</a> to the URL of the <var>specified
   entry</var>.</p></li><li><p>If the <var>specified entry</var> has a URL whose fragment identifier differs
   from that of the <a href="/breakup/specs/browser-dom/#current-entry" id="history-traversal:current-entry-6">current entry</a>'s when compared in a <a href="/breakup/specs/core-algorithms/#case-sensitive" id="history-traversal:case-sensitive">case-sensitive</a>
   manner, and the two share the same <code id="history-traversal:document-18"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object, then let <var>hash
   changed</var> be true, and let <var>old URL</var> be the URL of the <a href="/breakup/specs/browser-dom/#current-entry" id="history-traversal:current-entry-7">current
   entry</a> and <var>new URL</var> be the URL of the <var>specified
   entry</var>. Otherwise, let <var>hash changed</var> be false.</p></li><li><p>If the traversal was initiated with <dfn id="replacement-enabled">replacement enabled</dfn>, remove the entry
   immediately before the <var>specified entry</var> in the session history.</p>

   </li><li><p>If the <var>specified entry</var> is not <a href="/breakup/specs/browser-dom/#an-entry-with-persisted-user-state" id="history-traversal:an-entry-with-persisted-user-state-2">an entry with persisted user
   state</a>, but its URL has a fragment identifier, <a href="/breakup/specs/browsing/#scroll-to-the-fragment-identifier" id="history-traversal:scroll-to-the-fragment-identifier">scroll to the fragment
   identifier</a>.</p></li><li>

    <p>If the entry is <a href="/breakup/specs/browser-dom/#an-entry-with-persisted-user-state" id="history-traversal:an-entry-with-persisted-user-state-3">an entry with persisted user state</a>, the user agent may update
    aspects of the document and its rendering, for instance the scroll position or values of form
    fields, that it had previously recorded.</p>

    
    <p class="note">This can even include updating the <code id="history-traversal:the-dir-attribute"><a href="/breakup/specs/html-attributes/#the-dir-attribute">dir</a></code> attribute
    of <code id="history-traversal:the-textarea-element"><a href="/breakup/specs/html-forms/#the-textarea-element">textarea</a></code> elements or <code id="history-traversal:the-input-element"><a href="/breakup/specs/html-forms/#the-input-element">input</a></code> elements whose <code id="history-traversal:attr-input-type"><a href="/breakup/specs/html-forms/#attr-input-type">type</a></code> attribute is in either the <a href="/breakup/specs/html-forms/#text-(type=text)-state-and-search-state-(type=search)" id="history-traversal:text-(type=text)-state-and-search-state-(type=search)">Text</a> state or the <a href="/breakup/specs/html-forms/#text-(type=text)-state-and-search-state-(type=search)" id="history-traversal:text-(type=text)-state-and-search-state-(type=search)-2">Search</a> state, if the persisted state includes the
    directionality of user input in such controls.</p>

   </li><li><p>If the entry is a <a href="/breakup/specs/browser-dom/#state-object" id="history-traversal:state-object">state object</a> entry, let <var>state</var> be a
   <a href="/breakup/specs/core-algorithms/#structured-clone" id="history-traversal:structured-clone">structured clone</a> of that state object. Otherwise, let <var>state</var> be
   null.</p></li><li><p>Set <code id="history-traversal:dom-history-state"><a href="/breakup/specs/browser-dom/#dom-history-state">history.state</a></code> to <var>state</var>.</p></li><li><p>Let <var>state changed</var> be true if the <code id="history-traversal:document-19"><a href="/breakup/specs/browser-dom/#document">Document</a></code> of the <var>specified entry</var> has a <a href="/breakup/specs/browser-dom/#latest-entry" id="history-traversal:latest-entry">latest entry</a>, and that entry is not the <var>specified entry</var>; otherwise let it be false.</p>

   </li><li><p>Let the <a href="/breakup/specs/browser-dom/#latest-entry" id="history-traversal:latest-entry-2">latest entry</a> of the <code id="history-traversal:document-20"><a href="/breakup/specs/browser-dom/#document">Document</a></code> of the <var>specified entry</var> be the <var>specified entry</var>.</p></li><li>

    <p>If the <i>non-blocking events</i> flag is not set, then run the following steps
    <a href="/breakup/specs/core-algorithms/#immediately" id="history-traversal:immediately">immediately</a>. Otherwise, the <i>non-blocking events</i> flag is set; <a href="/breakup/specs/browser-dom/#queue-a-task" id="history-traversal:queue-a-task-2">queue a task</a>
    to run the following substeps instead.</p>

    <ol><li><p>If <var>state changed</var> is true, <a href="/breakup/specs/core-algorithms/#concept-event-fire" id="history-traversal:concept-event-fire-2">fire</a> a <a href="/breakup/specs/core-algorithms/#concept-events-trusted" id="history-traversal:concept-events-trusted-2">trusted</a>
     event with the name <code id="history-traversal:event-popstate"><a href="/breakup/specs/html/#event-popstate">popstate</a></code> at the <code id="history-traversal:window-2"><a href="/breakup/specs/browser-dom/#window">Window</a></code>
     object of the <code id="history-traversal:document-21"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, using the <code id="history-traversal:popstateevent"><a href="/breakup/specs/browsing/#popstateevent">PopStateEvent</a></code> interface, with the
     <code id="history-traversal:dom-popstateevent-state"><a href="/breakup/specs/browsing/#dom-popstateevent-state">state</a></code> attribute initialised to the value of <var>state</var>. This event must bubble but not be cancelable and has no default
     action.</p></li><li><p>If <var>hash changed</var> is true, then <a href="/breakup/specs/core-algorithms/#concept-event-fire" id="history-traversal:concept-event-fire-3">fire</a> a <a href="/breakup/specs/core-algorithms/#concept-events-trusted" id="history-traversal:concept-events-trusted-3">trusted</a>
     event with the name <code id="history-traversal:event-hashchange"><a href="/breakup/specs/html/#event-hashchange">hashchange</a></code> at the <a href="/breakup/specs/browser-dom/#browsing-context" id="history-traversal:browsing-context-4">browsing
     context</a>'s <code id="history-traversal:window-3"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object, using the <code id="history-traversal:hashchangeevent"><a href="/breakup/specs/browsing/#hashchangeevent">HashChangeEvent</a></code> interface,
     with the <code id="history-traversal:dom-hashchangeevent-oldurl"><a href="/breakup/specs/browsing/#dom-hashchangeevent-oldurl">oldURL</a></code> attribute initialised to <var>old URL</var> and the <code id="history-traversal:dom-hashchangeevent-newurl"><a href="/breakup/specs/browsing/#dom-hashchangeevent-newurl">newURL</a></code> attribute
     initialised to <var>new URL</var>. This event must bubble but not be cancelable and
     has no default action.</p></li></ol>

   </li><li><p>The <a href="/breakup/specs/browser-dom/#current-entry" id="history-traversal:current-entry-8">current entry</a> is now the <var>specified entry</var>.</p></li></ol>

  <p>The <a href="/breakup/specs/browser-dom/#task-source" id="history-traversal:task-source">task source</a> for the tasks mentioned above is the <a href="/breakup/specs/browser-dom/#dom-manipulation-task-source" id="history-traversal:dom-manipulation-task-source">DOM manipulation task
  source</a>.</p>

  


  <section><h2>The <code id="the-popstateevent-interface:popstateevent"><a href="/breakup/specs/browsing/#popstateevent">PopStateEvent</a></code> interface</h2>

  <pre class="idl">[Constructor(DOMString type, optional <a href="/breakup/specs/browsing/#popstateeventinit" id="the-popstateevent-interface:popstateeventinit">PopStateEventInit</a> eventInitDict), Exposed=(Window,Worker)]
interface <dfn id="popstateevent">PopStateEvent</dfn> : <a href="/breakup/specs/core-algorithms/#event" id="the-popstateevent-interface:event">Event</a> {
  readonly attribute any <a href="/breakup/specs/browsing/#dom-popstateevent-state" id="the-popstateevent-interface:dom-popstateevent-state">state</a>;
};

dictionary <dfn id="popstateeventinit">PopStateEventInit</dfn> : <a href="/breakup/specs/core-algorithms/#eventinit" id="the-popstateevent-interface:eventinit">EventInit</a> {
  any state;
};</pre>

  <dl class="domintro"><dt><var>event</var> . <code id="the-popstateevent-interface:dom-popstateevent-state-2"><a href="/breakup/specs/browsing/#dom-popstateevent-state">state</a></code></dt><dd>

    <p>Returns a copy of the information that was provided to <code id="the-popstateevent-interface:dom-history-pushstate"><a href="/breakup/specs/browser-dom/#dom-history-pushstate">pushState()</a></code> or <code id="the-popstateevent-interface:dom-history-replacestate"><a href="/breakup/specs/browser-dom/#dom-history-replacestate">replaceState()</a></code>.</p>

   </dd></dl>

  

  <p>The <dfn id="dom-popstateevent-state"><code>state</code></dfn> attribute must return the
  value it was initialised to. When the object is created, this attribute must be initialised to
  null. It represents the context information for the event, or null, if the state represented is
  the initial state of the <code id="the-popstateevent-interface:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code>.</p></section>

  


  <section><h2>The <code id="the-hashchangeevent-interface:hashchangeevent"><a href="/breakup/specs/browsing/#hashchangeevent">HashChangeEvent</a></code> interface</h2>

  <pre class="idl">[Constructor(DOMString type, optional <a href="/breakup/specs/browsing/#hashchangeeventinit" id="the-hashchangeevent-interface:hashchangeeventinit">HashChangeEventInit</a> eventInitDict), Exposed=(Window,Worker)]
interface <dfn id="hashchangeevent">HashChangeEvent</dfn> : <a href="/breakup/specs/core-algorithms/#event" id="the-hashchangeevent-interface:event">Event</a> {
  readonly attribute DOMString <a href="/breakup/specs/browsing/#dom-hashchangeevent-oldurl" id="the-hashchangeevent-interface:dom-hashchangeevent-oldurl">oldURL</a>;
  readonly attribute DOMString <a href="/breakup/specs/browsing/#dom-hashchangeevent-newurl" id="the-hashchangeevent-interface:dom-hashchangeevent-newurl">newURL</a>;
};

dictionary <dfn id="hashchangeeventinit">HashChangeEventInit</dfn> : <a href="/breakup/specs/core-algorithms/#eventinit" id="the-hashchangeevent-interface:eventinit">EventInit</a> {
  DOMString oldURL;
  DOMString newURL;
};</pre>

  <dl class="domintro"><dt><var>event</var> . <code id="the-hashchangeevent-interface:dom-hashchangeevent-oldurl-2"><a href="/breakup/specs/browsing/#dom-hashchangeevent-oldurl">oldURL</a></code></dt><dd>

    <p>Returns the <a href="/breakup/specs/core-algorithms/#url" id="the-hashchangeevent-interface:url">URL</a> of the <a href="/breakup/specs/browser-dom/#session-history-entry" id="the-hashchangeevent-interface:session-history-entry">session history entry</a> that was previously
    current.</p>

   </dd><dt><var>event</var> . <code id="the-hashchangeevent-interface:dom-hashchangeevent-newurl-2"><a href="/breakup/specs/browsing/#dom-hashchangeevent-newurl">newURL</a></code></dt><dd>

    <p>Returns the <a href="/breakup/specs/core-algorithms/#url" id="the-hashchangeevent-interface:url-2">URL</a> of the <a href="/breakup/specs/browser-dom/#session-history-entry" id="the-hashchangeevent-interface:session-history-entry-2">session history entry</a> that is now
    current.</p>

   </dd></dl>

  

  <p>The <dfn id="dom-hashchangeevent-oldurl"><code>oldURL</code></dfn> attribute must return the
  value it was initialised to. When the object is created, this attribute must be initialised to
  null. It represents context information for the event, specifically the URL of the <a href="/breakup/specs/browser-dom/#session-history-entry" id="the-hashchangeevent-interface:session-history-entry-3">session
  history entry</a> that was traversed from.</p>

  <p>The <dfn id="dom-hashchangeevent-newurl"><code>newURL</code></dfn> attribute must return the
  value it was initialised to. When the object is created, this attribute must be initialised to
  null. It represents context information for the event, specifically the URL of the <a href="/breakup/specs/browser-dom/#session-history-entry" id="the-hashchangeevent-interface:session-history-entry-4">session
  history entry</a> that was traversed to.</p></section>

  


  <section><h2>The <code id="the-pagetransitionevent-interface:pagetransitionevent"><a href="/breakup/specs/browsing/#pagetransitionevent">PageTransitionEvent</a></code> interface</h2>

  <pre class="idl">[Constructor(DOMString type, optional <a href="/breakup/specs/browsing/#pagetransitioneventinit" id="the-pagetransitionevent-interface:pagetransitioneventinit">PageTransitionEventInit</a> eventInitDict), Exposed=(Window,Worker)]
interface <dfn id="pagetransitionevent">PageTransitionEvent</dfn> : <a href="/breakup/specs/core-algorithms/#event" id="the-pagetransitionevent-interface:event">Event</a> {
  readonly attribute boolean <a href="/breakup/specs/browsing/#dom-pagetransitionevent-persisted" id="the-pagetransitionevent-interface:dom-pagetransitionevent-persisted">persisted</a>;
};

dictionary <dfn id="pagetransitioneventinit">PageTransitionEventInit</dfn> : <a href="/breakup/specs/core-algorithms/#eventinit" id="the-pagetransitionevent-interface:eventinit">EventInit</a> {
  boolean persisted;
};</pre>

  <dl class="domintro"><dt><var>event</var> . <code id="the-pagetransitionevent-interface:dom-pagetransitionevent-persisted-2"><a href="/breakup/specs/browsing/#dom-pagetransitionevent-persisted">persisted</a></code></dt><dd>

    <p>For the <code id="the-pagetransitionevent-interface:event-pageshow"><a href="/breakup/specs/html/#event-pageshow">pageshow</a></code> event, returns false if the page is
    newly being loaded (and the <code id="the-pagetransitionevent-interface:event-load"><a href="/breakup/specs/html/#event-load">load</a></code> event will fire). Otherwise,
    returns true.</p>

    <p>For the <code id="the-pagetransitionevent-interface:event-pagehide"><a href="/breakup/specs/html/#event-pagehide">pagehide</a></code> event, returns false if the page is
    going away for the last time. Otherwise, returns true, meaning that (if nothing conspires to
    make the page unsalvageable) the page might be reused if the user navigates back to this
    page.</p>

    <p>Things that can cause the page to be unsalvageable include:</p>

    <ul class="brief"><li><code id="the-pagetransitionevent-interface:dom-document-open"><a href="/breakup/specs/browser-dom/#dom-document-open">document.open()</a></code>
     </li><li>Listening for <code id="the-pagetransitionevent-interface:event-beforeunload"><a href="/breakup/specs/html/#event-beforeunload">beforeunload</a></code> events
     </li><li>Listening for <code id="the-pagetransitionevent-interface:event-unload"><a href="/breakup/specs/html/#event-unload">unload</a></code> events
     </li><li>Having <code id="the-pagetransitionevent-interface:the-iframe-element"><a href="#the-iframe-element">iframe</a></code>s that are not salvageable
     </li><li>Active <code id="the-pagetransitionevent-interface:websocket"><a href="http://www.w3.org/TR/websockets/#websocket">WebSocket</a></code> objects
     </li><li><a href="/breakup/specs/browsing/#abort-a-document" id="the-pagetransitionevent-interface:abort-a-document">Aborting a <code>Document</code></a>
    </li></ul>

   </dd></dl>

  

  <p>The <dfn id="dom-pagetransitionevent-persisted"><code>persisted</code></dfn> attribute must
  return the value it was initialised to. When the object is created, this attribute must be
  initialised to false. It represents the context information for the event.</p></section></section><section><h2>Unloading documents</h2>

  

  <p>A <code id="unloading-documents:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code> has a <dfn id="concept-document-salvageable"><i>salvageable</i></dfn> state, which must initially be
  true, a <dfn id="fired-unload">fired unload</dfn> flag, which must initially be false, and a <dfn id="page-showing">page showing</dfn>
  flag, which must initially be false. The <a href="/breakup/specs/browsing/#page-showing" id="unloading-documents:page-showing">page showing</a> flag is used to ensure that
  scripts receive <code id="unloading-documents:event-pageshow"><a href="/breakup/specs/html/#event-pageshow">pageshow</a></code> and <code id="unloading-documents:event-pagehide"><a href="/breakup/specs/html/#event-pagehide">pagehide</a></code> events in a consistent manner (e.g. that they never
  receive two <code id="unloading-documents:event-pagehide-2"><a href="/breakup/specs/html/#event-pagehide">pagehide</a></code> events in a row without an intervening
  <code id="unloading-documents:event-pageshow-2"><a href="/breakup/specs/html/#event-pageshow">pageshow</a></code>, or vice versa).</p>

  <p><a href="/breakup/specs/browser-dom/#event-loop" id="unloading-documents:event-loop">Event loops</a> have a <dfn id="termination-nesting-level">termination nesting level</dfn>
  counter, which must initially be zero.</p>

  <p>When a user agent is to <dfn id="prompt-to-unload-a-document">prompt to unload a document</dfn>, it must run the following
  steps.</p>

  <ol><li><p>Increase the <a href="/breakup/specs/browser-dom/#event-loop" id="unloading-documents:event-loop-2">event loop</a>'s <a href="/breakup/specs/browsing/#termination-nesting-level" id="unloading-documents:termination-nesting-level">termination nesting level</a> by
   one.</p></li><li><p>Increase the <code id="unloading-documents:document-2"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browser-dom/#ignore-opens-during-unload-counter" id="unloading-documents:ignore-opens-during-unload-counter">ignore-opens-during-unload counter</a> by
   one.</p></li><li><p>Let <var>event</var> be a new <a href="/breakup/specs/core-algorithms/#concept-events-trusted" id="unloading-documents:concept-events-trusted">trusted</a>
   <code id="unloading-documents:beforeunloadevent"><a href="/breakup/specs/browsing/#beforeunloadevent">BeforeUnloadEvent</a></code> event object with the name <code id="unloading-documents:event-beforeunload"><a href="/breakup/specs/html/#event-beforeunload">beforeunload</a></code>, which does not bubble but is cancelable.</p></li><li><p><i>Dispatch</i>: <a href="/breakup/specs/core-algorithms/#concept-event-dispatch" id="unloading-documents:concept-event-dispatch">Dispatch</a> <var>event</var> at the <code id="unloading-documents:document-3"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <code id="unloading-documents:window"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object.</p></li><li><p>Decrease the <a href="/breakup/specs/browser-dom/#event-loop" id="unloading-documents:event-loop-3">event loop</a>'s <a href="/breakup/specs/browsing/#termination-nesting-level" id="unloading-documents:termination-nesting-level-2">termination nesting level</a> by
   one.</p></li><li><p>Release the <a href="/breakup/specs/browser-dom/#storage-mutex" id="unloading-documents:storage-mutex">storage mutex</a>.</p></li><li><p>If any event listeners were triggered by the earlier <i>dispatch</i> step, then set the
   <code id="unloading-documents:document-4"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <i id="unloading-documents:concept-document-salvageable"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state to
   false.</p></li><li>

    <p>If the <code id="unloading-documents:dom-beforeunloadevent-returnvalue"><a href="/breakup/specs/browsing/#dom-beforeunloadevent-returnvalue">returnValue</a></code> attribute of the
    <var>event</var> object is not the empty string, or if the event was canceled, then the
    user agent should ask the user to confirm that they wish to unload the document.</p>

    <p>The prompt shown by the user agent may include the string of the <code id="unloading-documents:dom-beforeunloadevent-returnvalue-2"><a href="/breakup/specs/browsing/#dom-beforeunloadevent-returnvalue">returnValue</a></code> attribute, or some leading subset
    thereof. (A user agent may want to truncate the string to 1024 characters for display, for
    instance.)</p>

    <p>The user agent must <a href="/breakup/specs/browser-dom/#pause" id="unloading-documents:pause">pause</a> while waiting for the user's response.</p>

    <p>If the user did not confirm the page navigation, then the user agent <dfn id="refused-to-allow-the-document-to-be-unloaded">refused to allow
    the document to be unloaded</dfn>.</p>

   </li><li><p>If this algorithm was invoked by another instance of the "prompt to unload a document"
   algorithm (i.e. through the steps below that invoke this algorithm for all descendant browsing
   contexts), then jump to the step labeled <i>end</i>.</p></li><li><p>Let <var>descendants</var> be the <a href="/breakup/specs/browser-dom/#list-of-the-descendant-browsing-contexts" id="unloading-documents:list-of-the-descendant-browsing-contexts">list of the descendant browsing
   contexts</a> of the <code id="unloading-documents:document-5"><a href="/breakup/specs/browser-dom/#document">Document</a></code>.</p></li><li>

    <p>If <var>descendants</var> is not an empty list, then for each <a href="/breakup/specs/browser-dom/#browsing-context" id="unloading-documents:browsing-context">browsing
    context</a> <var>b</var> in <var>descendants</var> run the following
    substeps:</p>

    <ol><li><p><a href="/breakup/specs/browsing/#prompt-to-unload-a-document" id="unloading-documents:prompt-to-unload-a-document">Prompt to unload</a> the <a href="/breakup/specs/browser-dom/#active-document" id="unloading-documents:active-document">active
     document</a> of the <a href="/breakup/specs/browser-dom/#browsing-context" id="unloading-documents:browsing-context-2">browsing context</a> <var>b</var>. If the user
     <a href="/breakup/specs/browsing/#refused-to-allow-the-document-to-be-unloaded" id="unloading-documents:refused-to-allow-the-document-to-be-unloaded">refused to allow the document to be unloaded</a>, then the user implicitly also <a href="/breakup/specs/browsing/#refused-to-allow-the-document-to-be-unloaded" id="unloading-documents:refused-to-allow-the-document-to-be-unloaded-2">refused to allow <em>this</em> document to
     be unloaded</a>; jump to the step labeled <i>end</i>.</p>

     </li><li><p>If the <i id="unloading-documents:concept-document-salvageable-2"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state of the <a href="/breakup/specs/browser-dom/#active-document" id="unloading-documents:active-document-2">active
     document</a> of the <a href="/breakup/specs/browser-dom/#browsing-context" id="unloading-documents:browsing-context-3">browsing context</a> <var>b</var> is false, then set
     the <i id="unloading-documents:concept-document-salvageable-3"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state of <em>this</em> document to
     false also.</p></li></ol>

   </li><li><p><i>End</i>: Decrease the <code id="unloading-documents:document-6"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browser-dom/#ignore-opens-during-unload-counter" id="unloading-documents:ignore-opens-during-unload-counter-2">ignore-opens-during-unload
   counter</a> by one.</p></li></ol>

  <p>When a user agent is to <dfn id="unload-a-document">unload a document</dfn>, it must run the following steps. These
  steps are passed an argument, <var>recycle</var>, which is either true or false,
  indicating whether the <code id="unloading-documents:document-7"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object is going to be re-used. (This is set by the
  <code id="unloading-documents:dom-document-open"><a href="/breakup/specs/browser-dom/#dom-document-open">document.open()</a></code> method.)</p>

  <ol><li><p>Increase the <a href="/breakup/specs/browser-dom/#event-loop" id="unloading-documents:event-loop-4">event loop</a>'s <a href="/breakup/specs/browsing/#termination-nesting-level" id="unloading-documents:termination-nesting-level-3">termination nesting level</a> by
   one.</p></li><li><p>Increase the <code id="unloading-documents:document-8"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browser-dom/#ignore-opens-during-unload-counter" id="unloading-documents:ignore-opens-during-unload-counter-3">ignore-opens-during-unload counter</a> by
   one.</p></li><li><p>If the <code id="unloading-documents:document-9"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browsing/#page-showing" id="unloading-documents:page-showing-2">page showing</a> flag is false, then jump to the
   step labeled <i>unload event</i> below (i.e. skip firing the <code id="unloading-documents:event-pagehide-3"><a href="/breakup/specs/html/#event-pagehide">pagehide</a></code> event and don't rerun the <a href="/breakup/specs/browsing/#unloading-document-visibility-change-steps" id="unloading-documents:unloading-document-visibility-change-steps">unloading document
   visibility change steps</a>).</p></li><li><p>Set the <code id="unloading-documents:document-10"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browsing/#page-showing" id="unloading-documents:page-showing-3">page showing</a> flag to false.</p></li><li><p><a href="/breakup/specs/core-algorithms/#concept-event-fire" id="unloading-documents:concept-event-fire">Fire</a> a <a href="/breakup/specs/core-algorithms/#concept-events-trusted" id="unloading-documents:concept-events-trusted-2">trusted</a> event with the name <code id="unloading-documents:event-pagehide-4"><a href="/breakup/specs/html/#event-pagehide">pagehide</a></code> at the <code id="unloading-documents:window-2"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object of the
   <code id="unloading-documents:document-11"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, with <i id="unloading-documents:concept-event-target-override"><a href="/breakup/specs/core-algorithms/#concept-event-target-override">target override</a></i> set to the <code id="unloading-documents:document-12"><a href="/breakup/specs/browser-dom/#document">Document</a></code>
   object, using the <code id="unloading-documents:pagetransitionevent"><a href="/breakup/specs/browsing/#pagetransitionevent">PageTransitionEvent</a></code> interface,
   with the <code id="unloading-documents:dom-pagetransitionevent-persisted"><a href="/breakup/specs/browsing/#dom-pagetransitionevent-persisted">persisted</a></code> attribute initialised
   to true if the <code id="unloading-documents:document-13"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object's <i id="unloading-documents:concept-document-salvageable-4"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state is true, and false otherwise. This
   event must not bubble, must not be cancelable, and has no default action.</p></li><li>

    <p>Run any <dfn id="unloading-document-visibility-change-steps">unloading document visibility change steps</dfn> for <code id="unloading-documents:document-14"><a href="/breakup/specs/browser-dom/#document">Document</a></code> that
    are defined by <a href="/breakup/specs/core-algorithms/#other-applicable-specifications" id="unloading-documents:other-applicable-specifications">other applicable specifications</a>.</p>

    <p class="note">This is specifically intended for use by the Page Visibility specification. [[PAGEVIS]]</p>

   </li><li><p><i>Unload event</i>: If the <code id="unloading-documents:document-15"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browsing/#fired-unload" id="unloading-documents:fired-unload">fired unload</a> flag is
   false, <a href="/breakup/specs/browser-dom/#fire-a-simple-event" id="unloading-documents:fire-a-simple-event">fire a simple event</a> named <code id="unloading-documents:event-unload"><a href="/breakup/specs/html/#event-unload">unload</a></code> at the
   <code id="unloading-documents:document-16"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <code id="unloading-documents:window-3"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object, with <i id="unloading-documents:concept-event-target-override-2"><a href="/breakup/specs/core-algorithms/#concept-event-target-override">target override</a></i> set to the
   <code id="unloading-documents:document-17"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object.</p></li><li><p>Decrease the <a href="/breakup/specs/browser-dom/#event-loop" id="unloading-documents:event-loop-5">event loop</a>'s <a href="/breakup/specs/browsing/#termination-nesting-level" id="unloading-documents:termination-nesting-level-4">termination nesting level</a> by
   one.</p></li><li><p>Release the <a href="/breakup/specs/browser-dom/#storage-mutex" id="unloading-documents:storage-mutex-2">storage mutex</a>.</p></li><li><p>If any event listeners were triggered by the earlier <i>unload event</i> step, then set
   the <code id="unloading-documents:document-18"><a href="/breakup/specs/browser-dom/#document">Document</a></code> object's <i id="unloading-documents:concept-document-salvageable-5"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state
   to false and set the <code id="unloading-documents:document-19"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browsing/#fired-unload" id="unloading-documents:fired-unload-2">fired unload</a> flag to true.</p></li><li><p>Run any <a href="/breakup/specs/browsing/#unloading-document-cleanup-steps" id="unloading-documents:unloading-document-cleanup-steps">unloading document cleanup steps</a> for <code id="unloading-documents:document-20"><a href="/breakup/specs/browser-dom/#document">Document</a></code> that are
   defined by this specification and <a href="/breakup/specs/core-algorithms/#other-applicable-specifications" id="unloading-documents:other-applicable-specifications-2">other applicable specifications</a>.</p></li><li><p>If this algorithm was invoked by another instance of the "unload a document" algorithm
   (i.e. by the steps below that invoke this algorithm for all descendant browsing contexts), then
   jump to the step labeled <i>end</i>.</p></li><li><p>Let <var>descendants</var> be the <a href="/breakup/specs/browser-dom/#list-of-the-descendant-browsing-contexts" id="unloading-documents:list-of-the-descendant-browsing-contexts-2">list of the descendant browsing
   contexts</a> of the <code id="unloading-documents:document-21"><a href="/breakup/specs/browser-dom/#document">Document</a></code>.</p></li><li>

    <p>If <var>descendants</var> is not an empty list, then for each <a href="/breakup/specs/browser-dom/#browsing-context" id="unloading-documents:browsing-context-4">browsing
    context</a> <var>b</var> in <var>descendants</var> run the following
    substeps:</p>

    <ol><li><p><a href="/breakup/specs/browsing/#unload-a-document" id="unloading-documents:unload-a-document">Unload</a> the <a href="/breakup/specs/browser-dom/#active-document" id="unloading-documents:active-document-3">active document</a> of the
     <a href="/breakup/specs/browser-dom/#browsing-context" id="unloading-documents:browsing-context-5">browsing context</a> <var>b</var> with the <var>recycle</var>
     parameter set to false.</p></li><li><p>If the <i id="unloading-documents:concept-document-salvageable-6"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state of the <a href="/breakup/specs/browser-dom/#active-document" id="unloading-documents:active-document-4">active
     document</a> of the <a href="/breakup/specs/browser-dom/#browsing-context" id="unloading-documents:browsing-context-6">browsing context</a> <var>b</var> is false, then set
     the <i id="unloading-documents:concept-document-salvageable-7"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state of <em>this</em> document to
     false also.</p></li></ol>

   </li><li><p>If both the <code id="unloading-documents:document-22"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <i id="unloading-documents:concept-document-salvageable-8"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state and <var>recycle</var> are
   false, then the <code id="unloading-documents:document-23"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browser-dom/#browsing-context" id="unloading-documents:browsing-context-7">browsing context</a> must <a href="/breakup/specs/browser-dom/#discard-a-document" id="unloading-documents:discard-a-document">discard the <code>Document</code></a>.</p></li><li><p><i>End</i>: Decrease the <code id="unloading-documents:document-24"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <a href="/breakup/specs/browser-dom/#ignore-opens-during-unload-counter" id="unloading-documents:ignore-opens-during-unload-counter-4">ignore-opens-during-unload
   counter</a> by one.</p></li></ol>

  <p>This specification defines the following <dfn id="unloading-document-cleanup-steps">unloading document cleanup steps</dfn>. Other
  specifications can define more.</p>

  <ol><li>

    <p><a href="http://www.w3.org/TR/websockets/#make-disappear" id="unloading-documents:make-disappear">Make disappear</a> any <code id="unloading-documents:websocket"><a href="http://www.w3.org/TR/websockets/#websocket">WebSocket</a></code> objects that were created by the <code id="unloading-documents:dom-websocket"><a href="http://www.w3.org/TR/websockets/#dom-websocket">WebSocket()</a></code> constructor from the
    <code id="unloading-documents:document-25"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <code id="unloading-documents:window-4"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object.</p>

    <p>If this affected any <code id="unloading-documents:websocket-2"><a href="http://www.w3.org/TR/websockets/#websocket">WebSocket</a></code> objects, then set <code id="unloading-documents:document-26"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <i id="unloading-documents:concept-document-salvageable-9"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state to false.</p>

   </li><li><p>If the <code id="unloading-documents:document-27"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <i id="unloading-documents:concept-document-salvageable-10"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i>
   state is false, <a href="http://www.w3.org/TR/eventsource/#concept-eventsource-forcibly-close" id="unloading-documents:concept-eventsource-forcibly-close">forcibly close</a> any
   <code id="unloading-documents:eventsource"><a href="http://www.w3.org/TR/eventsource/#eventsource">EventSource</a></code> objects that whose constructor was invoked from the
   <code id="unloading-documents:document-28"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <code id="unloading-documents:window-5"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object.</p></li><li><p>If the <code id="unloading-documents:document-29"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <i id="unloading-documents:concept-document-salvageable-11"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i>
   state is false, empty the <code id="unloading-documents:document-30"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <code id="unloading-documents:window-6"><a href="/breakup/specs/browser-dom/#window">Window</a></code>'s <a href="/breakup/specs/browser-dom/#list-of-active-timers" id="unloading-documents:list-of-active-timers">list of active
   timers</a>.</p></li></ol>

  



  <section><h2>The <code id="the-beforeunloadevent-interface:beforeunloadevent"><a href="/breakup/specs/browsing/#beforeunloadevent">BeforeUnloadEvent</a></code> interface</h2>

  <pre class="idl">interface <dfn id="beforeunloadevent">BeforeUnloadEvent</dfn> : <a href="/breakup/specs/core-algorithms/#event" id="the-beforeunloadevent-interface:event">Event</a> {
  attribute DOMString <a href="/breakup/specs/browsing/#dom-beforeunloadevent-returnvalue" id="the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue">returnValue</a>;
};</pre>

  <dl class="domintro"><dt><var>event</var> . <code id="the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue-2"><a href="/breakup/specs/browsing/#dom-beforeunloadevent-returnvalue">returnValue</a></code> [ = <var>value</var> ]</dt><dd>

    <p>Returns the current return value of the event (the message to show the user).</p>

    <p>Can be set, to update the message.</p>

   </dd></dl>

  <p class="note">There are no <code id="the-beforeunloadevent-interface:beforeunloadevent-2"><a href="/breakup/specs/browsing/#beforeunloadevent">BeforeUnloadEvent</a></code>-specific initialisation methods.</p>

  

  <p>The <dfn id="dom-beforeunloadevent-returnvalue"><code>returnValue</code></dfn> attribute
  represents the message to show the user. When the event is created, the attribute must be set to
  the empty string. On getting, it must return the last value it was set to. On setting, the
  attribute must be set to the new value.</p></section></section><section><h2>Aborting a document load</h2>

  <p>If a <code id="aborting-a-document-load:document"><a href="/breakup/specs/browser-dom/#document">Document</a></code> is <dfn id="abort-a-document">aborted</dfn>, the user agent must
  run the following steps:</p>

  <ol><li><p><a href="/breakup/specs/browsing/#abort-a-document" id="aborting-a-document-load:abort-a-document">Abort</a> the <a href="/breakup/specs/browser-dom/#active-document" id="aborting-a-document-load:active-document">active
   documents</a> of every <a href="/breakup/specs/browser-dom/#child-browsing-context" id="aborting-a-document-load:child-browsing-context">child browsing context</a>. If this results in any of those
   <code id="aborting-a-document-load:document-2"><a href="/breakup/specs/browser-dom/#document">Document</a></code> objects having their <i id="aborting-a-document-load:concept-document-salvageable"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state set to false, then set this
   <code id="aborting-a-document-load:document-3"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <i id="aborting-a-document-load:concept-document-salvageable-2"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state to false
   also.</p></li><li><p>Cancel any instances of the <a href="/breakup/specs/core-algorithms/#fetch" id="aborting-a-document-load:fetch">fetch</a> algorithm in the context of
   this <code id="aborting-a-document-load:document-4"><a href="/breakup/specs/browser-dom/#document">Document</a></code>, discarding any <a href="/breakup/specs/browser-dom/#concept-task" id="aborting-a-document-load:concept-task">tasks</a> <a href="/breakup/specs/browser-dom/#queue-a-task" id="aborting-a-document-load:queue-a-task">queued</a> for them, and discarding any further data received from the
   network for them. If this resulted in any instances of the <a href="/breakup/specs/core-algorithms/#fetch" id="aborting-a-document-load:fetch-2">fetch</a>
   algorithm being canceled or any <a href="/breakup/specs/browser-dom/#queue-a-task" id="aborting-a-document-load:queue-a-task-2">queued</a> <a href="/breakup/specs/browser-dom/#concept-task" id="aborting-a-document-load:concept-task-2">tasks</a> or any network data getting discarded, then set the
   <code id="aborting-a-document-load:document-5"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <i id="aborting-a-document-load:concept-document-salvageable-3"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state to
   false.</p></li><li><p>If the <code id="aborting-a-document-load:document-6"><a href="/breakup/specs/browser-dom/#document">Document</a></code> has an <a href="/breakup/specs/browser-dom/#active-parser" id="aborting-a-document-load:active-parser">active parser</a>, then <a href="/breakup/specs/html-syntax/#abort-a-parser" id="aborting-a-document-load:abort-a-parser">abort that parser</a> and set the <code id="aborting-a-document-load:document-7"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <i id="aborting-a-document-load:concept-document-salvageable-4"><a href="/breakup/specs/browsing/#concept-document-salvageable">salvageable</a></i> state to false.</p></li></ol>

  <p>User agents may allow users to explicitly invoke the <a href="/breakup/specs/browsing/#abort-a-document" id="aborting-a-document-load:abort-a-document-2">abort a
  document</a> algorithm for a <code id="aborting-a-document-load:document-8"><a href="/breakup/specs/browser-dom/#document">Document</a></code>. If the user does so, then, if that
  <code id="aborting-a-document-load:document-9"><a href="/breakup/specs/browser-dom/#document">Document</a></code> is an <a href="/breakup/specs/browser-dom/#active-document" id="aborting-a-document-load:active-document-2">active document</a>, the user agent should <a href="/breakup/specs/browser-dom/#queue-a-task" id="aborting-a-document-load:queue-a-task-3">queue a
  task</a> to <a href="/breakup/specs/browser-dom/#fire-a-simple-event" id="aborting-a-document-load:fire-a-simple-event">fire a simple event</a> named <code id="aborting-a-document-load:event-abort"><a href="/breakup/specs/html/#event-abort">abort</a></code> at
  that <code id="aborting-a-document-load:document-10"><a href="/breakup/specs/browser-dom/#document">Document</a></code>'s <code id="aborting-a-document-load:window"><a href="/breakup/specs/browser-dom/#window">Window</a></code> object before invoking the <a href="/breakup/specs/browsing/#abort-a-document" id="aborting-a-document-load:abort-a-document-3">abort</a> algorithm.</p></section></body></html>