<html lang="en"><head>
    <meta charset="utf-8">
    <title>HTML Bidirectional Algorithm Requirements</title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common" class="remove"></script>
    <script class="remove">
      var respecConfig = {
              specStatus:     "ED"
          ,   shortName:      "html-bidi"
          ,   editors:      [{ name: "Up for the taking" }]
          ,   wg:             "HTML Working Group"
          ,   wgURI:          "http://www.w3.org/html/wg/"
          ,   wgPublicList:   "public-html"
          ,   wgPatentURI:    "http://www.w3.org/2004/01/pp-impl/40318/status"
          ,   license:        "cc-by"
          ,   processVersion: "2014"
        };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
        Bidirectional.
      </p>
    </section>
    <section id="sotd">
      <p>
        This specification is an experimental breakup of the
        <a href="http://www.w3.org/TR/html51/">HTML specification</a>. You can see the full list on
        <a href="https://darobin.github.io/breakup/specs/">the index page</a> and take part in the
        discussion in <a href="https://github.com/darobin/breakup/">the repository</a>.
      </p>
    </section>
  

<section><h2>Authoring conformance criteria for bidirectional-algorithm formatting characters</h2>
  

  <p><a href="/breakup/specs/html-best-practices/#text-content" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:text-content">Text content</a> in <a href="/breakup/specs/core-algorithms/#html-elements" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:html-elements">HTML elements</a> with <code id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:text"><a href="/breakup/specs/core-algorithms/#text">Text</a></code> nodes in their
  <a href="/breakup/specs/html-best-practices/#concept-html-contents" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:concept-html-contents">contents</a>, and text in attributes of <a href="/breakup/specs/core-algorithms/#html-elements" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:html-elements-2">HTML
  elements</a> that allow free-form text, may contain characters in the ranges U+202A to U+202E
  and U+2066 to U+2069 (the bidirectional-algorithm formatting characters). However, the use of
  these characters is restricted so that any embedding or overrides generated by these characters do
  not start and end with different parent elements, and so that all such embeddings and overrides
  are explicitly terminated by a U+202C POP DIRECTIONAL FORMATTING character. This helps reduce
  incidences of text being reused in a manner that has unforeseen effects on the bidirectional
  algorithm. [[!BIDI]]</p>

  <p>The aforementioned restrictions are defined by specifying that certain parts of documents form
  <a href="/breakup/specs/html-bidi/#bidirectional-algorithm-formatting-character-ranges" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:bidirectional-algorithm-formatting-character-ranges">bidirectional-algorithm formatting character ranges</a>, and then imposing a requirement
  on such ranges.</p>

  <p>The strings resulting from applying the following algorithm to an <a href="/breakup/specs/core-algorithms/#html-elements" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:html-elements-3">HTML element</a> <var>element</var> are <a href="/breakup/specs/html-bidi/#bidirectional-algorithm-formatting-character-ranges" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:bidirectional-algorithm-formatting-character-ranges-2">bidirectional-algorithm
  formatting character ranges</a>:</p>

  <ol><li><p>Let <var>output</var> be an empty list of strings.</p></li><li><p>Let <var>string</var> be an empty string.</p></li><li><p>Let <var>node</var> be the first child node of <var>element</var>, if
   any, or null otherwise.</p></li><li><p><i>Loop</i>: If <var>node</var> is null, jump to the step labeled
   <i>end</i>.</p></li><li>

    <p>Process <var>node</var> according to the first matching step from the following
    list:</p>

    <dl class="switch"><dt>If <var>node</var> is a <code id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:text-2"><a href="/breakup/specs/core-algorithms/#text">Text</a></code> node</dt><dd><p>Append the text data of <var>node</var> to <var>string</var>.</p></dd><dt>If <var>node</var> is a <code id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:the-br-element"><a href="/breakup/specs/html-text/#the-br-element">br</a></code> element</dt><dt>If <var>node</var> is an <a href="/breakup/specs/core-algorithms/#html-elements" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:html-elements-4">HTML element</a> that is
     <a href="/breakup/specs/html-best-practices/#flow-content-2" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:flow-content-2">flow content</a> but that is not also <a href="/breakup/specs/html-best-practices/#phrasing-content-2" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:phrasing-content-2">phrasing content</a></dt><dd><p>If <var>string</var> is not the empty string, push <var>string</var>
     onto <var>output</var>, and let <var>string</var> be empty string.</p></dd><dt>Otherwise</dt><dd>Do nothing.</dd></dl>

   </li><li><p>Let <var>node</var> be <var>node</var>'s next sibling, if any, or null
   otherwise.</p></li><li><p>Jump to the step labeled <i>loop</i>.</p></li><li><p><i>End</i>: If <var>string</var> is not the empty string, push <var>string</var> onto <var>output</var>.</p></li><li><p>Return <var>output</var> as the <a href="/breakup/specs/html-bidi/#bidirectional-algorithm-formatting-character-ranges" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:bidirectional-algorithm-formatting-character-ranges-3">bidirectional-algorithm formatting
   character ranges</a>.</p></li></ol>

  <p>The value of a namespace-less attribute of an <a href="/breakup/specs/core-algorithms/#html-elements" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:html-elements-5">HTML element</a>
  is a <a href="/breakup/specs/html-bidi/#bidirectional-algorithm-formatting-character-ranges" id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:bidirectional-algorithm-formatting-character-ranges-4">bidirectional-algorithm
  formatting character range</a>.</p>



  <p>Any strings that, as described above, are <dfn id="bidirectional-algorithm-formatting-character-ranges">bidirectional-algorithm formatting character
  ranges</dfn> must match the <code>string</code> production in the following ABNF, the
  character set for which is Unicode. [[!ABNF]]</p>

  <pre>string        = *( plaintext ( embedding / override / isolation ) ) plaintext
embedding     = ( lre / rle ) string pdf
override      = ( lro / rlo ) string pdf
isolation     = ( lri / rli / fsi ) string pdi
lre           = %x202A ; U+202A LEFT-TO-RIGHT EMBEDDING
rle           = %x202B ; U+202B RIGHT-TO-LEFT EMBEDDING
lro           = %x202D ; U+202D LEFT-TO-RIGHT OVERRIDE
rlo           = %x202E ; U+202E RIGHT-TO-LEFT OVERRIDE
pdf           = %x202C ; U+202C POP DIRECTIONAL FORMATTING
lri           = %x2066 ; U+2066 LEFT-TO-RIGHT ISOLATE
rli           = %x2067 ; U+2067 RIGHT-TO-LEFT ISOLATE
fsi           = %x2068 ; U+2068 FIRST STRONG ISOLATE
pdi           = %x2069 ; U+2069 POP DIRECTIONAL ISOLATE
plaintext     = *( %x0000-2029 / %x202F-2065 / %x206A-10FFFF )
                ; any string with no bidirectional-algorithm formatting characters</pre>

  <p class="note">While the U+2069 POP DIRECTIONAL ISOLATE character implicitly also ends open
  embeddings and overrides, text that relies on this implicit scope closure is not conforming to
  this specification. All strings of embeddings, overrides, and isolations need to be explicitly
  terminated to conform to this section's requirements.</p>

  <p class="note">Authors are encouraged to use the <code id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:the-dir-attribute"><a href="/breakup/specs/html-attributes/#the-dir-attribute">dir</a></code> attribute, the
  <code id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:the-bdo-element"><a href="/breakup/specs/html-text/#the-bdo-element">bdo</a></code> element, and the <code id="authoring-conformance-criteria-for-bidirectional-algorithm-formatting-characters:the-bdi-element"><a href="/breakup/specs/html-text/#the-bdi-element">bdi</a></code> element, rather than maintaining the
  bidirectional-algorithm formatting characters manually. The bidirectional-algorithm formatting
  characters interact poorly with CSS.</p></section><section><h2>User agent conformance criteria</h2>

  <p>User agents must implement the Unicode bidirectional algorithm to determine the proper ordering
  of characters when rendering documents and parts of documents. [[!BIDI]]</p>

  <p>The mapping of HTML to the Unicode bidirectional algorithm must be done in one of three ways.
  Either the user agent must implement CSS, including in particular the CSS 'unicode-bidi',
  'direction', and 'content' properties, and must have, in its user agent style sheet, the rules
  using those properties given in this specification's <a href="#rendering">rendering</a> section,
  or, alternatively, the user agent must act as if it implemented just the aforementioned properties
  and had a user agent style sheet that included all the aforementioned rules, but without letting
  style sheets specified in documents override them, or, alternatively, the user agent must
  implement another styling language with equivalent semantics. [[!CSSWM]] [[!CSSGC]]</p>

  <p id="bidireq">The following elements and attributes have requirements defined by the <a href="#rendering">rendering</a> section that, due to the requirements in this section, are
  requirements on all user agents (not just those that <a href="/breakup/specs/core-algorithms/#renderingUA">support the suggested
  default rendering</a>):</p>

  <ul class="brief"><li><code id="user-agent-conformance-criteria:the-dir-attribute"><a href="/breakup/specs/html-attributes/#the-dir-attribute">dir</a></code> attribute</li><li><code id="user-agent-conformance-criteria:the-bdi-element"><a href="/breakup/specs/html-text/#the-bdi-element">bdi</a></code> element</li><li><code id="user-agent-conformance-criteria:the-bdo-element"><a href="/breakup/specs/html-text/#the-bdo-element">bdo</a></code> element</li><li><code id="user-agent-conformance-criteria:the-br-element"><a href="/breakup/specs/html-text/#the-br-element">br</a></code> element</li><li><code id="user-agent-conformance-criteria:the-pre-element"><a href="/breakup/specs/html-blocks/#the-pre-element">pre</a></code> element</li><li><code id="user-agent-conformance-criteria:the-textarea-element"><a href="/breakup/specs/html-forms/#the-textarea-element">textarea</a></code> element</li><li><code id="user-agent-conformance-criteria:the-wbr-element"><a href="/breakup/specs/html-text/#the-wbr-element">wbr</a></code> element</li></ul></section></body></html>