<!DOCTYPE html>
<html data-revision="$Revision: 8891 $" lang="en-GB-x-hixie"><head><meta charset="utf-8"><title>6 Loading Web pages | HTML 5.1</title><style>/* WHAT 1 */
[hidden] { display: none; }

.proposal { border: blue solid; padding: 1em; }
.bad, .bad *:not(.X\58X) { color: gray; border-color: gray; background: transparent; }
#updatesStatus { display: none; z-index: 10; }
#updatesStatus.relevant { display: block; position: fixed; right: 1em; top: 1em; padding: 0.5em; font: bold small sans-serif; min-width: 25em; width: 30%; max-width: 40em; height: auto; border: ridge 4px gray; background: #EEEEEE; color: black; }
div.head .logo { width: 11em; margin-bottom: 20em; }

@media print { #configUI, #alert { display: none; } }

.fingerprint { position: absolute; right: 0; z-index: 5; }

.panel { position: fixed; z-index: 30; top: 10%; left: 0; margin: auto; right: 0; width: 35em; border: double thick; background: #EEEEEE; color: black; padding: 1em; font: 1em sans-serif; max-height: 70%; overflow: auto; }
.panel h2 { margin: 0; text-align: center; }
.panel ul { min-height: 6em; }
.panel p { text-align: right; margin: 0; }
.panel form { background: transparent; color: black; margin: 0.5em -0.5em 1em; padding: 0.5em; }
.panel form.changed { background: yellow; color: black; }
.panel form p { text-align: left; margin: 1em 0 0; }
.panel form p:first-child { margin-top: 0; }
.panel form p:last-child { margin-bottom: 0; }
.panel form p textarea { width: 100% /* need the keyword that makes it fit to the parent here XXX */; min-height: 4em; display: block; }
.panel form dl { line-height: 1.5em; }
.panel form dt { display: inline-block; width: 20em; white-space: nowrap; text-align: right; font-weight: normal; margin: 0; padding: 0; }
.panel form dd { display: inline; margin: 0 0 0 1em; padding: 0; }
.panel form dd:after { display: block; }
ul.checkboxes { list-style-type: none; }
.progress { text-decoration: blink; }

.applies .yes { background: yellow; }

/* WHAT 2 */

.applies thead th > * { display: block; }
.applies thead code { display: block; }
.applies td { text-align: center; }

.matrix, .matrix td { border: hidden; text-align: right; }
.matrix { margin-left: 2em; }

.vertical-summary-table tr > th[rowspan="2"]:first-child + th,
.vertical-summary-table tr > td[rowspan="2"]:first-child + td { border-bottom: hidden; }

.dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
.dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
.dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

td.eg { border-width: thin; text-align: center; }

#table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
#table-example-1 caption { padding-bottom: 0.5em; }
#table-example-1 thead, #table-example-1 tbody { border: none; }
#table-example-1 th, #table-example-1 td { border: solid thin; }
#table-example-1 th { font-weight: normal; }
#table-example-1 td { border-style: none solid; vertical-align: top; }
#table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
#table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
#table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
#table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
#table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
#table-example-1 tbody td:first-child + td { width: 10em; }
#table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
#table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

.apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
.apple-table-examples * { font-family: "Times", serif; }
.apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
.apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
.apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
.apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
.apple-table-examples td { text-align: right; vertical-align: top; }
.apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
.apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
.apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
.apple-table-examples sup { line-height: 0; }

.three-column-nowrap tr > td:first-child,
.three-column-nowrap tr > td:first-child + td,
.three-column-nowrap tr > td:first-child + td + td { white-space: nowrap; }

.details-example img { vertical-align: top; }

#base64-table {
 white-space: nowrap;
 font-size: 0.6em;
 column-width: 6em;
 column-count: 5;
 column-gap: 1em;
}
#base64-table thead { display: none; }
#base64-table * { border: none; }
#base64-table tbody td:first-child:after { content: ':'; }
#base64-table tbody td:last-child { text-align: right; }

#named-character-references-table {
 white-space: nowrap;
 font-size: 0.6em;
 column-width: 30em;
 column-gap: 1em;
}
#named-character-references-table > table > tbody > tr > td:first-child + td,
#named-character-references-table > table > tbody > tr > td:last-child { text-align: center; }
#named-character-references-table > table > tbody > tr > td:last-child:hover > span { position: absolute; top: auto; left: auto; margin-left: 0.5em; line-height: 1.2; font-size: 5em; border: outset; padding: 0.25em 0.5em; background: white; width: 1.25em; height: auto; text-align: center; }
#named-character-references-table > table > tbody > tr#entity-CounterClockwiseContourIntegral > td:first-child { font-size: 0.5em; }

.glyph.control { color: red; }

/* WHAT 3 */
#table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
@font-face {
    font-family: 'Essays1743';
    src: url('fonts/Essays1743.ttf');
}
@font-face {
    font-family: 'Essays1743';
    font-weight: bold;
    src: url('fonts/Essays1743-Bold.ttf');
}
@font-face {
    font-family: 'Essays1743';
    font-style: italic;
    src: url('fonts/Essays1743-Italic.ttf');
}
@font-face {
    font-family: 'Essays1743';
    font-style: italic;
    font-weight: bold;
    src: url('fonts/Essays1743-BoldItalic.ttf');
}

/* HTML */
pre { margin-left: 2em; white-space: pre-wrap; }
h2 { margin: 3em 0 1em 0; }
h3 { margin: 2.5em 0 1em 0; }
h4 { margin: 2.5em 0 0.75em 0; }
h5, h6 { margin: 2.5em 0 1em; }
h1 + h2, h1 + h2 + h2, h1 + p, h1 + p + h2 { margin: 0.75em 0 0.75em; }
h2 + h3, h3 + h4, h4 + h5, h5 + h6 { margin-top: 0.5em; }
p { margin: 1em 0; }
hr:not(.top) { display: block; background: none; border: none; padding: 0; margin: 2em 0; height: auto; }
.element dd,  .element dl { margin-top: 0em; margin-bottom: 0.25em;}
dt { margin-top: 0.75em; margin-bottom: 0.5em; clear: left; }
 .element dt { margin-top: 0.5em; margin-bottom: 0.5em;  }
dt + dt { margin-top: 0; }
dd dt { margin-top: 0.25em; margin-bottom: 0; }
dd p { margin-top: 0; }
dd dl + p { margin-top: 1em; }
dd table + p { margin-top: 1em; }
p + * > li, dd li { margin: 1em 0; }
dt, dfn { font-weight: bold; font-style: normal; }
i, em { font-style: italic; }
dt dfn { font-style: italic; }
pre, code { font-size: inherit; font-family: monospace; font-variant: normal; }
pre strong { color: black; font: inherit; font-weight: bold; background: yellow; }
pre em { font-weight: bolder; font-style: normal; }
@media screen { code { color: #D93B00; } code :link, code :visited { color: inherit; } }
var { background-color: #f9f9f9; border: 1px solid #eee; padding: 0 2px; }
var sub { vertical-align: bottom; font-size: smaller; position: relative; top: 0.1em; }
table { border-collapse: collapse; border-style: hidden hidden none hidden; }
table thead, table tbody { border-bottom: solid; }
table tbody th:first-child { border-left: solid; }
table tbody th { text-align: left; }
table td, table th { border-left: solid; border-right: solid; border-bottom: solid thin; vertical-align: top; padding: 0.2em; }
blockquote { margin: 0 0 0 2em; border: 0; padding: 0; font-style: italic; }

.bad, .bad *:not(.XXX) { color: #5F6D7A; border-color: gray; background: transparent; }
.matrix, .matrix td { border: none; text-align: right; }
.matrix { margin-left: 2em; }
.dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
.dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
.dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

.toc dfn, h1 dfn, h2 dfn, h3 dfn, h4 dfn, h5 dfn, h6 dfn { font: inherit; }
img.extra, p.overview { float: right; }
pre.idl { border: solid thin #d3d3d3; background: #FCFCFC; color: black; padding: 0.5em 1em; position: relative; }
pre.idl :link, pre.idl :visited { color: inherit; background: transparent; }
pre.idl::before { content: "IDL"; font: bold small sans-serif; padding: 0.5em; background: white; position: absolute; top: 0; margin: -1px 0 0 -4em; width: 1.5em; border: thin solid; border-radius: 0 0 0 0.5em }
pre.css { border: solid thin; background: #FFFFEE; color: black; padding: 0.5em 1em; }
pre.css:first-line { color: #AAAA50; }
dl.domintro {padding: 0.5em 1em; border: none; background:#E9FBE9; border: 1px solid lightgray; }
hr + dl.domintro, div.impl + dl.domintro { margin-top: 2.5em; margin-bottom: 1.5em; }
dl.domintro dt, dl.domintro dt * { color: black; text-decoration: none; }
dl.domintro dd { margin: 0.5em 0 1em 2em; padding: 0; }
dl.domintro dd p { margin: 0.5em 0; }
dl.domintro:before { display: table; margin: -1em -0.5em -0.5em auto; width: auto; content: 'This definition is non-normative. Implementation requirements are given below this definition.'; color: #606060; border:1px solid lightgray; background: white; padding: 0 0.25em;font-size:.9em;}
dl.switch { padding-left: 2em; }
dl.switch > dt { text-indent: -1.5em; }
dl.switch > dt:before { content: '\21AA'; padding: 0 0.5em 0 0; display: inline-block; width: 1em; text-align: right; line-height: 0.5em; }
dl.triple { padding: 0 0 0 1em; }
dl.triple dt, dl.triple dd { margin: 0; display: inline }
dl.triple dt:after { content: ':'; }
dl.triple dd:after { content: '\A'; white-space: pre; }
.diff-old { text-decoration: line-through; color: silver; background: transparent; }
.diff-chg, .diff-new { text-decoration: underline; color: green; background: transparent; }
a .diff-new { border-bottom: 1px blue solid; }

figure.diagrams { border: double black; background: white; padding: 1em; }
figure.diagrams img { display: block; margin: 1em auto; } 

h2 { page-break-before: always; }
h1, h2, h3, h4, h5, h6 { page-break-after: avoid; }
h1 + h2, hr + h2.no-toc { page-break-before: auto; }

p  > span:not([title=""]):not([class="XXX"]):not([class="impl"]):not([class="note"]):not([class="t2"]):not([id]):not([lang]),
li > span:not([title=""]):not([class="XXX"]):not([class="impl"]):not([class="note"]):not([class="t2"]):not([id]):not([lang])
{ border-bottom: solid #9999CC; }

div.head { margin: 0 0 1em; padding: 1em 0 0 0; }
div.head p { margin: 0; }
div.head h1 { margin: 0; }
div.head .logo { float: right; margin: 0 1em; }
div.head .logo img { border: none } /* remove border from top image */
div.head dl { margin: 1em 0; }
div.head p.copyright, div.head p.alt { font-size: x-small; font-style: oblique; margin: 0; }

body > .toc > li { margin-top: 1em; margin-bottom: 1em; }
body > .toc.brief > li { margin-top: 0.35em; margin-bottom: 0.35em; }
body > .toc > li > * { margin-bottom: 0.5em; }
body > .toc > li > * > li > * { margin-bottom: 0.25em; }
.toc, .toc li { list-style: none; }

.brief { margin-top: 1em; margin-bottom: 1em; line-height: 1.1; }
.brief li { margin: 0; padding: 0; }
.brief li p { margin: 0; padding: 0; }

.category-list { margin-top: -0.75em; margin-bottom: 1em; line-height: 1.5; }
.category-list::before { content: '\21D2\A0'; font-size: 1.2em; font-weight: 900; }
.category-list li { display: inline; }
.category-list li:not(:last-child)::after { content: ', '; }
.category-list li > span, .category-list li > a { text-transform: lowercase; }
.category-list li * { text-transform: none; } /* don't affect <code> nested in <a> */

.XXX { color: #E50000; background: white; border: solid red; padding: 0.5em; margin: 1em 0; }
.XXX > :first-child { margin-top: 0; }
p .XXX { line-height: 3em; }
.annotation { border: solid thin black; background: #0C479D; color: white; position: relative; margin: 8px 0 20px 0; }
.annotation:before { position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin: 6px -6px -6px 6px; background: #333333; z-index: -1; content: ''; }
.annotation :link, .annotation :visited { color: inherit; }
.annotation :link:hover, .annotation :visited:hover { background: transparent; }
.annotation span { border: none ! important; }
.note { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #E9FBE9; border-color: #52E052; }
.warning { background-color: #F9F0D4; border: medium double #FF0000; margin: 1em; padding: 1em; }
.note em, .warning em, .note i, .warning i { font-style: normal; }
p.note, div.note { padding: 0.5em 2em; }
span.note { padding: 0 2em; }
.note p:first-child, .warning p:first-child { margin-top: 0; }
.note p:last-child, .warning p:last-child { margin-bottom: 0; }
.warning:before { font-style: normal; }
p.note:before { content: 'Note: '; font-weight: bolder;}
p.warning:before { content: '\26A0 Warning! '; font-weight:bolder;}
.critical {margin:1em; border:double red; padding:1em; background-color:#F9F0D4;}

.bookkeeping:before { display: block; content: 'Bookkeeping details'; font-weight: bolder; font-style: italic; }
.bookkeeping { font-size: 0.8em; margin: 2em 0; }
.bookkeeping p { margin: 0.5em 2em; display: list-item; list-style: square; }
.bookkeeping dt { margin: 0.5em 2em 0; }
.bookkeeping dd { margin: 0 3em 0.5em; }

h4 { position: relative; z-index: 3; }
h4 + .element, h4 + div + .element { margin-top: -2.5em; padding-top: 2em; }
.element {
  background: #F4F4FA;
  color: black;
  margin: 0 0 1em 0.15em;
  padding: 0 1em 0.25em 0.75em;
  border-left: solid #9999FF 0.25em;
  position: relative;
  z-index: 1;
}
.element:before {
  position: absolute;
  z-index: 2;
  top: 0;
  left: -1.15em;
  height: 2em;
  width: 0.9em;
  background: #F4F4FA;
  content: ' ';
  border-style: none none solid solid;
  border-color: #9999FF;
  border-width: 0.25em;
}

.example { display: block; color: #222222; background: #FCFCFC; border-left-style: solid;border-color:#c0c0c0; border-left-width: 0.25em; margin-left: 1em; padding-left: 1em;padding-bottom: 0.5em;}
div.example:before { content: 'Code Example: '; font-weight: bolder;}
td > .example:only-child { margin: 0 0 0 0.1em; }

ul.domTree, ul.domTree ul { padding: 0 0 0 1em; margin: 0; }
ul.domTree li { padding: 0; margin: 0; list-style: none; position: relative; }
ul.domTree li li { list-style: none; }
ul.domTree li:first-child::before { position: absolute; top: 0; height: 0.6em; left: -0.75em; width: 0.5em; border-style: none none solid solid; content: ''; border-width: 0.1em; }
ul.domTree li:not(:last-child)::after { position: absolute; top: 0; bottom: -0.6em; left: -0.75em; width: 0.5em; border-style: none none solid solid; content: ''; border-width: 0.1em; }
ul.domTree span { font-style: italic; font-family: serif; }
ul.domTree .t1 code { color: purple; font-weight: bold; }
ul.domTree .t2 { font-style: normal; font-family: monospace; }
ul.domTree .t2 .name { color: black; font-weight: bold; }
ul.domTree .t2 .value { color: blue; font-weight: normal; }
ul.domTree .t3 code, .domTree .t4 code, .domTree .t5 code { color: gray; }
ul.domTree .t7 code, .domTree .t8 code { color: green; }
ul.domTree .t10 code { color: teal; }

body.dfnEnabled dfn { cursor: pointer; }
.dfnPanel {
  display: inline;
  position: absolute;
  z-index: 10;
  height: auto;
  width: auto;
  padding: 0.5em 0.75em;
  font: small sans-serif, Droid Sans Fallback;
  background: #DDDDDD;
  color: black;
  border: outset 0.2em;
}
.dfnPanel * { margin: 0; padding: 0; font: inherit; text-indent: 0; }
.dfnPanel :link, .dfnPanel :visited { color: black; }
.dfnPanel p { font-weight: bolder; }
.dfnPanel * + p { margin-top: 0.25em; }
.dfnPanel li { list-style-position: inside; }

#configUI { position: absolute; z-index: 20; top: 10em; right: 1em; width: 11em; font-size: small; }
#configUI p { margin: 0.5em 0; padding: 0.3em; background: #EEEEEE; color: black; border: inset thin; }
#configUI p label { display: block; }
#configUI #updateUI, #configUI .loginUI { text-align: center; }
#configUI input[type=button] { display: block; margin: auto; }

fieldset { margin: 1em; padding: 0.5em 1em; }
fieldset > legend + * { margin-top: 0; }
fieldset > :last-child { margin-bottom: 0; }
fieldset p { margin: 0.5em 0; }
header p.subline {color:#005A9C; font: 140% sans-serif;margin: 0.75em 0;}
#authorButton {overflow: visible; padding: 0.1em 0.3em; position: fixed; right: 2em; top: 6em; width: auto;}

@media print {#authorButton { display:none;}}</style><link href="http://www.w3.org/StyleSheets/TR/W3C-WD" rel="stylesheet" type="text/css"></head><body class=" dfnEnabled">
  

  <div class="head">
  <header>
    <p>
      <a href="http://www.w3.org/"><img alt="W3C" height="48" src="http://www.w3.org/Icons/w3c_home" width="72"></a>
    </p>
    <h1 id="big-title">HTML 5.1</h1>
    <h2 class="no-num no-toc subline">W3C Working Draft 06 May 2015</h2>
  </header>
  
  

  
</div>
<hr>



  

  

  <nav class="prev_next"><a href="editing.html#editing">← 5 User interaction</a> — <a href="Overview.html#contents">Table of contents</a> — <a href="webappapis.html#webappapis">7 Web application APIs →</a></nav><section><h2 id="contents" class="no-num no-toc">Table of Contents</h2>
  <ol class="toc"><li id="toc-browsers"><a href="browsers.html#browsers">6 Loading Web pages</a><ol><li><a href="browsers.html#windows">6.1 Browsing contexts</a><ol><li><a href="browsers.html#nested-browsing-contexts">6.1.1 Nested browsing contexts</a><ol><li><a href="browsers.html#navigating-nested-browsing-contexts-in-the-dom">6.1.1.1 Navigating nested browsing contexts in the DOM</a></li></ol></li><li><a href="browsers.html#auxiliary-browsing-contexts">6.1.2 Auxiliary browsing contexts</a><ol><li><a href="browsers.html#navigating-auxiliary-browsing-contexts-in-the-dom">6.1.2.1 Navigating auxiliary browsing contexts in the DOM</a></li></ol></li><li><a href="browsers.html#secondary-browsing-contexts">6.1.3 Secondary browsing contexts</a></li><li><a href="browsers.html#security-nav">6.1.4 Security</a></li><li><a href="browsers.html#groupings-of-browsing-contexts">6.1.5 Groupings of browsing contexts</a></li><li><a href="browsers.html#browsing-context-names">6.1.6 Browsing context names</a></li></ol></li><li><a href="browsers.html#the-window-object">6.2 The <code>Window</code> object</a><ol><li><a href="browsers.html#security-window">6.2.1 Security</a></li><li><a href="browsers.html#apis-for-creating-and-navigating-browsing-contexts-by-name">6.2.2 APIs for creating and navigating browsing contexts by name</a></li><li><a href="browsers.html#accessing-other-browsing-contexts">6.2.3 Accessing other browsing contexts</a></li><li><a href="browsers.html#named-access-on-the-window-object">6.2.4 Named access on the <code>Window</code> object</a></li><li><a href="browsers.html#garbage-collection-and-browsing-contexts">6.2.5 Garbage collection and browsing contexts</a></li><li><a href="browsers.html#closing-browsing-contexts">6.2.6 Closing browsing contexts</a></li><li><a href="browsers.html#browser-interface-elements">6.2.7 Browser interface elements</a></li><li><a href="browsers.html#the-windowproxy-object">6.2.8 The <code>WindowProxy</code> object</a></li></ol></li><li><a href="browsers.html#origin">6.3 Origin</a><ol><li><a href="browsers.html#relaxing-the-same-origin-restriction">6.3.1 Relaxing the same-origin restriction</a></li></ol></li><li><a href="browsers.html#sandboxing">6.4 Sandboxing</a></li><li><a href="browsers.html#history">6.5 Session history and navigation</a><ol><li><a href="browsers.html#the-session-history-of-browsing-contexts">6.5.1 The session history of browsing contexts</a></li><li><a href="browsers.html#the-history-interface">6.5.2 The <code>History</code> interface</a></li><li><a href="browsers.html#the-location-interface">6.5.3 The <code>Location</code> interface</a><ol><li><a href="browsers.html#security-location">6.5.3.1 Security</a></li></ol></li><li><a href="browsers.html#history-notes">6.5.4 Implementation notes for session history</a></li></ol></li><li><a href="browsers.html#browsing-the-web">6.6 Browsing the Web</a><ol><li><a href="browsers.html#navigating-across-documents">6.6.1 Navigating across documents</a></li><li><a href="browsers.html#read-html">6.6.2 Page load processing model for HTML files</a></li><li><a href="browsers.html#read-xml">6.6.3 Page load processing model for XML files</a></li><li><a href="browsers.html#read-text">6.6.4 Page load processing model for text files</a></li><li><a href="browsers.html#read-multipart-x-mixed-replace">6.6.5 Page load processing model for <code>multipart/x-mixed-replace</code> resources</a></li><li><a href="browsers.html#read-media">6.6.6 Page load processing model for media</a></li><li><a href="browsers.html#read-plugin">6.6.7 Page load processing model for content that uses plugins</a></li><li><a href="browsers.html#read-ua-inline">6.6.8 Page load processing model for inline
  content that doesn't have a DOM</a></li><li><a href="browsers.html#scroll-to-fragid">6.6.9 Navigating to a fragment identifier</a></li><li><a href="browsers.html#history-traversal">6.6.10 History traversal</a><ol><li><a href="browsers.html#the-popstateevent-interface">6.6.10.1 The <code>PopStateEvent</code> interface</a></li><li><a href="browsers.html#the-hashchangeevent-interface">6.6.10.2 The <code>HashChangeEvent</code> interface</a></li><li><a href="browsers.html#the-pagetransitionevent-interface">6.6.10.3 The <code>PageTransitionEvent</code> interface</a></li></ol></li><li><a href="browsers.html#unloading-documents">6.6.11 Unloading documents</a><ol><li><a href="browsers.html#the-beforeunloadevent-interface">6.6.11.1 The <code>BeforeUnloadEvent</code> interface</a></li></ol></li><li><a href="browsers.html#aborting-a-document-load">6.6.12 Aborting a document load</a></li></ol></li><li><a href="browsers.html#offline">6.7 Offline Web applications</a><ol><li><a href="browsers.html#introduction-10">6.7.1 Introduction</a><ol><li><a href="browsers.html#supporting-offline-caching-for-legacy-applications">6.7.1.1 Supporting offline caching for legacy applications</a></li><li><a href="browsers.html#appcacheevents">6.7.1.2 Event summary</a></li></ol></li><li><a href="browsers.html#appcache">6.7.2 Application caches</a></li><li><a href="browsers.html#manifests">6.7.3 The cache manifest syntax</a><ol><li><a href="browsers.html#some-sample-manifests">6.7.3.1 Some sample manifests</a></li><li><a href="browsers.html#writing-cache-manifests">6.7.3.2 Writing cache manifests</a></li><li><a href="browsers.html#parsing-cache-manifests">6.7.3.3 Parsing cache manifests</a></li></ol></li><li><a href="browsers.html#downloading-or-updating-an-application-cache">6.7.4 Downloading or updating an application cache</a></li><li><a href="browsers.html#the-application-cache-selection-algorithm">6.7.5 The application cache selection algorithm</a></li><li><a href="browsers.html#changesToNetworkingModel">6.7.6 Changes to the networking model</a></li><li><a href="browsers.html#expiring-application-caches">6.7.7 Expiring application caches</a></li><li><a href="browsers.html#disk-space">6.7.8 Disk space</a></li><li><a href="browsers.html#security-concerns-with-offline-applications-caches">6.7.9 Security concerns with offline applications caches</a></li><li><a href="browsers.html#application-cache-api">6.7.10 Application cache API</a></li><li><a href="browsers.html#navigator.online">6.7.11 <span>Browser state</span></a></li></ol></li></ol></li></ol></section>

  

  



  



  



  



  




  

  





  

  




  <section><h2 id="browsers">6 Loading Web pages</h2>

  

  <p>This section describes features that apply most directly to Web browsers. Having said that,
  except where specified otherwise, the requirements defined in this section <em>do</em> apply to
  all user agents, whether they are Web browsers or not.</p>

  



  <section><h3 id="windows">6.1 Browsing contexts</h3>

  <p>A <dfn id="browsing-context">browsing context</dfn> is an environment in which <code id="windows:document"><a href="dom.html#document">Document</a></code> objects are
  presented to the user.</p>

  <p class="note">A tab or window in a Web browser typically contains a <a href="browsers.html#browsing-context" id="windows:browsing-context">browsing
  context</a>, as does an <code id="windows:the-iframe-element"><a href="semantics.html#the-iframe-element">iframe</a></code> or <code id="windows:frame"><a href="obsolete.html#frame">frame</a></code>s in a
  <code id="windows:frameset"><a href="obsolete.html#frameset">frameset</a></code>.</p>

  <p>Each <a href="browsers.html#browsing-context" id="windows:browsing-context-2">browsing context</a> has a corresponding <code id="windows:windowproxy"><a href="browsers.html#windowproxy">WindowProxy</a></code> object.</p>

  <p>A <a href="browsers.html#browsing-context" id="windows:browsing-context-3">browsing context</a> has a <a href="browsers.html#session-history" id="windows:session-history">session history</a>, which lists the
  <code id="windows:document-2"><a href="dom.html#document">Document</a></code> objects that that <a href="browsers.html#browsing-context" id="windows:browsing-context-4">browsing context</a> has presented, is
  presenting, or will present. At any time, one <code id="windows:document-3"><a href="dom.html#document">Document</a></code> in each <a href="browsers.html#browsing-context" id="windows:browsing-context-5">browsing
  context</a> is designated the <dfn id="active-document">active document</dfn>. A <code id="windows:document-4"><a href="dom.html#document">Document</a></code>'s
  <a href="browsers.html#browsing-context" id="windows:browsing-context-6">browsing context</a> is that <a href="browsers.html#browsing-context" id="windows:browsing-context-7">browsing context</a> whose <a href="browsers.html#session-history" id="windows:session-history-2">session
  history</a> contains the <code id="windows:document-5"><a href="dom.html#document">Document</a></code>, if any. (A <code id="windows:document-6"><a href="dom.html#document">Document</a></code> created using
  an API such as <code id="windows:dom-domimplementation-createdocument"><a href="infrastructure.html#dom-domimplementation-createdocument">createDocument()</a></code> has no
  <a href="browsers.html#browsing-context" id="windows:browsing-context-8">browsing context</a>.)</p>

  <p>Each <code id="windows:document-7"><a href="dom.html#document">Document</a></code> in a <a href="browsers.html#browsing-context" id="windows:browsing-context-9">browsing context</a> is <dfn id="concept-document-window">associated</dfn> with a <code id="windows:window"><a href="browsers.html#window">Window</a></code> object. A
  <a href="browsers.html#browsing-context" id="windows:browsing-context-10">browsing context</a>'s <code id="windows:windowproxy-2"><a href="browsers.html#windowproxy">WindowProxy</a></code> object forwards everything to the
  <a href="browsers.html#browsing-context" id="windows:browsing-context-11">browsing context</a>'s <a href="browsers.html#active-document" id="windows:active-document">active document</a>'s <code id="windows:window-2"><a href="browsers.html#window">Window</a></code> object.</p>

  <p class="note">In general, there is a 1-to-1 mapping from the <code id="windows:window-3"><a href="browsers.html#window">Window</a></code> object to the
  <code id="windows:document-8"><a href="dom.html#document">Document</a></code> object. There are two exceptions. First, a <code id="windows:window-4"><a href="browsers.html#window">Window</a></code> can be reused
  for the presentation of a second <code id="windows:document-9"><a href="dom.html#document">Document</a></code> in the same <a href="browsers.html#browsing-context" id="windows:browsing-context-12">browsing context</a>,
  such that the mapping is then 1-to-2. This occurs when a <a href="browsers.html#browsing-context" id="windows:browsing-context-13">browsing context</a> is <a href="browsers.html#navigate" id="windows:navigate">navigated</a> from the initial <code id="windows:about:blank"><a href="infrastructure.html#about:blank">about:blank</a></code> <code id="windows:document-10"><a href="dom.html#document">Document</a></code>
  to another, with <a href="browsers.html#replacement-enabled" id="windows:replacement-enabled">replacement enabled</a>. Second, a <code id="windows:document-11"><a href="dom.html#document">Document</a></code> can end up
  being reused for several <code id="windows:window-5"><a href="browsers.html#window">Window</a></code> objects when the <code id="windows:dom-document-open"><a href="webappapis.html#dom-document-open">document.open()</a></code> method is used, such that the mapping is then
  many-to-1.</p>

  <p class="note">A <code id="windows:document-12"><a href="dom.html#document">Document</a></code> does not necessarily have a <a href="browsers.html#browsing-context" id="windows:browsing-context-14">browsing context</a>
  associated with it. In particular, data mining tools are likely to never instantiate browsing
  contexts.</p>

  <hr>

  <p>A <a href="browsers.html#browsing-context" id="windows:browsing-context-15">browsing context</a> can have a <dfn id="creator-browsing-context">creator browsing context</dfn>, the
  <a href="browsers.html#browsing-context" id="windows:browsing-context-16">browsing context</a> that was responsible for its creation. If a <a href="browsers.html#browsing-context" id="windows:browsing-context-17">browsing
  context</a> has a <a href="browsers.html#parent-browsing-context" id="windows:parent-browsing-context">parent browsing context</a>, then that is its <a href="browsers.html#creator-browsing-context" id="windows:creator-browsing-context">creator browsing
  context</a>. Otherwise, if the <a href="browsers.html#browsing-context" id="windows:browsing-context-18">browsing context</a> has an <a href="browsers.html#opener-browsing-context" id="windows:opener-browsing-context">opener browsing
  context</a>, then <em>that</em> is its <a href="browsers.html#creator-browsing-context" id="windows:creator-browsing-context-2">creator browsing context</a>. Otherwise, the
  <a href="browsers.html#browsing-context" id="windows:browsing-context-19">browsing context</a> has no <a href="browsers.html#creator-browsing-context" id="windows:creator-browsing-context-3">creator browsing context</a>.</p>

  <p>If a <a href="browsers.html#browsing-context" id="windows:browsing-context-20">browsing context</a> <var>A</var> has a <a href="browsers.html#creator-browsing-context" id="windows:creator-browsing-context-4">creator browsing
  context</a>, then the <code id="windows:document-13"><a href="dom.html#document">Document</a></code> that was the <a href="browsers.html#active-document" id="windows:active-document-2">active document</a> of that
  <a href="browsers.html#creator-browsing-context" id="windows:creator-browsing-context-5">creator browsing context</a> at the time <var>A</var> was created is the
  <dfn id="creator-document">creator <code>Document</code></dfn>.</p>

  

  <p><dfn id="creating-a-new-browsing-context">Creating a browsing context</dfn>: When a <a href="browsers.html#browsing-context" id="windows:browsing-context-21">browsing context</a> is first created, it must be created with a single
  <code id="windows:document-14"><a href="dom.html#document">Document</a></code> in its session history, whose <a href="https://dom.spec.whatwg.org/#concept-document-url" id="windows:the-document's-address" data-x-internal="the-document's-address">address</a> is <code id="windows:about:blank-2"><a href="infrastructure.html#about:blank">about:blank</a></code>, which is marked as being an <a href="infrastructure.html#html-documents" id="windows:html-documents">HTML document</a>, whose <a href="infrastructure.html#document's-character-encoding" id="windows:document's-character-encoding">character encoding</a> is UTF-8, and which is both <a href="syntax.html#ready-for-post-load-tasks" id="windows:ready-for-post-load-tasks">ready for post-load
  tasks</a> and <a href="syntax.html#completely-loaded" id="windows:completely-loaded">completely loaded</a> immediately, along with a new <code id="windows:window-6"><a href="browsers.html#window">Window</a></code>
  object that the <code id="windows:document-15"><a href="dom.html#document">Document</a></code> is associated with. The <code id="windows:document-16"><a href="dom.html#document">Document</a></code> must have a
  single child <code id="windows:the-html-element"><a href="semantics.html#the-html-element">html</a></code> node, which itself has two empty child nodes: a <code id="windows:the-head-element"><a href="semantics.html#the-head-element">head</a></code>
  element, and a <code id="windows:the-body-element"><a href="semantics.html#the-body-element">body</a></code> element. As soon as this <code id="windows:document-17"><a href="dom.html#document">Document</a></code> is created, the
  user agent must <a href="browsers.html#implement-the-sandboxing" id="windows:implement-the-sandboxing">implement the sandboxing</a> for it. If the <a href="browsers.html#browsing-context" id="windows:browsing-context-22">browsing context</a>
  has a <a href="browsers.html#creator-document" id="windows:creator-document">creator <code>Document</code></a>, then the <a href="browsers.html#browsing-context" id="windows:browsing-context-23">browsing context</a>'s
  <code id="windows:document-18"><a href="dom.html#document">Document</a></code>'s <a href="dom.html#the-document's-referrer" id="windows:the-document's-referrer">referrer</a> must be set to
  <a href="https://dom.spec.whatwg.org/#concept-document-url" id="windows:the-document's-address-2" data-x-internal="the-document's-address">the address</a> of that <a href="browsers.html#creator-document" id="windows:creator-document-2">creator
  <code>Document</code></a> at the time of the <a href="browsers.html#browsing-context" id="windows:browsing-context-24">browsing context</a>'s creation.</p>

  <p class="note">If the <a href="browsers.html#browsing-context" id="windows:browsing-context-25">browsing context</a> is created specifically to be immediately
  navigated, then that initial navigation will have <a href="browsers.html#replacement-enabled" id="windows:replacement-enabled-2">replacement enabled</a>.</p>

  <p id="about-blank-origin">The <a href="browsers.html#origin-2" id="windows:origin-2">origin</a> and <a href="browsers.html#effective-script-origin" id="windows:effective-script-origin">effective script origin</a> of the
  <code id="windows:about:blank-3"><a href="infrastructure.html#about:blank">about:blank</a></code> <code id="windows:document-19"><a href="dom.html#document">Document</a></code> are set when the <code id="windows:document-20"><a href="dom.html#document">Document</a></code> is created.
  If the new <a href="browsers.html#browsing-context" id="windows:browsing-context-26">browsing context</a> has a <a href="browsers.html#creator-browsing-context" id="windows:creator-browsing-context-6">creator browsing context</a>, then the
  <a href="browsers.html#origin-2" id="windows:origin-2-2">origin</a> of the <code id="windows:about:blank-4"><a href="infrastructure.html#about:blank">about:blank</a></code> <code id="windows:document-21"><a href="dom.html#document">Document</a></code> is an <a href="browsers.html#concept-origin-alias" id="windows:concept-origin-alias">alias</a> to the <a href="browsers.html#origin-2" id="windows:origin-2-3">origin</a> of the <a href="browsers.html#creator-document" id="windows:creator-document-3">creator
  <code>Document</code></a> and the <a href="browsers.html#effective-script-origin" id="windows:effective-script-origin-2">effective script origin</a> of the
  <code id="windows:about:blank-5"><a href="infrastructure.html#about:blank">about:blank</a></code> <code id="windows:document-22"><a href="dom.html#document">Document</a></code> is initially an <a href="browsers.html#concept-origin-alias" id="windows:concept-origin-alias-2">alias</a> to the <a href="browsers.html#effective-script-origin" id="windows:effective-script-origin-3">effective script origin</a> of the
  <a href="browsers.html#creator-document" id="windows:creator-document-4">creator <code>Document</code></a>. Otherwise, the <a href="browsers.html#origin-2" id="windows:origin-2-4">origin</a> of the
  <code id="windows:about:blank-6"><a href="infrastructure.html#about:blank">about:blank</a></code> <code id="windows:document-23"><a href="dom.html#document">Document</a></code> is a globally unique identifier assigned when the
  new <a href="browsers.html#browsing-context" id="windows:browsing-context-27">browsing context</a> is created and the <a href="browsers.html#effective-script-origin" id="windows:effective-script-origin-4">effective script origin</a> of the
  <code id="windows:about:blank-7"><a href="infrastructure.html#about:blank">about:blank</a></code> <code id="windows:document-24"><a href="dom.html#document">Document</a></code> is initially an <a href="browsers.html#concept-origin-alias" id="windows:concept-origin-alias-3">alias</a> to its <a href="browsers.html#origin-2" id="windows:origin-2-5">origin</a>.</p>

  


  <section><h4 id="nested-browsing-contexts">6.1.1 Nested browsing contexts</h4>

  <p>Certain elements (for example, <code id="nested-browsing-contexts:the-iframe-element"><a href="semantics.html#the-iframe-element">iframe</a></code> elements) can instantiate further <a href="browsers.html#browsing-context" id="nested-browsing-contexts:browsing-context">browsing contexts</a>. These are called <dfn id="nested-browsing-context">nested browsing contexts</dfn>. If a browsing context <var>P</var> has a
  <code id="nested-browsing-contexts:document"><a href="dom.html#document">Document</a></code> <var>D</var> with an element <var>E</var> that nests
  another browsing context <var>C</var> inside it, then <var>C</var> is said to be
  <dfn id="browsing-context-nested-through">nested through</dfn> <var>D</var>, and <var>E</var> is said to be the <dfn id="browsing-context-container">browsing context container</dfn> of <var>C</var>.
  If the <a href="browsers.html#browsing-context-container" id="nested-browsing-contexts:browsing-context-container">browsing context container</a> element <var>E</var> is <a href="infrastructure.html#in-a-document" id="nested-browsing-contexts:in-a-document">in</a> the <code id="nested-browsing-contexts:document-2"><a href="dom.html#document">Document</a></code> <var>D</var>, then <var>P</var> is
  said to be the <dfn id="parent-browsing-context">parent browsing context</dfn> of <var>C</var> and <var>C</var> is said to be a <dfn id="child-browsing-context">child browsing context</dfn> of <var>P</var>.
  Otherwise, the <a href="browsers.html#nested-browsing-context" id="nested-browsing-contexts:nested-browsing-context">nested browsing context</a> <var>C</var> has no <a href="browsers.html#parent-browsing-context" id="nested-browsing-contexts:parent-browsing-context">parent
  browsing context</a>.</p>

  <p>A browsing context <var>A</var> is said to be an <dfn id="ancestor-browsing-context">ancestor</dfn> of a browsing context <var>B</var> if there exists a browsing
  context <var>A'</var> that is a <a href="browsers.html#child-browsing-context" id="nested-browsing-contexts:child-browsing-context">child browsing context</a> of <var>A</var> and that is itself an <a href="browsers.html#ancestor-browsing-context" id="nested-browsing-contexts:ancestor-browsing-context">ancestor</a> of
  <var>B</var>, or if the browsing context <var>A</var> is the
  <a href="browsers.html#parent-browsing-context" id="nested-browsing-contexts:parent-browsing-context-2">parent browsing context</a> of <var>B</var>.</p>

  <p>A browsing context that is not a <a href="browsers.html#nested-browsing-context" id="nested-browsing-contexts:nested-browsing-context-2">nested browsing context</a> has no <a href="browsers.html#parent-browsing-context" id="nested-browsing-contexts:parent-browsing-context-3">parent
  browsing context</a>, and is the <dfn id="top-level-browsing-context">top-level browsing context</dfn> of all the browsing
  contexts for which it is an <a href="browsers.html#ancestor-browsing-context" id="nested-browsing-contexts:ancestor-browsing-context-2">ancestor browsing context</a>.</p>

  <p>The transitive closure of <a href="browsers.html#parent-browsing-context" id="nested-browsing-contexts:parent-browsing-context-4">parent browsing contexts</a>
  for a <a href="browsers.html#nested-browsing-context" id="nested-browsing-contexts:nested-browsing-context-3">nested browsing context</a> gives the list of <a href="browsers.html#ancestor-browsing-context" id="nested-browsing-contexts:ancestor-browsing-context-3">ancestor browsing contexts</a>.</p>

  <p>The <dfn id="list-of-the-descendant-browsing-contexts">list of the descendant browsing contexts</dfn> of a <code id="nested-browsing-contexts:document-3"><a href="dom.html#document">Document</a></code> <var>d</var> is the (ordered) list returned by the following algorithm:</p>

  <ol><li><p>Let <var>list</var> be an empty list.</p></li><li>

    <p>For each <a href="browsers.html#child-browsing-context" id="nested-browsing-contexts:child-browsing-context-2">child browsing context</a> of <var>d</var> that is <a href="browsers.html#browsing-context-nested-through" id="nested-browsing-contexts:browsing-context-nested-through">nested through</a> an element that is <a href="infrastructure.html#in-a-document" id="nested-browsing-contexts:in-a-document-2">in the <code>Document</code></a> <var>d</var>, in the <a href="infrastructure.html#tree-order" id="nested-browsing-contexts:tree-order">tree
    order</a> of the elements nesting those <a href="browsers.html#browsing-context" id="nested-browsing-contexts:browsing-context-2">browsing
    contexts</a>, run these substeps:</p>

    <ol><li><p>Append that <a href="browsers.html#child-browsing-context" id="nested-browsing-contexts:child-browsing-context-3">child browsing context</a> to the list <var>list</var>.</p>

     </li><li><p>Append the <a href="browsers.html#list-of-the-descendant-browsing-contexts" id="nested-browsing-contexts:list-of-the-descendant-browsing-contexts">list of the descendant browsing contexts</a> of the <a href="browsers.html#active-document" id="nested-browsing-contexts:active-document">active
     document</a> of that <a href="browsers.html#child-browsing-context" id="nested-browsing-contexts:child-browsing-context-4">child browsing context</a> to the list <var>list</var>.</p></li></ol>

   </li><li><p>Return the constructed <var>list</var>.</p></li></ol>

  <p>A <code id="nested-browsing-contexts:document-4"><a href="dom.html#document">Document</a></code> is said to be <dfn id="fully-active">fully active</dfn> when it is the <a href="browsers.html#active-document" id="nested-browsing-contexts:active-document-2">active
  document</a> of its <a href="browsers.html#browsing-context" id="nested-browsing-contexts:browsing-context-3">browsing context</a>, and either its browsing context is a
  <a href="browsers.html#top-level-browsing-context" id="nested-browsing-contexts:top-level-browsing-context">top-level browsing context</a>, or it has a <a href="browsers.html#parent-browsing-context" id="nested-browsing-contexts:parent-browsing-context-5">parent browsing context</a> and the
  <code id="nested-browsing-contexts:document-5"><a href="dom.html#document">Document</a></code> <a href="browsers.html#browsing-context-nested-through" id="nested-browsing-contexts:browsing-context-nested-through-2">through which</a> it is
  <a href="browsers.html#nested-browsing-context" id="nested-browsing-contexts:nested-browsing-context-4">nested</a> is itself <a href="browsers.html#fully-active" id="nested-browsing-contexts:fully-active">fully active</a>.</p>

  <p>Because they are nested through an element, <a href="browsers.html#child-browsing-context" id="nested-browsing-contexts:child-browsing-context-5">child browsing
  contexts</a> are always tied to a specific <code id="nested-browsing-contexts:document-6"><a href="dom.html#document">Document</a></code> in their <a href="browsers.html#parent-browsing-context" id="nested-browsing-contexts:parent-browsing-context-6">parent browsing
  context</a>. User agents must not allow the user to interact with <a href="browsers.html#child-browsing-context" id="nested-browsing-contexts:child-browsing-context-6">child browsing contexts</a> of elements that are in <code id="nested-browsing-contexts:document-7"><a href="dom.html#document">Document</a></code>s that are
  not themselves <a href="browsers.html#fully-active" id="nested-browsing-contexts:fully-active-2">fully active</a>.</p>

  <p>A <a href="browsers.html#nested-browsing-context" id="nested-browsing-contexts:nested-browsing-context-5">nested browsing context</a> can have a <a href="semantics.html#seamless-browsing-context-flag" id="nested-browsing-contexts:seamless-browsing-context-flag">seamless browsing context flag</a>
  set, if it is embedded through an <code id="nested-browsing-contexts:the-iframe-element-2"><a href="semantics.html#the-iframe-element">iframe</a></code> element with a <code id="nested-browsing-contexts:attr-iframe-seamless"><a href="semantics.html#attr-iframe-seamless">seamless</a></code> attribute.</p>

  <p>A <a href="browsers.html#nested-browsing-context" id="nested-browsing-contexts:nested-browsing-context-6">nested browsing context</a> can be put into a <dfn id="delaying-load-events-mode">delaying <code>load</code> events mode</dfn>. This is used when it is <a href="browsers.html#navigate" id="nested-browsing-contexts:navigate">navigated</a>, to <a href="syntax.html#delay-the-load-event" id="nested-browsing-contexts:delay-the-load-event">delay the load event</a> of the <a href="browsers.html#browsing-context-container" id="nested-browsing-contexts:browsing-context-container-2">browsing
  context container</a> before the new <code id="nested-browsing-contexts:document-8"><a href="dom.html#document">Document</a></code> is created.</p>



  <p>The <dfn id="document-family">document family</dfn> of a <a href="browsers.html#browsing-context" id="nested-browsing-contexts:browsing-context-4">browsing context</a> consists of the union of all
  the <code id="nested-browsing-contexts:document-9"><a href="dom.html#document">Document</a></code> objects in that <a href="browsers.html#browsing-context" id="nested-browsing-contexts:browsing-context-5">browsing context</a>'s <a href="browsers.html#session-history" id="nested-browsing-contexts:session-history">session
  history</a> and the <a href="browsers.html#document-family" id="nested-browsing-contexts:document-family">document families</a> of all those
  <code id="nested-browsing-contexts:document-10"><a href="dom.html#document">Document</a></code> objects. The <a href="browsers.html#document-family" id="nested-browsing-contexts:document-family-2">document family</a> of a <code id="nested-browsing-contexts:document-11"><a href="dom.html#document">Document</a></code> object
  consists of the union of all the <a href="browsers.html#document-family" id="nested-browsing-contexts:document-family-3">document families</a> of the
  <a href="browsers.html#browsing-context" id="nested-browsing-contexts:browsing-context-6">browsing contexts</a> that are <a href="browsers.html#browsing-context-nested-through" id="nested-browsing-contexts:browsing-context-nested-through-3">nested through</a> the <code id="nested-browsing-contexts:document-12"><a href="dom.html#document">Document</a></code> object.</p>


  <section><h5 id="navigating-nested-browsing-contexts-in-the-dom">6.1.1.1 Navigating nested browsing contexts in the DOM</h5>

  <dl class="domintro"><dt><var>window</var> . <code id="navigating-nested-browsing-contexts-in-the-dom:dom-top"><a href="browsers.html#dom-top">top</a></code></dt><dd>

    <p>Returns the <code id="navigating-nested-browsing-contexts-in-the-dom:windowproxy"><a href="browsers.html#windowproxy">WindowProxy</a></code> for the <a href="browsers.html#top-level-browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context">top-level browsing context</a>.</p>

   </dd><dt><var>window</var> . <code id="navigating-nested-browsing-contexts-in-the-dom:dom-parent"><a href="browsers.html#dom-parent">parent</a></code></dt><dd>

    <p>Returns the <code id="navigating-nested-browsing-contexts-in-the-dom:windowproxy-2"><a href="browsers.html#windowproxy">WindowProxy</a></code> for the <a href="browsers.html#parent-browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:parent-browsing-context">parent browsing context</a>.</p>

   </dd><dt><var>window</var> . <code id="navigating-nested-browsing-contexts-in-the-dom:dom-frameelement"><a href="browsers.html#dom-frameelement">frameElement</a></code></dt><dd>

    <p>Returns the <code id="navigating-nested-browsing-contexts-in-the-dom:element"><a href="infrastructure.html#element">Element</a></code> for the <a href="browsers.html#browsing-context-container" id="navigating-nested-browsing-contexts-in-the-dom:browsing-context-container">browsing context container</a>.</p>

    <p>Returns null if there isn't one.</p>

    <p>Throws a <code id="navigating-nested-browsing-contexts-in-the-dom:securityerror"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception in cross-origin situations.</p>

   </dd></dl>

  

  <p>The <dfn id="dom-top"><code>top</code></dfn> IDL attribute on the <code id="navigating-nested-browsing-contexts-in-the-dom:window"><a href="browsers.html#window">Window</a></code> object
  of a <code id="navigating-nested-browsing-contexts-in-the-dom:document"><a href="dom.html#document">Document</a></code> in a <a href="browsers.html#browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:browsing-context">browsing context</a> <var>b</var> must return
  the <code id="navigating-nested-browsing-contexts-in-the-dom:windowproxy-3"><a href="browsers.html#windowproxy">WindowProxy</a></code> object of its <a href="browsers.html#top-level-browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context-2">top-level browsing context</a> (which would be
  its own <code id="navigating-nested-browsing-contexts-in-the-dom:windowproxy-4"><a href="browsers.html#windowproxy">WindowProxy</a></code> object if it was a <a href="browsers.html#top-level-browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context-3">top-level browsing context</a>
  itself), if it has one, or its own <code id="navigating-nested-browsing-contexts-in-the-dom:windowproxy-5"><a href="browsers.html#windowproxy">WindowProxy</a></code> object otherwise (e.g. if it was a
  detached <a href="browsers.html#nested-browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:nested-browsing-context">nested browsing context</a>).</p>

  <p>The <dfn id="dom-parent"><code>parent</code></dfn> IDL attribute on the <code id="navigating-nested-browsing-contexts-in-the-dom:window-2"><a href="browsers.html#window">Window</a></code>
  object of a <code id="navigating-nested-browsing-contexts-in-the-dom:document-2"><a href="dom.html#document">Document</a></code> in a <a href="browsers.html#browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:browsing-context-2">browsing context</a> <var>b</var> must
  return the <code id="navigating-nested-browsing-contexts-in-the-dom:windowproxy-6"><a href="browsers.html#windowproxy">WindowProxy</a></code> object of the <a href="browsers.html#parent-browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:parent-browsing-context-2">parent browsing context</a>, if there
  is one (i.e. if <var>b</var> is a <a href="browsers.html#child-browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:child-browsing-context">child browsing context</a>), or the
  <code id="navigating-nested-browsing-contexts-in-the-dom:windowproxy-7"><a href="browsers.html#windowproxy">WindowProxy</a></code> object of the <a href="browsers.html#browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:browsing-context-3">browsing context</a> <var>b</var> itself,
  otherwise (i.e. if it is a <a href="browsers.html#top-level-browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:top-level-browsing-context-4">top-level browsing context</a> or a detached <a href="browsers.html#nested-browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:nested-browsing-context-2">nested
  browsing context</a>).</p>

  <p>The <dfn id="dom-frameelement"><code>frameElement</code></dfn> IDL attribute on the
  <code id="navigating-nested-browsing-contexts-in-the-dom:window-3"><a href="browsers.html#window">Window</a></code> object of a <code id="navigating-nested-browsing-contexts-in-the-dom:document-3"><a href="dom.html#document">Document</a></code> <var>d</var>, on getting, must run
  the following algorithm:</p>

  <ol><li><p>If <var>d</var> is not a <code id="navigating-nested-browsing-contexts-in-the-dom:document-4"><a href="dom.html#document">Document</a></code> in a <a href="browsers.html#nested-browsing-context" id="navigating-nested-browsing-contexts-in-the-dom:nested-browsing-context-3">nested browsing
   context</a>, return null and abort these steps.</p></li><li><p>If the <a href="browsers.html#browsing-context-container" id="navigating-nested-browsing-contexts-in-the-dom:browsing-context-container-2">browsing context container</a>'s <a id="navigating-nested-browsing-contexts-in-the-dom:node-document" href="https://dom.spec.whatwg.org/#concept-node-document" data-x-internal="node-document">node document</a> does not have the
   <a href="browsers.html#same-origin" id="navigating-nested-browsing-contexts-in-the-dom:same-origin">same</a> <a href="browsers.html#effective-script-origin" id="navigating-nested-browsing-contexts-in-the-dom:effective-script-origin">effective script origin</a> as the
   <a href="browsers.html#effective-script-origin" id="navigating-nested-browsing-contexts-in-the-dom:effective-script-origin-2">effective script origin</a> specified by the <a href="webappapis.html#entry-settings-object" id="navigating-nested-browsing-contexts-in-the-dom:entry-settings-object">entry settings object</a>, then
   throw a <code id="navigating-nested-browsing-contexts-in-the-dom:securityerror-2"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</p></li><li><p>Return the <a href="browsers.html#browsing-context-container" id="navigating-nested-browsing-contexts-in-the-dom:browsing-context-container-3">browsing context container</a> for <var>b</var>.</p></li></ol></section></section>

  



  <section><h4 id="auxiliary-browsing-contexts">6.1.2 Auxiliary browsing contexts</h4>

  <p>It is possible to create new browsing contexts that are related to a <a href="browsers.html#top-level-browsing-context" id="auxiliary-browsing-contexts:top-level-browsing-context">top-level browsing
  context</a> without being nested through an element. Such browsing contexts are called <dfn id="auxiliary-browsing-context">auxiliary browsing contexts</dfn>. Auxiliary browsing contexts
  are always <a href="browsers.html#top-level-browsing-context" id="auxiliary-browsing-contexts:top-level-browsing-context-2">top-level browsing contexts</a>.</p>

  <p>An <a href="browsers.html#auxiliary-browsing-context" id="auxiliary-browsing-contexts:auxiliary-browsing-context">auxiliary browsing context</a> has an <dfn id="opener-browsing-context">opener browsing context</dfn>, which is
  the <a href="browsers.html#browsing-context" id="auxiliary-browsing-contexts:browsing-context">browsing context</a> from which the <a href="browsers.html#auxiliary-browsing-context" id="auxiliary-browsing-contexts:auxiliary-browsing-context-2">auxiliary browsing context</a> was
  created.</p>


  <section><h5 id="navigating-auxiliary-browsing-contexts-in-the-dom">6.1.2.1 Navigating auxiliary browsing contexts in the DOM</h5>

  <p>The <dfn id="dom-opener"><code>opener</code></dfn> IDL attribute on the <code id="navigating-auxiliary-browsing-contexts-in-the-dom:window"><a href="browsers.html#window">Window</a></code>
  object, on getting, must return the <code id="navigating-auxiliary-browsing-contexts-in-the-dom:windowproxy"><a href="browsers.html#windowproxy">WindowProxy</a></code> object of the <a href="browsers.html#browsing-context" id="navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context">browsing
  context</a> from which the current <a href="browsers.html#browsing-context" id="navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-2">browsing context</a> was created (its <a href="browsers.html#opener-browsing-context" id="navigating-auxiliary-browsing-contexts-in-the-dom:opener-browsing-context">opener
  browsing context</a>), if there is one, if it is still available, and if the current
  <a href="browsers.html#browsing-context" id="navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-3">browsing context</a> has not <i id="navigating-auxiliary-browsing-contexts-in-the-dom:disowned-its-opener"><a href="browsers.html#disowned-its-opener">disowned its opener</a></i>;
  otherwise, it must return null. On setting, if the new value is null then the current
  <a href="browsers.html#browsing-context" id="navigating-auxiliary-browsing-contexts-in-the-dom:browsing-context-4">browsing context</a> must <dfn id="disowned-its-opener">disown its opener</dfn>; if
  the new value is anything else then the user agent must

    
    call the [[DefineOwnProperty]] internal method of the <code id="navigating-auxiliary-browsing-contexts-in-the-dom:window-2"><a href="browsers.html#window">Window</a></code> object, passing the
    property name "<code>opener</code>" as the property key, and the Property Descriptor {
    [[Value]]: <var>value</var>, [[Writable]]: true, [[Enumerable]]: true,
    [[Configurable]]: true } as the property descriptor,
    

  where <var>value</var> is the new value.</p></section></section>



  <section><h4 id="secondary-browsing-contexts">6.1.3 Secondary browsing contexts</h4>

  <p>User agents may support <dfn id="secondary-browsing-context">secondary browsing
  contexts</dfn>, which are <a href="browsers.html#browsing-context" id="secondary-browsing-contexts:browsing-context">browsing contexts</a> that form part
  of the user agent's interface, apart from the main content area.</p>

  </section>



  

  <section><h4 id="security-nav">6.1.4 Security</h4>

  <p id="security-1">A <a href="browsers.html#browsing-context" id="security-nav:browsing-context">browsing context</a> <var>A</var> is <dfn id="familiar-with">familiar
  with</dfn> a second <a href="browsers.html#browsing-context" id="security-nav:browsing-context-2">browsing context</a> <var>B</var> if one of the following
  conditions is true:</p>

  <ul><li>Either the <a href="browsers.html#origin-2" id="security-nav:origin-2">origin</a> of the <a href="browsers.html#active-document" id="security-nav:active-document">active document</a> of <var>A</var>
   is the <a href="browsers.html#same-origin" id="security-nav:same-origin">same</a> as the <a href="browsers.html#origin-2" id="security-nav:origin-2-2">origin</a> of the <a href="browsers.html#active-document" id="security-nav:active-document-2">active
   document</a> of <var>B</var>, or</li><li>The browsing context <var>A</var> is a <a href="browsers.html#nested-browsing-context" id="security-nav:nested-browsing-context">nested browsing context</a> with a
   <a href="browsers.html#top-level-browsing-context" id="security-nav:top-level-browsing-context">top-level browsing context</a>, and its <a href="browsers.html#top-level-browsing-context" id="security-nav:top-level-browsing-context-2">top-level browsing context</a> is <var>B</var>, or</li><li>The browsing context <var>B</var> is an <a href="browsers.html#auxiliary-browsing-context" id="security-nav:auxiliary-browsing-context">auxiliary browsing context</a> and
   <var>A</var> is <a href="browsers.html#familiar-with" id="security-nav:familiar-with">familiar with</a> <var>B</var>'s <a href="browsers.html#opener-browsing-context" id="security-nav:opener-browsing-context">opener
   browsing context</a>, or</li><li>The browsing context <var>B</var> is not a <a href="browsers.html#top-level-browsing-context" id="security-nav:top-level-browsing-context-3">top-level browsing context</a>,
   but there exists an <a href="browsers.html#ancestor-browsing-context" id="security-nav:ancestor-browsing-context">ancestor browsing context</a> of <var>B</var> whose
   <a href="browsers.html#active-document" id="security-nav:active-document-3">active document</a> has the <a href="browsers.html#same-origin" id="security-nav:same-origin-2">same</a> <a href="browsers.html#origin-2" id="security-nav:origin-2-3">origin</a> as
   the <a href="browsers.html#active-document" id="security-nav:active-document-4">active document</a> of <var>A</var> (possibly in fact being <var>A</var> itself).</li></ul>

  <hr>

  <p>A <a href="browsers.html#browsing-context" id="security-nav:browsing-context-3">browsing context</a> <var>A</var> is <dfn id="allowed-to-navigate">allowed to navigate</dfn> a
  second <a href="browsers.html#browsing-context" id="security-nav:browsing-context-4">browsing context</a> <var>B</var> if the following algorithm terminates
  positively:</p>

  <ol><li><p>If <var>A</var> is not the same <a href="browsers.html#browsing-context" id="security-nav:browsing-context-5">browsing context</a> as <var>B</var>, and <var>A</var> is not one of the <a href="browsers.html#ancestor-browsing-context" id="security-nav:ancestor-browsing-context-2">ancestor browsing contexts</a> of <var>B</var>, and <var>B</var>
   is not a <a href="browsers.html#top-level-browsing-context" id="security-nav:top-level-browsing-context-4">top-level browsing context</a>, and <var>A</var>'s <a href="browsers.html#active-document" id="security-nav:active-document-5">active
   document</a>'s <a href="browsers.html#active-sandboxing-flag-set" id="security-nav:active-sandboxing-flag-set">active sandboxing flag set</a> has its <a href="browsers.html#sandboxed-navigation-browsing-context-flag" id="security-nav:sandboxed-navigation-browsing-context-flag">sandboxed navigation
   browsing context flag</a> set, then abort these steps negatively.</p></li><li><p>Otherwise, if <var>B</var> is a <a href="browsers.html#top-level-browsing-context" id="security-nav:top-level-browsing-context-5">top-level browsing context</a>, and is
   one of the <a href="browsers.html#ancestor-browsing-context" id="security-nav:ancestor-browsing-context-3">ancestor browsing contexts</a> of <var>A</var>, and <var>A</var>'s <a id="security-nav:node-document" href="https://dom.spec.whatwg.org/#concept-node-document" data-x-internal="node-document">node document</a>'s <a href="browsers.html#active-sandboxing-flag-set" id="security-nav:active-sandboxing-flag-set-2">active sandboxing
   flag set</a> has its <a href="browsers.html#sandboxed-top-level-navigation-browsing-context-flag" id="security-nav:sandboxed-top-level-navigation-browsing-context-flag">sandboxed top-level navigation browsing context flag</a> set,
   then abort these steps negatively.</p></li><li><p>Otherwise, if <var>B</var> is a <a href="browsers.html#top-level-browsing-context" id="security-nav:top-level-browsing-context-6">top-level browsing context</a>, and is
   neither <var>A</var> nor one of the <a href="browsers.html#ancestor-browsing-context" id="security-nav:ancestor-browsing-context-4">ancestor
   browsing contexts</a> of <var>A</var>, and <var>A</var>'s
   <code id="security-nav:document"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#active-sandboxing-flag-set" id="security-nav:active-sandboxing-flag-set-3">active sandboxing flag set</a> has its <a href="browsers.html#sandboxed-navigation-browsing-context-flag" id="security-nav:sandboxed-navigation-browsing-context-flag-2">sandboxed
   navigation browsing context flag</a> set, and <var>A</var> is not the <a href="browsers.html#one-permitted-sandboxed-navigator" id="security-nav:one-permitted-sandboxed-navigator">one
   permitted sandboxed navigator</a> of <var>B</var>, then abort these steps
   negatively.</p></li><li><p>Otherwise, terminate positively!</p></li></ol>

  <hr>

  <p>An element has a <dfn id="browsing-context-scope-origin">browsing context scope origin</dfn> if its <code id="security-nav:document-2"><a href="dom.html#document">Document</a></code>'s
  <a href="browsers.html#browsing-context" id="security-nav:browsing-context-6">browsing context</a> is a <a href="browsers.html#top-level-browsing-context" id="security-nav:top-level-browsing-context-7">top-level browsing context</a> or if all of its
  <code id="security-nav:document-3"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#ancestor-browsing-context" id="security-nav:ancestor-browsing-context-5">ancestor browsing contexts</a>
  all have <a href="browsers.html#active-document" id="security-nav:active-document-6">active documents</a> whose <a href="browsers.html#origin-2" id="security-nav:origin-2-4">origin</a> are the
  <a href="browsers.html#same-origin" id="security-nav:same-origin-3">same origin</a> as the element's <a id="security-nav:node-document-2" href="https://dom.spec.whatwg.org/#concept-node-document" data-x-internal="node-document">node document</a>'s <a href="browsers.html#origin-2" id="security-nav:origin-2-5">origin</a>. If an
  element has a <a href="browsers.html#browsing-context-scope-origin" id="security-nav:browsing-context-scope-origin">browsing context scope origin</a>, then its value is the
  <a href="browsers.html#origin-2" id="security-nav:origin-2-6">origin</a> of the element's <a id="security-nav:node-document-3" href="https://dom.spec.whatwg.org/#concept-node-document" data-x-internal="node-document">node document</a>.</p></section>

  



  

  <section><h4 id="groupings-of-browsing-contexts">6.1.5 Groupings of browsing contexts</h4>

  <p>Each <a href="browsers.html#browsing-context" id="groupings-of-browsing-contexts:browsing-context">browsing context</a> is defined as having a list of one or more <dfn id="directly-reachable-browsing-contexts">directly
  reachable browsing contexts</dfn>. These are:</p>

  <ul><li>The <a href="browsers.html#browsing-context" id="groupings-of-browsing-contexts:browsing-context-2">browsing context</a> itself.</li><li>All the <a href="browsers.html#browsing-context" id="groupings-of-browsing-contexts:browsing-context-3">browsing context</a>'s <a href="browsers.html#child-browsing-context" id="groupings-of-browsing-contexts:child-browsing-context">child browsing
   contexts</a>.</li><li>The <a href="browsers.html#browsing-context" id="groupings-of-browsing-contexts:browsing-context-4">browsing context</a>'s <a href="browsers.html#parent-browsing-context" id="groupings-of-browsing-contexts:parent-browsing-context">parent browsing context</a>.</li><li>All the <a href="browsers.html#browsing-context" id="groupings-of-browsing-contexts:browsing-context-5">browsing contexts</a> that have the <a href="browsers.html#browsing-context" id="groupings-of-browsing-contexts:browsing-context-6">browsing
   context</a> as their <a href="browsers.html#opener-browsing-context" id="groupings-of-browsing-contexts:opener-browsing-context">opener browsing context</a>.</li><li>The <a href="browsers.html#browsing-context" id="groupings-of-browsing-contexts:browsing-context-7">browsing context</a>'s <a href="browsers.html#opener-browsing-context" id="groupings-of-browsing-contexts:opener-browsing-context-2">opener browsing context</a>.</li></ul>

  <p>The transitive closure of all the <a href="browsers.html#browsing-context" id="groupings-of-browsing-contexts:browsing-context-8">browsing contexts</a> that
  are <a href="browsers.html#directly-reachable-browsing-contexts" id="groupings-of-browsing-contexts:directly-reachable-browsing-contexts">directly reachable browsing contexts</a> forms a <dfn id="unit-of-related-browsing-contexts">unit of related browsing
  contexts</dfn>.</p>

  <p>Each <a href="browsers.html#unit-of-related-browsing-contexts" id="groupings-of-browsing-contexts:unit-of-related-browsing-contexts">unit of related browsing contexts</a> is then further divided into the smallest
  number of groups such that every member of each group has an <a href="browsers.html#active-document" id="groupings-of-browsing-contexts:active-document">active document</a> with an
  <a href="browsers.html#effective-script-origin" id="groupings-of-browsing-contexts:effective-script-origin">effective script origin</a> that, through appropriate manipulation of the <code id="groupings-of-browsing-contexts:dom-document-domain"><a href="browsers.html#dom-document-domain">document.domain</a></code> attribute, could be made to be the same as
  other members of the group, but could not be made the same as members of any other group. Each
  such group is a <dfn id="unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin browsing contexts</dfn>.</p>

  <p class="note">There is also at most one <a href="webappapis.html#event-loop" id="groupings-of-browsing-contexts:event-loop">event loop</a> per <a href="browsers.html#unit-of-related-similar-origin-browsing-contexts" id="groupings-of-browsing-contexts:unit-of-related-similar-origin-browsing-contexts">unit of related
  similar-origin browsing contexts</a> (though several <a href="browsers.html#unit-of-related-similar-origin-browsing-contexts" id="groupings-of-browsing-contexts:unit-of-related-similar-origin-browsing-contexts-2">units of related similar-origin browsing contexts</a> can
  have a shared <a href="webappapis.html#event-loop" id="groupings-of-browsing-contexts:event-loop-2">event loop</a>).</p></section>

  



  <section><h4 id="browsing-context-names">6.1.6 Browsing context names</h4>

  <p>Browsing contexts can have a <dfn id="browsing-context-name">browsing context name</dfn>. By default, a browsing context
  has no name (its name is not set).</p>

  <p>A <dfn id="valid-browsing-context-name">valid browsing context name</dfn> is any string with at least one character that does
  not start with a U+005F LOW LINE character. (Names starting with an underscore are reserved for
  special keywords.)</p>

  <p>A <dfn id="valid-browsing-context-name-or-keyword">valid browsing context name or keyword</dfn> is any string that is either a <a href="browsers.html#valid-browsing-context-name" id="browsing-context-names:valid-browsing-context-name">valid
  browsing context name</a> or that is an <a href="infrastructure.html#ascii-case-insensitive" id="browsing-context-names:ascii-case-insensitive">ASCII case-insensitive</a> match for one of:
  <code>_blank</code>, <code>_self</code>, <code>_parent</code>, or <code>_top</code>.</p>

  <p>These values have different meanings based on whether the page is sandboxed or not, as
  summarised in the following (non-normative) table. In this table, "current" means the
  <a href="browsers.html#browsing-context" id="browsing-context-names:browsing-context">browsing context</a> that the link or script is in, "parent" means the <a href="browsers.html#parent-browsing-context" id="browsing-context-names:parent-browsing-context">parent
  browsing context</a> of the one the link or script is in, "master" means the nearest
  <a href="browsers.html#ancestor-browsing-context" id="browsing-context-names:ancestor-browsing-context">ancestor browsing context</a> of the one the link or script is in that is not itself in a
  <a href="semantics.html#attr-iframe-seamless" id="browsing-context-names:attr-iframe-seamless">seamless iframe</a>, "top" means the <a href="browsers.html#top-level-browsing-context" id="browsing-context-names:top-level-browsing-context">top-level
  browsing context</a> of the one the link or script is in, "new" means a new <a href="browsers.html#top-level-browsing-context" id="browsing-context-names:top-level-browsing-context-2">top-level
  browsing context</a> or <a href="browsers.html#auxiliary-browsing-context" id="browsing-context-names:auxiliary-browsing-context">auxiliary browsing context</a> is to be created, subject to
  various user preferences and user agent policies, "none" means that nothing will happen, and
  "maybe new" means the same as "new" if the "<code id="browsing-context-names:attr-iframe-sandbox-allow-popups"><a href="browsers.html#attr-iframe-sandbox-allow-popups">allow-popups</a></code>" keyword is also specified on the
  <code id="browsing-context-names:attr-iframe-sandbox"><a href="semantics.html#attr-iframe-sandbox">sandbox</a></code> attribute (or if the user overrode the
  sandboxing), and the same as "none" otherwise.</p>

  <table><thead><tr><th rowspan="2">Keyword
     </th><th rowspan="2">Ordinary effect
     </th><th colspan="5">Effect in an <code id="browsing-context-names:the-iframe-element"><a href="semantics.html#the-iframe-element">iframe</a></code> with...
    </th></tr><tr><th><code>seamless=""</code>
     </th><th><code>sandbox=""</code>
     </th><th><code>sandbox="" seamless=""</code>
     </th><th><code>sandbox="allow-top-navigation"</code>
     </th><th><code>sandbox="allow-top-navigation" seamless=""</code>

   </th></tr></thead><tbody><tr><td>none specified, for links and form submissions 
     </td><td>current
     </td><td>master
     </td><td>current
     </td><td>master
     </td><td>current
     </td><td>master

    </td></tr><tr><td>empty string
     </td><td>current
     </td><td>master
     </td><td>current
     </td><td>master
     </td><td>current
     </td><td>master

    </td></tr><tr><td><code>_blank</code>
     </td><td>new
     </td><td>new
     </td><td>maybe new
     </td><td>maybe new
     </td><td>maybe new
     </td><td>maybe new

    </td></tr><tr><td><code>_self</code>
     </td><td>current
     </td><td>current
     </td><td>current
     </td><td>current
     </td><td>current
     </td><td>current

    </td></tr><tr><td><code>_parent</code> if there isn't a parent
     </td><td>current
     </td><td>current
     </td><td>current
     </td><td>current
     </td><td>current
     </td><td>current

    </td></tr><tr><td><code>_parent</code> if parent is also top
     </td><td>parent/top
     </td><td>parent/top
     </td><td>none
     </td><td>none
     </td><td>parent/top
     </td><td>parent/top

    </td></tr><tr><td><code>_parent</code> if there is one and it's not top
     </td><td>parent
     </td><td>parent
     </td><td>none
     </td><td>none
     </td><td>none
     </td><td>none

    </td></tr><tr><td><code>_top</code> if top is current
     </td><td>current
     </td><td>current
     </td><td>current
     </td><td>current
     </td><td>current
     </td><td>current

    </td></tr><tr><td><code>_top</code> if top is not current
     </td><td>top
     </td><td>top
     </td><td>none
     </td><td>none
     </td><td>top
     </td><td>top

    </td></tr><tr><td>name that doesn't exist
     </td><td>new
     </td><td>new
     </td><td>maybe new
     </td><td>maybe new
     </td><td>maybe new
     </td><td>maybe new

    </td></tr><tr><td>name that exists and is a descendant
     </td><td>specified descendant
     </td><td>specified descendant
     </td><td>specified descendant
     </td><td>specified descendant
     </td><td>specified descendant
     </td><td>specified descendant

    </td></tr><tr><td>name that exists and is current
     </td><td>current
     </td><td>current
     </td><td>current
     </td><td>current
     </td><td>current
     </td><td>current

    </td></tr><tr><td>name that exists and is an ancestor that is top
     </td><td>specified ancestor
     </td><td>specified ancestor
     </td><td>none
     </td><td>none
     </td><td>specified ancestor/top
     </td><td>specified ancestor/top

    </td></tr><tr><td>name that exists and is an ancestor that is not top
     </td><td>specified ancestor
     </td><td>specified ancestor
     </td><td>none
     </td><td>none
     </td><td>none
     </td><td>none

    </td></tr><tr><td>other name that exists with common top
     </td><td>specified
     </td><td>specified
     </td><td>none
     </td><td>none
     </td><td>none
     </td><td>none

    </td></tr><tr><td>name that exists with different top, if <a href="browsers.html#familiar-with" id="browsing-context-names:familiar-with">familiar</a> and <a href="browsers.html#one-permitted-sandboxed-navigator" id="browsing-context-names:one-permitted-sandboxed-navigator">one permitted sandboxed navigator</a>
     </td><td>specified
     </td><td>specified
     </td><td>specified
     </td><td>specified
     </td><td>specified
     </td><td>specified

    </td></tr><tr><td>name that exists with different top, if <a href="browsers.html#familiar-with" id="browsing-context-names:familiar-with-2">familiar</a> but not <a href="browsers.html#one-permitted-sandboxed-navigator" id="browsing-context-names:one-permitted-sandboxed-navigator-2">one permitted sandboxed navigator</a>
     </td><td>specified
     </td><td>specified
     </td><td>none
     </td><td>none
     </td><td>none
     </td><td>none

    </td></tr><tr><td>name that exists with different top, not <a href="browsers.html#familiar-with" id="browsing-context-names:familiar-with-3">familiar</a>
     </td><td>new
     </td><td>new
     </td><td>maybe new
     </td><td>maybe new
     </td><td>maybe new
     </td><td>maybe new

  </td></tr></tbody></table>

  <p class="tablenote"><small>Most of the restrictions on sandboxed browsing contexts are applied by
  other algorithms, e.g. the <a href="browsers.html#navigate" id="browsing-context-names:navigate">navigation</a> algorithm, not <a href="browsers.html#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name" id="browsing-context-names:the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name">the rules
  for choosing a browsing context given a browsing context name</a> given below.</small></p>

  

  <hr>

  <p>An algorithm is <dfn id="allowed-to-show-a-popup">allowed to show a popup</dfn> if any of the following conditions is
  true:</p>

  <ul><li><p>The <a href="webappapis.html#concept-task" id="browsing-context-names:concept-task">task</a> in which the algorithm is running is currently
   processing an <a href="editing.html#activation-behaviour" id="browsing-context-names:activation-behaviour">activation behaviour</a> whose <code id="browsing-context-names:event-click"><a href="infrastructure.html#event-click">click</a></code> event
   was <a href="infrastructure.html#concept-events-trusted" id="browsing-context-names:concept-events-trusted">trusted</a>.</p></li><li>

    <p>The <a href="webappapis.html#concept-task" id="browsing-context-names:concept-task-2">task</a> in which the algorithm is running is currently
    running the event listener for a <a href="infrastructure.html#concept-events-trusted" id="browsing-context-names:concept-events-trusted-2">trusted</a> event whose
    type is in the following list:</p>

    <ul class="brief"><li><code id="browsing-context-names:event-change"><a href="index.html#event-change">change</a></code></li><li><code id="browsing-context-names:event-click-2"><a href="infrastructure.html#event-click">click</a></code></li><li><code id="browsing-context-names:event-dblclick"><a href="infrastructure.html#event-dblclick">dblclick</a></code></li><li><code id="browsing-context-names:event-mouseup"><a href="infrastructure.html#event-mouseup">mouseup</a></code></li><li><code id="browsing-context-names:event-reset"><a href="index.html#event-reset">reset</a></code></li><li><code id="browsing-context-names:event-submit"><a href="index.html#event-submit">submit</a></code></li></ul>

   </li><li>

    <p>The <a href="webappapis.html#concept-task" id="browsing-context-names:concept-task-3">task</a> in which the algorithm is running was <a href="webappapis.html#queue-a-task" id="browsing-context-names:queue-a-task">queued</a> by an algorithm that was <a href="browsers.html#allowed-to-show-a-popup" id="browsing-context-names:allowed-to-show-a-popup">allowed to show a popup</a>,
    and the chain of such algorithms started within a user-agent defined timeframe.</p>

    <p class="example">For example, if a user clicked a button, it might be acceptable for a popup
    to result from that after 4 seconds, but it would likely not be acceptable for a popup to result
    from that after 4 hours.</p>

   </li></ul>

  <hr>

  <p><dfn id="the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name">The rules for choosing a browsing context given a browsing context name</dfn> are as
  follows. The rules assume that they are being applied in the context of a <a href="browsers.html#browsing-context" id="browsing-context-names:browsing-context-2">browsing
  context</a>, as part of the execution of a <a href="webappapis.html#concept-task" id="browsing-context-names:concept-task-4">task</a>.</p>

  <ol><li>

    <p>If the given browsing context name is the empty string or <code>_self</code>, then
    the chosen browsing context must be the current one.</p>

    <p>If the given browsing context name is <code>_self</code>, then this is an
    <a href="browsers.html#explicit-self-navigation-override" id="browsing-context-names:explicit-self-navigation-override">explicit self-navigation override</a>, which overrides the behaviour of the
    <a href="semantics.html#seamless-browsing-context-flag" id="browsing-context-names:seamless-browsing-context-flag">seamless browsing context flag</a> set by the <code id="browsing-context-names:attr-iframe-seamless-2"><a href="semantics.html#attr-iframe-seamless">seamless</a></code> attribute on <code id="browsing-context-names:the-iframe-element-2"><a href="semantics.html#the-iframe-element">iframe</a></code> elements.</p>

   </li><li><p>If the given browsing context name is <code>_parent</code>, then the chosen
   browsing context must be the <a href="browsers.html#parent-browsing-context" id="browsing-context-names:parent-browsing-context-2"><em>parent</em> browsing context</a> of the current one,
   unless there isn't one, in which case the chosen browsing context must be the current browsing
   context.</p></li><li><p>If the given browsing context name is <code>_top</code>, then the chosen browsing
   context must be the <a href="browsers.html#top-level-browsing-context" id="browsing-context-names:top-level-browsing-context-3">top-level browsing context</a> of the current one, if there is one,
   or else the current browsing context.</p></li><li>

    <p>If the given browsing context name is not <code>_blank</code> and there exists a
    browsing context whose <a href="browsers.html#browsing-context-name" id="browsing-context-names:browsing-context-name">name</a> is the same as the given
    browsing context name, and the current browsing context is <a href="browsers.html#familiar-with" id="browsing-context-names:familiar-with-4">familiar with</a> that
    browsing context, and the user agent determines that the two browsing contexts are related
    enough that it is ok if they reach each other, then that browsing context must be the chosen
    one. If there are multiple matching browsing contexts, the user agent should select one in some
    arbitrary consistent manner, such as the most recently opened, most recently focused, or more
    closely related.</p>

    <p>If the browsing context is chosen by this step to be the current browsing context, then this
    is also an <a href="browsers.html#explicit-self-navigation-override" id="browsing-context-names:explicit-self-navigation-override-2">explicit self-navigation override</a>.</p>

   </li><li>

    <p>Otherwise, a new browsing context is being requested, and what happens depends on the user
    agent's configuration and abilities — it is determined by the rules given for the first
    applicable option from the following list:</p>

    <dl class="switch"><dt id="popup-blocker">If the algorithm is not <a href="browsers.html#allowed-to-show-a-popup" id="browsing-context-names:allowed-to-show-a-popup-2">allowed to show a popup</a> and the
     user agent has been configured to not show popups (i.e. the user agent has a "popup blocker"
     enabled)</dt><dd>

      <p>There is no chosen browsing context. The user agent may inform the user that a popup has
      been blocked.</p>

     </dd><dt id="sandboxWindowOpen">If the current browsing context's <a href="browsers.html#active-document" id="browsing-context-names:active-document">active document</a>'s
     <a href="browsers.html#active-sandboxing-flag-set" id="browsing-context-names:active-sandboxing-flag-set">active sandboxing flag set</a> has the <a href="browsers.html#sandboxed-auxiliary-navigation-browsing-context-flag" id="browsing-context-names:sandboxed-auxiliary-navigation-browsing-context-flag">sandboxed auxiliary navigation browsing
     context flag</a> set.</dt><dd>

      <p>Typically, there is no chosen browsing context.</p>

      <p>The user agent may offer to <a href="browsers.html#creating-a-new-browsing-context" id="browsing-context-names:creating-a-new-browsing-context">create</a> a new <a href="browsers.html#top-level-browsing-context" id="browsing-context-names:top-level-browsing-context-4">top-level browsing context</a> or reuse
      an existing <a href="browsers.html#top-level-browsing-context" id="browsing-context-names:top-level-browsing-context-5">top-level browsing context</a>. If the user picks one of those options,
      then the designated browsing context must be the chosen one (the browsing context's name isn't
      set to the given browsing context name). The default behaviour (if the user agent doesn't
      offer the option to the user, or if the user declines to allow a browsing context to be used)
      must be that there must not be a chosen browsing context.</p>

      <p class="warning">If this case occurs, it means that an author has explicitly sandboxed the
      document that is trying to open a link.</p>

     </dd><dt id="noopener">If the user agent has been configured such that in this instance it will
     create a new browsing context, and the browsing context is being requested as part of <a href="semantics.html#following-hyperlinks-2" id="browsing-context-names:following-hyperlinks-2">following a hyperlink</a> whose <a href="semantics.html#linkTypes">link
     types</a> include the <code id="browsing-context-names:link-type-noreferrer"><a href="semantics.html#link-type-noreferrer">noreferrer</a></code> keyword</dt><dd><p>A new <a href="browsers.html#top-level-browsing-context" id="browsing-context-names:top-level-browsing-context-6">top-level browsing context</a> must be <a href="browsers.html#creating-a-new-browsing-context" id="browsing-context-names:creating-a-new-browsing-context-2">created</a>. If the given browsing
     context name is not <code>_blank</code>, then the new top-level browsing context's
     name must be the given browsing context name (otherwise, it has no name). The chosen browsing
     context must be this new browsing context. The creation of such a <a href="browsers.html#browsing-context" id="browsing-context-names:browsing-context-3">browsing context</a>
     is <dfn id="a-new-start-for-session-storage">a new start for session storage</dfn>.</p>

     <p class="note">If it is immediately <a href="browsers.html#navigate" id="browsing-context-names:navigate-2">navigated</a>, then the
     navigation will be done with <a href="browsers.html#replacement-enabled" id="browsing-context-names:replacement-enabled">replacement enabled</a>.</p></dd><dt>If the user agent has been configured such that in this instance it will create a new
     browsing context, and the <code id="browsing-context-names:link-type-noreferrer-2"><a href="semantics.html#link-type-noreferrer">noreferrer</a></code> keyword doesn't
     apply</dt><dd><p>A new <a href="browsers.html#auxiliary-browsing-context" id="browsing-context-names:auxiliary-browsing-context-2">auxiliary browsing context</a> must be created, with the <a href="browsers.html#opener-browsing-context" id="browsing-context-names:opener-browsing-context">opener
     browsing context</a> being the current one. If the given browsing context name is not <code>_blank</code>, then the new auxiliary browsing context's name must be the given
     browsing context name (otherwise, it has no name). The chosen browsing context must be this new
     browsing context.</p>

     <p class="note">If it is immediately <a href="browsers.html#navigate" id="browsing-context-names:navigate-3">navigated</a>, then the
     navigation will be done with <a href="browsers.html#replacement-enabled" id="browsing-context-names:replacement-enabled-2">replacement enabled</a>.</p></dd><dt>If the user agent has been configured such that in this instance it will reuse the current
     browsing context</dt><dd><p>The chosen browsing context is the current browsing context.</p></dd><dt>If the user agent has been configured such that in this instance it will not find a
     browsing context</dt><dd><p>There must not be a chosen browsing context.</p></dd></dl>

    <p>User agent implementors are encouraged to provide a way for users to configure the user agent
    to always reuse the current browsing context.</p>

    <p>If the current browsing context's <a href="browsers.html#active-document" id="browsing-context-names:active-document-2">active document</a>'s <a href="browsers.html#active-sandboxing-flag-set" id="browsing-context-names:active-sandboxing-flag-set-2">active sandboxing flag
    set</a> has the <a href="browsers.html#sandboxed-navigation-browsing-context-flag" id="browsing-context-names:sandboxed-navigation-browsing-context-flag">sandboxed navigation browsing context flag</a> set and the chosen
    browsing context picked above, if any, is a new browsing context (whether top-level or
    auxiliary), then all the flags that are set in the current browsing context's <a href="browsers.html#active-document" id="browsing-context-names:active-document-3">active
    document</a>'s <a href="browsers.html#active-sandboxing-flag-set" id="browsing-context-names:active-sandboxing-flag-set-3">active sandboxing flag set</a> when the new browsing context is
    created must be set in the new browsing context's <a href="browsers.html#popup-sandboxing-flag-set" id="browsing-context-names:popup-sandboxing-flag-set">popup sandboxing flag set</a>, and
    the current browsing context must be set as the new browsing context's <a href="browsers.html#one-permitted-sandboxed-navigator" id="browsing-context-names:one-permitted-sandboxed-navigator-3">one permitted
    sandboxed navigator</a>.</p>

   </li></ol></section></section>

  




  <section><h3 id="the-window-object">6.2 The <code id="the-window-object:window"><a href="browsers.html#window">Window</a></code> object</h3>

  <pre class="idl">[PrimaryGlobal] 
/*sealed*/ interface <dfn id="window">Window</dfn> : <a href="infrastructure.html#eventtarget" id="the-window-object:eventtarget">EventTarget</a> {
  // the current browsing context
  [Unforgeable] readonly attribute <a href="browsers.html#windowproxy" id="the-window-object:windowproxy">WindowProxy</a> <a href="browsers.html#dom-window" id="the-window-object:dom-window">window</a>;
  [Replaceable] readonly attribute <a href="browsers.html#windowproxy" id="the-window-object:windowproxy-2">WindowProxy</a> <a href="browsers.html#dom-self" id="the-window-object:dom-self">self</a>;
  [Unforgeable] readonly attribute <a href="dom.html#document" id="the-window-object:document">Document</a> <a href="browsers.html#dom-document-2" id="the-window-object:dom-document-2">document</a>;
  attribute DOMString <a href="browsers.html#dom-name" id="the-window-object:dom-name">name</a>; 
  [PutForwards=<a href="infrastructure.html#dom-url-href" id="the-window-object:dom-url-href">href</a>, Unforgeable] readonly attribute <a href="browsers.html#location" id="the-window-object:location">Location</a> <a href="browsers.html#dom-location" id="the-window-object:dom-location">location</a>;
  readonly attribute <a href="browsers.html#history-3" id="the-window-object:history-3">History</a> <a href="browsers.html#dom-history" id="the-window-object:dom-history">history</a>;
  [Replaceable] readonly attribute <a href="browsers.html#barprop" id="the-window-object:barprop">BarProp</a> <a href="browsers.html#dom-window-locationbar" id="the-window-object:dom-window-locationbar">locationbar</a>;
  [Replaceable] readonly attribute <a href="browsers.html#barprop" id="the-window-object:barprop-2">BarProp</a> <a href="browsers.html#dom-window-menubar" id="the-window-object:dom-window-menubar">menubar</a>;
  [Replaceable] readonly attribute <a href="browsers.html#barprop" id="the-window-object:barprop-3">BarProp</a> <a href="browsers.html#dom-window-personalbar" id="the-window-object:dom-window-personalbar">personalbar</a>;
  [Replaceable] readonly attribute <a href="browsers.html#barprop" id="the-window-object:barprop-4">BarProp</a> <a href="browsers.html#dom-window-scrollbars" id="the-window-object:dom-window-scrollbars">scrollbars</a>;
  [Replaceable] readonly attribute <a href="browsers.html#barprop" id="the-window-object:barprop-5">BarProp</a> <a href="browsers.html#dom-window-statusbar" id="the-window-object:dom-window-statusbar">statusbar</a>;
  [Replaceable] readonly attribute <a href="browsers.html#barprop" id="the-window-object:barprop-6">BarProp</a> <a href="browsers.html#dom-window-toolbar" id="the-window-object:dom-window-toolbar">toolbar</a>;
  attribute DOMString <a href="browsers.html#dom-window-status" id="the-window-object:dom-window-status">status</a>;
  void <a href="browsers.html#dom-window-close" id="the-window-object:dom-window-close">close</a>();
  readonly attribute boolean <a href="browsers.html#dom-window-closed" id="the-window-object:dom-window-closed">closed</a>;
  void <a href="browsers.html#dom-window-stop" id="the-window-object:dom-window-stop">stop</a>();
  void <a href="editing.html#dom-window-focus" id="the-window-object:dom-window-focus">focus</a>();
  void <a href="editing.html#dom-window-blur" id="the-window-object:dom-window-blur">blur</a>();

  // other browsing contexts
  [Replaceable] readonly attribute <a href="browsers.html#windowproxy" id="the-window-object:windowproxy-3">WindowProxy</a> <a href="browsers.html#dom-frames" id="the-window-object:dom-frames">frames</a>;
  [Replaceable] readonly attribute unsigned long <a href="browsers.html#dom-length" id="the-window-object:dom-length">length</a>;
  [Unforgeable] readonly attribute <a href="browsers.html#windowproxy" id="the-window-object:windowproxy-4">WindowProxy</a> <a href="browsers.html#dom-top" id="the-window-object:dom-top">top</a>;
  attribute any <a href="browsers.html#dom-opener" id="the-window-object:dom-opener">opener</a>;
  [Replaceable] readonly attribute <a href="browsers.html#windowproxy" id="the-window-object:windowproxy-5">WindowProxy</a> <a href="browsers.html#dom-parent" id="the-window-object:dom-parent">parent</a>;
  readonly attribute <a href="infrastructure.html#element" id="the-window-object:element">Element</a>? <a href="browsers.html#dom-frameelement" id="the-window-object:dom-frameelement">frameElement</a>;
  <a href="browsers.html#windowproxy" id="the-window-object:windowproxy-6">WindowProxy</a> <a href="browsers.html#dom-open" id="the-window-object:dom-open">open</a>(optional DOMString url = "about:blank", optional DOMString target = "_blank", [TreatNullAs=EmptyString] optional DOMString features = "", optional boolean replace = false);
  <a href="browsers.html#dom-window-item" id="the-window-object:dom-window-item">getter</a> <a href="browsers.html#windowproxy" id="the-window-object:windowproxy-7">WindowProxy</a> (unsigned long index);
  <a href="browsers.html#dom-window-nameditem" id="the-window-object:dom-window-nameditem">getter</a> object (DOMString name);

  // the user agent
  readonly attribute <a href="webappapis.html#navigator" id="the-window-object:navigator">Navigator</a> <a href="webappapis.html#dom-navigator" id="the-window-object:dom-navigator">navigator</a>; 
  [Replaceable, SameObject] readonly attribute <a href="webappapis.html#external" id="the-window-object:external">External</a> <a href="webappapis.html#dom-external" id="the-window-object:dom-external">external</a>;
  readonly attribute <a href="browsers.html#applicationcache" id="the-window-object:applicationcache">ApplicationCache</a> <a href="browsers.html#dom-applicationcache" id="the-window-object:dom-applicationcache">applicationCache</a>;

  // user prompts
  void <a href="webappapis.html#dom-alert" id="the-window-object:dom-alert">alert</a>();
  void <a href="webappapis.html#dom-alert" id="the-window-object:dom-alert-2">alert</a>(DOMString message);
  boolean <a href="webappapis.html#dom-confirm" id="the-window-object:dom-confirm">confirm</a>(optional DOMString message = "");
  DOMString? <a href="webappapis.html#dom-prompt" id="the-window-object:dom-prompt">prompt</a>(optional DOMString message = "", optional DOMString default = "");
  void <a href="webappapis.html#dom-print" id="the-window-object:dom-print">print</a>();
  any <a href="webappapis.html#dom-showmodaldialog" id="the-window-object:dom-showmodaldialog">showModalDialog</a>(DOMString url, optional any argument); // deprecated

  long <a href="webappapis.html#dom-window-requestanimationframe" id="the-window-object:dom-window-requestanimationframe">requestAnimationFrame</a>(<span>FrameRequestCallback</span> callback);
  void <a href="webappapis.html#dom-window-cancelanimationframe" id="the-window-object:dom-window-cancelanimationframe">cancelAnimationFrame</a>(long handle);

  void <a href="http://www.w3.org/TR/webmessaging/#dom-window-postmessage" id="the-window-object:dom-window-postmessage">postMessage</a>(any message, DOMString targetOrigin, optional sequence&lt;<a href="infrastructure.html#transferable" id="the-window-object:transferable">Transferable</a>&gt; transfer);

  // <a href="obsolete.html#Window-partial">also has obsolete members</a>
};
<a href="browsers.html#window" id="the-window-object:window-2">Window</a> implements <a href="webappapis.html#globaleventhandlers" id="the-window-object:globaleventhandlers">GlobalEventHandlers</a>;
<a href="browsers.html#window" id="the-window-object:window-3">Window</a> implements <a href="webappapis.html#windoweventhandlers" id="the-window-object:windoweventhandlers">WindowEventHandlers</a>;</pre>



  <dl class="domintro"><dt><var>window</var> . <code id="the-window-object:dom-window-2"><a href="browsers.html#dom-window">window</a></code></dt><dt><var>window</var> . <code id="the-window-object:dom-frames-2"><a href="browsers.html#dom-frames">frames</a></code></dt><dt><var>window</var> . <code id="the-window-object:dom-self-2"><a href="browsers.html#dom-self">self</a></code></dt><dd>

    <p>These attributes all return <var>window</var>.</p>

   </dd><dt><var>window</var> . <code id="the-window-object:dom-document-2-2"><a href="browsers.html#dom-document-2">document</a></code></dt><dd>

    <p>Returns the <code id="the-window-object:document-2"><a href="dom.html#document">Document</a></code> associated with <var>window</var>.</p>

   </dd><dt><var>document</var> . <code id="the-window-object:dom-document-defaultview"><a href="browsers.html#dom-document-defaultview">defaultView</a></code></dt><dd>

    <p>Returns the <code id="the-window-object:window-4"><a href="browsers.html#window">Window</a></code> object of the <a href="browsers.html#active-document" id="the-window-object:active-document">active document</a>.</p>

   </dd></dl>

  

  <p>The <dfn id="dom-window"><code>window</code></dfn>, <dfn id="dom-frames"><code>frames</code></dfn>, and <dfn id="dom-self"><code>self</code></dfn>
  IDL attributes must all return the <code id="the-window-object:window-5"><a href="browsers.html#window">Window</a></code> object's <a href="browsers.html#browsing-context" id="the-window-object:browsing-context">browsing context</a>'s
  <code id="the-window-object:windowproxy-8"><a href="browsers.html#windowproxy">WindowProxy</a></code> object.</p>

  <p>The <dfn id="dom-document-2"><code>document</code></dfn> IDL attribute must return
  <a href="browsers.html#concept-document-window" id="the-window-object:concept-document-window">the <code>Window</code> object's newest <code>Document</code> object</a>.</p>

  <p class="note">The <code id="the-window-object:document-3"><a href="dom.html#document">Document</a></code> object associated with a <code id="the-window-object:window-6"><a href="browsers.html#window">Window</a></code> object can
  change in exactly one case: when the <a href="browsers.html#navigate" id="the-window-object:navigate">navigate</a> algorithm <a href="browsers.html#initialise-the-document-object" id="the-window-object:initialise-the-document-object">initialises a new <code>Document</code> object</a> for the first page loaded
  in a <a href="browsers.html#browsing-context" id="the-window-object:browsing-context-2">browsing context</a>. In that specific case, the <code id="the-window-object:window-7"><a href="browsers.html#window">Window</a></code> object of the
  original <code id="the-window-object:about:blank"><a href="infrastructure.html#about:blank">about:blank</a></code> page is reused and gets a new <code id="the-window-object:document-4"><a href="dom.html#document">Document</a></code> object.</p>

  <p>The <dfn id="dom-document-defaultview"><code>defaultView</code></dfn> IDL attribute of the
  <code id="the-window-object:document-5"><a href="dom.html#document">Document</a></code> interface must return the <code id="the-window-object:document-6"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#browsing-context" id="the-window-object:browsing-context-3">browsing
  context</a>'s <code id="the-window-object:windowproxy-9"><a href="browsers.html#windowproxy">WindowProxy</a></code> object, if there is one, or null otherwise.</p>

  <hr>

  <p>For historical reasons, <code id="the-window-object:window-8"><a href="browsers.html#window">Window</a></code> objects must also have a writable, configurable,
  non-enumerable property named <dfn id="htmldocument"><code>HTMLDocument</code></dfn> whose value is the
  <code id="the-window-object:document-7"><a href="dom.html#document">Document</a></code> interface object.</p>

  



  

  <section><h4 id="security-window">6.2.1 Security</h4>

  <p class="critical">This section describes a security model that is underdefined, imperfect, and
  does not match implementations. Work is ongoing to attempt to resolve this, but in the meantime,
  please do not rely on this section for precision. Implementors are urged to send their feedback on
  how cross-origin cross-global access to <code id="security-window:window"><a href="browsers.html#window">Window</a></code> and <code id="security-window:location"><a href="browsers.html#location">Location</a></code> objects
  should work. See <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=20701">bug 20701</a>.</p>

  <p id="security-2">User agents must throw a <code id="security-window:securityerror"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception whenever any
  properties of a <code id="security-window:window-2"><a href="browsers.html#window">Window</a></code> object are accessed when the <a href="webappapis.html#incumbent-settings-object" id="security-window:incumbent-settings-object">incumbent settings
  object</a> specifies an <a href="browsers.html#effective-script-origin" id="security-window:effective-script-origin">effective script origin</a> that is not the <a href="browsers.html#same-origin" id="security-window:same-origin">same</a> as <a href="browsers.html#concept-document-window" id="security-window:concept-document-window">the <code>Window</code> object's
  <code>Document</code></a>'s <a href="browsers.html#effective-script-origin" id="security-window:effective-script-origin-2">effective script origin</a>, with the following
  exceptions:</p>

  <ul><li>The <code id="security-window:dom-location"><a href="browsers.html#dom-location">location</a></code> attribute

   </li><li>The <code id="security-window:dom-window-postmessage"><a href="http://www.w3.org/TR/webmessaging/#dom-window-postmessage">postMessage()</a></code> method

   </li><li>The <code id="security-window:dom-window"><a href="browsers.html#dom-window">window</a></code> attribute

   </li><li>The <code id="security-window:dom-frames"><a href="browsers.html#dom-frames">frames</a></code> attribute

   </li><li>The <code id="security-window:dom-self"><a href="browsers.html#dom-self">self</a></code> attribute

   </li><li>The <code id="security-window:dom-top"><a href="browsers.html#dom-top">top</a></code> attribute

   </li><li>The <code id="security-window:dom-parent"><a href="browsers.html#dom-parent">parent</a></code> attribute

   </li><li>The <code id="security-window:dom-opener"><a href="browsers.html#dom-opener">opener</a></code> attribute

   </li><li>The <code id="security-window:dom-window-closed"><a href="browsers.html#dom-window-closed">closed</a></code> attribute

   </li><li>The <code id="security-window:dom-window-close"><a href="browsers.html#dom-window-close">close()</a></code> method

   </li><li>The <code id="security-window:dom-window-blur"><a href="editing.html#dom-window-blur">blur()</a></code> method

   </li><li>The <code id="security-window:dom-window-focus"><a href="editing.html#dom-window-focus">focus()</a></code> method

   </li><li>The <a href="browsers.html#dynamic-nested-browsing-context-properties" id="security-window:dynamic-nested-browsing-context-properties">dynamic nested browsing context properties</a>

  </li></ul>

  <p>When the <a href="webappapis.html#incumbent-settings-object" id="security-window:incumbent-settings-object-2">incumbent settings object</a> specifies an <a href="browsers.html#effective-script-origin" id="security-window:effective-script-origin-3">effective script
  origin</a> that is different than a <a href="browsers.html#concept-document-window" id="security-window:concept-document-window-2"><code>Window</code>
  object's <code>Document</code></a>'s <a href="browsers.html#effective-script-origin" id="security-window:effective-script-origin-4">effective script origin</a>, the user agent must
  act as if any changes to that <code id="security-window:window-3"><a href="browsers.html#window">Window</a></code> object's properties, getters, setters, etc, were
  not present, and as if all the properties of that <code id="security-window:window-4"><a href="browsers.html#window">Window</a></code> object had their
  [[Enumerable]] attribute set to false.</p>

  <p>For members that return objects (including function objects), each distinct <a href="browsers.html#effective-script-origin" id="security-window:effective-script-origin-5">effective
  script origin</a> that is not the same as the <code id="security-window:window-5"><a href="browsers.html#window">Window</a></code> object's
  <code id="security-window:document"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#effective-script-origin" id="security-window:effective-script-origin-6">effective script origin</a> must be provided with a separate set
  of objects. These objects must have the prototype chain appropriate for the script for which the
  objects are created (not those that would be appropriate for scripts whose <a href="webappapis.html#global-object" id="security-window:global-object">global
  object</a>, as specified by their <a href="webappapis.html#settings-object" id="security-window:settings-object">settings object</a>, is the <code id="security-window:window-6"><a href="browsers.html#window">Window</a></code>
  object in question).</p>

  <div class="example">

   <p>For instance, if two frames containing <code id="security-window:document-2"><a href="dom.html#document">Document</a></code>s from different <a href="browsers.html#origin-2" id="security-window:origin-2">origins</a> access the same <code id="security-window:window-7"><a href="browsers.html#window">Window</a></code> object's <code id="security-window:dom-window-postmessage-2"><a href="http://www.w3.org/TR/webmessaging/#dom-window-postmessage">postMessage()</a></code> method, they will get distinct objects that
   are not equal.</p>

  </div></section>

  




  <section><h4 id="apis-for-creating-and-navigating-browsing-contexts-by-name">6.2.2 APIs for creating and navigating browsing contexts by name</h4>

  <dl class="domintro"><dt><var>window</var> = <var>window</var> . <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:dom-open"><a href="browsers.html#dom-open">open</a></code>( [ <var>url</var> [, <var>target</var> [, <var>features</var> [, <var>replace</var> ] ] ] ] )</dt><dd>

    <p>Opens a window to show <var>url</var> (defaults to <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:about:blank"><a href="infrastructure.html#about:blank">about:blank</a></code>), and
    returns it. The <var>target</var> argument gives the name of the new window. If a
    window exists with that name already, it is reused. The <var>replace</var> attribute,
    if true, means that whatever page is currently open in that window will be removed from the
    window's session history. The <var id="apis-for-creating-and-navigating-browsing-contexts-by-name:dom-open-features"><a data-x-internal="dom-open-features" href="http://dev.w3.org/csswg/cssom-view/#the-features-argument-to-the-open()-method">features</a></var> argument can be used to influence the rendering of the new window.</p>

   </dd><dt><var>window</var> . <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:dom-name"><a href="browsers.html#dom-name">name</a></code> [ = <var>value</var> ]</dt><dd>

    <p>Returns the name of the window.</p>

    <p>Can be set, to change the name.</p>

   </dd><dt><var>window</var> . <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:dom-window-close"><a href="browsers.html#dom-window-close">close</a></code>()</dt><dd>

    <p>Closes the window.</p>

   </dd><dt><var>window</var> . <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:dom-window-closed"><a href="browsers.html#dom-window-closed">closed</a></code></dt><dd>

    <p>Returns true if the window has been closed, false otherwise.</p>

   </dd><dt><var>window</var> . <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:dom-window-stop"><a href="browsers.html#dom-window-stop">stop</a></code>()</dt><dd>

    <p>Cancels the document load.</p>

   </dd></dl>

  

  <p>The <dfn id="dom-open"><code>open()</code></dfn> method on <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:window"><a href="browsers.html#window">Window</a></code> objects
  provides a mechanism for <a href="browsers.html#navigate" id="apis-for-creating-and-navigating-browsing-contexts-by-name:navigate">navigating</a> an existing <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context">browsing
  context</a> or opening and navigating an <a href="browsers.html#auxiliary-browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:auxiliary-browsing-context">auxiliary browsing context</a>.</p>

  <p>When the method is invoked, the user agent must run the following steps:</p>

  <ol><li><p>Let <var>entry settings</var> be the <a href="webappapis.html#entry-settings-object" id="apis-for-creating-and-navigating-browsing-contexts-by-name:entry-settings-object">entry settings object</a> when the method
   was invoked.</p></li><li><p>Let <var>url</var> be the first argument.</p></li><li><p>Let <var>target</var> be the second argument.</p></li><li><p>Let <var id="apis-for-creating-and-navigating-browsing-contexts-by-name:dom-open-features-2"><a data-x-internal="dom-open-features" href="http://dev.w3.org/csswg/cssom-view/#the-features-argument-to-the-open()-method">features</a></var> be the third argument.</p></li><li><p>Let <var>replace</var> be the fourth argument.</p></li><li><p>Let <var>source browsing context</var> be the <a href="webappapis.html#responsible-browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:responsible-browsing-context">responsible browsing context</a>
   specified by <var>entry settings</var>.</p></li><li><p>If <var>target</var> is the empty string, let it be the string "<code>_blank</code>" instead.</p></li><li>

    <p>If the user has indicated a preference for which <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-2">browsing context</a> to navigate,
    follow these substeps:</p>

    <ol><li><p>Let <var>target browsing context</var> be the <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-3">browsing context</a> indicated by
     the user.</p></li><li><p>If <var>target browsing context</var> is a new <a href="browsers.html#top-level-browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:top-level-browsing-context">top-level browsing context</a>,
     let the <var>source browsing context</var> be set as <var>target browsing context</var>'s
     <a href="browsers.html#one-permitted-sandboxed-navigator" id="apis-for-creating-and-navigating-browsing-contexts-by-name:one-permitted-sandboxed-navigator">one permitted sandboxed navigator</a>.</p></li></ol>

    <p class="example">For example, suppose there is a user agent that supports control-clicking a
    link to open it in a new tab. If a user clicks in that user agent on an element whose <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:handler-onclick"><a href="webappapis.html#handler-onclick">onclick</a></code> handler uses the <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:dom-open-2"><a href="browsers.html#dom-open">window.open()</a></code> API to open a page in an iframe, but, while doing so,
    holds the control key down, the user agent could override the selection of the target browsing
    context to instead target a new tab.</p>

    <p>Otherwise, apply <a href="browsers.html#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name" id="apis-for-creating-and-navigating-browsing-contexts-by-name:the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name">the rules for choosing a browsing context given a browsing context
    name</a> using <var>target</var> as the name and <var>source browsing context</var> as the
    context in which the algorithm is executed. If this results in there not being a chosen browsing
    context, then throw an <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:invalidaccesserror"><a href="infrastructure.html#invalidaccesserror">InvalidAccessError</a></code> exception and abort these steps.
    Otherwise, let <var>target browsing context</var> be the <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-4">browsing context</a> so
    obtained.</p>

   </li><li><p>If <var>target browsing context</var> was just created, either as part of <a href="browsers.html#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name" id="apis-for-creating-and-navigating-browsing-contexts-by-name:the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name-2">the rules
   for choosing a browsing context given a browsing context name</a> or due to the user
   indicating a preference for navigating a new <a href="browsers.html#top-level-browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:top-level-browsing-context-2">top-level browsing context</a>, then let
   <var>new</var> be true. Otherwise, let it be false.</p></li><li><p>Interpret <var>features</var> as defined in the CSSOM View specification. <a href="references.html#refsCSSOMVIEW">[CSSOMVIEW]</a></p></li><li>

    <p>If <var>url</var> is the empty string, run the appropriate steps from the following list:</p>

    <dl><dt>If <var>new</var> is false</dt><dd><p>Jump to the step labeled <i>end</i>.</p></dd><dt>If <var>new</var> is true</dt><dd><p>Let <var>resource</var> be the <a href="infrastructure.html#url" id="apis-for-creating-and-navigating-browsing-contexts-by-name:url">URL</a> "<code id="apis-for-creating-and-navigating-browsing-contexts-by-name:about:blank-2"><a href="infrastructure.html#about:blank">about:blank</a></code>".</p></dd></dl>

    <p>Otherwise, <a href="infrastructure.html#resolve-a-url" id="apis-for-creating-and-navigating-browsing-contexts-by-name:resolve-a-url">resolve</a> <var>url</var> relative to the
    <a href="webappapis.html#api-base-url" id="apis-for-creating-and-navigating-browsing-contexts-by-name:api-base-url">API base URL</a> specified by <var>entry settings</var>, and let <var>resource</var> be
    the <a href="infrastructure.html#resulting-absolute-url" id="apis-for-creating-and-navigating-browsing-contexts-by-name:resulting-absolute-url">resulting absolute URL</a>, if any. If the <a href="infrastructure.html#resolve-a-url" id="apis-for-creating-and-navigating-browsing-contexts-by-name:resolve-a-url-2">resolve a URL</a> algorithm
    failed, then run one of the following two steps instead:</p>

    <ul><li><p>Let <var>resource</var> be a resource representing an inline error page.</p></li><li><p>If <var>new</var> is false, jump to the step labeled <i>end</i>, otherwise, let
     <var>resource</var> be the <a href="infrastructure.html#url" id="apis-for-creating-and-navigating-browsing-contexts-by-name:url-2">URL</a> "<code id="apis-for-creating-and-navigating-browsing-contexts-by-name:about:blank-3"><a href="infrastructure.html#about:blank">about:blank</a></code>".</p></li></ul>

   </li><li>

    <p>If <var>resource</var> is "<code id="apis-for-creating-and-navigating-browsing-contexts-by-name:about:blank-4"><a href="infrastructure.html#about:blank">about:blank</a></code>" and <var>new</var> is true, <a href="webappapis.html#queue-a-task" id="apis-for-creating-and-navigating-browsing-contexts-by-name:queue-a-task">queue
    a task</a> to <a href="webappapis.html#fire-a-simple-event" id="apis-for-creating-and-navigating-browsing-contexts-by-name:fire-a-simple-event">fire a simple event</a> named <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:event-load"><a href="index.html#event-load">load</a></code> at
    <var>target browsing context</var>'s <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:window-2"><a href="browsers.html#window">Window</a></code> object, with <i id="apis-for-creating-and-navigating-browsing-contexts-by-name:concept-event-target-override"><a href="infrastructure.html#concept-event-target-override">target override</a></i> set to <var>target browsing
    context</var>'s <a href="browsers.html#concept-document-window" id="apis-for-creating-and-navigating-browsing-contexts-by-name:concept-document-window"><code>Window</code> object's
    <code>Document</code></a> object.</p>

    <p>Otherwise, <a href="browsers.html#navigate" id="apis-for-creating-and-navigating-browsing-contexts-by-name:navigate-2">navigate</a> <var>target browsing context</var>
    to <var>resource</var>, with <a href="browsers.html#exceptions-enabled" id="apis-for-creating-and-navigating-browsing-contexts-by-name:exceptions-enabled">exceptions enabled</a>. If <var>new</var> is true, then
    <a href="browsers.html#replacement-enabled" id="apis-for-creating-and-navigating-browsing-contexts-by-name:replacement-enabled">replacement must be enabled</a> also. The <a href="browsers.html#source-browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:source-browsing-context">source
    browsing context</a> is <var>source browsing context</var>.</p>

   </li><li><p><i>End</i>: Return the <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:windowproxy"><a href="browsers.html#windowproxy">WindowProxy</a></code> object of <var>target browsing
   context</var>.</p></li></ol>

  <hr>

  <p>The <dfn id="dom-name"><code>name</code></dfn> attribute of the <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:window-3"><a href="browsers.html#window">Window</a></code> object
  must, on getting, return the current <a href="browsers.html#browsing-context-name" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-name">name</a> of the
  <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-5">browsing context</a>, if one is set, or the empty string otherwise; and, on setting, set
  the <a href="browsers.html#browsing-context-name" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-name-2">name</a> of the <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-6">browsing context</a> to the
  new value.</p>

  <p class="note">The name <a href="browsers.html#resetBCName">gets reset</a> when the browsing context is
  navigated to another domain.</p>

  <hr>

  <p>The <dfn id="dom-window-close"><code>close()</code></dfn> method on <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:window-4"><a href="browsers.html#window">Window</a></code>
  objects should, if all the following conditions are met, <a href="browsers.html#close-a-browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:close-a-browsing-context">close</a> the <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-7">browsing context</a> <var>A</var>:

  </p><ul class="brief"><li>The corresponding <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-8">browsing context</a> <var>A</var> is
   <a href="browsers.html#script-closable" id="apis-for-creating-and-navigating-browsing-contexts-by-name:script-closable">script-closable</a>.</li><li>The <a href="webappapis.html#responsible-browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:responsible-browsing-context-2">responsible browsing context</a> specified by the <a href="webappapis.html#incumbent-settings-object" id="apis-for-creating-and-navigating-browsing-contexts-by-name:incumbent-settings-object">incumbent settings
   object</a> is <a href="browsers.html#familiar-with" id="apis-for-creating-and-navigating-browsing-contexts-by-name:familiar-with">familiar with</a> the <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-9">browsing context</a> <var>A</var>.</li><li id="sandboxClose">The <a href="webappapis.html#responsible-browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:responsible-browsing-context-3">responsible browsing context</a> specified by the
   <a href="webappapis.html#incumbent-settings-object" id="apis-for-creating-and-navigating-browsing-contexts-by-name:incumbent-settings-object-2">incumbent settings object</a> is <a href="browsers.html#allowed-to-navigate" id="apis-for-creating-and-navigating-browsing-contexts-by-name:allowed-to-navigate">allowed to navigate</a> the <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-10">browsing
   context</a> <var>A</var>.</li></ul>

  <p>A <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-11">browsing context</a> is <dfn id="script-closable">script-closable</dfn> if it is an <a href="browsers.html#auxiliary-browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:auxiliary-browsing-context-2">auxiliary
  browsing context</a> that was created by a script (as opposed to by an action of the user), or
  if it is a <a href="browsers.html#top-level-browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:top-level-browsing-context-3">top-level browsing context</a> whose <a href="browsers.html#session-history" id="apis-for-creating-and-navigating-browsing-contexts-by-name:session-history">session history</a> contains
  only one <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:document"><a href="dom.html#document">Document</a></code>.</p>

  <p>The <dfn id="dom-window-closed"><code>closed</code></dfn> attribute on <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:window-5"><a href="browsers.html#window">Window</a></code>
  objects must return true if the <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:window-6"><a href="browsers.html#window">Window</a></code> object's <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-12">browsing context</a> has
  been <a href="browsers.html#a-browsing-context-is-discarded" id="apis-for-creating-and-navigating-browsing-contexts-by-name:a-browsing-context-is-discarded">discarded</a>, and false otherwise.</p>

  <p>The <dfn id="dom-window-stop"><code>stop()</code></dfn> method on <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:window-7"><a href="browsers.html#window">Window</a></code>
  objects should, if there is an existing attempt to <a href="browsers.html#navigate" id="apis-for-creating-and-navigating-browsing-contexts-by-name:navigate-3">navigate</a> the <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-13">browsing
  context</a> and that attempt is not currently running the <a href="browsers.html#unload-a-document" id="apis-for-creating-and-navigating-browsing-contexts-by-name:unload-a-document">unload a document</a>
  algorithm, cancel that <a href="browsers.html#navigate" id="apis-for-creating-and-navigating-browsing-contexts-by-name:navigate-4">navigation</a>; then, it must <a href="browsers.html#abort-a-document" id="apis-for-creating-and-navigating-browsing-contexts-by-name:abort-a-document">abort</a> the <a href="browsers.html#active-document" id="apis-for-creating-and-navigating-browsing-contexts-by-name:active-document">active document</a> of the <a href="browsers.html#browsing-context" id="apis-for-creating-and-navigating-browsing-contexts-by-name:browsing-context-14">browsing
  context</a> of the <code id="apis-for-creating-and-navigating-browsing-contexts-by-name:window-8"><a href="browsers.html#window">Window</a></code> object on which it was invoked.</p></section>

  


  <section><h4 id="accessing-other-browsing-contexts">6.2.3 Accessing other browsing contexts</h4>

  <dl class="domintro"><dt><var>window</var> . <code id="accessing-other-browsing-contexts:dom-length"><a href="browsers.html#dom-length">length</a></code></dt><dd>

    <p>Returns the number of <a href="browsers.html#child-browsing-context" id="accessing-other-browsing-contexts:child-browsing-context">child browsing
    contexts</a>.</p>

   </dd><dt><var>window</var>[<var>index</var>]</dt><dd>

    <p>Returns the indicated <a href="browsers.html#child-browsing-context" id="accessing-other-browsing-contexts:child-browsing-context-2">child browsing context</a>.</p>

   </dd></dl>

  

  <p>The <dfn id="dom-length"><code>length</code></dfn> IDL attribute on the <code id="accessing-other-browsing-contexts:window"><a href="browsers.html#window">Window</a></code>
  interface must return the number of <a href="browsers.html#child-browsing-context" id="accessing-other-browsing-contexts:child-browsing-context-3">child browsing
  contexts</a> that are <a href="browsers.html#browsing-context-nested-through" id="accessing-other-browsing-contexts:browsing-context-nested-through">nested through</a>
  elements that are <a href="infrastructure.html#in-a-document" id="accessing-other-browsing-contexts:in-a-document">in the <code>Document</code></a> that is the
  <a href="browsers.html#active-document" id="accessing-other-browsing-contexts:active-document">active document</a> of that <code id="accessing-other-browsing-contexts:window-2"><a href="browsers.html#window">Window</a></code> object, if that <code id="accessing-other-browsing-contexts:window-3"><a href="browsers.html#window">Window</a></code>'s
  <a href="browsers.html#browsing-context" id="accessing-other-browsing-contexts:browsing-context">browsing context</a> shares the same <a href="webappapis.html#event-loop" id="accessing-other-browsing-contexts:event-loop">event loop</a> as the <a href="webappapis.html#responsible-document" id="accessing-other-browsing-contexts:responsible-document">responsible
  document</a> specified by the <a href="webappapis.html#entry-settings-object" id="accessing-other-browsing-contexts:entry-settings-object">entry settings object</a> accessing the IDL attribute;
  otherwise, it must return zero.</p>

  

  <p>The <a href="infrastructure.html#supported-property-indices" id="accessing-other-browsing-contexts:supported-property-indices">supported property indices</a> on the <code id="accessing-other-browsing-contexts:window-4"><a href="browsers.html#window">Window</a></code> object at any instant
  are the numbers in the range 0 .. <span><var>n</var>-1</span>, where <var>n</var> is the number returned by the <code id="accessing-other-browsing-contexts:dom-length-2"><a href="browsers.html#dom-length">length</a></code> IDL
  attribute. If <var>n</var> is zero then there are no <a href="infrastructure.html#supported-property-indices" id="accessing-other-browsing-contexts:supported-property-indices-2">supported property
  indices</a>.</p>

  
  <p>To <dfn id="dom-window-item">determine the value of an indexed property</dfn> <var>index</var> of a <code id="accessing-other-browsing-contexts:window-5"><a href="browsers.html#window">Window</a></code> object, the user agent must return the
  <code id="accessing-other-browsing-contexts:windowproxy"><a href="browsers.html#windowproxy">WindowProxy</a></code> object of the <var>index</var>th <a href="browsers.html#child-browsing-context" id="accessing-other-browsing-contexts:child-browsing-context-4">child browsing
  context</a> of the <code id="accessing-other-browsing-contexts:document"><a href="dom.html#document">Document</a></code> that is <a href="browsers.html#browsing-context-nested-through" id="accessing-other-browsing-contexts:browsing-context-nested-through-2">nested through</a> an element that is <a href="infrastructure.html#in-a-document" id="accessing-other-browsing-contexts:in-a-document-2">in the
  <code>Document</code></a>, sorted in the order that the elements nesting those <a href="browsers.html#browsing-context" id="accessing-other-browsing-contexts:browsing-context-2">browsing contexts</a> were most recently inserted into the
  <code id="accessing-other-browsing-contexts:document-2"><a href="dom.html#document">Document</a></code>, the <code id="accessing-other-browsing-contexts:windowproxy-2"><a href="browsers.html#windowproxy">WindowProxy</a></code> object of the most recently inserted
  <a href="browsers.html#browsing-context-container" id="accessing-other-browsing-contexts:browsing-context-container">browsing context container</a>'s <a href="browsers.html#nested-browsing-context" id="accessing-other-browsing-contexts:nested-browsing-context">nested browsing context</a> being last.</p>

  <p>These properties are the <dfn id="dynamic-nested-browsing-context-properties">dynamic nested browsing context properties</dfn>.</p></section>

  



  <section><h4 id="named-access-on-the-window-object">6.2.4 Named access on the <code id="named-access-on-the-window-object:window"><a href="browsers.html#window">Window</a></code> object</h4>

  <dl class="domintro"><dt><var>window</var>[<var>name</var>]</dt><dd>

    <p>Returns the indicated element or collection of elements.</p>

    <p>As a general rule, relying on this will lead to brittle code. Which IDs end up mapping to
    this API can vary over time, as new features are added to the Web platform, for example. Instead
    of this, use <code>document.getElementById()</code> or <code>document.querySelector()</code>.</p>

   </dd></dl>

  

  <p>The <code id="named-access-on-the-window-object:window-2"><a href="browsers.html#window">Window</a></code> interface <a href="infrastructure.html#support-named-properties" id="named-access-on-the-window-object:support-named-properties">supports named
  properties</a>. The <a href="infrastructure.html#supported-property-names" id="named-access-on-the-window-object:supported-property-names">supported property names</a> at any moment consist of the
  following, in <a href="infrastructure.html#tree-order" id="named-access-on-the-window-object:tree-order">tree order</a>, ignoring later duplicates:</p>

  <ul><li>the <a href="browsers.html#browsing-context-name" id="named-access-on-the-window-object:browsing-context-name">browsing context name</a> of any <a href="browsers.html#child-browsing-context" id="named-access-on-the-window-object:child-browsing-context">child browsing context</a> of the
   <a href="browsers.html#active-document" id="named-access-on-the-window-object:active-document">active document</a> whose name is not the empty string,</li><li>the value of the <code>name</code> content attribute for all <code id="named-access-on-the-window-object:the-a-element"><a href="semantics.html#the-a-element">a</a></code>,
   <code id="named-access-on-the-window-object:the-applet-element"><a href="obsolete.html#the-applet-element">applet</a></code>, <code id="named-access-on-the-window-object:the-area-element"><a href="semantics.html#the-area-element">area</a></code>, <code id="named-access-on-the-window-object:the-embed-element"><a href="semantics.html#the-embed-element">embed</a></code>, <code id="named-access-on-the-window-object:the-form-element"><a href="semantics.html#the-form-element">form</a></code>,
   <code id="named-access-on-the-window-object:frameset"><a href="obsolete.html#frameset">frameset</a></code>, <code id="named-access-on-the-window-object:the-img-element"><a href="semantics.html#the-img-element">img</a></code>, and <code id="named-access-on-the-window-object:the-object-element"><a href="semantics.html#the-object-element">object</a></code> elements in the <a href="browsers.html#active-document" id="named-access-on-the-window-object:active-document-2">active
   document</a> that have a non-empty <code>name</code> content attribute, and</li><li>the value of the <code id="named-access-on-the-window-object:the-id-attribute"><a href="dom.html#the-id-attribute">id</a></code> content attribute of any <a href="infrastructure.html#html-elements" id="named-access-on-the-window-object:html-elements">HTML element</a> in the <a href="browsers.html#active-document" id="named-access-on-the-window-object:active-document-3">active document</a> with a non-empty <code id="named-access-on-the-window-object:the-id-attribute-2"><a href="dom.html#the-id-attribute">id</a></code> content attribute.</li></ul>

  <p>To <a href="infrastructure.html#determine-the-value-of-a-named-property" id="named-access-on-the-window-object:determine-the-value-of-a-named-property">determine the value of a named property</a> <var>name</var> when <dfn id="dom-window-nameditem">the <code>Window</code> object is indexed for property
  retrieval</dfn>, the user agent must return the value obtained using the following steps:</p>

  <ol><li>

    <p>Let <var>objects</var> be the list of <a href="browsers.html#dom-window-nameditem-filter" id="named-access-on-the-window-object:dom-window-nameditem-filter">named objects</a> with the name <var>name</var>
    in the <a href="browsers.html#active-document" id="named-access-on-the-window-object:active-document-4">active document</a>.

    </p><p class="note">There will be at least one such object, by definition.</p>

   </li><li>

    <p>If <var>objects</var> contains a <a href="browsers.html#nested-browsing-context" id="named-access-on-the-window-object:nested-browsing-context">nested browsing context</a>, then return
    the <code id="named-access-on-the-window-object:windowproxy"><a href="browsers.html#windowproxy">WindowProxy</a></code> object of the <a href="browsers.html#nested-browsing-context" id="named-access-on-the-window-object:nested-browsing-context-2">nested browsing context</a> corresponding to
    the first <a href="browsers.html#browsing-context-container" id="named-access-on-the-window-object:browsing-context-container">browsing context container</a> in <a href="infrastructure.html#tree-order" id="named-access-on-the-window-object:tree-order-2">tree order</a> whose
    <a href="browsers.html#browsing-context" id="named-access-on-the-window-object:browsing-context">browsing context</a> is in <var>objects</var>, and abort these steps.</p>

   </li><li>

    <p>Otherwise, if <var>objects</var> has only one element, return that element and
    abort these steps.</p>

   </li><li>

    <p>Otherwise return an <code id="named-access-on-the-window-object:htmlcollection"><a href="infrastructure.html#htmlcollection">HTMLCollection</a></code> rooted at the <code id="named-access-on-the-window-object:document"><a href="dom.html#document">Document</a></code> node,
    whose filter matches only <a href="browsers.html#dom-window-nameditem-filter" id="named-access-on-the-window-object:dom-window-nameditem-filter-2">named objects</a> with
    the name <var>name</var>. (By definition, these will all be elements.)</p> 

   </li></ol>

  <p><dfn id="dom-window-nameditem-filter">Named objects</dfn> with the name <var>name</var>, for the purposes of the above algorithm, are those that are either:</p>

  <ul><li><a href="browsers.html#child-browsing-context" id="named-access-on-the-window-object:child-browsing-context-2">child browsing contexts</a> of the <a href="browsers.html#active-document" id="named-access-on-the-window-object:active-document-5">active
   document</a> whose name is <var>name</var>,</li><li><code id="named-access-on-the-window-object:the-a-element-2"><a href="semantics.html#the-a-element">a</a></code>, <code id="named-access-on-the-window-object:the-applet-element-2"><a href="obsolete.html#the-applet-element">applet</a></code>, <code id="named-access-on-the-window-object:the-area-element-2"><a href="semantics.html#the-area-element">area</a></code>, <code id="named-access-on-the-window-object:the-embed-element-2"><a href="semantics.html#the-embed-element">embed</a></code>,
   <code id="named-access-on-the-window-object:the-form-element-2"><a href="semantics.html#the-form-element">form</a></code>, <code id="named-access-on-the-window-object:frameset-2"><a href="obsolete.html#frameset">frameset</a></code>, <code id="named-access-on-the-window-object:the-img-element-2"><a href="semantics.html#the-img-element">img</a></code>, or <code id="named-access-on-the-window-object:the-object-element-2"><a href="semantics.html#the-object-element">object</a></code> elements that
   have a <code>name</code> content attribute whose value is <var>name</var>, or</li><li><a href="infrastructure.html#html-elements" id="named-access-on-the-window-object:html-elements-2">HTML elements</a> that have an <code id="named-access-on-the-window-object:the-id-attribute-3"><a href="dom.html#the-id-attribute">id</a></code> content attribute
   whose value is <var>name</var>.</li></ul></section>

  


  

  <section><h4 id="garbage-collection-and-browsing-contexts">6.2.5 Garbage collection and browsing contexts</h4>

  <p>A <a href="browsers.html#browsing-context" id="garbage-collection-and-browsing-contexts:browsing-context">browsing context</a> has a strong reference to each of its <code id="garbage-collection-and-browsing-contexts:document"><a href="dom.html#document">Document</a></code>s
  and its <code id="garbage-collection-and-browsing-contexts:windowproxy"><a href="browsers.html#windowproxy">WindowProxy</a></code> object, and the user agent itself has a strong reference to its
  <a href="browsers.html#top-level-browsing-context" id="garbage-collection-and-browsing-contexts:top-level-browsing-context">top-level browsing contexts</a>.</p>

  <p>A <code id="garbage-collection-and-browsing-contexts:document-2"><a href="dom.html#document">Document</a></code> has a strong reference to its <code id="garbage-collection-and-browsing-contexts:window"><a href="browsers.html#window">Window</a></code> object.</p>

  <p class="note">A <code id="garbage-collection-and-browsing-contexts:window-2"><a href="browsers.html#window">Window</a></code> object <a href="infrastructure.html#implied-strong-reference" id="garbage-collection-and-browsing-contexts:implied-strong-reference">has a strong
  reference</a> to its <code id="garbage-collection-and-browsing-contexts:document-3"><a href="dom.html#document">Document</a></code> object through its <code id="garbage-collection-and-browsing-contexts:dom-document-2"><a href="browsers.html#dom-document-2">document</a></code> attribute. Thus, references from other scripts to either of
  those objects will keep both alive. Similarly, both <code id="garbage-collection-and-browsing-contexts:document-4"><a href="dom.html#document">Document</a></code> and <code id="garbage-collection-and-browsing-contexts:window-3"><a href="browsers.html#window">Window</a></code>
  objects have <a href="infrastructure.html#implied-strong-reference" id="garbage-collection-and-browsing-contexts:implied-strong-reference-2">implied strong references</a> to the
  <code id="garbage-collection-and-browsing-contexts:windowproxy-2"><a href="browsers.html#windowproxy">WindowProxy</a></code> object.</p>

  <p>Each <a href="webappapis.html#concept-script" id="garbage-collection-and-browsing-contexts:concept-script">script</a> has a strong reference to its <a href="webappapis.html#settings-object" id="garbage-collection-and-browsing-contexts:settings-object">settings
  object</a>, and each <a href="webappapis.html#environment-settings-object" id="garbage-collection-and-browsing-contexts:environment-settings-object">environment settings object</a> has strong references to its
  <a href="webappapis.html#global-object" id="garbage-collection-and-browsing-contexts:global-object">global object</a>, <a href="webappapis.html#responsible-browsing-context" id="garbage-collection-and-browsing-contexts:responsible-browsing-context">responsible browsing context</a>, and <a href="webappapis.html#responsible-document" id="garbage-collection-and-browsing-contexts:responsible-document">responsible
  document</a> (if any).</p>

  
  <p>When a <a href="browsers.html#browsing-context" id="garbage-collection-and-browsing-contexts:browsing-context-2">browsing context</a> is to <dfn id="discard-a-document">discard a <code>Document</code></dfn>, the user
  agent must run the following steps:</p>

  <ol><li><p>Set the <code id="garbage-collection-and-browsing-contexts:document-5"><a href="dom.html#document">Document</a></code>'s <i id="garbage-collection-and-browsing-contexts:concept-document-salvageable"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state to false.</p></li><li><p>Run any <a href="browsers.html#unloading-document-cleanup-steps" id="garbage-collection-and-browsing-contexts:unloading-document-cleanup-steps">unloading document cleanup steps</a> for the <code id="garbage-collection-and-browsing-contexts:document-6"><a href="dom.html#document">Document</a></code> that
   are defined by this specification and <a href="infrastructure.html#other-applicable-specifications" id="garbage-collection-and-browsing-contexts:other-applicable-specifications">other applicable specifications</a>.</p></li><li><p><a href="browsers.html#abort-a-document" id="garbage-collection-and-browsing-contexts:abort-a-document">Abort the <code>Document</code></a>.</p></li><li><p>Remove any <a href="webappapis.html#concept-task" id="garbage-collection-and-browsing-contexts:concept-task">tasks</a> associated with the
   <code id="garbage-collection-and-browsing-contexts:document-7"><a href="dom.html#document">Document</a></code> in any <a href="webappapis.html#task-source" id="garbage-collection-and-browsing-contexts:task-source">task source</a>, without running those tasks.</p></li><li><p><a href="browsers.html#a-browsing-context-is-discarded" id="garbage-collection-and-browsing-contexts:a-browsing-context-is-discarded">Discard</a> all the <a href="browsers.html#child-browsing-context" id="garbage-collection-and-browsing-contexts:child-browsing-context">child browsing contexts</a> of the <code id="garbage-collection-and-browsing-contexts:document-8"><a href="dom.html#document">Document</a></code>.</p></li><li><p>Lose the strong reference from the <code id="garbage-collection-and-browsing-contexts:document-9"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#browsing-context" id="garbage-collection-and-browsing-contexts:browsing-context-3">browsing context</a>
   to the <code id="garbage-collection-and-browsing-contexts:document-10"><a href="dom.html#document">Document</a></code>.</p></li></ol>

  <p class="note">Whenever a <code id="garbage-collection-and-browsing-contexts:document-11"><a href="dom.html#document">Document</a></code> object is <a href="browsers.html#discard-a-document" id="garbage-collection-and-browsing-contexts:discard-a-document">discarded</a>, it is also removed from the list of <a href="http://www.w3.org/TR/workers/#the-worker's-documents" id="garbage-collection-and-browsing-contexts:the-worker's-documents">the worker's
  <code>Document</code>s</a> of each worker whose list contains that <code id="garbage-collection-and-browsing-contexts:document-12"><a href="dom.html#document">Document</a></code>.</p>

  <p>When <dfn id="a-browsing-context-is-discarded">a <em>browsing context</em> is discarded</dfn>, the strong reference from the user
  agent itself to the <a href="browsers.html#browsing-context" id="garbage-collection-and-browsing-contexts:browsing-context-4">browsing context</a> must be severed, and all the
  <code id="garbage-collection-and-browsing-contexts:document-13"><a href="dom.html#document">Document</a></code> objects for all the entries in the <a href="browsers.html#browsing-context" id="garbage-collection-and-browsing-contexts:browsing-context-5">browsing context</a>'s session
  history must be <a href="browsers.html#discard-a-document" id="garbage-collection-and-browsing-contexts:discard-a-document-2">discarded</a> as well.</p>

  <p>User agents may <a href="browsers.html#a-browsing-context-is-discarded" id="garbage-collection-and-browsing-contexts:a-browsing-context-is-discarded-2">discard</a> <a href="browsers.html#top-level-browsing-context" id="garbage-collection-and-browsing-contexts:top-level-browsing-context-2">top-level browsing contexts</a> at any time (typically, in
  response to user requests, e.g. when a user force-closes a window containing one or more <a href="browsers.html#top-level-browsing-context" id="garbage-collection-and-browsing-contexts:top-level-browsing-context-3">top-level browsing contexts</a>). Other <a href="browsers.html#browsing-context" id="garbage-collection-and-browsing-contexts:browsing-context-6">browsing contexts</a> must be discarded once their
  <code id="garbage-collection-and-browsing-contexts:windowproxy-3"><a href="browsers.html#windowproxy">WindowProxy</a></code> object is eligible for garbage collection.</p></section>

  


  <section><h4 id="closing-browsing-contexts">6.2.6 Closing browsing contexts</h4>

  <p>When the user agent is required to <dfn id="close-a-browsing-context">close a browsing context</dfn>, it must run the
  following steps:</p>

  <ol><li><p>Let <var>specified browsing context</var> be the <a href="browsers.html#browsing-context" id="closing-browsing-contexts:browsing-context">browsing context</a>
   being closed.</p></li><li><p><a href="browsers.html#prompt-to-unload-a-document" id="closing-browsing-contexts:prompt-to-unload-a-document">Prompt to unload</a> the <a href="browsers.html#active-document" id="closing-browsing-contexts:active-document">active
   document</a> of the <var>specified browsing context</var>. If the user <a href="browsers.html#refused-to-allow-the-document-to-be-unloaded" id="closing-browsing-contexts:refused-to-allow-the-document-to-be-unloaded">refused
   to allow the document to be unloaded</a>, then abort these steps.</p></li><li><p><a href="browsers.html#unload-a-document" id="closing-browsing-contexts:unload-a-document">Unload</a> the <a href="browsers.html#active-document" id="closing-browsing-contexts:active-document-2">active document</a> of the <var>specified browsing context</var> with the <var>recycle</var> parameter set to
   false.</p></li><li><p>Remove the <var>specified browsing context</var> from the user interface (e.g.
   close or hide its tab in a tabbed browser).</p></li><li><p><a href="browsers.html#a-browsing-context-is-discarded" id="closing-browsing-contexts:a-browsing-context-is-discarded">Discard</a> the <var>specified
   browsing context</var>.</p></li></ol>

  <p>User agents should offer users the ability to arbitrarily <a href="browsers.html#close-a-browsing-context" id="closing-browsing-contexts:close-a-browsing-context">close</a> any <a href="browsers.html#top-level-browsing-context" id="closing-browsing-contexts:top-level-browsing-context">top-level browsing context</a>.</p></section>



  <section><h4 id="browser-interface-elements">6.2.7 Browser interface elements</h4>

  <p>To allow Web pages to integrate with Web browsers, certain Web browser interface elements are
  exposed in a limited way to scripts in Web pages.</p>

  <p>Each interface element is represented by a <code id="browser-interface-elements:barprop"><a href="browsers.html#barprop">BarProp</a></code> object:</p>

  <pre class="idl">interface <dfn id="barprop">BarProp</dfn> {
  attribute boolean <a href="browsers.html#dom-barprop-visible" id="browser-interface-elements:dom-barprop-visible">visible</a>;
};</pre>

  <dl class="domintro"><dt><var>window</var> . <code id="browser-interface-elements:dom-window-locationbar"><a href="browsers.html#dom-window-locationbar">locationbar</a></code> . <code id="browser-interface-elements:dom-barprop-visible-2"><a href="browsers.html#dom-barprop-visible">visible</a></code></dt><dd>
    <p>Returns true if the location bar is visible; otherwise, returns false.</p>
   </dd><dt><var>window</var> . <code id="browser-interface-elements:dom-window-menubar"><a href="browsers.html#dom-window-menubar">menubar</a></code> . <code id="browser-interface-elements:dom-barprop-visible-3"><a href="browsers.html#dom-barprop-visible">visible</a></code></dt><dd>
    <p>Returns true if the menu bar is visible; otherwise, returns false.</p>
   </dd><dt><var>window</var> . <code id="browser-interface-elements:dom-window-personalbar"><a href="browsers.html#dom-window-personalbar">personalbar</a></code> . <code id="browser-interface-elements:dom-barprop-visible-4"><a href="browsers.html#dom-barprop-visible">visible</a></code></dt><dd>
    <p>Returns true if the personal bar is visible; otherwise, returns false.</p>
   </dd><dt><var>window</var> . <code id="browser-interface-elements:dom-window-scrollbars"><a href="browsers.html#dom-window-scrollbars">scrollbars</a></code> . <code id="browser-interface-elements:dom-barprop-visible-5"><a href="browsers.html#dom-barprop-visible">visible</a></code></dt><dd>
    <p>Returns true if the scroll bars are visible; otherwise, returns false.</p>
   </dd><dt><var>window</var> . <code id="browser-interface-elements:dom-window-statusbar"><a href="browsers.html#dom-window-statusbar">statusbar</a></code> . <code id="browser-interface-elements:dom-barprop-visible-6"><a href="browsers.html#dom-barprop-visible">visible</a></code></dt><dd>
    <p>Returns true if the status bar is visible; otherwise, returns false.</p>
   </dd><dt><var>window</var> . <code id="browser-interface-elements:dom-window-toolbar"><a href="browsers.html#dom-window-toolbar">toolbar</a></code> . <code id="browser-interface-elements:dom-barprop-visible-7"><a href="browsers.html#dom-barprop-visible">visible</a></code></dt><dd>
    <p>Returns true if the toolbar is visible; otherwise, returns false.</p>
   </dd></dl>

  

  <p>The <dfn id="dom-barprop-visible">visible</dfn> attribute, on getting, must return either
  true or a value determined by the user agent to most accurately represent the visibility state of
  the user interface element that the object represents, as described below. On setting, the new
  value must be discarded.</p>

  <p>The following <code id="browser-interface-elements:barprop-2"><a href="browsers.html#barprop">BarProp</a></code> objects exist for each <code id="browser-interface-elements:document"><a href="dom.html#document">Document</a></code> object in a
  <a href="browsers.html#browsing-context" id="browser-interface-elements:browsing-context">browsing context</a>. Some of the user interface elements represented by these objects
  might have no equivalent in some user agents; for those user agents, except when otherwise
  specified, the object must act as if it was present and visible (i.e. its <code id="browser-interface-elements:dom-barprop-visible-8"><a href="browsers.html#dom-barprop-visible">visible</a></code> attribute must return true).</p>

  <dl><dt><dfn id="the-location-bar-barprop-object">The location bar <code>BarProp</code> object</dfn></dt><dd>Represents the user interface element that contains a control that displays the
   <a href="infrastructure.html#url" id="browser-interface-elements:url">URL</a> of the <a href="browsers.html#active-document" id="browser-interface-elements:active-document">active document</a>, or some similar interface concept.</dd><dt><dfn id="the-menu-bar-barprop-object">The menu bar <code>BarProp</code> object</dfn></dt><dd>Represents the user interface element that contains a list of commands in menu form, or some
   similar interface concept.</dd><dt><dfn id="the-personal-bar-barprop-object">The personal bar <code>BarProp</code> object</dfn></dt><dd>Represents the user interface element that contains links to the user's favorite pages, or
   some similar interface concept.</dd><dt><dfn id="the-scrollbar-barprop-object">The scrollbar <code>BarProp</code> object</dfn></dt><dd>Represents the user interface element that contains a scrolling mechanism, or some similar
   interface concept.</dd><dt><dfn id="the-status-bar-barprop-object">The status bar <code>BarProp</code> object</dfn></dt><dd>Represents a user interface element found immediately below or after the document, as
   appropriate for the user's media, which typically provides information about ongoing network
   activity or information about elements that the user's pointing device is current indicating. If
   the user agent has no such user interface element, then the object may act as if the
   corresponding user interface element was absent (i.e. its <code id="browser-interface-elements:dom-barprop-visible-9"><a href="browsers.html#dom-barprop-visible">visible</a></code> attribute may return false).</dd><dt><dfn id="the-toolbar-barprop-object">The toolbar <code>BarProp</code> object</dfn></dt><dd>Represents the user interface element found immediately above or before the document, as
   appropriate for the user's media, which typically provides <a href="browsers.html#session-history" id="browser-interface-elements:session-history">session history</a> traversal
   controls (back and forward buttons, reload buttons, etc). If the user agent has no such user
   interface element, then the object may act as if the corresponding user interface element was
   absent (i.e. its <code id="browser-interface-elements:dom-barprop-visible-10"><a href="browsers.html#dom-barprop-visible">visible</a></code> attribute may return
   false).</dd></dl>

  <p>The <dfn id="dom-window-locationbar"><code>locationbar</code></dfn> attribute must return
  <a href="browsers.html#the-location-bar-barprop-object" id="browser-interface-elements:the-location-bar-barprop-object">the location bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id="dom-window-menubar"><code>menubar</code></dfn> attribute must return <a href="browsers.html#the-menu-bar-barprop-object" id="browser-interface-elements:the-menu-bar-barprop-object">the
  menu bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id="dom-window-personalbar"><code>personalbar</code></dfn> attribute must return
  <a href="browsers.html#the-personal-bar-barprop-object" id="browser-interface-elements:the-personal-bar-barprop-object">the personal bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id="dom-window-scrollbars"><code>scrollbars</code></dfn> attribute must return
  <a href="browsers.html#the-scrollbar-barprop-object" id="browser-interface-elements:the-scrollbar-barprop-object">the scrollbar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id="dom-window-statusbar"><code>statusbar</code></dfn> attribute must return
  <a href="browsers.html#the-status-bar-barprop-object" id="browser-interface-elements:the-status-bar-barprop-object">the status bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn id="dom-window-toolbar"><code>toolbar</code></dfn> attribute must return <a href="browsers.html#the-toolbar-barprop-object" id="browser-interface-elements:the-toolbar-barprop-object">the
  toolbar <code>BarProp</code> object</a>.</p>



  <hr>

  <p>For historical reasons, the <dfn id="dom-window-status"><code>status</code></dfn> attribute
  on the <code id="browser-interface-elements:window"><a href="browsers.html#window">Window</a></code> object must, on getting, return the last string it was set to, and on
  setting, must set itself to the new value. When the <code id="browser-interface-elements:window-2"><a href="browsers.html#window">Window</a></code> object is created, the
  attribute must be set to the empty string. It does not do anything else.</p></section>

  


  

  <section><h4 id="the-windowproxy-object">6.2.8 The <code id="the-windowproxy-object:windowproxy"><a href="browsers.html#windowproxy">WindowProxy</a></code> object</h4>

  <p>As mentioned earlier, each <a href="browsers.html#browsing-context" id="the-windowproxy-object:browsing-context">browsing context</a> has a
  <dfn id="windowproxy"><code>WindowProxy</code></dfn> object. This object is unusual in that all operations that
  would be performed on it must be performed on the <code id="the-windowproxy-object:window"><a href="browsers.html#window">Window</a></code> object of the <a href="browsers.html#browsing-context" id="the-windowproxy-object:browsing-context-2">browsing
  context</a>'s <a href="browsers.html#active-document" id="the-windowproxy-object:active-document">active document</a> instead. It is thus indistinguishable from that
  <code id="the-windowproxy-object:window-2"><a href="browsers.html#window">Window</a></code> object in every way until the <a href="browsers.html#browsing-context" id="the-windowproxy-object:browsing-context-3">browsing context</a> is navigated.</p>

  <p>There is no <code id="the-windowproxy-object:windowproxy-2"><a href="browsers.html#windowproxy">WindowProxy</a></code> interface object.</p>

  <p class="note">The <code id="the-windowproxy-object:windowproxy-3"><a href="browsers.html#windowproxy">WindowProxy</a></code> object allows scripts to act as if each
  <a href="browsers.html#browsing-context" id="the-windowproxy-object:browsing-context-4">browsing context</a> had a single <code id="the-windowproxy-object:window-3"><a href="browsers.html#window">Window</a></code> object, while still keeping
  separate <code id="the-windowproxy-object:window-4"><a href="browsers.html#window">Window</a></code> objects for each <code id="the-windowproxy-object:document"><a href="dom.html#document">Document</a></code>.</p>

  <div class="example">

   <p>In the following example, the variable <var>x</var> is set to the
   <code id="the-windowproxy-object:windowproxy-4"><a href="browsers.html#windowproxy">WindowProxy</a></code> object returned by the <code id="the-windowproxy-object:dom-window"><a href="browsers.html#dom-window">window</a></code> accessor
   on the global object. All of the expressions following the assignment return true, because in
   every respect, the <code id="the-windowproxy-object:windowproxy-5"><a href="browsers.html#windowproxy">WindowProxy</a></code> object acts like the underlying <code id="the-windowproxy-object:window-5"><a href="browsers.html#window">Window</a></code>
   object.</p>

   <pre>var x = window;
x instanceof Window; // true
x === this; // true</pre>

  </div></section></section>

  





  <section><h3 id="origin">6.3 Origin</h3>
  

  <p>Origins are the fundamental currency of the Web's security model. Two actors in the Web
  platform that share an origin are assumed to trust each other and to have the same authority.
  Actors with differing origins are considered potentially hostile versus each other, and are
  isolated from each other to varying degrees.</p>

  <p class="example">For example, if Example Bank's Web site, hosted at <code>bank.example.com</code>, tries to examine the DOM of Example Charity's Web site, hosted
  at <code>charity.example.org</code>, a <code id="origin:securityerror"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception will be
  raised.</p>

  <hr>

  <p>The <dfn id="origin-2">origin</dfn> of a resource and the <dfn id="effective-script-origin">effective script origin</dfn> of a resource
  are each one of the following:</p>

  <dl><dt>Opaque identifiers

   </dt><dd>

    <p>Internal values, with no serialisation, for which the only meaningful operation is testing
    for equality.</p>


   </dd><dt>Tuples

   </dt><dd>

    <p>Tuples consisting of a scheme component, a host component, a port component, and optionally
    extra data.</p>

    <p class="note">The extra data could include the certificate of the site when using encrypted
    connections, to ensure that if the site's secure certificate changes, the origin is considered to
    change as well.</p>


   </dd><dt>Aliases

   </dt><dd>

    <p>A reference to another <a href="browsers.html#origin-2" id="origin:origin-2">origin</a> or <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin">effective script origin</a>.</p>


  </dd></dl>

  

  <p>An <a href="browsers.html#origin-2" id="origin:origin-2-2">origin</a> or <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-2">effective script origin</a> can be defined as an <dfn id="concept-origin-alias">alias</dfn> to another <a href="browsers.html#origin-2" id="origin:origin-2-3">origin</a> or <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-3">effective script
  origin</a>. The value of the <a href="browsers.html#origin-2" id="origin:origin-2-4">origin</a> or <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-4">effective script origin</a> is
  then the value of the <a href="browsers.html#origin-2" id="origin:origin-2-5">origin</a> or <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-5">effective script origin</a> to which it is
  an alias.</p>

  <p>These characteristics are defined as follows:</p>

  <dl><dt>For URLs</dt><dd>

    <p>The <a href="browsers.html#origin-2" id="origin:origin-2-6">origin</a> and <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-6">effective script origin</a> of the <a href="infrastructure.html#url" id="origin:url">URL</a> are
    the <a href="https://url.spec.whatwg.org/#concept-url-origin" id="origin:concept-url-origin" data-x-internal="concept-url-origin">URL origin</a> defined in the WHATWG URL standard. <a href="references.html#refsURL">[URL]</a></p>

   </dd><dt>For <code id="origin:document"><a href="dom.html#document">Document</a></code> objects</dt><dd>

    <dl class="switch"><dt id="sandboxOrigin">If a <code id="origin:document-2"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#active-sandboxing-flag-set" id="origin:active-sandboxing-flag-set">active sandboxing flag set</a> has
     its <a href="browsers.html#sandboxed-origin-browsing-context-flag" id="origin:sandboxed-origin-browsing-context-flag">sandboxed origin browsing context flag</a> set</dt><dd>

      <p>The <a href="browsers.html#origin-2" id="origin:origin-2-7">origin</a> is a globally unique identifier assigned when the
      <code id="origin:document-3"><a href="dom.html#document">Document</a></code> is created.</p>

      <p>The <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-7">effective script origin</a> is initially an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias">alias</a> to the <a href="browsers.html#origin-2" id="origin:origin-2-8">origin</a> of the
      <code id="origin:document-4"><a href="dom.html#document">Document</a></code>.</p>

     </dd><dt>If a <code id="origin:document-5"><a href="dom.html#document">Document</a></code> was served over the network and has an address that uses a URL
     scheme with a server-based naming authority</dt><dd>

      <p>The <a href="browsers.html#origin-2" id="origin:origin-2-9">origin</a> is an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-2">alias</a> to the
      <a href="browsers.html#origin-2" id="origin:origin-2-10">origin</a> of <a id="origin:the-document's-address" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">the <code>Document</code>'s address</a>.</p>

      <p>The <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-8">effective script origin</a> is initially an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-3">alias</a> to the <a href="browsers.html#origin-2" id="origin:origin-2-11">origin</a> of the
      <code id="origin:document-6"><a href="dom.html#document">Document</a></code>.</p>

     </dd><dt>If a <code id="origin:document-7"><a href="dom.html#document">Document</a></code> was generated from a <a href="http://tools.ietf.org/html/rfc2397#section-2" id="origin:data-protocol" data-x-internal="data-protocol"><code>data:</code> URL</a> found in another <code id="origin:document-8"><a href="dom.html#document">Document</a></code> or in a
     script</dt><dd>

      <p>The <a href="browsers.html#origin-2" id="origin:origin-2-12">origin</a> is an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-4">alias</a> to the
      <a href="browsers.html#origin-2" id="origin:origin-2-13">origin</a> specified by the <a href="webappapis.html#incumbent-settings-object" id="origin:incumbent-settings-object">incumbent settings object</a> when the <a href="browsers.html#navigate" id="origin:navigate">navigate</a>
      algorithm was invoked, or, if no <a href="webappapis.html#concept-script" id="origin:concept-script">script</a> was involved, of
      the <a id="origin:node-document" href="https://dom.spec.whatwg.org/#concept-node-document" data-x-internal="node-document">node document</a> of the element that initiated the <a href="browsers.html#navigate" id="origin:navigate-2">navigation</a> to that <a href="infrastructure.html#url" id="origin:url-2">URL</a>.</p>

      <p>The <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-9">effective script origin</a> is initially an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-5">alias</a> to the <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-10">effective script origin</a> of that
      same <a href="webappapis.html#environment-settings-object" id="origin:environment-settings-object">environment settings object</a> or <code id="origin:document-9"><a href="dom.html#document">Document</a></code>.</p>

     </dd><dt>If a <code id="origin:document-10"><a href="dom.html#document">Document</a></code> is the initial "<code id="origin:about:blank"><a href="infrastructure.html#about:blank">about:blank</a></code>" document</dt><dd>

      <p>The <a href="browsers.html#origin-2" id="origin:origin-2-14">origin</a> and <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-11">effective script origin</a> of the
      <code id="origin:document-11"><a href="dom.html#document">Document</a></code> are <a href="browsers.html#about-blank-origin">those it was assigned when its
      browsing context was created</a>.</p>

     </dd><dt>If a <code id="origin:document-12"><a href="dom.html#document">Document</a></code> was created as part of the processing for <a href="browsers.html#javascript-protocol" id="origin:javascript-protocol"><code>javascript:</code> URLs</a></dt><dd>

      <p>The <a href="browsers.html#origin-2" id="origin:origin-2-15">origin</a> is an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-6">alias</a> to the
      <a href="browsers.html#origin-2" id="origin:origin-2-16">origin</a> of the <a href="browsers.html#active-document" id="origin:active-document">active document</a> of the <a href="browsers.html#browsing-context" id="origin:browsing-context">browsing context</a>
      being navigated when the <a href="browsers.html#navigate" id="origin:navigate-3">navigate</a> algorithm was invoked.</p>

      <p>The <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-12">effective script origin</a> is initially an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-7">alias</a> to the <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-13">effective script origin</a> of that
      same <code id="origin:document-13"><a href="dom.html#document">Document</a></code>.</p>

     </dd><dt>If a <code id="origin:document-14"><a href="dom.html#document">Document</a></code> is <a href="semantics.html#an-iframe-srcdoc-document" id="origin:an-iframe-srcdoc-document">an <code>iframe</code> <code>srcdoc</code> document</a></dt><dd>

      <p>The <a href="browsers.html#origin-2" id="origin:origin-2-17">origin</a> of the <code id="origin:document-15"><a href="dom.html#document">Document</a></code> is an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-8">alias</a> to the <a href="browsers.html#origin-2" id="origin:origin-2-18">origin</a> of the
      <code id="origin:document-16"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#browsing-context" id="origin:browsing-context-2">browsing context</a>'s <a href="browsers.html#browsing-context-container" id="origin:browsing-context-container">browsing context
      container</a>'s <a id="origin:node-document-2" href="https://dom.spec.whatwg.org/#concept-node-document" data-x-internal="node-document">node document</a>.</p>

      <p>The <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-14">effective script origin</a> is initially an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-9">alias</a> to the <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-15">effective script origin</a> of the
      <code id="origin:document-17"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#browsing-context" id="origin:browsing-context-3">browsing context</a>'s <a href="browsers.html#browsing-context-container" id="origin:browsing-context-container-2">browsing context
      container</a>'s <a id="origin:node-document-3" href="https://dom.spec.whatwg.org/#concept-node-document" data-x-internal="node-document">node document</a>.</p>

     </dd><dt>If a <code id="origin:document-18"><a href="dom.html#document">Document</a></code> was obtained in some other manner (e.g. a <a href="http://tools.ietf.org/html/rfc2397#section-2" id="origin:data-protocol-2" data-x-internal="data-protocol"><code>data:</code> URL</a> typed in by the user or that was returned as the
     location of an HTTP redirect (<a href="infrastructure.html#concept-http-equivalent-codes" id="origin:concept-http-equivalent-codes">or equivalent</a>
     in other protocols), a <code id="origin:document-19"><a href="dom.html#document">Document</a></code> created using the <code id="origin:dom-domimplementation-createdocument"><a href="infrastructure.html#dom-domimplementation-createdocument">createDocument()</a></code> API, etc)</dt><dd>

      <p>The default behaviour as defined in the DOM standard applies. <a href="references.html#refsDOM">[DOM]</a>.</p>

      <p class="note">The <a href="browsers.html#origin-2" id="origin:origin-2-19">origin</a> is a globally unique identifier assigned when the
      <code id="origin:document-20"><a href="dom.html#document">Document</a></code> is created, and the <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-16">effective script origin</a> is initially an
      <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-10">alias</a> to the <a href="browsers.html#origin-2" id="origin:origin-2-20">origin</a> of the
      <code id="origin:document-21"><a href="dom.html#document">Document</a></code>.</p>

     </dd></dl>

    <p class="note">The <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-17">effective script origin</a> of a <code id="origin:document-22"><a href="dom.html#document">Document</a></code> can be
    manipulated using the <code id="origin:dom-document-domain"><a href="browsers.html#dom-document-domain">document.domain</a></code> IDL
    attribute.</p>

   </dd><dt>For images of <code id="origin:the-img-element"><a href="semantics.html#the-img-element">img</a></code> elements</dt><dd>

    <dl class="switch"><dt>If the image data is <a href="infrastructure.html#cors-cross-origin" id="origin:cors-cross-origin">CORS-cross-origin</a></dt><dd>The <a href="browsers.html#origin-2" id="origin:origin-2-21">origin</a> is a globally unique identifier assigned when the image is
     created.</dd><dt>If the image data is <a href="infrastructure.html#cors-same-origin" id="origin:cors-same-origin">CORS-same-origin</a></dt><dd>The <a href="browsers.html#origin-2" id="origin:origin-2-22">origin</a> is an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-11">alias</a> to the
     <a href="browsers.html#origin-2" id="origin:origin-2-23">origin</a> of the <code id="origin:the-img-element-2"><a href="semantics.html#the-img-element">img</a></code> element's <a id="origin:node-document-4" href="https://dom.spec.whatwg.org/#concept-node-document" data-x-internal="node-document">node document</a>.</dd></dl>

    <p>Images do not have an <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-18">effective script origin</a>.</p>

   </dd><dt>For <code id="origin:the-audio-element"><a href="semantics.html#the-audio-element">audio</a></code> and <code id="origin:the-video-element"><a href="semantics.html#the-video-element">video</a></code> elements</dt><dd>

    <dl class="switch"><dt>If the <a href="semantics.html#media-data" id="origin:media-data">media data</a> is <a href="infrastructure.html#cors-cross-origin" id="origin:cors-cross-origin-2">CORS-cross-origin</a></dt><dd>The <a href="browsers.html#origin-2" id="origin:origin-2-24">origin</a> is a globally unique identifier assigned when the <a href="semantics.html#media-data" id="origin:media-data-2">media
     data</a> is <a href="infrastructure.html#fetch" id="origin:fetch">fetched</a>.</dd><dt>If the <a href="semantics.html#media-data" id="origin:media-data-3">media data</a> is <a href="infrastructure.html#cors-same-origin" id="origin:cors-same-origin-2">CORS-same-origin</a></dt><dd>The <a href="browsers.html#origin-2" id="origin:origin-2-25">origin</a> is an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-12">alias</a> to the
     <a href="browsers.html#origin-2" id="origin:origin-2-26">origin</a> of the <a href="semantics.html#media-element" id="origin:media-element">media element</a>'s <a id="origin:node-document-5" href="https://dom.spec.whatwg.org/#concept-node-document" data-x-internal="node-document">node document</a>.</dd></dl>

    <p><a href="semantics.html#media-element" id="origin:media-element-2">Media elements</a> do not have an <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-19">effective script
    origin</a>.</p>

   </dd><dt>For fonts</dt><dd>

    <p>The <a href="browsers.html#origin-2" id="origin:origin-2-27">origin</a> of a downloadable Web font is an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-13">alias</a> to the <a href="browsers.html#origin-2" id="origin:origin-2-28">origin</a> of the <a href="infrastructure.html#absolute-url" id="origin:absolute-url">absolute
    URL</a> used to obtain the font (after any redirects). <a href="references.html#refsCSSFONTS">[CSSFONTS]</a>
    <a href="references.html#refsCSSFONTLOAD">[CSSFONTLOAD]</a></p> 

    <p>The <a href="browsers.html#origin-2" id="origin:origin-2-29">origin</a> of a locally installed system font is an <a href="browsers.html#concept-origin-alias" id="origin:concept-origin-alias-14">alias</a> to the <a href="browsers.html#origin-2" id="origin:origin-2-30">origin</a> of the
    <code id="origin:document-23"><a href="dom.html#document">Document</a></code> in which that font is being used.</p>

    <p>Fonts do not have an <a href="browsers.html#effective-script-origin" id="origin:effective-script-origin-20">effective script origin</a>.</p>

   </dd></dl>

  <p>Other specifications can override the above definitions by themselves specifying the origin of
  a particular <a href="infrastructure.html#url" id="origin:url-3">URL</a>, <code id="origin:document-24"><a href="dom.html#document">Document</a></code>, image, <a href="semantics.html#media-element" id="origin:media-element-3">media element</a>, or
  font.</p>

  

  <hr>

  <p>The <dfn id="unicode-serialisation-of-an-origin">Unicode serialisation of an origin</dfn> is the string obtained by applying the
  following algorithm to the given <a href="browsers.html#origin-2" id="origin:origin-2-31">origin</a>:</p>

  <ol><li><p>If the <a href="browsers.html#origin-2" id="origin:origin-2-32">origin</a> in question is not a scheme/host/port tuple, then return the
   literal string "<code>null</code>" and abort these steps.</p></li><li><p>Otherwise, let <var>result</var> be the scheme part of the <a href="browsers.html#origin-2" id="origin:origin-2-33">origin</a>
   tuple.</p></li><li><p>Append the string "<code>://</code>" to <var>result</var>.</p></li><li><p>Apply the <a href="infrastructure.html#domain-to-unicode" id="origin:domain-to-unicode">domain to Unicode</a> algorithm to each component of the host
   part of the <a href="browsers.html#origin-2" id="origin:origin-2-34">origin</a> tuple, and append the results — each component, in the same
   order, separated by U+002E FULL STOP characters (.) — to <var>result</var>. <a href="references.html#refsURL">[URL]</a></p></li><li><p>If the port part of the <a href="browsers.html#origin-2" id="origin:origin-2-35">origin</a> tuple gives a port that is different from the
   default port for the protocol given by the scheme part of the <a href="browsers.html#origin-2" id="origin:origin-2-36">origin</a> tuple, then
   append a U+003A COLON character (:) and the given port, in base ten, to <var>result</var>.</p></li><li><p>Return <var>result</var>.</p></li></ol>


  <p>The <dfn id="ascii-serialisation-of-an-origin">ASCII serialisation of an origin</dfn> is the string obtained by applying the
  following algorithm to the given <a href="browsers.html#origin-2" id="origin:origin-2-37">origin</a>:</p>

  <ol><li><p>If the <a href="browsers.html#origin-2" id="origin:origin-2-38">origin</a> in question is not a scheme/host/port tuple, then return the
   literal string "<code>null</code>" and abort these steps.</p></li><li><p>Otherwise, let <var>result</var> be the scheme part of the <a href="browsers.html#origin-2" id="origin:origin-2-39">origin</a>
   tuple.</p></li><li><p>Append the string "<code>://</code>" to <var>result</var>.</p></li><li>

    <p>Apply the <a href="infrastructure.html#domain-to-ascii" id="origin:domain-to-ascii">domain to ASCII</a> algorithm to each component of the host part of
    the <a href="browsers.html#origin-2" id="origin:origin-2-40">origin</a> tuple, and append the results — each component, in the same order,
    separated by U+002E FULL STOP characters (.) — to <var>result</var>. <a href="references.html#refsURL">[URL]</a></p>

    <p>If the <a href="infrastructure.html#domain-to-ascii" id="origin:domain-to-ascii-2">domain to ASCII</a> algorithm returns failure, e.g. because a component is too long or because it contains
    invalid characters, then throw a <code id="origin:securityerror-2"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</p>

   </li><li><p>If the port part of the <a href="browsers.html#origin-2" id="origin:origin-2-41">origin</a> tuple gives a port that is different from the
   default port for the protocol given by the scheme part of the <a href="browsers.html#origin-2" id="origin:origin-2-42">origin</a> tuple, then
   append a U+003A COLON character (:) and the given port, in base ten, to <var>result</var>.</p></li><li><p>Return <var>result</var>.</p></li></ol>


  <p>Two <a href="browsers.html#origin-2" id="origin:origin-2-43">origins</a> are said to be the <dfn id="same-origin">same origin</dfn> if the
  following algorithm returns true:</p>

  <ol><li><p>Let <var>A</var> be the first <a href="browsers.html#origin-2" id="origin:origin-2-44">origin</a> being compared, and <var>B</var> be the second <a href="browsers.html#origin-2" id="origin:origin-2-45">origin</a> being compared.</p></li><li><p>If <var>A</var> and <var>B</var> are both opaque identifiers, and their
   value is equal, then return true.</p></li><li><p>Otherwise, if either <var>A</var> or <var>B</var> or both are opaque
   identifiers, return false.</p></li><li><p>If <var>A</var> and <var>B</var> have scheme components that are not
   identical, return false.</p></li><li><p>If <var>A</var> and <var>B</var> have host components that are not
   identical, return false.</p></li><li><p>If <var>A</var> and <var>B</var> have port components that are not
   identical, return false.</p></li><li><p>If either <var>A</var> or <var>B</var> have additional data, but that
   data is not identical for both, return false.</p></li><li><p>Return true.</p></li></ol>

  


  <section><h4 id="relaxing-the-same-origin-restriction">6.3.1 Relaxing the same-origin restriction</h4>

  <dl class="domintro"><dt><var>document</var> . <code id="relaxing-the-same-origin-restriction:dom-document-domain"><a href="browsers.html#dom-document-domain">domain</a></code> [ = <var>domain</var> ]</dt><dd>

    <p>Returns the current domain used for security checks.</p>

    <p>Can be set to a value that removes subdomains, to change the <a href="browsers.html#effective-script-origin" id="relaxing-the-same-origin-restriction:effective-script-origin">effective script
    origin</a> to allow pages on other subdomains of the same domain (if they do the same thing)
    to access each other. (Can't be set in sandboxed <code id="relaxing-the-same-origin-restriction:the-iframe-element"><a href="semantics.html#the-iframe-element">iframe</a></code>s.)</p>

   </dd></dl>

  

  <p>The <dfn id="dom-document-domain"><code>domain</code></dfn> attribute on
  <code id="relaxing-the-same-origin-restriction:document"><a href="dom.html#document">Document</a></code> objects must be initialised to <a href="browsers.html#the-document's-domain" id="relaxing-the-same-origin-restriction:the-document's-domain">the document's domain</a>, if it has
  one, and the empty string otherwise. If <a href="browsers.html#the-document's-domain" id="relaxing-the-same-origin-restriction:the-document's-domain-2">the document's domain</a> starts with a U+005B
  LEFT SQUARE BRACKET character ([) and ends with a U+005D RIGHT SQUARE BRACKET character (]), it is
  an IPv6 address; these square brackets must be omitted when initialising the attribute's
  value.</p>

  <p>On getting, the attribute must return its current value, unless the <code id="relaxing-the-same-origin-restriction:document-2"><a href="dom.html#document">Document</a></code> has
  no <a href="browsers.html#browsing-context" id="relaxing-the-same-origin-restriction:browsing-context">browsing context</a>, in which case it must return the empty string.</p>

  <p>On setting, the user agent must run the following algorithm:</p>

  <ol><li>

    <p>If the <code id="relaxing-the-same-origin-restriction:document-3"><a href="dom.html#document">Document</a></code> has no <a href="browsers.html#browsing-context" id="relaxing-the-same-origin-restriction:browsing-context-2">browsing context</a>, throw a
    <code id="relaxing-the-same-origin-restriction:securityerror"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</p>

   </li><li>

    <p>If the <code id="relaxing-the-same-origin-restriction:document-4"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#active-sandboxing-flag-set" id="relaxing-the-same-origin-restriction:active-sandboxing-flag-set">active sandboxing flag set</a> has its
    <a href="browsers.html#sandboxed-document.domain-browsing-context-flag" id="relaxing-the-same-origin-restriction:sandboxed-document.domain-browsing-context-flag">sandboxed <code>document.domain</code> browsing context
    flag</a> set, throw a <code id="relaxing-the-same-origin-restriction:securityerror-2"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</p>

   </li><li>

    <p>If the new value is an IPv4 or IPv6 address, let <var>new value</var> be the new
    value.</p>

    <p>Otherwise, <a href="infrastructure.html#strictly-split-a-string" id="relaxing-the-same-origin-restriction:strictly-split-a-string">strictly split</a> the new value on
    U+002E FULL STOP characters (.), apply the <a href="infrastructure.html#domain-to-ascii" id="relaxing-the-same-origin-restriction:domain-to-ascii">domain to ASCII</a> algorithm to each
    returned token, and let <var>new value</var> be the result of concatenating the
    results of applying that algorithm to each token, in the same order, separated by U+002E FULL
    STOP characters (.). <a href="references.html#refsURL">[URL]</a></p>

    <p>If the <a href="infrastructure.html#domain-to-ascii" id="relaxing-the-same-origin-restriction:domain-to-ascii-2">domain to ASCII</a> algorithm returns failure, e.g. because a component is too long or because it contains
    invalid characters, then throw a <code id="relaxing-the-same-origin-restriction:securityerror-3"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</p>

   </li><li>

    <p>If <var>new value</var> is not exactly equal to the current value of the <code id="relaxing-the-same-origin-restriction:dom-document-domain-2"><a href="browsers.html#dom-document-domain">document.domain</a></code> attribute, then run these substeps:</p>

    <ol><li>

      <p>If the current value is an IPv4 or IPv6 address, throw a <code id="relaxing-the-same-origin-restriction:securityerror-4"><a href="infrastructure.html#securityerror">SecurityError</a></code>
      exception and abort these steps.</p>

     </li><li>

      <p>If <var>new value</var>, prefixed by a U+002E FULL STOP (.), does not exactly
      match the end of the current value, throw a <code id="relaxing-the-same-origin-restriction:securityerror-5"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort
      these steps.</p>

      <p class="note">If the <var>new value</var> is an IPv4 or IPv6 address, it cannot
      match the <var>new value</var> in this way and thus an exception will be thrown
      here.</p>

      

     </li><li>

      <p>If <var>new value</var> matches a suffix in the Public Suffix List, or, if <var>new value</var>, prefixed by a U+002E FULL STOP (.), matches the end of a suffix in
      the Public Suffix List, then throw a <code id="relaxing-the-same-origin-restriction:securityerror-6"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these
      steps. <a href="references.html#refsPSL">[PSL]</a></p>

      <p>Suffixes must be compared in an <a href="infrastructure.html#ascii-case-insensitive" id="relaxing-the-same-origin-restriction:ascii-case-insensitive">ASCII case-insensitive</a> manner, after applying
      the <a href="infrastructure.html#domain-to-ascii" id="relaxing-the-same-origin-restriction:domain-to-ascii-3">domain to ASCII</a> algorithm to their individual components, . <a href="references.html#refsURL">[URL]</a></p>

     </li></ol>

   </li><li><p>Release the <a href="webappapis.html#storage-mutex" id="relaxing-the-same-origin-restriction:storage-mutex">storage mutex</a>.</p></li><li>

    <p>Set the attribute's value to <var>new value</var>.</p>

   </li><li>

    <p>If the <a href="browsers.html#effective-script-origin" id="relaxing-the-same-origin-restriction:effective-script-origin-2">effective script origin</a> of the <code id="relaxing-the-same-origin-restriction:document-5"><a href="dom.html#document">Document</a></code> is an <a href="browsers.html#concept-origin-alias" id="relaxing-the-same-origin-restriction:concept-origin-alias">alias</a>, set it to the value of the <a href="browsers.html#effective-script-origin" id="relaxing-the-same-origin-restriction:effective-script-origin-3">effective script
    origin</a> (essentially de-aliasing the <a href="browsers.html#effective-script-origin" id="relaxing-the-same-origin-restriction:effective-script-origin-4">effective script origin</a>).</p>

   </li><li>

    <p>If <var>new value</var> is not the empty string, then run these substeps:</p>

    <ol><li>

      <p>Set the host part of the <a href="browsers.html#effective-script-origin" id="relaxing-the-same-origin-restriction:effective-script-origin-5">effective script origin</a> tuple of the
      <code id="relaxing-the-same-origin-restriction:document-6"><a href="dom.html#document">Document</a></code> to <var>new value</var>.</p>

     </li><li>

      <p>Set the port part of the <a href="browsers.html#effective-script-origin" id="relaxing-the-same-origin-restriction:effective-script-origin-6">effective script origin</a> tuple of the
      <code id="relaxing-the-same-origin-restriction:document-7"><a href="dom.html#document">Document</a></code> to "manual override" (a value that, for the purposes of <a href="browsers.html#same-origin" id="relaxing-the-same-origin-restriction:same-origin">comparing origins</a>, is identical to "manual override" but not
      identical to any other value).</p>

     </li></ol>

   </li></ol>

  <p>The <dfn id="the-document's-domain">domain</dfn> of a <code id="relaxing-the-same-origin-restriction:document-8"><a href="dom.html#document">Document</a></code> is the host part
  of the document's <a href="browsers.html#origin-2" id="relaxing-the-same-origin-restriction:origin-2">origin</a>, if the value of that <a href="browsers.html#origin-2" id="relaxing-the-same-origin-restriction:origin-2-2">origin</a> is a
  scheme/host/port tuple. If it isn't, then the document does not have a domain.</p>

  

  <p class="note">The <code id="relaxing-the-same-origin-restriction:dom-document-domain-3"><a href="browsers.html#dom-document-domain">domain</a></code> attribute is used to enable
  pages on different hosts of a domain to access each others' DOMs.</p>

  <p class="warning">Do not use the <code id="relaxing-the-same-origin-restriction:dom-document-domain-4"><a href="browsers.html#dom-document-domain">document.domain</a></code>
  attribute when using shared hosting. If an untrusted third party is able to host an HTTP server at
  the same IP address but on a different port, then the same-origin protection that normally
  protects two different sites on the same host will fail, as the ports are ignored when comparing
  origins after the <code id="relaxing-the-same-origin-restriction:dom-document-domain-5"><a href="browsers.html#dom-document-domain">document.domain</a></code> attribute has been
  used.</p></section></section>





  <section><h3 id="sandboxing">6.4 Sandboxing</h3>

  <p>A <dfn id="sandboxing-flag-set">sandboxing flag set</dfn> is a set of zero or more of the following flags, which are
  used to restrict the abilities that potentially untrusted resources have:</p>

  <dl><dt>The <dfn id="sandboxed-navigation-browsing-context-flag">sandboxed navigation browsing context flag</dfn></dt><dd>

    <p>This flag <a href="browsers.html#sandboxLinks">prevents content from navigating browsing contexts other
    than the sandboxed browsing context itself</a> (or browsing contexts further nested inside it),
    <a href="browsers.html#auxiliary-browsing-context" id="sandboxing:auxiliary-browsing-context">auxiliary browsing contexts</a> (which are protected
    by the <a href="browsers.html#sandboxed-auxiliary-navigation-browsing-context-flag" id="sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag">sandboxed auxiliary navigation browsing context flag</a> defined next), and the
    <a href="browsers.html#top-level-browsing-context" id="sandboxing:top-level-browsing-context">top-level browsing context</a> (which is protected by the <a href="browsers.html#sandboxed-top-level-navigation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-browsing-context-flag">sandboxed top-level
    navigation browsing context flag</a> defined below).</p>

    <p>If the <a href="browsers.html#sandboxed-auxiliary-navigation-browsing-context-flag" id="sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-2">sandboxed auxiliary navigation browsing context flag</a> is not set, then in
    certain cases the restrictions nonetheless allow popups (new <a href="browsers.html#top-level-browsing-context" id="sandboxing:top-level-browsing-context-2">top-level browsing contexts</a>) to be opened. These <a href="browsers.html#browsing-context" id="sandboxing:browsing-context">browsing contexts</a> always have <dfn id="one-permitted-sandboxed-navigator">one permitted sandboxed navigator</dfn>, set
    when the browsing context is created, which allows the <a href="browsers.html#browsing-context" id="sandboxing:browsing-context-2">browsing context</a> that
    created them to actually navigate them. (Otherwise, the <a href="browsers.html#sandboxed-navigation-browsing-context-flag" id="sandboxing:sandboxed-navigation-browsing-context-flag">sandboxed navigation browsing
    context flag</a> would prevent them from being navigated even if they were opened.)</p>

   </dd><dt>The <dfn id="sandboxed-auxiliary-navigation-browsing-context-flag">sandboxed auxiliary navigation browsing context flag</dfn></dt><dd>

    <p>This flag <a href="browsers.html#sandboxWindowOpen">prevents content from creating new auxiliary browsing
    contexts</a>, e.g. using the <code id="sandboxing:attr-hyperlink-target"><a href="semantics.html#attr-hyperlink-target">target</a></code> attribute, the
    <code id="sandboxing:dom-open"><a href="browsers.html#dom-open">window.open()</a></code> method, or the <code id="sandboxing:dom-showmodaldialog"><a href="webappapis.html#dom-showmodaldialog">showModalDialog()</a></code> method.</p>

   </dd><dt>The <dfn id="sandboxed-top-level-navigation-browsing-context-flag">sandboxed top-level navigation browsing context flag</dfn></dt><dd>

    <p>This flag <a href="browsers.html#sandboxLinks">prevents content from navigating their <span>top-level
    browsing context</span></a> and <a href="browsers.html#sandboxClose">prevents content from closing their
    <span>top-level browsing context</span></a>.</p>

    <p>When the <a href="browsers.html#sandboxed-top-level-navigation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-browsing-context-flag-2">sandboxed top-level navigation browsing context flag</a> is <em>not</em>
    set, content can navigate its <a href="browsers.html#top-level-browsing-context" id="sandboxing:top-level-browsing-context-3">top-level browsing context</a>, but other <a href="browsers.html#browsing-context" id="sandboxing:browsing-context-3">browsing contexts</a> are still protected by the <a href="browsers.html#sandboxed-navigation-browsing-context-flag" id="sandboxing:sandboxed-navigation-browsing-context-flag-2">sandboxed
    navigation browsing context flag</a> and possibly the <a href="browsers.html#sandboxed-auxiliary-navigation-browsing-context-flag" id="sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-3">sandboxed auxiliary navigation
    browsing context flag</a>.</p>

   </dd><dt>The <dfn id="sandboxed-plugins-browsing-context-flag">sandboxed plugins browsing context flag</dfn></dt><dd>

    <p>This flag prevents content from instantiating <a href="infrastructure.html#plugin" id="sandboxing:plugin">plugins</a>, whether
    using <a href="semantics.html#sandboxPluginEmbed">the <code>embed</code> element</a>, <a href="semantics.html#sandboxPluginObject">the <code>object</code> element</a>, <a href="obsolete.html#sandboxPluginApplet">the <code>applet</code> element</a>, or through <a href="browsers.html#sandboxPluginNavigate">navigation</a> of a <a href="browsers.html#nested-browsing-context" id="sandboxing:nested-browsing-context">nested browsing context</a>, unless
    those <a href="infrastructure.html#plugin" id="sandboxing:plugin-2">plugins</a> can be <a href="infrastructure.html#concept-plugin-secure" id="sandboxing:concept-plugin-secure">secured</a>.</p>

   </dd><dt>The <dfn id="sandboxed-seamless-iframes-flag">sandboxed seamless iframes flag</dfn></dt><dd>

    <p>This flag prevents content from using the <code id="sandboxing:attr-iframe-seamless"><a href="semantics.html#attr-iframe-seamless">seamless</a></code>
    attribute on descendant <code id="sandboxing:the-iframe-element"><a href="semantics.html#the-iframe-element">iframe</a></code> elements.</p>

    <p class="note">This prevents a page inserted using the <code id="sandboxing:attr-iframe-sandbox-allow-same-origin"><a href="browsers.html#attr-iframe-sandbox-allow-same-origin">allow-same-origin</a></code> keyword from using a
    CSS-selector-based method of probing the DOM of other pages on the same site (in particular,
    pages that contain user-sensitive information).</p>

    

   </dd><dt>The <dfn id="sandboxed-origin-browsing-context-flag">sandboxed origin browsing context flag</dfn></dt><dd>

    <p>This flag <a href="browsers.html#sandboxOrigin">forces content into a unique origin</a>, thus preventing
    it from accessing other content from the same <a href="browsers.html#origin-2" id="sandboxing:origin-2">origin</a>.</p>

    <p>This flag also <a href="dom.html#sandboxCookies">prevents script from reading from or writing to the
    <code>document.cookie</code> IDL attribute</a>, and blocks access to
    <code id="sandboxing:dom-localstorage"><a href="http://www.w3.org/TR/webstorage/#dom-localstorage">localStorage</a></code>.</p>

   </dd><dt>The <dfn id="sandboxed-forms-browsing-context-flag">sandboxed forms browsing context flag</dfn></dt><dd>

    <p>This flag <a href="semantics.html#sandboxSubmitBlocked">blocks form submission</a>.</p>

   </dd><dt>The <dfn id="sandboxed-pointer-lock-browsing-context-flag">sandboxed pointer lock browsing context flag</dfn></dt><dd>

    <p>This flag disables the Pointer Lock API. <a href="references.html#refsPOINTERLOCK">[POINTERLOCK]</a></p>

   </dd><dt>The <dfn id="sandboxed-scripts-browsing-context-flag">sandboxed scripts browsing context flag</dfn></dt><dd>

    <p>This flag <a href="webappapis.html#sandboxScriptBlocked">blocks script execution</a>.</p>

   </dd><dt>The <dfn id="sandboxed-automatic-features-browsing-context-flag">sandboxed automatic features browsing context flag</dfn></dt><dd>

    <p>This flag blocks features that trigger automatically, such as <a href="semantics.html#attr-media-autoplay" id="sandboxing:attr-media-autoplay">automatically playing a video</a> or <a href="semantics.html#attr-fe-autofocus" id="sandboxing:attr-fe-autofocus">automatically focusing a form control</a>.</p>

   </dd><dt>The <dfn id="sandboxed-storage-area-urls-flag">sandboxed storage area URLs flag</dfn></dt><dd>

    <p>This flag prevents URL schemes that use storage areas from being able to access the origin's
    data.</p>

   </dd><dt>The <dfn id="sandboxed-fullscreen-browsing-context-flag">sandboxed fullscreen browsing context flag</dfn></dt><dd>

    <p>This flag prevents content from using the <code id="sandboxing:dom-element-requestfullscreen"><a href="infrastructure.html#dom-element-requestfullscreen">requestFullscreen()</a></code> method.</p>

   </dd><dt>The <dfn id="sandboxed-document.domain-browsing-context-flag">sandboxed <code>document.domain</code> browsing context flag</dfn></dt><dd>

    <p>This flag prevents content from using the <code id="sandboxing:dom-document-domain"><a href="browsers.html#dom-document-domain">document.domain</a></code> feature to change the <a href="browsers.html#effective-script-origin" id="sandboxing:effective-script-origin">effective script
    origin</a>.</p>

   </dd></dl>

  <p>When the user agent is to <dfn id="parse-a-sandboxing-directive">parse a sandboxing directive</dfn>, given a string <var>input</var>, a <a href="browsers.html#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set">sandboxing flag set</a> <var>output</var>, and
  optionally an <var>allow fullscreen flag</var>, it must run the following steps:</p>

  <ol><li><p><a href="infrastructure.html#split-a-string-on-spaces" id="sandboxing:split-a-string-on-spaces">Split <var>input</var> on spaces</a>,
   to obtain <var>tokens</var>.</p></li><li><p>Let <var>output</var> be empty.</p></li><li>

    <p>Add the following flags to <var>output</var>:</p>

    <ul><li><p>The <a href="browsers.html#sandboxed-navigation-browsing-context-flag" id="sandboxing:sandboxed-navigation-browsing-context-flag-3">sandboxed navigation browsing context flag</a>.</p></li><li><p>The <a href="browsers.html#sandboxed-auxiliary-navigation-browsing-context-flag" id="sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-4">sandboxed auxiliary navigation browsing context flag</a>, unless <var>tokens</var> contains the <dfn id="attr-iframe-sandbox-allow-popups"><code>allow-popups</code></dfn> keyword.</p></li><li><p>The <a href="browsers.html#sandboxed-top-level-navigation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-browsing-context-flag-3">sandboxed top-level navigation browsing context flag</a>, unless <var>tokens</var> contains the <dfn id="attr-iframe-sandbox-allow-top-navigation"><code>allow-top-navigation</code></dfn>
     keyword.</p></li><li><p>The <a href="browsers.html#sandboxed-plugins-browsing-context-flag" id="sandboxing:sandboxed-plugins-browsing-context-flag">sandboxed plugins browsing context flag</a>.</p></li><li><p>The <a href="browsers.html#sandboxed-seamless-iframes-flag" id="sandboxing:sandboxed-seamless-iframes-flag">sandboxed seamless iframes flag</a>.</p></li><li>

      <p>The <a href="browsers.html#sandboxed-origin-browsing-context-flag" id="sandboxing:sandboxed-origin-browsing-context-flag">sandboxed origin browsing context flag</a>, unless the <var>tokens</var> contains the <dfn id="attr-iframe-sandbox-allow-same-origin"><code>allow-same-origin</code></dfn>
      keyword.</p>

      <div class="note">

       <p>The <code id="sandboxing:attr-iframe-sandbox-allow-same-origin-2"><a href="browsers.html#attr-iframe-sandbox-allow-same-origin">allow-same-origin</a></code> keyword
       is intended for two cases.</p>

       <p>First, it can be used to allow content from the same site to be sandboxed to disable
       scripting, while still allowing access to the DOM of the sandboxed content.</p>

       <p>Second, it can be used to embed content from a third-party site, sandboxed to prevent that
       site from opening pop-up windows, etc, without preventing the embedded page from
       communicating back to its originating site, using the database APIs to store data, etc.</p>

      </div>

     </li><li><p>The <a href="browsers.html#sandboxed-forms-browsing-context-flag" id="sandboxing:sandboxed-forms-browsing-context-flag">sandboxed forms browsing context flag</a>, unless <var>tokens</var> contains the <dfn id="attr-iframe-sandbox-allow-forms"><code>allow-forms</code></dfn> keyword.</p></li><li><p>The <a href="browsers.html#sandboxed-pointer-lock-browsing-context-flag" id="sandboxing:sandboxed-pointer-lock-browsing-context-flag">sandboxed pointer lock browsing context flag</a>, unless <var>tokens</var> contains the <dfn id="attr-iframe-sandbox-allow-pointer-lock"><code>allow-pointer-lock</code></dfn>
     keyword.</p></li><li><p>The <a href="browsers.html#sandboxed-scripts-browsing-context-flag" id="sandboxing:sandboxed-scripts-browsing-context-flag">sandboxed scripts browsing context flag</a>, unless <var>tokens</var> contains the <dfn id="attr-iframe-sandbox-allow-scripts"><code>allow-scripts</code></dfn> keyword.</p></li><li>

      <p>The <a href="browsers.html#sandboxed-automatic-features-browsing-context-flag" id="sandboxing:sandboxed-automatic-features-browsing-context-flag">sandboxed automatic features browsing context flag</a>, unless <var>tokens</var> contains the <code id="sandboxing:attr-iframe-sandbox-allow-scripts"><a href="browsers.html#attr-iframe-sandbox-allow-scripts">allow-scripts</a></code> keyword (defined above).</p>

      <p class="note">This flag is relaxed by the same keyword as scripts, because when scripts are
      enabled these features are trivially possible anyway, and it would be unfortunate to force
      authors to use script to do them when sandboxed rather than allowing them to use the
      declarative features.</p>

     </li><li><p>The <a href="browsers.html#sandboxed-storage-area-urls-flag" id="sandboxing:sandboxed-storage-area-urls-flag">sandboxed storage area URLs flag</a>.</p></li><li><p>The <a href="browsers.html#sandboxed-fullscreen-browsing-context-flag" id="sandboxing:sandboxed-fullscreen-browsing-context-flag">sandboxed fullscreen browsing context flag</a>, unless the <var>allow fullscreen flag</var> was passed to the <a href="browsers.html#parse-a-sandboxing-directive" id="sandboxing:parse-a-sandboxing-directive">parse a sandboxing
     directive</a> flag.</p></li><li><p>The <a href="browsers.html#sandboxed-document.domain-browsing-context-flag" id="sandboxing:sandboxed-document.domain-browsing-context-flag">sandboxed <code>document.domain</code> browsing
     context flag</a>.</p></li></ul>

   </li></ol>

  <hr>

  <p>Every <a href="browsers.html#top-level-browsing-context" id="sandboxing:top-level-browsing-context-4">top-level browsing context</a> has a <dfn id="popup-sandboxing-flag-set">popup sandboxing flag set</dfn>, which
  is a <a href="browsers.html#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-2">sandboxing flag set</a>. When a <a href="browsers.html#browsing-context" id="sandboxing:browsing-context-4">browsing context</a> is created, its
  <a href="browsers.html#popup-sandboxing-flag-set" id="sandboxing:popup-sandboxing-flag-set">popup sandboxing flag set</a> must be empty. It is populated by <a href="browsers.html#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name" id="sandboxing:the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name">the rules for
  choosing a browsing context given a browsing context name</a>.</p>

  <p>Every <a href="browsers.html#nested-browsing-context" id="sandboxing:nested-browsing-context-2">nested browsing context</a> has an <dfn id="iframe-sandboxing-flag-set"><code>iframe</code> sandboxing flag
  set</dfn>, which is a <a href="browsers.html#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-3">sandboxing flag set</a>. Which flags in a <a href="browsers.html#nested-browsing-context" id="sandboxing:nested-browsing-context-3">nested browsing
  context</a>'s <a href="browsers.html#iframe-sandboxing-flag-set" id="sandboxing:iframe-sandboxing-flag-set"><code>iframe</code> sandboxing flag set</a> are set at any particular
  time is determined by the <code id="sandboxing:the-iframe-element-2"><a href="semantics.html#the-iframe-element">iframe</a></code> element's <code id="sandboxing:attr-iframe-sandbox"><a href="semantics.html#attr-iframe-sandbox">sandbox</a></code> attribute.</p>

  <p>Every <code id="sandboxing:document"><a href="dom.html#document">Document</a></code> has an <dfn id="active-sandboxing-flag-set">active sandboxing flag set</dfn>, which is a
  <a href="browsers.html#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-4">sandboxing flag set</a>. When the <code id="sandboxing:document-2"><a href="dom.html#document">Document</a></code> is created, its <a href="browsers.html#active-sandboxing-flag-set" id="sandboxing:active-sandboxing-flag-set">active
  sandboxing flag set</a> must be empty. It is populated by the <a href="browsers.html#navigate" id="sandboxing:navigate">navigation
  algorithm</a>.</p>

  <p>Every resource that is obtained by the <a href="browsers.html#navigate" id="sandboxing:navigate-2">navigation algorithm</a> has a
  <dfn id="forced-sandboxing-flag-set">forced sandboxing flag set</dfn>, which is a <a href="browsers.html#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-5">sandboxing flag set</a>. A resource by
  default has no flags set in its <a href="browsers.html#forced-sandboxing-flag-set" id="sandboxing:forced-sandboxing-flag-set">forced sandboxing flag set</a>, but other specifications
  can define that certain flags are set.</p>

  <p class="note">In particular, the <a href="browsers.html#forced-sandboxing-flag-set" id="sandboxing:forced-sandboxing-flag-set-2">forced sandboxing flag set</a> is used by the Content
  Security Policy specification. <a href="references.html#refsCSP">[CSP]</a></p>

  <hr>

  <p>When a user agent is to <dfn id="implement-the-sandboxing">implement the sandboxing</dfn> for a <code id="sandboxing:document-3"><a href="dom.html#document">Document</a></code>, it
  must populate <code id="sandboxing:document-4"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#active-sandboxing-flag-set" id="sandboxing:active-sandboxing-flag-set-2">active sandboxing flag set</a> with the union of
  the flags that are present in the following <a href="browsers.html#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-6">sandboxing flag
  sets</a> at the time the <code id="sandboxing:document-5"><a href="dom.html#document">Document</a></code> object is created:</p>

  <ul><li><p>If the <code id="sandboxing:document-6"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#browsing-context" id="sandboxing:browsing-context-5">browsing context</a> is a <a href="browsers.html#top-level-browsing-context" id="sandboxing:top-level-browsing-context-5">top-level browsing
   context</a>, then: the flags set on the <a href="browsers.html#browsing-context" id="sandboxing:browsing-context-6">browsing context</a>'s <a href="browsers.html#popup-sandboxing-flag-set" id="sandboxing:popup-sandboxing-flag-set-2">popup sandboxing
   flag set</a>.</p></li><li><p>If the <code id="sandboxing:document-7"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#browsing-context" id="sandboxing:browsing-context-7">browsing context</a> is a <a href="browsers.html#nested-browsing-context" id="sandboxing:nested-browsing-context-4">nested browsing
   context</a>, then: the flags set on the <a href="browsers.html#browsing-context" id="sandboxing:browsing-context-8">browsing context</a>'s
   <a href="browsers.html#iframe-sandboxing-flag-set" id="sandboxing:iframe-sandboxing-flag-set-2"><code>iframe</code> sandboxing flag set</a>.</p></li><li><p>If the <code id="sandboxing:document-8"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#browsing-context" id="sandboxing:browsing-context-9">browsing context</a> is a <a href="browsers.html#nested-browsing-context" id="sandboxing:nested-browsing-context-5">nested browsing
   context</a>, then: the flags set on the <a href="browsers.html#browsing-context" id="sandboxing:browsing-context-10">browsing context</a>'s <a href="browsers.html#parent-browsing-context" id="sandboxing:parent-browsing-context">parent browsing
   context</a>'s <a href="browsers.html#active-document" id="sandboxing:active-document">active document</a>'s <a href="browsers.html#active-sandboxing-flag-set" id="sandboxing:active-sandboxing-flag-set-3">active sandboxing flag set</a>.</p></li><li><p>The flags set on the <code id="sandboxing:document-9"><a href="dom.html#document">Document</a></code>'s resource's <a href="browsers.html#forced-sandboxing-flag-set" id="sandboxing:forced-sandboxing-flag-set-3">forced sandboxing flag
   set</a>, if it has one.</p></li></ul></section>



  <section><h3 id="history">6.5 Session history and navigation</h3>

  <section><h4 id="the-session-history-of-browsing-contexts">6.5.1 The session history of browsing contexts</h4>

  <p>The sequence of <code id="the-session-history-of-browsing-contexts:document"><a href="dom.html#document">Document</a></code>s in a <a href="browsers.html#browsing-context" id="the-session-history-of-browsing-contexts:browsing-context">browsing context</a> is its <dfn id="session-history">session
  history</dfn>. Each <a href="browsers.html#browsing-context" id="the-session-history-of-browsing-contexts:browsing-context-2">browsing context</a>, including <a href="browsers.html#nested-browsing-context" id="the-session-history-of-browsing-contexts:nested-browsing-context">nested browsing contexts</a>, has a distinct session history. A <a href="browsers.html#browsing-context" id="the-session-history-of-browsing-contexts:browsing-context-3">browsing
  context</a>'s session history consists of a flat list of <a href="browsers.html#session-history-entry" id="the-session-history-of-browsing-contexts:session-history-entry">session history entries</a>. Each <dfn id="session-history-entry">session history entry</dfn> consists, at a
  minimum, of a <a href="infrastructure.html#url" id="the-session-history-of-browsing-contexts:url">URL</a>, and each entry may in addition have a <a href="browsers.html#state-object" id="the-session-history-of-browsing-contexts:state-object">state object</a>, a
  title, a <code id="the-session-history-of-browsing-contexts:document-2"><a href="dom.html#document">Document</a></code> object, form data, a scroll position, and other information
  associated with it.</p>

  <p class="note">Each entry, when first created, has a <code id="the-session-history-of-browsing-contexts:document-3"><a href="dom.html#document">Document</a></code>. However, when a
  <code id="the-session-history-of-browsing-contexts:document-4"><a href="dom.html#document">Document</a></code> is not <a href="browsers.html#fully-active" id="the-session-history-of-browsing-contexts:fully-active">active</a>, it's possible for it to be
  <a href="browsers.html#discard-a-document" id="the-session-history-of-browsing-contexts:discard-a-document">discarded</a> to free resources. The <a href="infrastructure.html#url" id="the-session-history-of-browsing-contexts:url-2">URL</a> and
  other data in a <a href="browsers.html#session-history-entry" id="the-session-history-of-browsing-contexts:session-history-entry-2">session history entry</a> is then used to bring a new
  <code id="the-session-history-of-browsing-contexts:document-5"><a href="dom.html#document">Document</a></code> into being to take the place of the original, should the user agent find
  itself having to reactivate that <code id="the-session-history-of-browsing-contexts:document-6"><a href="dom.html#document">Document</a></code>.</p>

  <p class="note">Titles associated with <a href="browsers.html#session-history-entry" id="the-session-history-of-browsing-contexts:session-history-entry-3">session history
  entries</a> need not have any relation with the current <code id="the-session-history-of-browsing-contexts:the-title-element"><a href="semantics.html#the-title-element">title</a></code> of the
  <code id="the-session-history-of-browsing-contexts:document-7"><a href="dom.html#document">Document</a></code>. The title of a <a href="browsers.html#session-history-entry" id="the-session-history-of-browsing-contexts:session-history-entry-4">session history entry</a> is intended to explain
  the state of the document at that point, so that the user can navigate the document's history.</p>

  <p>URLs without associated <a href="browsers.html#state-object" id="the-session-history-of-browsing-contexts:state-object-2">state objects</a> are added to the
  session history as the user (or script) navigates from page to page.</p>

  <hr>

  <p>Each <code id="the-session-history-of-browsing-contexts:document-8"><a href="dom.html#document">Document</a></code> object in a <a href="browsers.html#browsing-context" id="the-session-history-of-browsing-contexts:browsing-context-4">browsing context</a>'s <a href="browsers.html#session-history" id="the-session-history-of-browsing-contexts:session-history">session
  history</a> is associated with a unique <code id="the-session-history-of-browsing-contexts:history-3"><a href="browsers.html#history-3">History</a></code> object which must all model the
  same underlying <a href="browsers.html#session-history" id="the-session-history-of-browsing-contexts:session-history-2">session history</a>.</p>

  

  <p>The <dfn id="dom-history"><code>history</code></dfn> attribute of the <code id="the-session-history-of-browsing-contexts:window"><a href="browsers.html#window">Window</a></code>
  interface must return the object implementing the <code id="the-session-history-of-browsing-contexts:history-3-2"><a href="browsers.html#history-3">History</a></code> interface for that <a href="browsers.html#concept-document-window" id="the-session-history-of-browsing-contexts:concept-document-window"><code>Window</code> object's newest
  <code>Document</code></a>.</p>

  

  <hr>

  <p>A <dfn id="state-object">state object</dfn> is an object representing a user interface state.</p>

  <p>Pages can <a href="browsers.html#dom-history-pushstate" id="the-session-history-of-browsing-contexts:dom-history-pushstate">add</a> <a href="browsers.html#state-object" id="the-session-history-of-browsing-contexts:state-object-3">state
  objects</a> to the session history. These are then <a href="index.html#event-popstate" id="the-session-history-of-browsing-contexts:event-popstate">returned to the
  script</a> when the user (or script) goes back in the history, thus enabling authors to use the
  "navigation" metaphor even in one-page applications.</p>

  <div class="note">

   <p><a href="browsers.html#state-object" id="the-session-history-of-browsing-contexts:state-object-4">State objects</a> are intended to be used for two main purposes:
   first, storing a preparsed description of the state in the <a href="infrastructure.html#url" id="the-session-history-of-browsing-contexts:url-3">URL</a> so that in the simple
   case an author doesn't have to do the parsing (though one would still need the parsing for
   handling <a href="infrastructure.html#url" id="the-session-history-of-browsing-contexts:url-4">URLs</a> passed around by users, so it's only a minor
   optimization), and second, so that the author can store state that one wouldn't store in the URL
   because it only applies to the current <code id="the-session-history-of-browsing-contexts:document-9"><a href="dom.html#document">Document</a></code> instance and it would have to be
   reconstructed if a new <code id="the-session-history-of-browsing-contexts:document-10"><a href="dom.html#document">Document</a></code> were opened.</p>

   <p>An example of the latter would be something like keeping track of the precise coordinate from
   which a pop-up <code id="the-session-history-of-browsing-contexts:the-div-element"><a href="semantics.html#the-div-element">div</a></code> was made to animate, so that if the user goes back, it can be
   made to animate to the same location. Or alternatively, it could be used to keep a pointer into a
   cache of data that would be fetched from the server based on the information in the
   <a href="infrastructure.html#url" id="the-session-history-of-browsing-contexts:url-5">URL</a>, so that when going back and forward, the information doesn't have to be fetched
   again.</p>

  </div>

  <hr>

  <p>At any point, one of the entries in the session history is the <dfn id="current-entry">current entry</dfn>. This
  is the entry representing the <a href="browsers.html#active-document" id="the-session-history-of-browsing-contexts:active-document">active document</a> of the <a href="browsers.html#browsing-context" id="the-session-history-of-browsing-contexts:browsing-context-5">browsing context</a>.
  Which entry is the <a href="browsers.html#current-entry" id="the-session-history-of-browsing-contexts:current-entry">current entry</a> is changed by the algorithms defined in this
  specification, e.g. during <a href="browsers.html#traverse-the-history" id="the-session-history-of-browsing-contexts:traverse-the-history">session history
  traversal</a>.</p>

  <p class="note">The <a href="browsers.html#current-entry" id="the-session-history-of-browsing-contexts:current-entry-2">current entry</a> is usually an entry for the <a href="https://dom.spec.whatwg.org/#concept-document-url" id="the-session-history-of-browsing-contexts:the-document's-address" data-x-internal="the-document's-address">address</a> of the <code id="the-session-history-of-browsing-contexts:document-11"><a href="dom.html#document">Document</a></code>. However, it can also be one of
  the entries for <a href="browsers.html#state-object" id="the-session-history-of-browsing-contexts:state-object-5">state objects</a> added to the history by that
  document.</p>

  <p><dfn id="an-entry-with-persisted-user-state">An entry with persisted user state</dfn> is one that also has user-agent defined state.
  This specification does not specify what kind of state can be stored.</p>

  <p class="example">For example, some user agents might want to persist the scroll position, or the
  values of form controls.</p>

  <p class="note">User agents that persist the value of form controls are encouraged to also persist
  their directionality (the value of the element's <code id="the-session-history-of-browsing-contexts:the-dir-attribute"><a href="dom.html#the-dir-attribute">dir</a></code> attribute).
  This prevents values from being displayed incorrectly after a history traversal when the user had
  originally entered the values with an explicit, non-default directionality.</p>

  <p>Entries that consist of <a href="browsers.html#state-object" id="the-session-history-of-browsing-contexts:state-object-6">state objects</a> share the same
  <code id="the-session-history-of-browsing-contexts:document-12"><a href="dom.html#document">Document</a></code> as the entry for the page that was active when they were added.</p>

  <p>Contiguous entries that differ just by fragment identifier also share the same
  <code id="the-session-history-of-browsing-contexts:document-13"><a href="dom.html#document">Document</a></code>.</p>

  <p class="note">All entries that share the same <code id="the-session-history-of-browsing-contexts:document-14"><a href="dom.html#document">Document</a></code> (and that are therefore
  merely different states of one particular document) are contiguous by definition.</p>

  <p>Each <code id="the-session-history-of-browsing-contexts:document-15"><a href="dom.html#document">Document</a></code> in a <a href="browsers.html#browsing-context" id="the-session-history-of-browsing-contexts:browsing-context-6">browsing context</a> can also have a <dfn id="latest-entry">latest
  entry</dfn>. This is the entry for that <code id="the-session-history-of-browsing-contexts:document-16"><a href="dom.html#document">Document</a></code> to which the <a href="browsers.html#browsing-context" id="the-session-history-of-browsing-contexts:browsing-context-7">browsing
  context</a>'s <a href="browsers.html#session-history" id="the-session-history-of-browsing-contexts:session-history-3">session history</a> was most recently traversed. When a
  <code id="the-session-history-of-browsing-contexts:document-17"><a href="dom.html#document">Document</a></code> is created, it initially has no <a href="browsers.html#latest-entry" id="the-session-history-of-browsing-contexts:latest-entry">latest entry</a>.</p>

  

  <p>User agents may <a href="browsers.html#discard-a-document" id="the-session-history-of-browsing-contexts:discard-a-document-2">discard</a> the <code id="the-session-history-of-browsing-contexts:document-18"><a href="dom.html#document">Document</a></code>
  objects of entries other than the <a href="browsers.html#current-entry" id="the-session-history-of-browsing-contexts:current-entry-3">current entry</a> that are not referenced from any
  script, reloading the pages afresh when the user or script navigates back to such pages. This
  specification does not specify when user agents should discard <code id="the-session-history-of-browsing-contexts:document-19"><a href="dom.html#document">Document</a></code> objects and
  when they should cache them.</p>

  <p>Entries that have had their <code id="the-session-history-of-browsing-contexts:document-20"><a href="dom.html#document">Document</a></code> objects discarded must, for the purposes of
  the algorithms given below, act as if they had not. When the user or script navigates back or
  forwards to a page which has no in-memory DOM objects, any other entries that shared the same
  <code id="the-session-history-of-browsing-contexts:document-21"><a href="dom.html#document">Document</a></code> object with it must share the new object as well.</p></section>

  




  <section><h4 id="the-history-interface">6.5.2 The <code id="the-history-interface:history-3"><a href="browsers.html#history-3">History</a></code> interface</h4>

  <pre class="idl">interface <dfn id="history-3">History</dfn> {
  readonly attribute long <a href="browsers.html#dom-history-length" id="the-history-interface:dom-history-length">length</a>;
  readonly attribute any <a href="browsers.html#dom-history-state" id="the-history-interface:dom-history-state">state</a>;
  void <a href="browsers.html#dom-history-go" id="the-history-interface:dom-history-go">go</a>(optional long delta);
  void <a href="browsers.html#dom-history-back" id="the-history-interface:dom-history-back">back</a>();
  void <a href="browsers.html#dom-history-forward" id="the-history-interface:dom-history-forward">forward</a>();
  void <a href="browsers.html#dom-history-pushstate" id="the-history-interface:dom-history-pushstate">pushState</a>(any data, DOMString title, optional DOMString? url = null);
  void <a href="browsers.html#dom-history-replacestate" id="the-history-interface:dom-history-replacestate">replaceState</a>(any data, DOMString title, optional DOMString? url = null);
};</pre>

  <dl class="domintro"><dt><var>window</var> . <code id="the-history-interface:dom-history"><a href="browsers.html#dom-history">history</a></code> . <code id="the-history-interface:dom-history-length-2"><a href="browsers.html#dom-history-length">length</a></code></dt><dd>

    <p>Returns the number of entries in the <a href="browsers.html#joint-session-history" id="the-history-interface:joint-session-history">joint session history</a>.</p>

   </dd><dt><var>window</var> . <code id="the-history-interface:dom-history-2"><a href="browsers.html#dom-history">history</a></code> . <code id="the-history-interface:dom-history-state-2"><a href="browsers.html#dom-history-state">state</a></code></dt><dd>

    <p>Returns the current <a href="browsers.html#state-object" id="the-history-interface:state-object">state object</a>.</p>

   </dd><dt><var>window</var> . <code id="the-history-interface:dom-history-3"><a href="browsers.html#dom-history">history</a></code> . <code id="the-history-interface:dom-history-go-2"><a href="browsers.html#dom-history-go">go</a></code>( [ <var>delta</var> ] )</dt><dd>

    <p>Goes back or forward the specified number of steps in the <a href="browsers.html#joint-session-history" id="the-history-interface:joint-session-history-2">joint session history</a>.</p>

    <p>A zero delta will reload the current page.</p>

    <p>If the delta is out of range, does nothing.</p>

   </dd><dt><var>window</var> . <code id="the-history-interface:dom-history-4"><a href="browsers.html#dom-history">history</a></code> . <code id="the-history-interface:dom-history-back-2"><a href="browsers.html#dom-history-back">back</a></code>()</dt><dd>

    <p>Goes back one step in the <a href="browsers.html#joint-session-history" id="the-history-interface:joint-session-history-3">joint session history</a>.</p>

    <p>If there is no previous page, does nothing.</p>

   </dd><dt><var>window</var> . <code id="the-history-interface:dom-history-5"><a href="browsers.html#dom-history">history</a></code> . <code id="the-history-interface:dom-history-forward-2"><a href="browsers.html#dom-history-forward">forward</a></code>()</dt><dd>

    <p>Goes forward one step in the <a href="browsers.html#joint-session-history" id="the-history-interface:joint-session-history-4">joint session history</a>.</p>

    <p>If there is no next page, does nothing.</p>

   </dd><dt><var>window</var> . <code id="the-history-interface:dom-history-6"><a href="browsers.html#dom-history">history</a></code> . <code id="the-history-interface:dom-history-pushstate-2"><a href="browsers.html#dom-history-pushstate">pushState</a></code>(<var>data</var>, <var>title</var> [, <var>url</var> ] )</dt><dd>

    <p>Pushes the given data onto the session history, with the given title, and, if provided and
    not null, the given URL.</p>

   </dd><dt><var>window</var> . <code id="the-history-interface:dom-history-7"><a href="browsers.html#dom-history">history</a></code> . <code id="the-history-interface:dom-history-replacestate-2"><a href="browsers.html#dom-history-replacestate">replaceState</a></code>(<var>data</var>, <var>title</var> [, <var>url</var> ] )</dt><dd>

    <p>Updates the current entry in the session history to have the given data, title, and, if
    provided and not null, URL.</p>

   </dd></dl>



  <p>The <dfn id="joint-session-history">joint session history</dfn> of a <a href="browsers.html#top-level-browsing-context" id="the-history-interface:top-level-browsing-context">top-level browsing context</a> is the union
  of all the <a href="browsers.html#session-history" id="the-history-interface:session-history">session histories</a> of all <a href="browsers.html#browsing-context" id="the-history-interface:browsing-context">browsing contexts</a> of all the <a href="browsers.html#fully-active" id="the-history-interface:fully-active">fully active</a> <code id="the-history-interface:document"><a href="dom.html#document">Document</a></code>
  objects that share that <a href="browsers.html#top-level-browsing-context" id="the-history-interface:top-level-browsing-context-2">top-level browsing context</a>, with all the entries that are
  <a href="browsers.html#current-entry" id="the-history-interface:current-entry">current entries</a> in their respective <a href="browsers.html#session-history" id="the-history-interface:session-history-2">session histories</a> removed except for the <a href="browsers.html#current-entry-of-the-joint-session-history" id="the-history-interface:current-entry-of-the-joint-session-history">current entry of the joint session
  history</a>.</p>

  <p>The <dfn id="current-entry-of-the-joint-session-history">current entry of the joint session history</dfn> is the entry that most recently
  became a <a href="browsers.html#current-entry" id="the-history-interface:current-entry-2">current entry</a> in its <a href="browsers.html#session-history" id="the-history-interface:session-history-3">session history</a>.</p>

  <p>Entries in the <a href="browsers.html#joint-session-history" id="the-history-interface:joint-session-history-5">joint session history</a> are ordered chronologically by the time they
  were added to their respective <a href="browsers.html#session-history" id="the-history-interface:session-history-4">session histories</a>. Each entry
  has an index; the earliest entry has index 0, and the subsequent entries are numbered with
  consecutively increasing integers (1, 2, 3, etc).</p>

  <p class="note">Since each <code id="the-history-interface:document-2"><a href="dom.html#document">Document</a></code> in a <a href="browsers.html#browsing-context" id="the-history-interface:browsing-context-2">browsing context</a> might have a
  different <a href="webappapis.html#event-loop" id="the-history-interface:event-loop">event loop</a>, the actual state of the <a href="browsers.html#joint-session-history" id="the-history-interface:joint-session-history-6">joint session history</a> can
  be somewhat nebulous. For example, two sibling <code id="the-history-interface:the-iframe-element"><a href="semantics.html#the-iframe-element">iframe</a></code> elements could both <a href="browsers.html#traverse-the-history" id="the-history-interface:traverse-the-history">traverse</a> from one unique origin to another at the same time,
  so their precise order might not be well-defined; similarly, since they might only find out about
  each other later, they might disagree about the length of the <a href="browsers.html#joint-session-history" id="the-history-interface:joint-session-history-7">joint session
  history</a>.</p>



  


  <p>All the getters and setters for attributes, and all the methods, defined on the
  <code id="the-history-interface:history-3-2"><a href="browsers.html#history-3">History</a></code> interface, when invoked on a <code id="the-history-interface:history-3-3"><a href="browsers.html#history-3">History</a></code> object associated with a
  <code id="the-history-interface:document-3"><a href="dom.html#document">Document</a></code> that is not <a href="browsers.html#fully-active" id="the-history-interface:fully-active-2">fully active</a>, must throw a
  <code id="the-history-interface:securityerror"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception instead of operating as described below.</p>


  <p>The <dfn id="dom-history-length"><code>length</code></dfn> attribute of the
  <code id="the-history-interface:history-3-4"><a href="browsers.html#history-3">History</a></code> interface must return the number of entries in the <a href="browsers.html#top-level-browsing-context" id="the-history-interface:top-level-browsing-context-3">top-level browsing
  context</a>'s <a href="browsers.html#joint-session-history" id="the-history-interface:joint-session-history-8">joint session history</a>.</p>

  <p>The actual entries are not accessible from script.</p>

  <p>The <dfn id="dom-history-state"><code>state</code></dfn> attribute of the
  <code id="the-history-interface:history-3-5"><a href="browsers.html#history-3">History</a></code> interface must return the last value it was set to by the user agent.
  Initially, its value must be null.</p>

  <p>When the <dfn id="dom-history-go"><code>go(<var>delta</var>)</code></dfn> method is
  invoked, if the argument to the method was omitted or has the value zero, the user agent must act
  as if the <code id="the-history-interface:dom-location-reload"><a href="browsers.html#dom-location-reload">location.reload()</a></code> method was called instead.
  Otherwise, the user agent must <a href="browsers.html#traverse-the-history-by-a-delta" id="the-history-interface:traverse-the-history-by-a-delta">traverse the history by a delta</a> whose value is the
  value of the method's argument.</p>

  <p>When the <dfn id="dom-history-back"><code>back()</code></dfn> method is invoked, the user
  agent must <a href="browsers.html#traverse-the-history-by-a-delta" id="the-history-interface:traverse-the-history-by-a-delta-2">traverse the history by a delta</a> −1.</p>

  <p>When the <dfn id="dom-history-forward"><code>forward()</code></dfn>method is invoked, the
  user agent must <a href="browsers.html#traverse-the-history-by-a-delta" id="the-history-interface:traverse-the-history-by-a-delta-3">traverse the history by a delta</a> +1.</p>



  <hr>

  <p>Each <a href="browsers.html#top-level-browsing-context" id="the-history-interface:top-level-browsing-context-4">top-level browsing context</a> has a <dfn id="session-history-traversal-queue">session history traversal queue</dfn>,
  initially empty, to which <a href="webappapis.html#concept-task" id="the-history-interface:concept-task">tasks</a> can be added.</p>

  <p>Each <a href="browsers.html#top-level-browsing-context" id="the-history-interface:top-level-browsing-context-5">top-level browsing context</a>, when created, must begin running
  the following algorithm, known as the <dfn id="session-history-event-loop">session history event loop</dfn> for that
  <a href="browsers.html#top-level-browsing-context" id="the-history-interface:top-level-browsing-context-6">top-level browsing context</a>, <a href="infrastructure.html#in-parallel" id="the-history-interface:in-parallel">in parallel</a>:</p>

  <ol><li><p>Wait until this <a href="browsers.html#top-level-browsing-context" id="the-history-interface:top-level-browsing-context-7">top-level browsing context</a>'s <a href="browsers.html#session-history-traversal-queue" id="the-history-interface:session-history-traversal-queue">session history traversal
   queue</a> is not empty.</p></li><li><p>Pull the first <a href="webappapis.html#concept-task" id="the-history-interface:concept-task-2">task</a> from this <a href="browsers.html#top-level-browsing-context" id="the-history-interface:top-level-browsing-context-8">top-level browsing
   context</a>'s <a href="browsers.html#session-history-traversal-queue" id="the-history-interface:session-history-traversal-queue-2">session history traversal queue</a>, and execute it.</p></li><li><p>Return to the first step of this algorithm.</p>

  </li></ol>

  <p>The <a href="browsers.html#session-history-event-loop" id="the-history-interface:session-history-event-loop">session history event loop</a> helps coordinate cross-browsing-context transitions
  of the <a href="browsers.html#joint-session-history" id="the-history-interface:joint-session-history-9">joint session history</a>: since each <a href="browsers.html#browsing-context" id="the-history-interface:browsing-context-3">browsing context</a> might, at any
  particular time, have a different <a href="webappapis.html#event-loop" id="the-history-interface:event-loop-2">event loop</a> (this can happen if the user agent has
  more than one <a href="webappapis.html#event-loop" id="the-history-interface:event-loop-3">event loop</a> per <a href="browsers.html#unit-of-related-browsing-contexts" id="the-history-interface:unit-of-related-browsing-contexts">unit of related browsing contexts</a>),
  transitions would otherwise have to involve cross-event-loop synchronisation.</p>

  <hr>

  <p>To <dfn id="traverse-the-history-by-a-delta">traverse the history by a delta</dfn> <var>delta</var>, the user agent must
  append a <a href="webappapis.html#concept-task" id="the-history-interface:concept-task-3">task</a> to this <a href="browsers.html#top-level-browsing-context" id="the-history-interface:top-level-browsing-context-9">top-level browsing context</a>'s
  <a href="browsers.html#session-history-traversal-queue" id="the-history-interface:session-history-traversal-queue-3">session history traversal queue</a>, the <a href="webappapis.html#concept-task" id="the-history-interface:concept-task-4">task</a>
  consisting of running the following steps:</p>

  <ol><li><p>Let <var>delta</var> be the argument to the method.</p></li><li><p>If the index of the <a href="browsers.html#current-entry-of-the-joint-session-history" id="the-history-interface:current-entry-of-the-joint-session-history-2">current entry of the joint session history</a> plus <var>delta</var> is less than zero or greater than or equal to the number of items in the
   <a href="browsers.html#joint-session-history" id="the-history-interface:joint-session-history-10">joint session history</a>, then abort these steps.</p>

   </li><li><p>Let <var>specified entry</var> be the entry in the <a href="browsers.html#joint-session-history" id="the-history-interface:joint-session-history-11">joint session
   history</a> whose index is the sum of <var>delta</var> and the index of the
   <a href="browsers.html#current-entry-of-the-joint-session-history" id="the-history-interface:current-entry-of-the-joint-session-history-3">current entry of the joint session history</a>.</p></li><li><p>Let <var>specified browsing context</var> be the <a href="browsers.html#browsing-context" id="the-history-interface:browsing-context-4">browsing context</a> of
   the <var>specified entry</var>.</p></li><li><p>If the <var>specified browsing context</var>'s <a href="browsers.html#active-document" id="the-history-interface:active-document">active document</a>'s
   <a href="browsers.html#unload-a-document" id="the-history-interface:unload-a-document">unload a document</a> algorithm is currently running, abort these steps.</p></li><li>

    <p><a href="webappapis.html#queue-a-task" id="the-history-interface:queue-a-task">Queue a task</a> that consists of running the following substeps. The relevant
    <a href="webappapis.html#event-loop" id="the-history-interface:event-loop-4">event loop</a> is that of the <var>specified browsing context</var>'s
    <a href="browsers.html#active-document" id="the-history-interface:active-document-2">active document</a>. The <a href="webappapis.html#task-source" id="the-history-interface:task-source">task source</a> for the queued task is the
    <a href="webappapis.html#history-traversal-task-source" id="the-history-interface:history-traversal-task-source">history traversal task source</a>.</p>

    <ol><li><p>If there is an ongoing attempt to navigate <var>specified browsing context</var>
     that has not yet <a href="browsers.html#concept-navigate-mature" id="the-history-interface:concept-navigate-mature">matured</a> (i.e. it has not passed the
     point of making its <code id="the-history-interface:document-4"><a href="dom.html#document">Document</a></code> the <a href="browsers.html#active-document" id="the-history-interface:active-document-3">active document</a>), then cancel that
     attempt to navigate the <a href="browsers.html#browsing-context" id="the-history-interface:browsing-context-5">browsing context</a>.</p></li><li>

      <p>If the <var>specified browsing context</var>'s <a href="browsers.html#active-document" id="the-history-interface:active-document-4">active document</a> is not
      the same <code id="the-history-interface:document-5"><a href="dom.html#document">Document</a></code> as the <code id="the-history-interface:document-6"><a href="dom.html#document">Document</a></code> of the <var>specified
      entry</var>, then run these substeps:</p>

      <ol><li><p><a href="infrastructure.html#fully-exit-fullscreen" id="the-history-interface:fully-exit-fullscreen">Fully exit fullscreen</a>.</p></li><li><p><a href="browsers.html#prompt-to-unload-a-document" id="the-history-interface:prompt-to-unload-a-document">Prompt to unload</a> the <a href="browsers.html#active-document" id="the-history-interface:active-document-5">active
       document</a> of the <var>specified browsing context</var>. If the user
       <a href="browsers.html#refused-to-allow-the-document-to-be-unloaded" id="the-history-interface:refused-to-allow-the-document-to-be-unloaded">refused to allow the document to be unloaded</a>, then abort these steps.</p></li><li><p><a href="browsers.html#unload-a-document" id="the-history-interface:unload-a-document-2">Unload</a> the <a href="browsers.html#active-document" id="the-history-interface:active-document-6">active document</a> of the
       <var>specified browsing context</var> with the <var>recycle</var> parameter
       set to false.</p></li></ol>

     </li><li><p><a href="browsers.html#traverse-the-history" id="the-history-interface:traverse-the-history-2">Traverse the history</a> of the <var>specified browsing context</var> to
     the <var>specified entry</var>.</p>

    </li></ol>

   </li></ol>

  <p>When the user navigates through a <a href="browsers.html#browsing-context" id="the-history-interface:browsing-context-6">browsing context</a>, e.g. using a browser's back
  and forward buttons, the user agent must <a href="browsers.html#traverse-the-history-by-a-delta" id="the-history-interface:traverse-the-history-by-a-delta-4">traverse the history by a delta</a> equivalent
  to the action specified by the user.</p>

  <hr id="history-1"> 

  <p>The <dfn id="dom-history-pushstate"><code>pushState(<var>data</var>, <var>title</var>, <var>url</var>)</code></dfn> method adds a state object entry to
  the history.</p>

  <p>The <dfn id="dom-history-replacestate"><code>replaceState(<var>data</var>, <var>title</var>, <var>url</var>)</code></dfn> method updates the state object,
  title, and optionally the <a href="infrastructure.html#url" id="the-history-interface:url">URL</a> of the <a href="browsers.html#current-entry" id="the-history-interface:current-entry-3">current entry</a> in the history.</p>

  <p>When either of these methods is invoked, the user agent must run the following steps:</p>

  <ol><li><p>Let <var>cloned data</var> be a <a href="infrastructure.html#structured-clone" id="the-history-interface:structured-clone">structured clone</a> of the specified
   <var>data</var>. If this throws an exception, then rethrow that exception and abort
   these steps.</p></li><li>

    <p>If the third argument is not null, run these substeps:</p>

    <ol><li><a href="infrastructure.html#resolve-a-url" id="the-history-interface:resolve-a-url">Resolve</a> the value of the third argument, relative to
     the <a href="webappapis.html#api-base-url" id="the-history-interface:api-base-url">API base URL</a> specified by the <a href="webappapis.html#entry-settings-object" id="the-history-interface:entry-settings-object">entry settings object</a>.</li><li>If that fails, throw a <code id="the-history-interface:securityerror-2"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</li><li>Compare the resulting <a href="infrastructure.html#parsed-url" id="the-history-interface:parsed-url">parsed URL</a> to the result of applying the <a href="infrastructure.html#url-parser" id="the-history-interface:url-parser">URL
     parser</a> algorithm to <a id="the-history-interface:the-document's-address" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">the document's address</a>. If any component of these two
     <a href="infrastructure.html#url" id="the-history-interface:url-2">URLs</a> differ other than the <a href="infrastructure.html#concept-url-path" id="the-history-interface:concept-url-path">path</a>, <a href="infrastructure.html#concept-url-query" id="the-history-interface:concept-url-query">query</a>, and <a href="infrastructure.html#concept-url-fragment" id="the-history-interface:concept-url-fragment">fragment</a> components, then throw a
     <code id="the-history-interface:securityerror-3"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</li><li>If the <a href="browsers.html#origin-2" id="the-history-interface:origin-2">origin</a> of the resulting <a href="infrastructure.html#absolute-url" id="the-history-interface:absolute-url">absolute URL</a> is not the same as
     the <a href="browsers.html#origin-2" id="the-history-interface:origin-2-2">origin</a> of the <a href="webappapis.html#responsible-document" id="the-history-interface:responsible-document">responsible document</a> specified by the <a href="webappapis.html#entry-settings-object" id="the-history-interface:entry-settings-object-2">entry
     settings object</a>, and either the <a href="infrastructure.html#concept-url-path" id="the-history-interface:concept-url-path-2">path</a> or <a href="infrastructure.html#concept-url-query" id="the-history-interface:concept-url-query-2">query</a> components of the two <a href="infrastructure.html#parsed-url" id="the-history-interface:parsed-url-2">parsed
     URLs</a> compared in the previous step differ, throw a <code id="the-history-interface:securityerror-4"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception
     and abort these steps. (This prevents sandboxed content from spoofing other pages on the same
     origin.)</li><li><p>Let <var>new URL</var> be the resulting <a href="infrastructure.html#absolute-url" id="the-history-interface:absolute-url-2">absolute URL</a>.</p></li></ol>

    <p>For the purposes of the comparisons in the above substeps, the <a href="infrastructure.html#concept-url-path" id="the-history-interface:concept-url-path-3">path</a> and <a href="infrastructure.html#concept-url-query" id="the-history-interface:concept-url-query-3">query</a> components
    can only be the same if the <a href="infrastructure.html#concept-url-scheme" id="the-history-interface:concept-url-scheme">scheme</a> component of both
    <a href="infrastructure.html#parsed-url" id="the-history-interface:parsed-url-3">parsed URLs</a> are <a href="infrastructure.html#concept-url-scheme-relative" id="the-history-interface:concept-url-scheme-relative">relative schemes</a>.</p>

   </li><li>

    <p>If the third argument is null, then let <var>new URL</var> be the <a href="infrastructure.html#url" id="the-history-interface:url-3">URL</a>
    of the <a href="browsers.html#current-entry" id="the-history-interface:current-entry-4">current entry</a>.</p>

   </li><li>

    <p>If the method invoked was the <code id="the-history-interface:dom-history-pushstate-3"><a href="browsers.html#dom-history-pushstate">pushState()</a></code>
    method:</p>

    <ol><li>

      <p>Remove all the entries in the <a href="browsers.html#browsing-context" id="the-history-interface:browsing-context-7">browsing context</a>'s <a href="browsers.html#session-history" id="the-history-interface:session-history-5">session history</a>
      after the <a href="browsers.html#current-entry" id="the-history-interface:current-entry-5">current entry</a>. If the <a href="browsers.html#current-entry" id="the-history-interface:current-entry-6">current entry</a> is the last entry in
      the session history, then no entries are removed.</p>

      <p class="note">This <a href="browsers.html#history-notes">doesn't necessarily have to affect</a> the user
      agent's user interface.</p>

     </li><li><p>Remove any <a href="webappapis.html#concept-task" id="the-history-interface:concept-task-5">tasks</a> queued by the <a href="webappapis.html#history-traversal-task-source" id="the-history-interface:history-traversal-task-source-2">history traversal
     task source</a> that are associated with any <code id="the-history-interface:document-7"><a href="dom.html#document">Document</a></code> objects in the
     <a href="browsers.html#top-level-browsing-context" id="the-history-interface:top-level-browsing-context-10">top-level browsing context</a>'s <a href="browsers.html#document-family" id="the-history-interface:document-family">document family</a>.</p></li><li><p>If appropriate, update the <a href="browsers.html#current-entry" id="the-history-interface:current-entry-7">current entry</a> to reflect any state that the user
     agent wishes to persist. The entry is then said to be <a href="browsers.html#an-entry-with-persisted-user-state" id="the-history-interface:an-entry-with-persisted-user-state">an entry with persisted user
     state</a>.</p></li><li><p>Add a <a href="browsers.html#state-object" id="the-history-interface:state-object-2">state object</a> entry to the session history, after the <a href="browsers.html#current-entry" id="the-history-interface:current-entry-8">current
     entry</a>, with <var>cloned data</var> as the <a href="browsers.html#state-object" id="the-history-interface:state-object-3">state object</a>, the given
     <var>title</var> as the title, and <var>new URL</var> as the <a href="infrastructure.html#url" id="the-history-interface:url-4">URL</a>
     of the entry.</p></li><li><p>Update the <a href="browsers.html#current-entry" id="the-history-interface:current-entry-9">current entry</a> to be this newly added entry.</p></li></ol>

    <p>Otherwise, if the method invoked was the <code id="the-history-interface:dom-history-replacestate-3"><a href="browsers.html#dom-history-replacestate">replaceState()</a></code> method:</p>

    <ol><li><p>Update the <a href="browsers.html#current-entry" id="the-history-interface:current-entry-10">current entry</a> in the session history so that <var>cloned data</var> is the entry's new state object, the given <var>title</var>
     is the new title, and <var>new URL</var> is the entry's new <a href="infrastructure.html#url" id="the-history-interface:url-5">URL</a>.</p></li></ol>

   </li><li><p>If the <a href="browsers.html#current-entry" id="the-history-interface:current-entry-11">current entry</a> in the session history represents a non-GET request
   (e.g. it was the result of a POST submission) then update it to instead represent a GET request
   (<a href="infrastructure.html#concept-http-equivalent-get" id="the-history-interface:concept-http-equivalent-get">or equivalent</a>).</p></li><li>

    <p>Set <a id="the-history-interface:the-document's-address-2" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">the document's address</a> to <var>new URL</var>.</p>

    <p class="note">Since this is neither a <a href="browsers.html#navigate" id="the-history-interface:navigate">navigation</a> of the
    <a href="browsers.html#browsing-context" id="the-history-interface:browsing-context-8">browsing context</a> nor a <a href="browsers.html#traverse-the-history" id="the-history-interface:traverse-the-history-3">history traversal</a>,
    it does not cause a <code id="the-history-interface:event-hashchange"><a href="index.html#event-hashchange">hashchange</a></code> event to be fired.</p>

   </li><li>

    <p>Set <code id="the-history-interface:dom-history-state-3"><a href="browsers.html#dom-history-state">history.state</a></code> to a <a href="infrastructure.html#structured-clone" id="the-history-interface:structured-clone-2">structured clone</a>
    of <var>cloned data</var>.</p> 

   </li><li>

    <p>Let the <a href="browsers.html#latest-entry" id="the-history-interface:latest-entry">latest entry</a> of the <code id="the-history-interface:document-8"><a href="dom.html#document">Document</a></code> of the <a href="browsers.html#current-entry" id="the-history-interface:current-entry-12">current
    entry</a> be the <a href="browsers.html#current-entry" id="the-history-interface:current-entry-13">current entry</a>.</p>

   </li></ol>

  <p class="note">The <var>title</var> is purely advisory. User agents might use the title
  in the user interface.</p>

  <p>User agents may limit the number of state objects added to the session history per page. If a
  page hits the UA-defined limit, user agents must remove the entry immediately after the first
  entry for that <code id="the-history-interface:document-9"><a href="dom.html#document">Document</a></code> object in the session history after having added the new
  entry. (Thus the state history acts as a FIFO buffer for eviction, but as a LIFO buffer for
  navigation.)</p>

  

  <div class="example">

   <p>Consider a game where the user can navigate along a line, such that the user is always at some
   coordinate, and such that the user can bookmark the page corresponding to a particular
   coordinate, to return to it later.</p>

   <p>A static page implementing the x=5 position in such a game could look like the following:</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;!-- this is http://example.com/line?x=5 --&gt;
&lt;title&gt;Line Game - 5&lt;/title&gt;
&lt;p&gt;You are at coordinate 5 on the line.&lt;/p&gt;
&lt;p&gt;
 &lt;a href="?x=6"&gt;Advance to 6&lt;/a&gt; or
 &lt;a href="?x=4"&gt;retreat to 4&lt;/a&gt;?
&lt;/p&gt;</pre>

   <p>The problem with such a system is that each time the user clicks, the whole page has to be
   reloaded. Here instead is another way of doing it, using script:</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;!-- this starts off as http://example.com/line?x=5 --&gt;
&lt;title&gt;Line Game - 5&lt;/title&gt;
&lt;p&gt;You are at coordinate &lt;span id="coord"&gt;5&lt;/span&gt; on the line.&lt;/p&gt;
&lt;p&gt;
 &lt;a href="?x=6" onclick="go(1); return false;"&gt;Advance to 6&lt;/a&gt; or
 &lt;a href="?x=4" onclick="go(-1); return false;"&gt;retreat to 4&lt;/a&gt;?
&lt;/p&gt;
&lt;script&gt;
 var currentPage = 5; // prefilled by server
 function go(d) {
   setupPage(currentPage + d);
   history.pushState(currentPage, document.title, '?x=' + currentPage);
 }
 onpopstate = function(event) {
   setupPage(event.state);
 }
 function setupPage(page) {
   currentPage = page;
   document.title = 'Line Game - ' + currentPage;
   document.getElementById('coord').textContent = currentPage;
   document.links[0].href = '?x=' + (currentPage+1);
   document.links[0].textContent = 'Advance to ' + (currentPage+1);
   document.links[1].href = '?x=' + (currentPage-1);
   document.links[1].textContent = 'retreat to ' + (currentPage-1);
 }
&lt;/script&gt;</pre>

   <p>In systems without script, this still works like the previous example. However, users that
   <em>do</em> have script support can now navigate much faster, since there is no network access
   for the same experience. Furthermore, contrary to the experience the user would have with just a
   naïve script-based approach, bookmarking and navigating the session history still work.</p>

   <p>In the example above, the <var>data</var> argument to the <code id="the-history-interface:dom-history-pushstate-4"><a href="browsers.html#dom-history-pushstate">pushState()</a></code> method is the same information as would be sent
   to the server, but in a more convenient form, so that the script doesn't have to parse the URL
   each time the user navigates.</p>

  </div>

  <div class="example">

   <p>Applications might not use the same title for a <a href="browsers.html#session-history-entry" id="the-history-interface:session-history-entry">session history entry</a> as the
   value of the document's <code id="the-history-interface:the-title-element"><a href="semantics.html#the-title-element">title</a></code> element at that time. For example, here is a simple
   page that shows a block in the <code id="the-history-interface:the-title-element-2"><a href="semantics.html#the-title-element">title</a></code> element. Clearly, when navigating backwards to
   a previous state the user does not go back in time, and therefore it would be inappropriate to
   put the time in the session history title.</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;TITLE&gt;Line&lt;/TITLE&gt;
&lt;SCRIPT&gt;
 setInterval(function () { document.title = 'Line - ' + new Date(); }, 1000);
 var i = 1;
 function inc() {
   set(i+1);
   history.pushState(i, 'Line - ' + i);
 }
 function set(newI) {
   i = newI;
   document.forms.F.I.value = newI;
 }
&lt;/SCRIPT&gt;
&lt;BODY ONPOPSTATE="set(event.state)"&gt;
&lt;FORM NAME=F&gt;
State: &lt;OUTPUT NAME=I&gt;1&lt;/OUTPUT&gt; &lt;INPUT VALUE="Increment" TYPE=BUTTON ONCLICK="inc()"&gt;
&lt;/FORM&gt;</pre>

  </div></section>



  <section><h4 id="the-location-interface">6.5.3 The <code id="the-location-interface:location"><a href="browsers.html#location">Location</a></code> interface</h4>

  <p>Each <code id="the-location-interface:document"><a href="dom.html#document">Document</a></code> object in a <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context">browsing context</a>'s session history is
  associated with a unique instance of a <code id="the-location-interface:location-2"><a href="browsers.html#location">Location</a></code> object.</p>

  <dl class="domintro"><dt><var>document</var> . <code id="the-location-interface:dom-document-location"><a href="browsers.html#dom-document-location">location</a></code> [ = <var>value</var> ]</dt><dt><var>window</var> . <code id="the-location-interface:dom-location"><a href="browsers.html#dom-location">location</a></code> [ = <var>value</var> ]</dt><dd>

    <p>Returns a <code id="the-location-interface:location-3"><a href="browsers.html#location">Location</a></code> object with the current page's location.</p>

    <p>Can be set, to navigate to another page.</p>

   </dd></dl>

  

  <p>The <dfn id="dom-document-location"><code>location</code></dfn> attribute of the
  <code id="the-location-interface:document-2"><a href="dom.html#document">Document</a></code> interface must return the <code id="the-location-interface:location-4"><a href="browsers.html#location">Location</a></code> object for that
  <code id="the-location-interface:document-3"><a href="dom.html#document">Document</a></code> object, if it is in a <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-2">browsing context</a>, and null otherwise.</p>

  <p>The <dfn id="dom-location"><code>location</code></dfn> attribute of the <code id="the-location-interface:window"><a href="browsers.html#window">Window</a></code>
  interface must return the <code id="the-location-interface:location-5"><a href="browsers.html#location">Location</a></code> object for that <code id="the-location-interface:window-2"><a href="browsers.html#window">Window</a></code> object's
  <code id="the-location-interface:document-4"><a href="dom.html#document">Document</a></code>.</p>

  

  <p><code id="the-location-interface:location-6"><a href="browsers.html#location">Location</a></code> objects provide a representation of <a href="https://dom.spec.whatwg.org/#concept-document-url" id="the-location-interface:the-document's-address" data-x-internal="the-document's-address">the address</a> of the <a href="browsers.html#active-document" id="the-location-interface:active-document">active document</a> of their <code id="the-location-interface:document-5"><a href="dom.html#document">Document</a></code>'s
  <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-3">browsing context</a>, and allow the <a href="browsers.html#current-entry" id="the-location-interface:current-entry">current entry</a> of the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-4">browsing
  context</a>'s session history to be changed, by adding or replacing entries in the <code id="the-location-interface:dom-history"><a href="browsers.html#dom-history">history</a></code> object.</p>

  <pre class="idl">[Unforgeable] interface <dfn id="location">Location</dfn> {
  void <a href="browsers.html#dom-location-assign" id="the-location-interface:dom-location-assign">assign</a>(DOMString url);
  void <a href="browsers.html#dom-location-replace" id="the-location-interface:dom-location-replace">replace</a>(DOMString url);
  void <a href="browsers.html#dom-location-reload" id="the-location-interface:dom-location-reload">reload</a>();

  [SameObject] readonly attribute <span>DOMString</span>[] <a href="browsers.html#dom-location-ancestororigins" id="the-location-interface:dom-location-ancestororigins">ancestorOrigins</a>;
};
<a href="browsers.html#location" id="the-location-interface:location-7">Location</a> implements <a href="infrastructure.html#urlutils" id="the-location-interface:urlutils">URLUtils</a>;</pre>

  <dl class="domintro"><dt><var>location</var> . <code id="the-location-interface:dom-location-assign-2"><a href="browsers.html#dom-location-assign">assign</a></code>(<var>url</var>)</dt><dd>

    <p>Navigates to the given page.</p>

   </dd><dt><var>location</var> . <code id="the-location-interface:dom-location-replace-2"><a href="browsers.html#dom-location-replace">replace</a></code>(<var>url</var>)</dt><dd>

    <p>Removes the current page from the session history and navigates to the given page.</p>

   </dd><dt><var>location</var> . <code id="the-location-interface:dom-location-reload-2"><a href="browsers.html#dom-location-reload">reload</a></code>()</dt><dd>

    <p>Reloads the current page.</p>

   </dd><dt><var>location</var> . <code id="the-location-interface:dom-location-ancestororigins-2"><a href="browsers.html#dom-location-ancestororigins">ancestorOrigins</a></code></dt><dd>

    <p>Returns an array values are the origins of the ancestor <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-5">browsing contexts</a>, from the <a href="browsers.html#parent-browsing-context" id="the-location-interface:parent-browsing-context">parent browsing context</a> to the
    <a href="browsers.html#top-level-browsing-context" id="the-location-interface:top-level-browsing-context">top-level browsing context</a>.</p>

   </dd></dl>

  

  <p>The <i>relevant <code id="the-location-interface:document-6"><a href="dom.html#document">Document</a></code></i> is the <code id="the-location-interface:location-8"><a href="browsers.html#location">Location</a></code> object's associated
  <code id="the-location-interface:document-7"><a href="dom.html#document">Document</a></code> object's <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-6">browsing context</a>'s <a href="browsers.html#active-document" id="the-location-interface:active-document-2">active document</a>.</p>

  <p>When the <dfn id="dom-location-assign"><code>assign(<var>url</var>)</code></dfn>
  method is invoked, the UA must <a href="infrastructure.html#resolve-a-url" id="the-location-interface:resolve-a-url">resolve</a> the argument, relative
  to the <a href="webappapis.html#api-base-url" id="the-location-interface:api-base-url">API base URL</a> specified by the <a href="webappapis.html#entry-settings-object" id="the-location-interface:entry-settings-object">entry settings object</a>, and if that
  is successful, must <a href="browsers.html#navigate" id="the-location-interface:navigate">navigate</a> the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-7">browsing
  context</a> to the specified <var>url</var>, with <a href="browsers.html#exceptions-enabled" id="the-location-interface:exceptions-enabled">exceptions enabled</a>. If
  the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-8">browsing context</a>'s <a href="browsers.html#session-history" id="the-location-interface:session-history">session history</a> contains only one
  <code id="the-location-interface:document-8"><a href="dom.html#document">Document</a></code>, and that was the <code id="the-location-interface:about:blank"><a href="infrastructure.html#about:blank">about:blank</a></code> <code id="the-location-interface:document-9"><a href="dom.html#document">Document</a></code> created
  when the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-9">browsing context</a> was created, then the navigation must be done with
  <a href="browsers.html#replacement-enabled" id="the-location-interface:replacement-enabled">replacement enabled</a>.</p> 

  <p>When the <dfn id="dom-location-replace"><code>replace(<var>url</var>)</code></dfn> method is invoked, the UA must <a href="infrastructure.html#resolve-a-url" id="the-location-interface:resolve-a-url-2">resolve</a> the argument, relative to the <a href="webappapis.html#api-base-url" id="the-location-interface:api-base-url-2">API base URL</a> specified by the
  <a href="webappapis.html#entry-settings-object" id="the-location-interface:entry-settings-object-2">entry settings object</a>, and if that is successful, <a href="browsers.html#navigate" id="the-location-interface:navigate-2">navigate</a> the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-10">browsing context</a> to the specified <var>url</var> with <a href="browsers.html#replacement-enabled" id="the-location-interface:replacement-enabled-2">replacement enabled</a> and <a href="browsers.html#exceptions-enabled" id="the-location-interface:exceptions-enabled-2">exceptions enabled</a>.</p>

  <p>Navigation for the <code id="the-location-interface:dom-location-assign-3"><a href="browsers.html#dom-location-assign">assign()</a></code> and <code id="the-location-interface:dom-location-replace-3"><a href="browsers.html#dom-location-replace">replace()</a></code> methods must be done with the <a href="webappapis.html#responsible-browsing-context" id="the-location-interface:responsible-browsing-context">responsible
  browsing context</a> specified by the <a href="webappapis.html#incumbent-settings-object" id="the-location-interface:incumbent-settings-object">incumbent settings object</a> as the
  <a href="browsers.html#source-browsing-context" id="the-location-interface:source-browsing-context">source browsing context</a>.</p>

  <p>If the <a href="infrastructure.html#resolve-a-url" id="the-location-interface:resolve-a-url-3">resolving</a> step of the <code id="the-location-interface:dom-location-assign-4"><a href="browsers.html#dom-location-assign">assign()</a></code> and <code id="the-location-interface:dom-location-replace-4"><a href="browsers.html#dom-location-replace">replace()</a></code> methods is not successful, then the user agent must
  instead throw a <code id="the-location-interface:syntaxerror"><a href="infrastructure.html#syntaxerror">SyntaxError</a></code> exception.</p>

  <p>When the <dfn id="dom-location-reload"><code>reload()</code></dfn> method is invoked, the
  user agent must run the appropriate steps from the following list:</p>

  <dl class="switch"><dt>If the currently executing <a href="webappapis.html#concept-task" id="the-location-interface:concept-task">task</a> is the dispatch of a <code id="the-location-interface:event-resize"><a href="infrastructure.html#event-resize">resize</a></code> event in response to the user resizing the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-11">browsing
   context</a></dt><dd><p>Repaint the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-12">browsing context</a> and abort these steps.</p></dd><dt>If the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-13">browsing context</a>'s <a href="browsers.html#active-document" id="the-location-interface:active-document-3">active document</a> is <a href="semantics.html#an-iframe-srcdoc-document" id="the-location-interface:an-iframe-srcdoc-document">an
   <code>iframe</code> <code>srcdoc</code> document</a></dt><dd><p><a href="semantics.html#process-the-iframe-attributes" id="the-location-interface:process-the-iframe-attributes">Reprocess the <code>iframe</code>
   attributes</a> of the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-14">browsing context</a>'s <a href="browsers.html#browsing-context-container" id="the-location-interface:browsing-context-container">browsing context
   container</a>.</p></dd><dt>If the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-15">browsing context</a>'s <a href="browsers.html#active-document" id="the-location-interface:active-document-4">active document</a> has its <a href="dom.html#reload-override-flag" id="the-location-interface:reload-override-flag">reload
   override flag</a> set</dt><dd><p>Perform <a href="dom.html#an-overridden-reload" id="the-location-interface:an-overridden-reload">an overridden reload</a>, with the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-16">browsing context</a> being
   navigated as the <a href="webappapis.html#responsible-browsing-context" id="the-location-interface:responsible-browsing-context-2">responsible browsing context</a>.</p></dd><dt>Otherwise</dt><dd><p><a href="browsers.html#navigate" id="the-location-interface:navigate-3">Navigate</a> the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-17">browsing context</a> to
   <a id="the-location-interface:the-document's-address-2" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">the document's address</a> with <a href="browsers.html#replacement-enabled" id="the-location-interface:replacement-enabled-3">replacement enabled</a> and <a href="browsers.html#exceptions-enabled" id="the-location-interface:exceptions-enabled-3">exceptions
   enabled</a>. The <a href="browsers.html#source-browsing-context" id="the-location-interface:source-browsing-context-2">source browsing context</a> must be the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-18">browsing
   context</a> being navigated. This is a <a href="browsers.html#reload-triggered-navigation" id="the-location-interface:reload-triggered-navigation">reload-triggered navigation</a>.</p></dd></dl>

  <p>When a user requests that the <a href="browsers.html#active-document" id="the-location-interface:active-document-5">active document</a> of a <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-19">browsing context</a>
  be reloaded through a user interface element, the user agent should <a href="browsers.html#navigate" id="the-location-interface:navigate-4">navigate</a> the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-20">browsing context</a> to the same resource as that
  <code id="the-location-interface:document-10"><a href="dom.html#document">Document</a></code>, with <a href="browsers.html#replacement-enabled" id="the-location-interface:replacement-enabled-4">replacement enabled</a>. In the case of non-idempotent
  methods (e.g. HTTP POST), the user agent should prompt the user to confirm the operation first,
  since otherwise transactions (e.g. purchases or database modifications) could be repeated. User
  agents may allow the user to explicitly override any caches when reloading. If <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-21">browsing
  context</a>'s <a href="browsers.html#active-document" id="the-location-interface:active-document-6">active document</a>'s <a href="dom.html#reload-override-flag" id="the-location-interface:reload-override-flag-2">reload override flag</a> is set, then the
  user agent may instead perform <a href="dom.html#an-overridden-reload" id="the-location-interface:an-overridden-reload-2">an overridden reload</a> rather than the navigation
  described in this paragraph (with the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-22">browsing context</a> being reloaded as the
  <a href="browsers.html#source-browsing-context" id="the-location-interface:source-browsing-context-3">source browsing context</a>).</p>

  <hr>

  

  

  <p>The <code id="the-location-interface:location-9"><a href="browsers.html#location">Location</a></code> interface also supports the <code id="the-location-interface:urlutils-2"><a href="infrastructure.html#urlutils">URLUtils</a></code> interface. <a href="references.html#refsURL">[URL]</a></p>

  

  <p>When the object is created, and whenever the <a href="https://dom.spec.whatwg.org/#concept-document-url" id="the-location-interface:the-document's-address-3" data-x-internal="the-document's-address">the
  address</a> of the <i>relevant <code id="the-location-interface:document-11"><a href="dom.html#document">Document</a></code></i> changes, the user agent must invoke
  the object's <code id="the-location-interface:urlutils-3"><a href="infrastructure.html#urlutils">URLUtils</a></code> interface's <a href="infrastructure.html#concept-uu-set-the-input" id="the-location-interface:concept-uu-set-the-input">set the
  input</a> algorithm with <a href="https://dom.spec.whatwg.org/#concept-document-url" id="the-location-interface:the-document's-address-4" data-x-internal="the-document's-address">the address</a> of the
  <i>relevant <code id="the-location-interface:document-12"><a href="dom.html#document">Document</a></code></i> as the given value.</p>

  <p>The object's <code id="the-location-interface:urlutils-4"><a href="infrastructure.html#urlutils">URLUtils</a></code> interface's <a href="infrastructure.html#concept-uu-get-the-base" id="the-location-interface:concept-uu-get-the-base">get the
  base</a> algorithm must return the <a href="webappapis.html#api-base-url" id="the-location-interface:api-base-url-3">API base URL</a> specified by the <a href="webappapis.html#entry-settings-object" id="the-location-interface:entry-settings-object-3">entry
  settings object</a>, if there is one, or null otherwise.</p>

  <p>The object's <code id="the-location-interface:urlutils-5"><a href="infrastructure.html#urlutils">URLUtils</a></code> interface's <a href="infrastructure.html#concept-uu-query-encoding" id="the-location-interface:concept-uu-query-encoding">query
  encoding</a> is the <a href="infrastructure.html#document's-character-encoding" id="the-location-interface:document's-character-encoding">document's character encoding</a>.</p>

  <p>When the object's <code id="the-location-interface:urlutils-6"><a href="infrastructure.html#urlutils">URLUtils</a></code> interface invokes its <a href="infrastructure.html#concept-uu-update" id="the-location-interface:concept-uu-update">update steps</a> with the string <var>value</var>, the
  user agent must run the following steps:</p>

  <ol><li>

    <p>If any of the following conditions are met, let <var>mode</var> be <i>normal
    navigation</i>; otherwise, let it be <i>replace navigation</i>:</p>

    <ul class="brief"><li>The <code id="the-location-interface:location-10"><a href="browsers.html#location">Location</a></code> object's <i>relevant <code id="the-location-interface:document-13"><a href="dom.html#document">Document</a></code></i> has
     <a href="syntax.html#completely-loaded" id="the-location-interface:completely-loaded">completely loaded</a>, or</li><li>In the <a href="webappapis.html#concept-task" id="the-location-interface:concept-task-2">task</a> in which the algorithm is running, an
     <a href="editing.html#activation-behaviour" id="the-location-interface:activation-behaviour">activation behaviour</a> is currently being processed whose <code id="the-location-interface:event-click"><a href="infrastructure.html#event-click">click</a></code> event was <a href="infrastructure.html#concept-events-trusted" id="the-location-interface:concept-events-trusted">trusted</a>, or</li><li>In the <a href="webappapis.html#concept-task" id="the-location-interface:concept-task-3">task</a> in which the algorithm is running, the event
     listener for a <a href="infrastructure.html#concept-events-trusted" id="the-location-interface:concept-events-trusted-2">trusted</a> <code id="the-location-interface:event-click-2"><a href="infrastructure.html#event-click">click</a></code> event is being handled.</li></ul>

   </li><li><p>If <var>mode</var> is <i>normal navigation</i>, then act as if the <code id="the-location-interface:dom-location-assign-5"><a href="browsers.html#dom-location-assign">assign()</a></code> method had been called with <var>value</var> as its argument. Otherwise, act as if the <code id="the-location-interface:dom-location-replace-5"><a href="browsers.html#dom-location-replace">replace()</a></code> method had been called with <var>value</var> as its argument.</p></li></ol>

  <hr>

  <p>The <dfn id="dom-location-ancestororigins"><code>ancestorOrigins</code></dfn> attribute, on
  getting, must return a <a href="infrastructure.html#dfn-read-only-array" id="the-location-interface:dfn-read-only-array">read only</a> array whose values are
  determined as follows. The same object must be returned each time the attribute's value is
  obtained for any particular <code id="the-location-interface:location-11"><a href="browsers.html#location">Location</a></code> object.</p>

  <ol><li><p>Let <var>output</var> be an empty ordered list of strings.</p>

   </li><li><p>Let <var>current</var> be the <a href="browsers.html#browsing-context" id="the-location-interface:browsing-context-23">browsing context</a> of the <code id="the-location-interface:document-14"><a href="dom.html#document">Document</a></code>
   with which the <code id="the-location-interface:location-12"><a href="browsers.html#location">Location</a></code> object is associated.</p></li><li><p><i>Loop</i>: If <var>current</var> has no <a href="browsers.html#parent-browsing-context" id="the-location-interface:parent-browsing-context-2">parent browsing context</a>, jump to
   the step labeled <i>end</i>.</p></li><li><p>Let <var>current</var> be <var>current</var>'s <a href="browsers.html#parent-browsing-context" id="the-location-interface:parent-browsing-context-3">parent browsing
   context</a>.</p></li><li><p>Append the <a href="browsers.html#unicode-serialisation-of-an-origin" id="the-location-interface:unicode-serialisation-of-an-origin">Unicode serialisation</a>
   of <var>current</var>'s <a href="browsers.html#active-document" id="the-location-interface:active-document-7">active document</a>'s <a href="browsers.html#origin-2" id="the-location-interface:origin-2">origin</a> to <var>output</var>
   as a new value.</p></li><li><p>Return to the step labeled <i>loop</i>.</p></li><li><p><i>End</i>: Let <var>output</var> be the values of the array, in the same order.</p></li></ol>

  




  

  <section><h5 id="security-location">6.5.3.1 Security</h5>

  <p class="critical">This section describes a security model that is underdefined, imperfect, and
  does not match implementations. Work is ongoing to attempt to resolve this, but in the meantime,
  please do not rely on this section for precision. Implementors are urged to send their feedback on
  how cross-origin cross-global access to <code id="security-location:window"><a href="browsers.html#window">Window</a></code> and <code id="security-location:location"><a href="browsers.html#location">Location</a></code> objects
  should work. See <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=20701">bug 20701</a>.</p>

  <p id="security-3">User agents must throw a <code id="security-location:securityerror"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception whenever any
  properties of a <code id="security-location:location-2"><a href="browsers.html#location">Location</a></code> object are accessed when the <a href="webappapis.html#entry-settings-object" id="security-location:entry-settings-object">entry settings
  object</a> specifies an <a href="browsers.html#effective-script-origin" id="security-location:effective-script-origin">effective script origin</a> that is not the <a href="browsers.html#same-origin" id="security-location:same-origin">same</a> as the <code id="security-location:location-3"><a href="browsers.html#location">Location</a></code> object's associated <code id="security-location:document"><a href="dom.html#document">Document</a></code>'s
  <a href="browsers.html#browsing-context" id="security-location:browsing-context">browsing context</a>'s <a href="browsers.html#active-document" id="security-location:active-document">active document</a>'s <a href="browsers.html#effective-script-origin" id="security-location:effective-script-origin-2">effective script
  origin</a>, with the following exceptions:</p>

  <ul><li>The <code id="security-location:dom-url-href"><a href="infrastructure.html#dom-url-href">href</a></code> setter, if the <a href="webappapis.html#responsible-browsing-context" id="security-location:responsible-browsing-context">responsible browsing
   context</a> specified by the <a href="webappapis.html#entry-settings-object" id="security-location:entry-settings-object-2">entry settings object</a> is <a href="browsers.html#familiar-with" id="security-location:familiar-with">familiar with</a>
   the <a href="browsers.html#browsing-context" id="security-location:browsing-context-2">browsing context</a> with which the <code id="security-location:location-4"><a href="browsers.html#location">Location</a></code> object is associated

   </li><li>The <code id="security-location:dom-location-replace"><a href="browsers.html#dom-location-replace">replace()</a></code> method, if the <a href="webappapis.html#responsible-browsing-context" id="security-location:responsible-browsing-context-2">responsible
   browsing context</a> specified by the <a href="webappapis.html#entry-settings-object" id="security-location:entry-settings-object-3">entry settings object</a> is <a href="browsers.html#familiar-with" id="security-location:familiar-with-2">familiar
   with</a> the <a href="browsers.html#browsing-context" id="security-location:browsing-context-3">browsing context</a> with which the <code id="security-location:location-5"><a href="browsers.html#location">Location</a></code> object is
   associated

   </li><li>Any properties not defined in the IDL for the <code id="security-location:location-6"><a href="browsers.html#location">Location</a></code> object or indirectly via
   one of those properties (e.g. <code>toString()</code>, which is defined via the <code>stringifier</code> keyword), if the <a href="browsers.html#effective-script-origin" id="security-location:effective-script-origin-3">effective script origin</a> specified by
   the <a href="webappapis.html#entry-settings-object" id="security-location:entry-settings-object-4">entry settings object</a> is the <a href="browsers.html#same-origin" id="security-location:same-origin-2">same origin</a> as the
   <code id="security-location:location-7"><a href="browsers.html#location">Location</a></code> object's associated <code id="security-location:document-2"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#effective-script-origin" id="security-location:effective-script-origin-4">effective script
   origin</a>

  </li></ul>

  <p>When the <a href="browsers.html#effective-script-origin" id="security-location:effective-script-origin-5">effective script origin</a> specified by the <a href="webappapis.html#entry-settings-object" id="security-location:entry-settings-object-5">entry settings
  object</a> is different than a <code id="security-location:location-8"><a href="browsers.html#location">Location</a></code> object's associated
  <code id="security-location:document-3"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#effective-script-origin" id="security-location:effective-script-origin-6">effective script origin</a>, the user agent must act as if any
  changes to that <code id="security-location:location-9"><a href="browsers.html#location">Location</a></code> object's properties, getters, setters, etc, were not
  present, and as if all the properties of that <code id="security-location:location-10"><a href="browsers.html#location">Location</a></code> object had their
  [[Enumerable]] attribute set to false.</p>

  <p>For members that return objects (including function objects), each distinct <a href="browsers.html#effective-script-origin" id="security-location:effective-script-origin-7">effective
  script origin</a> that is not the <a href="browsers.html#same-origin" id="security-location:same-origin-3">same origin</a> as the <code id="security-location:location-11"><a href="browsers.html#location">Location</a></code>
  object's <code id="security-location:document-4"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#effective-script-origin" id="security-location:effective-script-origin-8">effective script origin</a> must be provided with a
  separate set of objects. These objects must have the prototype chain appropriate for the script
  for which the objects are created (not those that would be appropriate for scripts whose
  <a href="webappapis.html#settings-object" id="security-location:settings-object">settings object</a> specifies a <a href="webappapis.html#global-object" id="security-location:global-object">global object</a> that is the
  <code id="security-location:location-12"><a href="browsers.html#location">Location</a></code> object's <code id="security-location:document-5"><a href="dom.html#document">Document</a></code>'s <code id="security-location:window-2"><a href="browsers.html#window">Window</a></code> object).</p></section></section>

  



  

  <section><h4 id="history-notes">6.5.4 Implementation notes for session history</h4>
  

  <p><i>This section is non-normative.</i></p>

  <p>The <code id="history-notes:history-3"><a href="browsers.html#history-3">History</a></code> interface is not meant to place restrictions on how implementations
  represent the session history to the user.</p>

  <p>For example, session history could be implemented in a tree-like manner, with each page having
  multiple "forward" pages. This specification doesn't define how the linear list of pages in the
  <code id="history-notes:dom-history"><a href="browsers.html#dom-history">history</a></code> object are derived from the actual session history as
  seen from the user's perspective.</p>

  <p>Similarly, a page containing two <code id="history-notes:the-iframe-element"><a href="semantics.html#the-iframe-element">iframe</a></code>s has a <code id="history-notes:dom-history-2"><a href="browsers.html#dom-history">history</a></code> object distinct from the <code id="history-notes:the-iframe-element-2"><a href="semantics.html#the-iframe-element">iframe</a></code>s' <code id="history-notes:dom-history-3"><a href="browsers.html#dom-history">history</a></code> objects, despite the fact that typical Web browsers present the
  user with just one "Back" button, with a session history that interleaves the navigation of the
  two inner frames and the outer page.</p>


  <p><strong>Security</strong>: It is suggested that to avoid letting a page "hijack" the history
  navigation facilities of a UA by abusing <code id="history-notes:dom-history-pushstate"><a href="browsers.html#dom-history-pushstate">pushState()</a></code>,
  the UA provide the user with a way to jump back to the previous page (rather than just going back
  to the previous state). For example, the back button could have a drop down showing just the pages
  in the session history, and not showing any of the states. Similarly, an aural browser could have
  two "back" commands, one that goes back to the previous state, and one that jumps straight back to
  the previous page.</p>

  <p>In addition, a user agent could ignore calls to <code id="history-notes:dom-history-pushstate-2"><a href="browsers.html#dom-history-pushstate">pushState()</a></code> that are invoked on a timer, or from event
  listeners that are not triggered in response to a clear user action, or that are invoked in rapid
  succession.</p></section></section>


  



  <section><h3 id="browsing-the-web">6.6 Browsing the Web</h3>

  

  <section><h4 id="navigating-across-documents">6.6.1 Navigating across documents</h4>

  <p>Certain actions cause the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context">browsing context</a> to <i id="navigating-across-documents:navigate"><a href="browsers.html#navigate">navigate</a></i> to
  a new resource. A user agent may provide various ways for the user to explicitly cause a browsing
  context to navigate, in addition to those defined in this specification.</p>

  <p class="example">For example, <a href="semantics.html#following-hyperlinks-2" id="navigating-across-documents:following-hyperlinks-2">following a hyperlink</a>,
  <a href="semantics.html#concept-form-submit" id="navigating-across-documents:concept-form-submit">form submission</a>, and the <code id="navigating-across-documents:dom-open"><a href="browsers.html#dom-open">window.open()</a></code> and <code id="navigating-across-documents:dom-location-assign"><a href="browsers.html#dom-location-assign">location.assign()</a></code> methods can all cause a browsing context to
  navigate.</p>

  <p class="note">A <i>resource</i> has a URL, but that might not be the only information necessary
  to identify it. For example, a form submission that uses HTTP POST would also have the HTTP method
  and payload. Similarly, <a href="semantics.html#an-iframe-srcdoc-document" id="navigating-across-documents:an-iframe-srcdoc-document">an <code>iframe</code> <code>srcdoc</code> document</a> needs to know the data it is to use.</p>

  <p>Navigation always involves <dfn id="source-browsing-context">source browsing context</dfn>, which is the browsing context which
  was responsible for starting the navigation.</p>

  
  
  <p>When a browsing context is <dfn id="navigate">navigated</dfn> to a new resource, the user
  agent must run the following steps:</p>

  <ol><li><p>Release the <a href="webappapis.html#storage-mutex" id="navigating-across-documents:storage-mutex">storage mutex</a>.</p></li><li id="sandboxLinks">

    <p>If the <a href="browsers.html#source-browsing-context" id="navigating-across-documents:source-browsing-context">source browsing context</a> is not <a href="browsers.html#allowed-to-navigate" id="navigating-across-documents:allowed-to-navigate">allowed to navigate</a> the
    <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-2">browsing context</a> being navigated, then abort these steps.</p>

    <p>If these steps are aborted here, the user agent may instead offer to open the new resource in
    a new <a href="browsers.html#top-level-browsing-context" id="navigating-across-documents:top-level-browsing-context">top-level browsing context</a> or in the <a href="browsers.html#top-level-browsing-context" id="navigating-across-documents:top-level-browsing-context-2">top-level browsing context</a>
    of the <a href="browsers.html#source-browsing-context" id="navigating-across-documents:source-browsing-context-2">source browsing context</a>, at the user's option, in which case the user agent
    must <a href="browsers.html#navigate" id="navigating-across-documents:navigate-2">navigate</a> that designated <a href="browsers.html#top-level-browsing-context" id="navigating-across-documents:top-level-browsing-context-3">top-level
    browsing context</a> to the new resource as if the user had requested it independently.</p>

    <p class="note">Doing so, however, can be dangerous, as it means that the user is overriding the
    author's explicit request to sandbox the content.</p>

    <p>If the <a href="browsers.html#navigate" id="navigating-across-documents:navigate-3">navigate</a> algorithm was invoked with <dfn id="exceptions-enabled">exceptions enabled</dfn>, and it
    is aborted on this step, then in addition to aborting this algorithm, the user agent must also
    throw a <code id="navigating-across-documents:securityerror"><a href="infrastructure.html#securityerror">SecurityError</a></code> exception.</p>

   </li><li id="seamlessLinks"><p>If the <a href="browsers.html#source-browsing-context" id="navigating-across-documents:source-browsing-context-3">source browsing context</a> is the same as the
   <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-3">browsing context</a> being navigated, and this browsing context has its <a href="semantics.html#seamless-browsing-context-flag" id="navigating-across-documents:seamless-browsing-context-flag">seamless
   browsing context flag</a> set, and the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-4">browsing context</a> being navigated was not
   chosen using an <dfn id="explicit-self-navigation-override">explicit self-navigation override</dfn>, then find the nearest
   <a href="browsers.html#ancestor-browsing-context" id="navigating-across-documents:ancestor-browsing-context">ancestor browsing context</a> that does not have its <a href="semantics.html#seamless-browsing-context-flag" id="navigating-across-documents:seamless-browsing-context-flag-2">seamless browsing context
   flag</a> set, and continue these steps as if <em>that</em> <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-5">browsing context</a> was
   the one that was going to be <a href="browsers.html#navigate" id="navigating-across-documents:navigate-4">navigated</a> instead.</p></li><li><p>If there is a preexisting attempt to navigate the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-6">browsing context</a>, and the
   <a href="browsers.html#source-browsing-context" id="navigating-across-documents:source-browsing-context-4">source browsing context</a> is the same as the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-7">browsing context</a> being
   navigated, and that attempt is currently running the <a href="browsers.html#unload-a-document" id="navigating-across-documents:unload-a-document">unload a document</a> algorithm,
   and the <a href="browsers.html#origin-2" id="navigating-across-documents:origin-2">origin</a> of the <a href="infrastructure.html#url" id="navigating-across-documents:url">URL</a> of the resource being loaded in that
   navigation is not the <a href="browsers.html#same-origin" id="navigating-across-documents:same-origin">same origin</a> as the <a href="browsers.html#origin-2" id="navigating-across-documents:origin-2-2">origin</a> of the <a href="infrastructure.html#url" id="navigating-across-documents:url-2">URL</a>
   of the resource being loaded in <em>this</em> navigation, then abort these steps without
   affecting the preexisting attempt to navigate the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-8">browsing context</a>.</p></li><li><p>If a <a href="webappapis.html#concept-task" id="navigating-across-documents:concept-task">task</a> queued by the <a href="browsers.html#traverse-the-history-by-a-delta" id="navigating-across-documents:traverse-the-history-by-a-delta">traverse the history by a
   delta</a> algorithm is running the <a href="browsers.html#unload-a-document" id="navigating-across-documents:unload-a-document-2">unload a document</a> algorithm for the
   <a href="browsers.html#active-document" id="navigating-across-documents:active-document">active document</a> of the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-9">browsing context</a> being navigated, then abort
   these steps without affecting the <a href="browsers.html#unload-a-document" id="navigating-across-documents:unload-a-document-3">unload a document</a> algorithm or the aforementioned
   history traversal task.</p></li><li><p>If the <a href="browsers.html#prompt-to-unload-a-document" id="navigating-across-documents:prompt-to-unload-a-document">prompt to unload a document</a> algorithm is being run for the
   <a href="browsers.html#active-document" id="navigating-across-documents:active-document-2">active document</a> of the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-10">browsing context</a> being navigated, then abort
   these steps without affecting the <a href="browsers.html#prompt-to-unload-a-document" id="navigating-across-documents:prompt-to-unload-a-document-2">prompt to unload a document</a> algorithm.</p></li><li>

    <p>Let <var>gone async</var> be false.</p>

    <p class="note">The <a href="browsers.html#navigate-redirect-step"><i>handle redirects</i></a> step later in
    this algorithm can in certain cases jump back to the step labeled <a href="browsers.html#navigate-fragid-step"><i>fragment identifiers</i></a>. Since, between those two steps,
    this algorithm goes from operating synchronously in the context of the calling <a href="webappapis.html#concept-task" id="navigating-across-documents:concept-task-2">task</a> to operating <a href="infrastructure.html#in-parallel" id="navigating-across-documents:in-parallel">in parallel</a> independent of the <a href="webappapis.html#event-loop" id="navigating-across-documents:event-loop">event
    loop</a>, some of the intervening steps need to be able to handle both being run as part of a <a href="webappapis.html#concept-task" id="navigating-across-documents:concept-task-3">task</a> and
    running <a href="infrastructure.html#in-parallel" id="navigating-across-documents:in-parallel-2">in parallel</a>. The <var>gone async</var> flag is thus used to make these steps
    aware of which mode they are operating in.</p>

   </li><li id="navigate-fragid-step"><p><i>Fragment identifiers</i>: If this is not a
   <dfn id="reload-triggered-navigation">reload-triggered navigation</dfn>: apply the <a href="infrastructure.html#url-parser" id="navigating-across-documents:url-parser">URL parser</a> algorithm to the
   <a href="infrastructure.html#absolute-url" id="navigating-across-documents:absolute-url">absolute URL</a> of the new resource and the <a href="https://dom.spec.whatwg.org/#concept-document-url" id="navigating-across-documents:the-document's-address" data-x-internal="the-document's-address">address</a> of the <a href="browsers.html#active-document" id="navigating-across-documents:active-document-3">active document</a> of the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-11">browsing context</a>
   being navigated; if all the components of the resulting <a href="infrastructure.html#parsed-url" id="navigating-across-documents:parsed-url">parsed
   URLs</a>, ignoring any <a href="infrastructure.html#concept-url-fragment" id="navigating-across-documents:concept-url-fragment">fragment</a> components, are
   identical, and the new resource is to be fetched using HTTP GET <a href="infrastructure.html#concept-http-equivalent-get" id="navigating-across-documents:concept-http-equivalent-get">or equivalent</a>, and the <a href="infrastructure.html#parsed-url" id="navigating-across-documents:parsed-url-2">parsed URL</a> of the
   new resource has a <a href="infrastructure.html#concept-url-fragment" id="navigating-across-documents:concept-url-fragment-2">fragment</a> component that is not null
   (even if it is empty), then <a href="browsers.html#scroll-to-fragid" id="navigating-across-documents:scroll-to-fragid">navigate to that fragment
   identifier</a> and abort these steps.</p></li><li><p>If <var>gone async</var> is false, cancel any preexisting but not yet <a href="browsers.html#concept-navigate-mature" id="navigating-across-documents:concept-navigate-mature">mature</a> attempt to navigate the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-12">browsing
   context</a>, including canceling any instances of the <a href="infrastructure.html#fetch" id="navigating-across-documents:fetch">fetch</a> algorithm started by
   those attempts. If one of those attempts has already created and <a href="browsers.html#initialise-the-document-object" id="navigating-across-documents:initialise-the-document-object">initialised a new <code>Document</code> object</a>, <a href="browsers.html#abort-a-document" id="navigating-across-documents:abort-a-document">abort</a> that <code id="navigating-across-documents:document"><a href="dom.html#document">Document</a></code> also. (Navigation attempts that have <a href="browsers.html#concept-navigate-mature" id="navigating-across-documents:concept-navigate-mature-2">matured</a> already have session history entries, and are
   therefore handled during the <a href="browsers.html#update-the-session-history-with-the-new-page" id="navigating-across-documents:update-the-session-history-with-the-new-page">update the session history with the new page</a> algorithm,
   later.)</p></li><li><p>If the new resource is to be handled using a mechanism that does not affect the browsing
   context, e.g. ignoring the navigation request altogether because the specified scheme is not one
   of the supported protocols, then abort these steps and <a href="browsers.html#hand-off-to-external-software" id="navigating-across-documents:hand-off-to-external-software">proceed with that mechanism instead</a>.</p></li><li>

    <p>If <var>gone async</var> is false, <a href="browsers.html#prompt-to-unload-a-document" id="navigating-across-documents:prompt-to-unload-a-document-3">prompt
    to unload</a> the <code id="navigating-across-documents:document-2"><a href="dom.html#document">Document</a></code> object. If the user <a href="browsers.html#refused-to-allow-the-document-to-be-unloaded" id="navigating-across-documents:refused-to-allow-the-document-to-be-unloaded">refused to allow the
    document to be unloaded</a>, then abort these steps.</p>

    <p>If this instance of the <a href="browsers.html#navigate" id="navigating-across-documents:navigate-5">navigation</a> algorithm gets canceled
    while this step is running, the <a href="browsers.html#prompt-to-unload-a-document" id="navigating-across-documents:prompt-to-unload-a-document-4">prompt to unload a document</a> algorithm must
    nonetheless be run to completion.</p>

   </li><li><p>If <var>gone async</var> is false, <a href="browsers.html#abort-a-document" id="navigating-across-documents:abort-a-document-2">abort</a>
   the <a href="browsers.html#active-document" id="navigating-across-documents:active-document-4">active document</a> of the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-13">browsing context</a>.</p></li><li>

    <p>If the new resource is to be handled by displaying some sort of inline content, e.g. an error
    message because the specified scheme is not one of the supported protocols, or an inline prompt
    to allow the user to select <a href="webappapis.html#dom-navigator-registerprotocolhandler" id="navigating-across-documents:dom-navigator-registerprotocolhandler">a registered
    handler</a> for the given scheme, then <a href="browsers.html#read-ua-inline" id="navigating-across-documents:read-ua-inline">display the inline
    content</a> and abort these steps.</p>

    <p class="note">In the case of a registered handler being used, the algorithm will be reinvoked
    with a new URL to handle the request.</p>

   </li><li>

    <p>If the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-14">browsing context</a> being navigated is a <a href="browsers.html#nested-browsing-context" id="navigating-across-documents:nested-browsing-context">nested browsing
    context</a>, then put it in the <a href="browsers.html#delaying-load-events-mode" id="navigating-across-documents:delaying-load-events-mode">delaying <code>load</code> events
    mode</a>.</p>

    <p>The user agent must take this <a href="browsers.html#nested-browsing-context" id="navigating-across-documents:nested-browsing-context-2">nested browsing context</a> out of the <a href="browsers.html#delaying-load-events-mode" id="navigating-across-documents:delaying-load-events-mode-2">delaying
    <code>load</code> events mode</a> when this <a href="browsers.html#navigate" id="navigating-across-documents:navigate-6">navigation</a> algorithm later <a href="browsers.html#concept-navigate-mature" id="navigating-across-documents:concept-navigate-mature-3">matures</a>, or when it terminates (whether due to having
    run all the steps, or being canceled, or being aborted), whichever happens first.</p>

    

   </li><li>

    <p>This is the step that attempts to obtain the resource, if necessary. Jump to the first
    appropriate substep:</p>

    <dl><dt>If the resource has already been obtained (e.g. because it is being used to populate an
     <code id="navigating-across-documents:the-object-element"><a href="semantics.html#the-object-element">object</a></code> element's new <a href="browsers.html#child-browsing-context" id="navigating-across-documents:child-browsing-context">child browsing context</a>)</dt><dd><p>Skip this step. The data is already available.</p></dd><dt>If the new resource is a <a href="infrastructure.html#url" id="navigating-across-documents:url-3">URL</a> whose <a href="infrastructure.html#concept-url-scheme" id="navigating-across-documents:concept-url-scheme">scheme</a> is <code id="navigating-across-documents:javascript-protocol"><a href="browsers.html#javascript-protocol">javascript</a></code></dt><dd>

      

      <p><a href="webappapis.html#queue-a-task" id="navigating-across-documents:queue-a-task">Queue a task</a> to run <dfn id="javascript-protocol">these
      "<code>javascript:</code> URL" steps</dfn>, associated with the <a href="browsers.html#active-document" id="navigating-across-documents:active-document-5">active document</a>
      of the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-15">browsing context</a> being navigated:</p>

      <ol id="concept-js-deref"><li><p>If the <a href="browsers.html#origin-2" id="navigating-across-documents:origin-2-3">origin</a> of the <a href="browsers.html#source-browsing-context" id="navigating-across-documents:source-browsing-context-5">source browsing context</a> is not the
       <a href="browsers.html#same-origin" id="navigating-across-documents:same-origin-2">same origin</a> as the <a href="browsers.html#origin-2" id="navigating-across-documents:origin-2-4">origin</a> of the <a href="browsers.html#active-document" id="navigating-across-documents:active-document-6">active document</a> of
       the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-16">browsing context</a> being navigated, then act as if the result of evaluating
       the script was the void value, and jump to the step labeled <i>process results</i>
       below.</p></li><li><p>Apply the <a href="infrastructure.html#url-parser" id="navigating-across-documents:url-parser-2">URL parser</a> to the <a href="infrastructure.html#url" id="navigating-across-documents:url-4">URL</a> being navigated.</p></li><li><p>Let <var>parsed URL</var> be the result of the <a href="infrastructure.html#url-parser" id="navigating-across-documents:url-parser-3">URL
       parser</a>.</p></li><li><p>Let <var>script source</var> be the empty string.</p></li><li><p>Append <var>parsed URL</var>'s <a href="infrastructure.html#concept-url-scheme-data" id="navigating-across-documents:concept-url-scheme-data">scheme
       data</a> component to <var>script source</var>.</p></li><li><p>If <var>parsed URL</var>'s <a href="infrastructure.html#concept-url-query" id="navigating-across-documents:concept-url-query">query</a>
       component is not null, then first append a U+003F QUESTION MARK character (?) to <var>script source</var>, and then append <var>parsed URL</var>'s <a href="infrastructure.html#concept-url-query" id="navigating-across-documents:concept-url-query-2">query</a> component to <var>script
       source</var>.</p></li><li><p>If <var>parsed URL</var>'s <a href="infrastructure.html#concept-url-fragment" id="navigating-across-documents:concept-url-fragment-3">fragment</a> component is not null, then first append a
       U+0023 NUMBER SIGN character (#) to <var>script source</var>, and then append <var>parsed URL</var>'s <a href="infrastructure.html#concept-url-fragment" id="navigating-across-documents:concept-url-fragment-4">fragment</a> component to
       <var>script source</var>.</p></li><li><p>Replace <var>script source</var> with the result of applying the
       <a href="infrastructure.html#percent-decode" id="navigating-across-documents:percent-decode">percent decode</a> algorithm to <var>script source</var>.</p></li><li><p>Replace <var>script source</var> with the result of applying the <a href="infrastructure.html#utf-8-decode" id="navigating-across-documents:utf-8-decode">UTF-8
       decode</a> algorithm to <var>script source</var>.</p></li><li><p>Let <var>address</var> be the <a href="https://dom.spec.whatwg.org/#concept-document-url" id="navigating-across-documents:the-document's-address-2" data-x-internal="the-document's-address">address</a> of the <a href="browsers.html#active-document" id="navigating-across-documents:active-document-7">active document</a> of the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-17">browsing
       context</a> being navigated.</p></li><li>

        <p><a href="webappapis.html#create-a-script" id="navigating-across-documents:create-a-script">Create a script</a>, using <var>script source</var> as the script
        source, <var>address</var> as the script source URL, JavaScript as the scripting
        language, and the <a href="webappapis.html#environment-settings-object" id="navigating-across-documents:environment-settings-object">environment settings object</a> of the <code id="navigating-across-documents:window"><a href="browsers.html#window">Window</a></code> object of
        the <a href="browsers.html#active-document" id="navigating-across-documents:active-document-8">active document</a> of the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-18">browsing context</a> being navigated.</p>

        <p>Let <var>result</var> be the return value of the <a href="webappapis.html#code-entry-point" id="navigating-across-documents:code-entry-point">code entry-point</a>
        of this <a href="webappapis.html#concept-script" id="navigating-across-documents:concept-script">script</a>. If an exception was thrown, let <var>result</var> be void instead. (The result will be void also if <a href="webappapis.html#concept-bc-noscript" id="navigating-across-documents:concept-bc-noscript">scripting is disabled</a>.)</p>

       </li><li>

        <p><i>Process results</i>: If the result of executing the script is void (there is no return
        value), then the result of obtaining the resource for the URL is <a href="infrastructure.html#concept-http-equivalent-codes" id="navigating-across-documents:concept-http-equivalent-codes">equivalent to</a> an HTTP resource with an HTTP
        204 No Content response.</p>

        <p>Otherwise, the result of obtaining the resource for the URL is <a href="infrastructure.html#concept-http-equivalent-codes" id="navigating-across-documents:concept-http-equivalent-codes-2">equivalent</a> to an HTTP resource with a 200 OK
        response whose <a href="infrastructure.html#content-type" id="navigating-across-documents:content-type">Content-Type metadata</a> is
        <code id="navigating-across-documents:text/html"><a href="iana.html#text/html">text/html</a></code> and whose response body is the return value converted to a string
        value.</p>

        <p>When it comes time to <a href="browsers.html#set-the-document's-address" id="navigating-across-documents:set-the-document's-address">set the document's address</a> in the <a href="browsers.html#navigate" id="navigating-across-documents:navigate-7">navigation algorithm</a>, use <var>address</var> as the
        <a href="browsers.html#override-url" id="navigating-across-documents:override-url">override URL</a>.</p>

       </li></ol>

      <p>The <a href="webappapis.html#task-source" id="navigating-across-documents:task-source">task source</a> for this <a href="webappapis.html#concept-task" id="navigating-across-documents:concept-task-4">task</a> is the
      <a href="webappapis.html#dom-manipulation-task-source" id="navigating-across-documents:dom-manipulation-task-source">DOM manipulation task source</a>.</p>

      <div class="example">

       <p>So for example a <a href="browsers.html#javascript-protocol" id="navigating-across-documents:javascript-protocol-2"><code>javascript:</code> URL</a> in
       an <code id="navigating-across-documents:attr-hyperlink-href"><a href="semantics.html#attr-hyperlink-href">href</a></code> attribute of an <code id="navigating-across-documents:the-a-element"><a href="semantics.html#the-a-element">a</a></code> element
       would only be evaluated when the link was <a href="semantics.html#following-hyperlinks-2" id="navigating-across-documents:following-hyperlinks-2-2">followed</a>, while such a URL in the <code id="navigating-across-documents:attr-iframe-src"><a href="semantics.html#attr-iframe-src">src</a></code> attribute of an <code id="navigating-across-documents:the-iframe-element"><a href="semantics.html#the-iframe-element">iframe</a></code> element would be
       evaluated in the context of the <code id="navigating-across-documents:the-iframe-element-2"><a href="semantics.html#the-iframe-element">iframe</a></code>'s own <a href="browsers.html#nested-browsing-context" id="navigating-across-documents:nested-browsing-context-3">nested browsing
       context</a> when the <code id="navigating-across-documents:the-iframe-element-3"><a href="semantics.html#the-iframe-element">iframe</a></code> is being set up; once evaluated, its return value
       (if it was not void) would replace that <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-19">browsing context</a>'s <code id="navigating-across-documents:document-3"><a href="dom.html#document">Document</a></code>, thus also
       changing the <code id="navigating-across-documents:window-2"><a href="browsers.html#window">Window</a></code> object of that <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-20">browsing context</a>.</p>

      </div>

     </dd><dt>If the new resource is to be fetched using HTTP GET <a href="infrastructure.html#concept-http-equivalent-get" id="navigating-across-documents:concept-http-equivalent-get-2">or equivalent</a>, and there are <a href="browsers.html#relevant-application-cache" id="navigating-across-documents:relevant-application-cache">relevant application caches</a> that are identified by a URL with the
     <a href="browsers.html#same-origin" id="navigating-across-documents:same-origin-3">same origin</a> as the URL in question, and that have this URL as one of their
     entries, excluding entries marked as <a href="browsers.html#concept-appcache-foreign" id="navigating-across-documents:concept-appcache-foreign">foreign</a>,
     and whose <a href="browsers.html#concept-appcache-mode" id="navigating-across-documents:concept-appcache-mode">mode</a> is <a href="browsers.html#concept-appcache-mode-fast" id="navigating-across-documents:concept-appcache-mode-fast">fast</a>, and the user agent is not in a mode where it
     will avoid using <a href="browsers.html#application-cache" id="navigating-across-documents:application-cache">application caches</a></dt><dd>

      <p><a href="infrastructure.html#fetch" id="navigating-across-documents:fetch-2">Fetch</a> the resource from the <a href="browsers.html#concept-appcache-selection" id="navigating-across-documents:concept-appcache-selection">most
      appropriate application cache</a> of those that match.</p>

      <p class="example">For example, imagine an HTML page with an associated application cache
      displaying an image and a form, where the image is also used by several other application
      caches. If the user right-clicks on the image and chooses "View Image", then the user agent
      could decide to show the image from any of those caches, but it is likely that the most useful
      cache for the user would be the one that was used for the aforementioned HTML page. On the
      other hand, if the user submits the form, and the form does a POST submission, then the user
      agent will not use an application cache at all; the submission will be made to the
      network.</p>

     </dd><dt>Otherwise</dt><dd>

      <p><a href="infrastructure.html#fetch" id="navigating-across-documents:fetch-3">Fetch</a> the new resource, with the <i>manual redirect flag</i>
      set.</p>

     </dd></dl>

    <p>If the steps above invoked the <a href="infrastructure.html#fetch" id="navigating-across-documents:fetch-4">fetch</a> algorithm, the following requirements also
    apply:</p>

    <p>If the resource is being fetched using a method other than one <a href="infrastructure.html#concept-http-equivalent-get" id="navigating-across-documents:concept-http-equivalent-get-3">equivalent to</a> HTTP's GET, or, if the <a href="browsers.html#navigate" id="navigating-across-documents:navigate-8">navigation algorithm</a> was invoked as a
    result of the <a href="semantics.html#concept-form-submit" id="navigating-across-documents:concept-form-submit-2">form submission algorithm</a>, then the
    <a href="infrastructure.html#fetch" id="navigating-across-documents:fetch-5">fetching algorithm</a> must be invoked from the <a href="browsers.html#origin-2" id="navigating-across-documents:origin-2-5">origin</a> of
    the <a href="browsers.html#active-document" id="navigating-across-documents:active-document-9">active document</a> of the <a href="browsers.html#source-browsing-context" id="navigating-across-documents:source-browsing-context-6">source browsing context</a>, if any.</p> 

    <p>Otherwise, if the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-21">browsing context</a> being navigated is a <a href="browsers.html#child-browsing-context" id="navigating-across-documents:child-browsing-context-2">child browsing
    context</a>, then the <a href="infrastructure.html#fetch" id="navigating-across-documents:fetch-6">fetching algorithm</a> must be invoked from the
    <a href="browsers.html#browsing-context-scope-origin" id="navigating-across-documents:browsing-context-scope-origin">browsing context scope origin</a> of the <a href="browsers.html#browsing-context-container" id="navigating-across-documents:browsing-context-container">browsing context container</a> of the
    <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-22">browsing context</a> being navigated, if it has one.</p> 

   </li><li>

    

    <p>If <var>gone async</var> is false, return to whatever algorithm invoked the
    navigation steps and continue running these steps asynchronously.</p>

   </li><li><p>Let <var>gone async</var> be true.</p></li><li><p>Wait for one or more bytes to be available or for the user agent to establish that the
   resource in question is empty. During this time, the user agent may allow the user to cancel this
   navigation attempt or start other navigation attempts.</p></li><li id="navigate-redirect-step">

    <p><i>Handle redirects</i>: If fetching the resource results in a redirect, and either the
    <a href="infrastructure.html#url" id="navigating-across-documents:url-5">URL</a> of the target of the redirect has the <a href="browsers.html#same-origin" id="navigating-across-documents:same-origin-4">same origin</a> as the original
    resource, or the resource is being obtained using the POST method or a safe method (in HTTP
    terms), return to <a href="browsers.html#navigate-fragid-step">the step labeled <i>fragment
    identifiers</i></a> with the new resource, except that if the <a href="infrastructure.html#url" id="navigating-across-documents:url-6">URL</a> of the target of
    the redirect does not have a fragment identifier and the <a href="infrastructure.html#url" id="navigating-across-documents:url-7">URL</a> of the resource that
    led to the redirect does, then the fragment identifier of the resource that led to the redirect
    must be propagated to the <a href="infrastructure.html#url" id="navigating-across-documents:url-8">URL</a> of the target of the redirect.</p>

    <p class="example">So for instance, if the original URL was "<code>http://example.com/#!sample</code>" and "<code>http://example.com/</code>" is
    found to redirect to "<code>https://example.com/</code>", the URL of the new resource
    will be "<code>https://example.com/#!sample</code>".</p>

    <p>Otherwise, if fetching the resource results in a redirect but the <a href="infrastructure.html#url" id="navigating-across-documents:url-9">URL</a> of the
    target of the redirect does not have the <a href="browsers.html#same-origin" id="navigating-across-documents:same-origin-5">same origin</a> as the original resource and
    the resource is being obtained using a method that is neither the POST method nor a safe method
    (in HTTP terms), then abort these steps. The user agent may indicate to the user that the
    navigation has been aborted for security reasons.</p>

   </li><li>

    <p><strong>Fallback in prefer-online mode</strong>: If the resource was not fetched from an
    <a href="browsers.html#application-cache" id="navigating-across-documents:application-cache-2">application cache</a>, and was to be fetched using HTTP GET <a href="infrastructure.html#concept-http-equivalent-get" id="navigating-across-documents:concept-http-equivalent-get-4">or equivalent</a>, and there are <a href="browsers.html#relevant-application-cache" id="navigating-across-documents:relevant-application-cache-2">relevant application caches</a> that are identified by a URL with the
    <a href="browsers.html#same-origin" id="navigating-across-documents:same-origin-6">same origin</a> as the URL in question, and that have this URL as one of their entries,
    excluding entries marked as <a href="browsers.html#concept-appcache-foreign" id="navigating-across-documents:concept-appcache-foreign-2">foreign</a>, and whose
    <a href="browsers.html#concept-appcache-mode" id="navigating-across-documents:concept-appcache-mode-2">mode</a> is <a href="browsers.html#concept-appcache-mode-prefer-online" id="navigating-across-documents:concept-appcache-mode-prefer-online">prefer-online</a>, and the user didn't cancel the
    navigation attempt during the earlier step, and the navigation attempt failed (e.g. the server
    returned a 4xx or 5xx status code <a href="infrastructure.html#concept-http-equivalent-codes" id="navigating-across-documents:concept-http-equivalent-codes-3">or
    equivalent</a>, or there was a DNS error), then:</p>

    <p>Let <var>candidate</var> be the resource identified by the URL in question from the
    <a href="browsers.html#concept-appcache-selection" id="navigating-across-documents:concept-appcache-selection-2">most appropriate application cache</a> of those that
    match.</p> 

    <p>If <var>candidate</var> is not marked as <a href="browsers.html#concept-appcache-foreign" id="navigating-across-documents:concept-appcache-foreign-3">foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as the resource.
    The user agent may indicate to the user that the original page load failed, and that the page
    used was a previously cached resource.</p>

    <p class="note">This does not affect the <i>address of the resource from which Request-URIs are
    obtained</i>, as used to set <a href="dom.html#the-document's-referrer" id="navigating-across-documents:the-document's-referrer">the document's referrer</a> in the <a href="browsers.html#initialise-the-document-object" id="navigating-across-documents:initialise-the-document-object-2">initialise the
    <code>Document</code> object</a> steps below; they still use the value as computed by the
    original <a href="infrastructure.html#fetch" id="navigating-across-documents:fetch-7">fetch</a> algorithm.</p>

   </li><li>

    <p><strong>Fallback for fallback entries</strong>: If the resource was not fetched from an
    <a href="browsers.html#application-cache" id="navigating-across-documents:application-cache-3">application cache</a>, and was to be fetched using HTTP GET <a href="infrastructure.html#concept-http-equivalent-get" id="navigating-across-documents:concept-http-equivalent-get-5">or equivalent</a>, and its URL <a href="browsers.html#concept-appcache-matches-fallback" id="navigating-across-documents:concept-appcache-matches-fallback">matches the fallback namespace</a> of one or more
    <a href="browsers.html#relevant-application-cache" id="navigating-across-documents:relevant-application-cache-3">relevant application caches</a>, and the <a href="browsers.html#concept-appcache-selection" id="navigating-across-documents:concept-appcache-selection-3">most appropriate application cache</a> of those that match
    does not have an entry in its <a href="browsers.html#concept-appcache-onlinewhitelist" id="navigating-across-documents:concept-appcache-onlinewhitelist">online
    whitelist</a> that has the <a href="browsers.html#same-origin" id="navigating-across-documents:same-origin-7">same origin</a> as the resource's URL and that is a
    <a href="infrastructure.html#prefix-match" id="navigating-across-documents:prefix-match">prefix match</a> for the resource's URL, and the user didn't cancel the navigation
    attempt during the earlier step, and the navigation attempt failed (e.g. the server returned a
    4xx or 5xx status code <a href="infrastructure.html#concept-http-equivalent-codes" id="navigating-across-documents:concept-http-equivalent-codes-4">or equivalent</a>, or
    there was a DNS error), then:</p> 

    <p>Let <var>candidate</var> be the <a href="browsers.html#concept-appcache-fallback" id="navigating-across-documents:concept-appcache-fallback">fallback
    resource</a> specified for the <a href="browsers.html#concept-appcache-fallback-ns" id="navigating-across-documents:concept-appcache-fallback-ns">fallback
    namespace</a> in question. If multiple application caches match, the user agent must use the
    fallback of the <a href="browsers.html#concept-appcache-selection" id="navigating-across-documents:concept-appcache-selection-4">most appropriate application
    cache</a> of those that match.</p>

    <p>If <var>candidate</var> is not marked as <a href="browsers.html#concept-appcache-foreign" id="navigating-across-documents:concept-appcache-foreign-4">foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var>candidate</var> as the resource.
    <a id="navigating-across-documents:the-document's-address-3" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">The document's address</a>, if appropriate, will still be the originally requested URL,
    not the fallback URL, but the user agent may indicate to the user that the original page load
    failed, that the page used was a fallback resource, and what the URL of the fallback resource
    actually is.</p>

    <p class="note">This does not affect the <i>address of the resource from which Request-URIs are
    obtained</i>, as used to set <a href="dom.html#the-document's-referrer" id="navigating-across-documents:the-document's-referrer-2">the document's referrer</a> in the <a href="browsers.html#initialise-the-document-object" id="navigating-across-documents:initialise-the-document-object-3">initialise the
    <code>Document</code> object</a> steps below; they still use the value as computed by the
    original <a href="infrastructure.html#fetch" id="navigating-across-documents:fetch-8">fetch</a> algorithm.</p>

   </li><li>

    <p><i>Resource handling</i>: If the resource's out-of-band metadata (e.g. HTTP headers), not
    counting any <a href="infrastructure.html#content-type" id="navigating-across-documents:content-type-2">type information</a> (such as the Content-Type HTTP
    header), requires some sort of processing that will not affect the browsing context, then
    perform that processing and abort these steps.</p>

    <div class="note">
     <p>Such processing might be triggered by, amongst other things, the following:</p>
     <ul class="brief"><li>HTTP status codes (e.g. 204 No Content or 205 Reset Content)</li><li>Network errors (e.g. the network interface being unavailable)</li><li>Cryptographic protocol failures (e.g. an incorrect TLS certificate)</li></ul>
    </div>

    <p>Responses with HTTP <code id="navigating-across-documents:http-content-disposition"><a href="infrastructure.html#http-content-disposition">Content-Disposition</a></code> headers
    specifying the <code>attachment</code> disposition type must be handled <a href="semantics.html#as-a-download" id="navigating-across-documents:as-a-download">as a
    download</a>.</p>

    

    <p>HTTP 401 responses that do not include a challenge recognised by the user agent must be
    processed as if they had no challenge, e.g. rendering the entity body as if the response had
    been 200 OK.</p>

    <p>User agents may show the entity body of an HTTP 401 response even when the response does
    include a recognised challenge, with the option to login being included in a non-modal fashion,
    to enable the information provided by the server to be used by the user before authenticating.
    Similarly, user agents should allow the user to authenticate (in a non-modal fashion) against
    authentication challenges included in other responses such as HTTP 200 OK responses, effectively
    allowing resources to present HTTP login forms without requiring their use.</p>

   </li><li><p>Let <var>type</var> be <a href="https://mimesniff.spec.whatwg.org/#sniffed-mime-type" id="navigating-across-documents:content-type-sniffing-2" data-x-internal="content-type-sniffing-2">the sniffed type of
   the resource</a>.</p></li><li><p>If the user agent has been configured to process resources of the given <var>type</var> using some mechanism other than rendering the content in a <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-23">browsing
   context</a>, then skip this step. Otherwise, if the <var>type</var> is one of the
   following types, jump to the appropriate entry in the following list, and process the resource as
   described there:</p>

    <dl class="switch"><dt>"<code id="navigating-across-documents:text/html-2"><a href="iana.html#text/html">text/html</a></code>"</dt><dd>Follow the steps given in the <a href="browsers.html#read-html" id="navigating-across-documents:read-html">HTML document</a> section,
     and then, once they have completed, abort this <a href="browsers.html#navigate" id="navigating-across-documents:navigate-9">navigate</a> algorithm.</dd><dt>"<code id="navigating-across-documents:application/xml"><a href="index.html#application/xml">application/xml</a></code>"</dt><dt>"<code id="navigating-across-documents:text/xml"><a href="index.html#text/xml">text/xml</a></code>"</dt><dt>"<code id="navigating-across-documents:image/svg+xml"><a href="index.html#image/svg+xml">image/svg+xml</a></code>"</dt><dt>"<code id="navigating-across-documents:application/xhtml+xml"><a href="iana.html#application/xhtml+xml">application/xhtml+xml</a></code>"</dt><dt>Any other type ending in "<code>+xml</code>" that is not an <a href="browsers.html#explicitly-supported-xml-type" id="navigating-across-documents:explicitly-supported-xml-type">explicitly
     supported XML type</a></dt><dd>Follow the steps given in the <a href="browsers.html#read-xml" id="navigating-across-documents:read-xml">XML document</a> section. If
     that section determines that the content is <em>not</em> to be displayed as a generic XML
     document, then proceed to the next step in this overall set of steps. Otherwise, once the steps
     given in the <a href="browsers.html#read-xml" id="navigating-across-documents:read-xml-2">XML document</a> section have completed, abort this
     <a href="browsers.html#navigate" id="navigating-across-documents:navigate-10">navigate</a> algorithm.</dd><dt>"<code id="navigating-across-documents:text/plain"><a data-x-internal="text/plain" href="http://tools.ietf.org/html/rfc2046#section-4.1.3">text/plain</a></code>"</dt><dd>Follow the steps given in the <a href="browsers.html#read-text" id="navigating-across-documents:read-text">plain text file</a> section,
     and then, once they have completed, abort this <a href="browsers.html#navigate" id="navigating-across-documents:navigate-11">navigate</a> algorithm.</dd><dt>"<code id="navigating-across-documents:multipart/x-mixed-replace"><a href="iana.html#multipart/x-mixed-replace">multipart/x-mixed-replace</a></code>"</dt><dd>Follow the steps given in the <a href="browsers.html#read-multipart-x-mixed-replace" id="navigating-across-documents:read-multipart-x-mixed-replace">multipart/x-mixed-replace</a> section, and then,
     once they have completed, abort this <a href="browsers.html#navigate" id="navigating-across-documents:navigate-12">navigate</a> algorithm.</dd><dt>A supported image, video, or audio type</dt><dd>Follow the steps given in the <a href="browsers.html#read-media" id="navigating-across-documents:read-media">media</a> section, and then,
     once they have completed, abort this <a href="browsers.html#navigate" id="navigating-across-documents:navigate-13">navigate</a> algorithm.</dd><dt>A type that will use an external application to render the content in the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-24">browsing
     context</a></dt><dd>Follow the steps given in the <a href="browsers.html#read-plugin" id="navigating-across-documents:read-plugin">plugin</a> section, and then,
     once they have completed, abort this <a href="browsers.html#navigate" id="navigating-across-documents:navigate-14">navigate</a> algorithm.</dd></dl>

    <p>An <dfn id="explicitly-supported-xml-type">explicitly supported XML type</dfn> is one for which the user agent is configured to
    use an external application to render the content (either a <a href="infrastructure.html#plugin" id="navigating-across-documents:plugin">plugin</a> rendering
    directly in the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-25">browsing context</a>, or a separate application), or one for which the
    user agent has dedicated processing rules (e.g. a Web browser with a built-in Atom feed viewer
    would be said to explicitly support the <code id="navigating-across-documents:application/atom+xml"><a href="index.html#application/atom+xml">application/atom+xml</a></code> MIME type), or one for
    which the user agent has a dedicated handler (e.g. one registered using <code id="navigating-across-documents:dom-navigator-registercontenthandler"><a href="webappapis.html#dom-navigator-registercontenthandler">registerContentHandler()</a></code>).</p>

    <p><dfn id="set-the-document's-address">Setting the document's address</dfn>: If there is no
    <dfn id="override-url">override URL</dfn>, then any <code id="navigating-across-documents:document-4"><a href="dom.html#document">Document</a></code> created by these steps must have its
    <a href="https://dom.spec.whatwg.org/#concept-document-url" id="navigating-across-documents:the-document's-address-4" data-x-internal="the-document's-address">address</a> set to the <a href="infrastructure.html#url" id="navigating-across-documents:url-10">URL</a> that was
    originally to be <a href="infrastructure.html#fetch" id="navigating-across-documents:fetch-9">fetched</a>, ignoring any other data that was used to
    obtain the resource (e.g. the entity body in the case of a POST submission is not part of
    <a id="navigating-across-documents:the-document's-address-5" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">the document's address</a>, nor is the URL of the fallback resource in the case of the
    original load having failed and that URL having been found to match a <a href="browsers.html#concept-appcache-fallback-ns" id="navigating-across-documents:concept-appcache-fallback-ns-2">fallback namespace</a>). However, if there <em>is</em>
    an <a href="browsers.html#override-url" id="navigating-across-documents:override-url-2">override URL</a>, then any <code id="navigating-across-documents:document-5"><a href="dom.html#document">Document</a></code> created by these steps must have
    its <a href="https://dom.spec.whatwg.org/#concept-document-url" id="navigating-across-documents:the-document's-address-6" data-x-internal="the-document's-address">address</a> set to that <a href="infrastructure.html#url" id="navigating-across-documents:url-11">URL</a>
    instead.</p>

    <p class="note">An <a href="browsers.html#override-url" id="navigating-across-documents:override-url-3">override URL</a> is set when <a href="browsers.html#javascript-protocol" id="navigating-across-documents:javascript-protocol-3">dereferencing a <code>javascript:</code> URL</a> and when
    performing <a href="dom.html#an-overridden-reload" id="navigating-across-documents:an-overridden-reload">an overridden reload</a>.</p>

    <p><dfn id="initialise-the-document-object">Initialising a new <code>Document</code>
    object</dfn>: when a <code id="navigating-across-documents:document-6"><a href="dom.html#document">Document</a></code> is created as part of the above steps, the user agent
    will be required to additionally run the following algorithm after creating the new object:</p>

    <ol><li><p>Create a new <code id="navigating-across-documents:window-3"><a href="browsers.html#window">Window</a></code> object, and associate it with the
     <code id="navigating-across-documents:document-7"><a href="dom.html#document">Document</a></code>, with one exception: if the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-26">browsing context</a>'s only entry in
     its <a href="browsers.html#session-history" id="navigating-across-documents:session-history">session history</a> is the <code id="navigating-across-documents:about:blank"><a href="infrastructure.html#about:blank">about:blank</a></code> <code id="navigating-across-documents:document-8"><a href="dom.html#document">Document</a></code> that was
     added when the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-27">browsing context</a> was created, and navigation is occurring with
     <a href="browsers.html#replacement-enabled" id="navigating-across-documents:replacement-enabled">replacement enabled</a>, and that <code id="navigating-across-documents:document-9"><a href="dom.html#document">Document</a></code> has the <a href="browsers.html#same-origin" id="navigating-across-documents:same-origin-8">same
     origin</a> as the new <code id="navigating-across-documents:document-10"><a href="dom.html#document">Document</a></code>, then use the <code id="navigating-across-documents:window-4"><a href="browsers.html#window">Window</a></code> object of that
     <code id="navigating-across-documents:document-11"><a href="dom.html#document">Document</a></code> instead, and change the <code id="navigating-across-documents:dom-document-2"><a href="browsers.html#dom-document-2">document</a></code>
     attribute of the <code id="navigating-across-documents:window-5"><a href="browsers.html#window">Window</a></code> object to point to the new <code id="navigating-across-documents:document-12"><a href="dom.html#document">Document</a></code>.</p>

     </li><li><p>Set <a href="dom.html#the-document's-referrer" id="navigating-across-documents:the-document's-referrer-3">the document's referrer</a> to the <i>address of the resource from which
     Request-URIs are obtained</i> as determined when the <a href="infrastructure.html#fetch" id="navigating-across-documents:fetch-10">fetch</a> algorithm obtained the
     resource, if that algorithm was used and determined such a value; otherwise, set it to the
     empty string.</p></li><li><p><a href="browsers.html#implement-the-sandboxing" id="navigating-across-documents:implement-the-sandboxing">Implement the sandboxing</a> for the <code id="navigating-across-documents:document-13"><a href="dom.html#document">Document</a></code>.</p></li><li id="fullscreen-logic">

      <p>If the <a href="browsers.html#active-sandboxing-flag-set" id="navigating-across-documents:active-sandboxing-flag-set">active sandboxing flag set</a> of the <code id="navigating-across-documents:document-14"><a href="dom.html#document">Document</a></code>'s
      <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-28">browsing context</a> or any of its <a href="browsers.html#ancestor-browsing-context" id="navigating-across-documents:ancestor-browsing-context-2">ancestor
      browsing contexts</a> (if any) have the <a href="browsers.html#sandboxed-fullscreen-browsing-context-flag" id="navigating-across-documents:sandboxed-fullscreen-browsing-context-flag">sandboxed fullscreen browsing context
      flag</a> set, then skip this step.</p>

      <p>If the <code id="navigating-across-documents:document-15"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-29">browsing context</a> has a <a href="browsers.html#browsing-context-container" id="navigating-across-documents:browsing-context-container-2">browsing context
      container</a> and either it is not an <code id="navigating-across-documents:the-iframe-element-4"><a href="semantics.html#the-iframe-element">iframe</a></code> element, or it does not have the
      <code id="navigating-across-documents:attr-iframe-allowfullscreen"><a href="semantics.html#attr-iframe-allowfullscreen">allowfullscreen</a></code> attribute specified, or its
      <code id="navigating-across-documents:document-16"><a href="dom.html#document">Document</a></code> does not have the <a href="infrastructure.html#fullscreen-enabled-flag" id="navigating-across-documents:fullscreen-enabled-flag">fullscreen enabled flag</a> set, then also
      skip this step.</p>

      <p>Otherwise, set the <code id="navigating-across-documents:document-17"><a href="dom.html#document">Document</a></code>'s <a href="infrastructure.html#fullscreen-enabled-flag" id="navigating-across-documents:fullscreen-enabled-flag-2">fullscreen enabled flag</a>.</p>

    </li></ol>

   </li><li id="navigate-non-Document">

    <p><i>Non-document content</i>: If, given <var>type</var>, the new resource is to be
    handled by displaying some sort of inline content, e.g. a native rendering of the content, an
    error message because the specified type is not supported, or an inline prompt to allow the user
    to select <a href="webappapis.html#dom-navigator-registercontenthandler" id="navigating-across-documents:dom-navigator-registercontenthandler-2">a registered handler</a> for
    the given type, then <a href="browsers.html#read-ua-inline" id="navigating-across-documents:read-ua-inline-2">display the inline content</a>, and
    then abort these steps.</p>

    <p class="note">In the case of a registered handler being used, the algorithm will be reinvoked
    with a new URL to handle the request.</p>

   </li><li><p>Otherwise, the document's <var>type</var> is such that the resource will not
   affect the browsing context, e.g. because the resource is to be handed to an external application
   or because it is an unknown type that will be processed <a href="semantics.html#as-a-download" id="navigating-across-documents:as-a-download-2">as a download</a>. <a href="browsers.html#hand-off-to-external-software" id="navigating-across-documents:hand-off-to-external-software-2">Process the resource appropriately</a>.</p>

  </li></ol>

  <p>When a resource is handled by <dfn id="hand-off-to-external-software">passing its URL or
  data to an external software package</dfn> separate from the user agent (e.g. handing a <code id="navigating-across-documents:mailto-protocol"><a data-x-internal="mailto-protocol" href="http://tools.ietf.org/html/rfc6068#section-2">mailto:</a></code> URL to a mail client, or a Word document to a word
  processor), user agents should attempt to mitigate the risk that this is an attempt to exploit the
  target software, e.g. by prompting the user to confirm that the <a href="browsers.html#source-browsing-context" id="navigating-across-documents:source-browsing-context-7">source browsing
  context</a>'s <a href="browsers.html#active-document" id="navigating-across-documents:active-document-10">active document</a>'s <a href="browsers.html#origin-2" id="navigating-across-documents:origin-2-6">origin</a> is to be allowed to invoke the
  specified software. In particular, if the <a href="browsers.html#navigate" id="navigating-across-documents:navigate-15">navigate</a> algorithm, when it was invoked,
  was not <a href="browsers.html#allowed-to-show-a-popup" id="navigating-across-documents:allowed-to-show-a-popup">allowed to show a popup</a>, the user agent should not invoke the external
  software package without prior user confirmation.</p>

  <p class="example">For example, there could be a vulnerability in the target software's URL
  handler which a hostile page would attempt to exploit by tricking a user into clicking a link.</p>

  <hr>

  <p>Some of the sections below, to which the above algorithm defers in certain cases, require the
  user agent to <dfn id="update-the-session-history-with-the-new-page">update the session history with the new page</dfn>. When a user agent is
  required to do this, it must <a href="webappapis.html#queue-a-task" id="navigating-across-documents:queue-a-task-2">queue a task</a> (associated with the <code id="navigating-across-documents:document-18"><a href="dom.html#document">Document</a></code>
  object of the <a href="browsers.html#current-entry" id="navigating-across-documents:current-entry">current entry</a>, not the new one) to run the following steps:</p>

  <ol><li>

    

    <p><a href="browsers.html#unload-a-document" id="navigating-across-documents:unload-a-document-4">Unload</a> the <code id="navigating-across-documents:document-19"><a href="dom.html#document">Document</a></code> object of the
    <a href="browsers.html#current-entry" id="navigating-across-documents:current-entry-2">current entry</a>, with the <var>recycle</var> parameter set to false.</p>

    <p>If this instance of the <a href="browsers.html#navigate" id="navigating-across-documents:navigate-16">navigation</a> algorithm is canceled while
    this step is running the <a href="browsers.html#unload-a-document" id="navigating-across-documents:unload-a-document-5">unload a document</a> algorithm, then the <a href="browsers.html#unload-a-document" id="navigating-across-documents:unload-a-document-6">unload a
    document</a> algorithm must be allowed to run to completion, but this instance of the <a href="browsers.html#navigate" id="navigating-across-documents:navigate-17">navigation</a> algorithm must not run beyond this step. (In particular, for
    instance, the cancelation of this algorithm does not abort any event dispatch or script
    execution occurring as part of unloading the document or its descendants.)</p>

   </li><li>

    <dl><dt>If the navigation was initiated for <dfn id="entry-update">entry update</dfn> of an entry</dt><dd>

      <ol><li><p>Replace the <code id="navigating-across-documents:document-20"><a href="dom.html#document">Document</a></code> of the entry being updated, and any other entries
       that referenced the same document as that entry, with the new <code id="navigating-across-documents:document-21"><a href="dom.html#document">Document</a></code>.</p></li><li><p><a href="browsers.html#traverse-the-history" id="navigating-across-documents:traverse-the-history">Traverse the history</a> to the new entry.</p></li></ol>

      <p class="note">This can only happen if the entry being updated is not the <a href="browsers.html#current-entry" id="navigating-across-documents:current-entry-3">current
      entry</a>, and can never happen with <a href="browsers.html#replacement-enabled" id="navigating-across-documents:replacement-enabled-2">replacement enabled</a>. (It happens when the
      user tried to traverse to a session history entry that no longer had a <code id="navigating-across-documents:document-22"><a href="dom.html#document">Document</a></code>
      object.)</p>

     </dd><dt>Otherwise</dt><dd>

      <ol><li>

        <p>Remove all the entries in the <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-30">browsing context</a>'s <a href="browsers.html#session-history" id="navigating-across-documents:session-history-2">session
        history</a> after the <a href="browsers.html#current-entry" id="navigating-across-documents:current-entry-4">current entry</a>. If the <a href="browsers.html#current-entry" id="navigating-across-documents:current-entry-5">current entry</a> is
        the last entry in the session history, then no entries are removed.</p>

        <p class="note">This <a href="browsers.html#history-notes">doesn't necessarily have to affect</a> the
        user agent's user interface.</p>

       </li><li><p>Append a new entry at the end of the <code id="navigating-across-documents:history-3"><a href="browsers.html#history-3">History</a></code> object representing the new
       resource and its <code id="navigating-across-documents:document-23"><a href="dom.html#document">Document</a></code> object and related state.</p></li><li><p><a href="browsers.html#traverse-the-history" id="navigating-across-documents:traverse-the-history-2">Traverse the history</a> to the new entry. If the navigation was initiated
       with <a href="browsers.html#replacement-enabled" id="navigating-across-documents:replacement-enabled-3">replacement enabled</a>, then the traversal must itself be initiated with
       <a href="browsers.html#replacement-enabled" id="navigating-across-documents:replacement-enabled-4">replacement enabled</a>.</p>

       </li></ol>

     </dd></dl>

   </li><li><p>The <a href="browsers.html#navigate" id="navigating-across-documents:navigate-18">navigation algorithm</a> has now <dfn id="concept-navigate-mature">matured</dfn>.</p></li><li><p><i>Fragment identifier loop</i>: <a href="webappapis.html#spin-the-event-loop" id="navigating-across-documents:spin-the-event-loop">Spin the event loop</a> for a user-agent-defined
   amount of time, as desired by the user agent implementor. (This is intended to allow the user
   agent to optimise the user experience in the face of performance concerns.)</p></li><li><p>If the <code id="navigating-across-documents:document-24"><a href="dom.html#document">Document</a></code> object has no parser, or its parser has <a href="syntax.html#stop-parsing" id="navigating-across-documents:stop-parsing">stopped parsing</a>, or the user agent has reason to believe the user is no longer
   interested in scrolling to the fragment identifier, then abort these steps.</p></li><li><p><a href="browsers.html#scroll-to-the-fragment-identifier" id="navigating-across-documents:scroll-to-the-fragment-identifier">Scroll to the fragment identifier</a> given in <a id="navigating-across-documents:the-document's-address-7" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">the document's
   address</a>. If this fails to find <a href="browsers.html#the-indicated-part-of-the-document" id="navigating-across-documents:the-indicated-part-of-the-document">an
   indicated part of the document</a>, then return to the <i>fragment identifier loop</i>
   step.</p></li></ol>

  <p>The <a href="webappapis.html#task-source" id="navigating-across-documents:task-source-2">task source</a> for this <a href="webappapis.html#concept-task" id="navigating-across-documents:concept-task-5">task</a> is the
  <a href="webappapis.html#networking-task-source" id="navigating-across-documents:networking-task-source">networking task source</a>.</p></section>


  <section><h4 id="read-html">6.6.2 <dfn>Page load processing model for HTML files</dfn></h4>

  <p>When an HTML document is to be loaded in a <a href="browsers.html#browsing-context" id="read-html:browsing-context">browsing context</a>, the user agent must
  <a href="webappapis.html#queue-a-task" id="read-html:queue-a-task">queue a task</a> to create a <code id="read-html:document"><a href="dom.html#document">Document</a></code> object, mark it as being an <a href="infrastructure.html#html-documents" id="read-html:html-documents">HTML document</a>, set its <a href="infrastructure.html#concept-document-content-type" id="read-html:concept-document-content-type">content type</a> to "<code>text/html</code>",
  <a href="browsers.html#initialise-the-document-object" id="read-html:initialise-the-document-object">initialise the <code>Document</code> object</a>, and finally create an <a href="syntax.html#html-parser" id="read-html:html-parser">HTML
  parser</a> and associate it with the <code id="read-html:document-2"><a href="dom.html#document">Document</a></code>. Each <a href="webappapis.html#concept-task" id="read-html:concept-task">task</a> that the <a href="webappapis.html#networking-task-source" id="read-html:networking-task-source">networking task source</a> places on the
  <a href="webappapis.html#task-queue" id="read-html:task-queue">task queue</a> while the <a href="infrastructure.html#fetch" id="read-html:fetch">fetching algorithm</a> runs must then
  fill the parser's <a href="syntax.html#the-input-byte-stream" id="read-html:the-input-byte-stream">input byte stream</a> with the fetched bytes and cause the <a href="syntax.html#html-parser" id="read-html:html-parser-2">HTML
  parser</a> to perform the appropriate processing of the input stream.</p>

  <p class="note">The <a href="syntax.html#the-input-byte-stream" id="read-html:the-input-byte-stream-2">input byte stream</a> converts bytes into characters for use in the
  <a href="syntax.html#tokenization" id="read-html:tokenization">tokenizer</a>. This process relies, in part, on character encoding
  information found in the real <a href="infrastructure.html#content-type" id="read-html:content-type">Content-Type metadata</a> of the
  resource; the "sniffed type" is not used for this purpose.</p>

  

  <p>When no more bytes are available, the user agent must <a href="webappapis.html#queue-a-task" id="read-html:queue-a-task-2">queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code id="read-html:event-load"><a href="index.html#event-load">load</a></code> event to be fired.</p>

  <p>After creating the <code id="read-html:document-3"><a href="dom.html#document">Document</a></code> object, but before any script execution, certainly
  before the parser <a href="syntax.html#stop-parsing" id="read-html:stop-parsing">stops</a>, the user agent must <a href="browsers.html#update-the-session-history-with-the-new-page" id="read-html:update-the-session-history-with-the-new-page">update the
  session history with the new page</a>.</p>

  <p class="note"><a href="browsers.html#concept-appcache-init" id="read-html:concept-appcache-init">Application cache selection</a> happens <a href="syntax.html#parser-appcache">in the HTML parser</a>.</p>

  <p>The <a href="webappapis.html#task-source" id="read-html:task-source">task source</a> for the two tasks mentioned in this section must be the
  <a href="webappapis.html#networking-task-source" id="read-html:networking-task-source-2">networking task source</a>.</p></section>



  <section><h4 id="read-xml">6.6.3 <dfn>Page load processing model for XML files</dfn></h4>

  <p>When faced with displaying an XML file inline, user agents must follow the requirements defined
  in the XML and Namespaces in XML recommendations, RFC 7303, DOM, and other relevant specifications
  to create a <code id="read-xml:document"><a href="dom.html#document">Document</a></code> object and a corresponding <a href="the-xhtml-syntax.html#xml-parser" id="read-xml:xml-parser">XML parser</a>. <a href="references.html#refsXML">[XML]</a> <a href="references.html#refsXMLNS">[XMLNS]</a> <a href="references.html#refsRFC7303">[RFC7303]</a> <a href="references.html#refsDOM">[DOM]</a></p>

  <p class="note">At the time of writing, the XML specification community had not actually yet
  specified how XML and the DOM interact.</p> 

  <p>After the <code id="read-xml:document-2"><a href="dom.html#document">Document</a></code> is created, the user agent must <a href="browsers.html#initialise-the-document-object" id="read-xml:initialise-the-document-object">initialise the
  <code>Document</code> object</a>.</p>

  <p>The actual HTTP headers and other metadata, not the headers as mutated or implied by the
  algorithms given in this specification, are the ones that must be used when determining the
  character encoding according to the rules given in the above specifications. Once the character
  encoding is established, the <a href="infrastructure.html#document's-character-encoding" id="read-xml:document's-character-encoding">document's character encoding</a> must be set to that
  character encoding.</p>

  <p>If the root element, as parsed according to the XML specifications cited above, is found to be
  an <code id="read-xml:the-html-element"><a href="semantics.html#the-html-element">html</a></code> element with an attribute <code id="read-xml:attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code>
  whose value is not the empty string, then, as soon as the element is <a href="infrastructure.html#insert-an-element-into-a-document" id="read-xml:insert-an-element-into-a-document">inserted into the document</a>, the user agent must <a href="infrastructure.html#resolve-a-url" id="read-xml:resolve-a-url">resolve</a> the value of that attribute relative to that element, and if
  that is successful, must apply the <a href="infrastructure.html#concept-url-serialiser" id="read-xml:concept-url-serialiser">URL serialiser</a>
  algorithm to the resulting <a href="infrastructure.html#parsed-url" id="read-xml:parsed-url">parsed URL</a> with the <i>exclude fragment flag</i> set to
  obtain <var>manifest URL</var>, and then run the <a href="browsers.html#concept-appcache-init" id="read-xml:concept-appcache-init">application
  cache selection algorithm</a> with <var>manifest URL</var> as the manifest URL, passing in the
  newly-created <code id="read-xml:document-3"><a href="dom.html#document">Document</a></code>. Otherwise, if the attribute is absent, its value is the empty
  string, or resolving its value fails, then as soon as the root element is <a href="infrastructure.html#insert-an-element-into-a-document" id="read-xml:insert-an-element-into-a-document-2">inserted into the document</a>, the user agent must run the <a href="browsers.html#concept-appcache-init" id="read-xml:concept-appcache-init-2">application cache selection algorithm</a> with no manifest, and
  passing in the <code id="read-xml:document-4"><a href="dom.html#document">Document</a></code>.</p>

  <p class="note">Because the processing of the <code id="read-xml:attr-html-manifest-2"><a href="semantics.html#attr-html-manifest">manifest</a></code>
  attribute happens only once the root element is parsed, any URLs referenced by processing
  instructions before the root element (such as <code>&lt;?xml-stylesheet?&gt;</code> PIs)
  will be fetched from the network and cannot be cached.</p>

  <p>User agents may examine the namespace of the root <code id="read-xml:element"><a href="infrastructure.html#element">Element</a></code> node of this
  <code id="read-xml:document-5"><a href="dom.html#document">Document</a></code> object to perform namespace-based dispatch to alternative processing tools,
  e.g. determining that the content is actually a syndication feed and passing it to a feed handler.
  If such processing is to take place, abort the steps in this section, and jump to <a href="browsers.html#navigate-non-Document">the next step</a> (labeled <i>non-document content</i>) in the
  <a href="browsers.html#navigate" id="read-xml:navigate">navigate</a> steps above.</p>

  <p>Otherwise, then, with the newly created <code id="read-xml:document-6"><a href="dom.html#document">Document</a></code>, the user agent must <a href="browsers.html#update-the-session-history-with-the-new-page" id="read-xml:update-the-session-history-with-the-new-page">update
  the session history with the new page</a>. User agents may do this before the complete document
  has been parsed (thus achieving <i>incremental rendering</i>), and must do this before any scripts
  are to be executed.</p>

  <p>Error messages from the parse process (e.g. XML namespace well-formedness errors) may be
  reported inline by mutating the <code id="read-xml:document-7"><a href="dom.html#document">Document</a></code>.</p></section>


  <section><h4 id="read-text">6.6.4 <dfn>Page load processing model for text files</dfn></h4>

  <p>When a plain text document is to be loaded in a <a href="browsers.html#browsing-context" id="read-text:browsing-context">browsing context</a>, the user agent
  must <a href="webappapis.html#queue-a-task" id="read-text:queue-a-task">queue a task</a> to create a <code id="read-text:document"><a href="dom.html#document">Document</a></code> object, mark it as being an <a href="infrastructure.html#html-documents" id="read-text:html-documents">HTML document</a>, set its <a href="infrastructure.html#concept-document-content-type" id="read-text:concept-document-content-type">content type</a> to "<code>text/plain</code>",
  <a href="browsers.html#initialise-the-document-object" id="read-text:initialise-the-document-object">initialise the <code>Document</code> object</a>, create an <a href="syntax.html#html-parser" id="read-text:html-parser">HTML parser</a>,
  associate it with the <code id="read-text:document-2"><a href="dom.html#document">Document</a></code>, act as if the tokenizer had emitted a start tag token
  with the tag name "pre" followed by a single U+000A LINE FEED (LF) character, and switch the <a href="syntax.html#html-parser" id="read-text:html-parser-2">HTML
  parser</a>'s tokenizer to the <a href="syntax.html#plaintext-state" id="read-text:plaintext-state">PLAINTEXT state</a>. Each <a href="webappapis.html#concept-task" id="read-text:concept-task">task</a> that the <a href="webappapis.html#networking-task-source" id="read-text:networking-task-source">networking task source</a> places on the
  <a href="webappapis.html#task-queue" id="read-text:task-queue">task queue</a> while the <a href="infrastructure.html#fetch" id="read-text:fetch">fetching algorithm</a> runs must then
  fill the parser's <a href="syntax.html#the-input-byte-stream" id="read-text:the-input-byte-stream">input byte stream</a> with the fetched bytes and cause the <a href="syntax.html#html-parser" id="read-text:html-parser-3">HTML
  parser</a> to perform the appropriate processing of the input stream.</p>

  <p>The rules for how to convert the bytes of the plain text document into actual characters, and
  the rules for actually rendering the text to the user, are defined in RFC 2046, RFC 3676, and
  subsequent versions thereof. <a href="references.html#refsRFC2046">[RFC2046]</a> <a href="references.html#refsRFC3676">[RFC3676]</a></p>

  <p>The <a href="infrastructure.html#document's-character-encoding" id="read-text:document's-character-encoding">document's character encoding</a> must be set to the character encoding used to
  decode the document.</p>

  <p>Upon creation of the <code id="read-text:document-3"><a href="dom.html#document">Document</a></code> object, the user agent must run the <a href="browsers.html#concept-appcache-init" id="read-text:concept-appcache-init">application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id="read-text:document-4"><a href="dom.html#document">Document</a></code>.</p>

  

  <p>When no more bytes are available, the user agent must <a href="webappapis.html#queue-a-task" id="read-text:queue-a-task-2">queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code id="read-text:event-load"><a href="index.html#event-load">load</a></code> event to be fired.</p>

  <p>After creating the <code id="read-text:document-5"><a href="dom.html#document">Document</a></code> object, but potentially before the page has finished
  parsing, the user agent must <a href="browsers.html#update-the-session-history-with-the-new-page" id="read-text:update-the-session-history-with-the-new-page">update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id="read-text:the-head-element"><a href="semantics.html#the-head-element">head</a></code> element of the <code id="read-text:document-6"><a href="dom.html#document">Document</a></code>, e.g.
  linking to a style sheet or a binding, providing script, giving the document a
  <code id="read-text:the-title-element"><a href="semantics.html#the-title-element">title</a></code>, etc.</p>

  <p class="note">In particular, if the user agent supports the <code>Format=Flowed</code>
  feature of RFC 3676 then the user agent would need to apply extra styling to cause the text to
  wrap correctly and to handle the quoting feature. This could be performed using, e.g., a
  binding or a CSS extension.</p>

  <p>The <a href="webappapis.html#task-source" id="read-text:task-source">task source</a> for the two tasks mentioned in this section must be the
  <a href="webappapis.html#networking-task-source" id="read-text:networking-task-source-2">networking task source</a>.</p></section>


  <section><h4 id="read-multipart-x-mixed-replace">6.6.5 <dfn>Page load processing model for <code>multipart/x-mixed-replace</code> resources</dfn></h4>

  <p>When a resource with the type <code id="read-multipart-x-mixed-replace:multipart/x-mixed-replace"><a href="iana.html#multipart/x-mixed-replace">multipart/x-mixed-replace</a></code> is to be loaded in a
  <a href="browsers.html#browsing-context" id="read-multipart-x-mixed-replace:browsing-context">browsing context</a>, the user agent must parse the resource using the rules for
  multipart types. <a href="references.html#refsRFC2046">[RFC2046]</a></p>

  <p>For each body part obtained from the resource, the user agent must run a new instance of the
  <a href="browsers.html#navigate" id="read-multipart-x-mixed-replace:navigate">navigate</a> algorithm, starting from the <i>resource handling</i> step, using the new
  body part as the resource being navigated, with <a href="browsers.html#replacement-enabled" id="read-multipart-x-mixed-replace:replacement-enabled">replacement enabled</a> if a previous
  body part from the same resource resulted in a <code id="read-multipart-x-mixed-replace:document"><a href="dom.html#document">Document</a></code> object being created and
  <a href="browsers.html#initialise-the-document-object" id="read-multipart-x-mixed-replace:initialise-the-document-object">initialised</a>, and otherwise using the same
  setup as the <a href="browsers.html#navigate" id="read-multipart-x-mixed-replace:navigate-2">navigate</a> attempt that caused this section to be invoked in the first
  place.</p>

  <p>For the purposes of algorithms processing these body parts as if they were complete stand-alone
  resources, the user agent must act as if there were no more bytes for those resources whenever the
  boundary following the body part is reached.</p>

  <p class="note">Thus, <code id="read-multipart-x-mixed-replace:event-load"><a href="index.html#event-load">load</a></code> events (and for that matter <code id="read-multipart-x-mixed-replace:event-unload"><a href="index.html#event-unload">unload</a></code> events) do fire for each body part loaded.</p></section>


  <section><h4 id="read-media">6.6.6 <dfn>Page load processing model for media</dfn></h4>

  <p>When an image, video, or audio resource is to be loaded in a <a href="browsers.html#browsing-context" id="read-media:browsing-context">browsing context</a>, the
  user agent should create a <code id="read-media:document"><a href="dom.html#document">Document</a></code> object, mark it as being an <a href="infrastructure.html#html-documents" id="read-media:html-documents">HTML document</a>, set its <a href="infrastructure.html#concept-document-content-type" id="read-media:concept-document-content-type">content
  type</a> to the sniffed MIME type of the resource (<var>type</var> in the
  <a href="browsers.html#navigate" id="read-media:navigate">navigate</a> algorithm), <a href="browsers.html#initialise-the-document-object" id="read-media:initialise-the-document-object">initialise the <code>Document</code> object</a>, append
  an <code id="read-media:the-html-element"><a href="semantics.html#the-html-element">html</a></code> element to the <code id="read-media:document-2"><a href="dom.html#document">Document</a></code>, append a <code id="read-media:the-head-element"><a href="semantics.html#the-head-element">head</a></code> element and
  a <code id="read-media:the-body-element"><a href="semantics.html#the-body-element">body</a></code> element to the <code id="read-media:the-html-element-2"><a href="semantics.html#the-html-element">html</a></code> element, append an element <var>host element</var> for the media, as described below, to the <code id="read-media:the-body-element-2"><a href="semantics.html#the-body-element">body</a></code> element,
  and set the appropriate attribute of the element <var>host element</var>, as described
  below, to the address of the image, video, or audio resource.</p>

  <p>The element <var>host element</var> to create for the media is the element given in
  the table below in the second cell of the row whose first cell describes the media. The
  appropriate attribute to set is the one given by the third cell in that same row.</p>

  <table><thead><tr><th> Type of media
         </th><th> Element for the media
         </th><th> Appropriate attribute
    </th></tr><tr><td> Image
         </td><td> <code id="read-media:the-img-element"><a href="semantics.html#the-img-element">img</a></code>
         </td><td> <code id="read-media:attr-img-src"><a href="semantics.html#attr-img-src">src</a></code>
    </td></tr><tr><td> Video
         </td><td> <code id="read-media:the-video-element"><a href="semantics.html#the-video-element">video</a></code>
         </td><td> <code id="read-media:attr-media-src"><a href="semantics.html#attr-media-src">src</a></code>
    </td></tr><tr><td> Audio
         </td><td> <code id="read-media:the-audio-element"><a href="semantics.html#the-audio-element">audio</a></code>
         </td><td> <code id="read-media:attr-media-src-2"><a href="semantics.html#attr-media-src">src</a></code>
  </td></tr></thead></table>

  

  <p>Then, the user agent must act as if it had <a href="syntax.html#stop-parsing" id="read-media:stop-parsing">stopped
  parsing</a>.</p>

  <p>Upon creation of the <code id="read-media:document-3"><a href="dom.html#document">Document</a></code> object, the user agent must run the <a href="browsers.html#concept-appcache-init" id="read-media:concept-appcache-init">application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id="read-media:document-4"><a href="dom.html#document">Document</a></code>.</p>

  <p>After creating the <code id="read-media:document-5"><a href="dom.html#document">Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href="browsers.html#update-the-session-history-with-the-new-page" id="read-media:update-the-session-history-with-the-new-page">update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id="read-media:the-head-element-2"><a href="semantics.html#the-head-element">head</a></code> element of the <code id="read-media:document-6"><a href="dom.html#document">Document</a></code>, or
  attributes to the element <var>host element</var>, e.g. to link to a style sheet or a
  binding, to provide a script, to give the document a <code id="read-media:the-title-element"><a href="semantics.html#the-title-element">title</a></code>, to make the media
  <a href="semantics.html#attr-media-autoplay" id="read-media:attr-media-autoplay">autoplay</a>, etc.</p></section>


  <section><h4 id="read-plugin">6.6.7 <dfn>Page load processing model for content that uses plugins</dfn></h4>

  <p>When a resource that requires an external resource to be rendered is to be loaded in a
  <a href="browsers.html#browsing-context" id="read-plugin:browsing-context">browsing context</a>, the user agent should create a <code id="read-plugin:document"><a href="dom.html#document">Document</a></code> object, mark
  it as being an <a href="infrastructure.html#html-documents" id="read-plugin:html-documents">HTML document</a> and mark it as being a
  <dfn id="plugin-document">plugin document</dfn>, set its <a href="infrastructure.html#concept-document-content-type" id="read-plugin:concept-document-content-type">content
  type</a> to the sniffed MIME type of the resource (<var>type</var> in the
  <a href="browsers.html#navigate" id="read-plugin:navigate">navigate</a> algorithm), <a href="browsers.html#initialise-the-document-object" id="read-plugin:initialise-the-document-object">initialise the <code>Document</code> object</a>, append
  an <code id="read-plugin:the-html-element"><a href="semantics.html#the-html-element">html</a></code> element to the <code id="read-plugin:document-2"><a href="dom.html#document">Document</a></code>, append a <code id="read-plugin:the-head-element"><a href="semantics.html#the-head-element">head</a></code> element and
  a <code id="read-plugin:the-body-element"><a href="semantics.html#the-body-element">body</a></code> element to the <code id="read-plugin:the-html-element-2"><a href="semantics.html#the-html-element">html</a></code> element, append an <code id="read-plugin:the-embed-element"><a href="semantics.html#the-embed-element">embed</a></code> to the
  <code id="read-plugin:the-body-element-2"><a href="semantics.html#the-body-element">body</a></code> element, and set the <code id="read-plugin:attr-embed-src"><a href="semantics.html#attr-embed-src">src</a></code> attribute of the
  <code id="read-plugin:the-embed-element-2"><a href="semantics.html#the-embed-element">embed</a></code> element to the address of the resource.</p>

  <p class="note">The term <a href="browsers.html#plugin-document" id="read-plugin:plugin-document">plugin document</a> is used by the Content Security Policy
  specification as part of the mechanism that ensures <code id="read-plugin:the-iframe-element"><a href="semantics.html#the-iframe-element">iframe</a></code>s can't be used to evade
  <code>plugin-types</code> directives. <a href="references.html#refsCSP">[CSP]</a></p>

  

  <p>Then, the user agent must act as if it had <a href="syntax.html#stop-parsing" id="read-plugin:stop-parsing">stopped
  parsing</a>.</p>

  <p>Upon creation of the <code id="read-plugin:document-3"><a href="dom.html#document">Document</a></code> object, the user agent must run the <a href="browsers.html#concept-appcache-init" id="read-plugin:concept-appcache-init">application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code id="read-plugin:document-4"><a href="dom.html#document">Document</a></code>.</p>

  <p>After creating the <code id="read-plugin:document-5"><a href="dom.html#document">Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href="browsers.html#update-the-session-history-with-the-new-page" id="read-plugin:update-the-session-history-with-the-new-page">update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code id="read-plugin:the-head-element-2"><a href="semantics.html#the-head-element">head</a></code> element of the <code id="read-plugin:document-6"><a href="dom.html#document">Document</a></code>, or
  attributes to the <code id="read-plugin:the-embed-element-3"><a href="semantics.html#the-embed-element">embed</a></code> element, e.g. to link to a style sheet or a binding, or
  to give the document a <code id="read-plugin:the-title-element"><a href="semantics.html#the-title-element">title</a></code>.</p>

  <p id="sandboxPluginNavigate" class="note">If the <code id="read-plugin:document-7"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#active-sandboxing-flag-set" id="read-plugin:active-sandboxing-flag-set">active sandboxing
  flag set</a> has its <a href="browsers.html#sandboxed-plugins-browsing-context-flag" id="read-plugin:sandboxed-plugins-browsing-context-flag">sandboxed plugins browsing context flag</a> set, the synthesized
  <code id="read-plugin:the-embed-element-4"><a href="semantics.html#the-embed-element">embed</a></code> element will <a href="semantics.html#sandboxPluginEmbed">fail to render the content</a> if
  the relevant <a href="infrastructure.html#plugin" id="read-plugin:plugin">plugin</a> cannot be <a href="infrastructure.html#concept-plugin-secure" id="read-plugin:concept-plugin-secure">secured</a>.</p></section>


  <section><h4 id="read-ua-inline">6.6.8 <dfn>Page load processing model for inline
  content that doesn't have a DOM</dfn></h4>

  <p>When the user agent is to display a user agent page inline in a <a href="browsers.html#browsing-context" id="read-ua-inline:browsing-context">browsing context</a>,
  the user agent should create a <code id="read-ua-inline:document"><a href="dom.html#document">Document</a></code> object, mark it as being an <a href="infrastructure.html#html-documents" id="read-ua-inline:html-documents">HTML document</a>, set its <a href="infrastructure.html#concept-document-content-type" id="read-ua-inline:concept-document-content-type">content type</a> to "<code>text/html</code>",
  <a href="browsers.html#initialise-the-document-object" id="read-ua-inline:initialise-the-document-object">initialise the <code>Document</code> object</a>, and then either associate that
  <code id="read-ua-inline:document-2"><a href="dom.html#document">Document</a></code> with a custom rendering that is not rendered using the normal
  <code id="read-ua-inline:document-3"><a href="dom.html#document">Document</a></code> rendering rules, or mutate that <code id="read-ua-inline:document-4"><a href="dom.html#document">Document</a></code> until it represents
  the content the user agent wants to render.</p>

  

  <p>Once the page has been set up, the user agent must act as if it had <a href="syntax.html#stop-parsing" id="read-ua-inline:stop-parsing">stopped parsing</a>.</p>

  <p>Upon creation of the <code id="read-ua-inline:document-5"><a href="dom.html#document">Document</a></code> object, the user agent must run the <a href="browsers.html#concept-appcache-init" id="read-ua-inline:concept-appcache-init">application cache selection algorithm</a> with no manifest,
  passing in the newly-created <code id="read-ua-inline:document-6"><a href="dom.html#document">Document</a></code>.</p>

  <p>After creating the <code id="read-ua-inline:document-7"><a href="dom.html#document">Document</a></code> object, but potentially before the page has been
  completely set up, the user agent must <a href="browsers.html#update-the-session-history-with-the-new-page" id="read-ua-inline:update-the-session-history-with-the-new-page">update the session history with the new
  page</a>.</p></section>



  <section><h4 id="scroll-to-fragid">6.6.9 <dfn>Navigating to a fragment identifier</dfn></h4>

  <p>When a user agent is supposed to navigate to a fragment identifier, then the user agent must
  run the following steps:</p>

  <ol><li>

    <p>Remove all the entries in the <a href="browsers.html#browsing-context" id="scroll-to-fragid:browsing-context">browsing context</a>'s <a href="browsers.html#session-history" id="scroll-to-fragid:session-history">session history</a>
    after the <a href="browsers.html#current-entry" id="scroll-to-fragid:current-entry">current entry</a>. If the <a href="browsers.html#current-entry" id="scroll-to-fragid:current-entry-2">current entry</a> is the last entry in the
    session history, then no entries are removed.</p>

    <p class="note">This <a href="browsers.html#history-notes">doesn't necessarily have to affect</a> the user
    agent's user interface.</p>

   </li><li><p>Remove any <a href="webappapis.html#concept-task" id="scroll-to-fragid:concept-task">tasks</a> queued by the <a href="webappapis.html#history-traversal-task-source" id="scroll-to-fragid:history-traversal-task-source">history traversal
   task source</a> that are associated with any <code id="scroll-to-fragid:document"><a href="dom.html#document">Document</a></code> objects in the
   <a href="browsers.html#top-level-browsing-context" id="scroll-to-fragid:top-level-browsing-context">top-level browsing context</a>'s <a href="browsers.html#document-family" id="scroll-to-fragid:document-family">document family</a>.</p></li><li><p>Append a new entry at the end of the <code id="scroll-to-fragid:history-3"><a href="browsers.html#history-3">History</a></code> object representing the new
   resource and its <code id="scroll-to-fragid:document-2"><a href="dom.html#document">Document</a></code> object and related state. Its <a href="infrastructure.html#url" id="scroll-to-fragid:url">URL</a> must be set
   to the address to which the user agent was <a href="browsers.html#navigate" id="scroll-to-fragid:navigate">navigating</a>. The title
   must be left unset.</p></li><li><p><a href="browsers.html#traverse-the-history" id="scroll-to-fragid:traverse-the-history">Traverse the history</a> to the new entry, with the <i>non-blocking events</i> flag
   set. This will <a href="browsers.html#scroll-to-the-fragment-identifier" id="scroll-to-fragid:scroll-to-the-fragment-identifier">scroll to the fragment
   identifier</a> given in what is now <a id="scroll-to-fragid:the-document's-address" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">the document's address</a>.</p></li></ol>

  <p class="note">If the scrolling fails because the relevant <a href="infrastructure.html#concept-id" id="scroll-to-fragid:concept-id">ID</a> has
  not yet been parsed, then the original <a href="browsers.html#navigate" id="scroll-to-fragid:navigate-2">navigation</a> algorithm will
  take care of the scrolling instead, as the last few steps of its <a href="browsers.html#update-the-session-history-with-the-new-page" id="scroll-to-fragid:update-the-session-history-with-the-new-page">update the session history
  with the new page</a> algorithm.</p>

  <hr>

  <p>When the user agent is required to <dfn id="scroll-to-the-fragment-identifier">scroll to the fragment identifier</dfn> and <a href="browsers.html#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document">the
  indicated part of the document</a>, if any, is <a href="rendering.html#being-rendered" id="scroll-to-fragid:being-rendered">being rendered</a>, the user agent must
  either change the scrolling position of the document using the following algorithm, or perform
  some other action such that <a href="browsers.html#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-2">the indicated part of the document</a> is brought to the
  user's attention. If there is no indicated part, or if the indicated part is not <a href="rendering.html#being-rendered" id="scroll-to-fragid:being-rendered-2">being
  rendered</a>, then the user agent must do nothing. The aforementioned algorithm is as
  follows:</p>

  <ol><li><p>Let <var>target</var> be <a href="browsers.html#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-3">the indicated part of the
   document</a>, as defined below.</p></li><li><p>If <var>target</var> is the top of the document, then <a href="infrastructure.html#scroll-to-the-beginning-of-the-document" id="scroll-to-fragid:scroll-to-the-beginning-of-the-document">scroll to the
   beginning of the document</a> for the <code id="scroll-to-fragid:document-3"><a href="dom.html#document">Document</a></code>, and abort these steps. <a href="references.html#refsCSSOMVIEW">[CSSOMVIEW]</a></p></li><li><p>Use the <a href="infrastructure.html#scroll-an-element-into-view" id="scroll-to-fragid:scroll-an-element-into-view">scroll an element into view</a> algorithm to scroll <var>target</var> into view, with the <var>align to top flag</var> set. <a href="references.html#refsCSSOMVIEW">[CSSOMVIEW]</a></p></li><li><p>Run the <a href="editing.html#focusing-steps" id="scroll-to-fragid:focusing-steps">focusing steps</a> for that element, with the <code id="scroll-to-fragid:document-4"><a href="dom.html#document">Document</a></code>'s
   viewport as the <i>fallback target</i>.</p></li><li><p>Optionally, move the <a href="editing.html#sequential-focus-navigation-starting-point" id="scroll-to-fragid:sequential-focus-navigation-starting-point">sequential focus navigation starting point</a> to
   <var>target</var>.</p>

  </li></ol>

  <p><dfn id="the-indicated-part-of-the-document">The indicated part of the document</dfn> is the one that the fragment identifier, if any,
  identifies. The semantics of the fragment identifier in terms of mapping it to a specific DOM Node
  is defined by the specification that defines the <a href="infrastructure.html#mime-type" id="scroll-to-fragid:mime-type">MIME type</a> used by the
  <code id="scroll-to-fragid:document-5"><a href="dom.html#document">Document</a></code> (for example, the processing of fragment identifiers for <a href="infrastructure.html#xml-mime-type" id="scroll-to-fragid:xml-mime-type">XML MIME types</a> is the responsibility of RFC7303). <a href="references.html#refsRFC7303">[RFC7303]</a></p>

  <p>For HTML documents (and <a href="infrastructure.html#html-mime-type" id="scroll-to-fragid:html-mime-type">HTML MIME types</a>), the following
  processing model must be followed to determine what <a href="browsers.html#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-4">the indicated part of the
  document</a> is.</p>

  <ol><li><p>Apply the <a href="infrastructure.html#url-parser" id="scroll-to-fragid:url-parser">URL parser</a> algorithm to the <a href="infrastructure.html#url" id="scroll-to-fragid:url-2">URL</a>, and let <var>fragid</var> be the <a href="infrastructure.html#concept-url-fragment" id="scroll-to-fragid:concept-url-fragment">fragment</a> component of the
   resulting <a href="infrastructure.html#parsed-url" id="scroll-to-fragid:parsed-url">parsed URL</a>.</p></li><li><p>If <var>fragid</var> is the empty string, then <a href="browsers.html#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-5">the indicated part of the
   document</a> is the top of the document; stop the algorithm here.</p></li><li><p>Let <var>fragid bytes</var> be the result of <a href="infrastructure.html#percent-decode" id="scroll-to-fragid:percent-decode">percent-decoding</a> <var>fragid</var>.</p></li><li><p>Let <var>decoded fragid</var> be the result of applying the <a href="infrastructure.html#utf-8-decoder" id="scroll-to-fragid:utf-8-decoder">UTF-8
   decoder</a> algorithm to <var>fragid bytes</var>. If the <a href="infrastructure.html#utf-8-decoder" id="scroll-to-fragid:utf-8-decoder-2">UTF-8 decoder</a>
   emits a <a href="infrastructure.html#decoder-error" id="scroll-to-fragid:decoder-error">decoder error</a>, abort the decoder and instead jump to the step labeled <i>no
   decoded fragid</i>.</p></li><li><p>If there is an element in the DOM that has an <a href="infrastructure.html#concept-id" id="scroll-to-fragid:concept-id-2">ID</a> exactly
   equal to <var>decoded fragid</var>, then the first such element in <a href="infrastructure.html#tree-order" id="scroll-to-fragid:tree-order">tree order</a> is
   <a href="browsers.html#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-6">the indicated part of the document</a>; stop the algorithm here.</p></li><li><p><i>No decoded fragid</i>: If there is an <code id="scroll-to-fragid:the-a-element"><a href="semantics.html#the-a-element">a</a></code> element in the DOM that has a <code id="scroll-to-fragid:attr-a-name"><a href="obsolete.html#attr-a-name">name</a></code> attribute whose value is exactly equal to <var>fragid</var> (<em>not</em> <var>decoded fragid</var>), then the first such
   element in <a href="infrastructure.html#tree-order" id="scroll-to-fragid:tree-order-2">tree order</a> is <a href="browsers.html#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-7">the indicated part of the document</a>; stop the algorithm
   here.</p></li><li><p>If <var>fragid</var> is an <a href="infrastructure.html#ascii-case-insensitive" id="scroll-to-fragid:ascii-case-insensitive">ASCII case-insensitive</a> match for the
   string <code>top</code>, then <a href="browsers.html#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-8">the indicated part of the document</a> is the top
   of the document; stop the algorithm here.</p></li><li><p>Otherwise, there is no <a href="browsers.html#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-9">indicated part of
   the document</a>.</p></li></ol>

  <p>For the purposes of the interaction of HTML with Selectors' <dfn id="selector-target"><code>:target</code></dfn> pseudo-class, the <dfn id="target-element"><i>target element</i></dfn>
  is <a href="browsers.html#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-10">the indicated part of the document</a>, if that is an element; otherwise there is no
  <i id="scroll-to-fragid:target-element"><a href="browsers.html#target-element">target element</a></i>. <a href="references.html#refsSELECTORS">[SELECTORS]</a></p>

  <p>The <a href="webappapis.html#task-source" id="scroll-to-fragid:task-source">task source</a> for the task mentioned in this section must be the <a href="webappapis.html#dom-manipulation-task-source" id="scroll-to-fragid:dom-manipulation-task-source">DOM
  manipulation task source</a>.</p></section>

  



  <section><h4 id="history-traversal">6.6.10 History traversal</h4> 

  

  <p>When a user agent is required to <dfn id="traverse-the-history">traverse the history</dfn> to a <var>specified
  entry</var>, optionally with <a href="browsers.html#replacement-enabled" id="history-traversal:replacement-enabled">replacement enabled</a>, and optionally with the
  <i>non-blocking events</i> flag set, the user agent must act as follows.</p>

  <p class="note">This algorithm is not just invoked when <a href="browsers.html#traverse-the-history-by-a-delta" id="history-traversal:traverse-the-history-by-a-delta">explicitly going back or forwards in the session history</a> — it is also invoked
  in other situations, for example when <a href="browsers.html#navigate" id="history-traversal:navigate">navigating a browsing context</a>,
  as part of <a href="browsers.html#update-the-session-history-with-the-new-page" id="history-traversal:update-the-session-history-with-the-new-page">updating the session history
  with the new page</a>.</p>

  <ol><li>

    <p>If there is no longer a <code id="history-traversal:document"><a href="dom.html#document">Document</a></code> object for the entry in question,
    <a href="browsers.html#navigate" id="history-traversal:navigate-2">navigate</a> the <a href="browsers.html#browsing-context" id="history-traversal:browsing-context">browsing
    context</a> to the resource for that entry to perform an <a href="browsers.html#entry-update" id="history-traversal:entry-update">entry update</a> of that
    entry, and abort these steps. The "<a href="browsers.html#navigate" id="history-traversal:navigate-3">navigate</a>" algorithm reinvokes this "traverse"
    algorithm to complete the traversal, at which point there <em>is</em> a <code id="history-traversal:document-2"><a href="dom.html#document">Document</a></code>
    object and so this step gets skipped. The navigation must be done using the same <a href="browsers.html#source-browsing-context" id="history-traversal:source-browsing-context">source
    browsing context</a> as was used the first time this entry was created. (This can never
    happen with <a href="browsers.html#replacement-enabled" id="history-traversal:replacement-enabled-2">replacement enabled</a>.)</p>

    <p class="note">If the resource was obtained usign a non-idempotent action, for example a POST
    form submission, or if the resource is no longer available, for example because the computer is
    now offline and the page wasn't cached, navigating to it again might not be possible. In this
    case, the navigation will result in a different page than previously; for example, it might be
    an error message explaining the problem or offering to resubmit the form.</p>

   </li><li><p>If the <a href="browsers.html#current-entry" id="history-traversal:current-entry">current entry</a>'s title was not set by the <code id="history-traversal:dom-history-pushstate"><a href="browsers.html#dom-history-pushstate">pushState()</a></code> or <code id="history-traversal:dom-history-replacestate"><a href="browsers.html#dom-history-replacestate">replaceState()</a></code> methods, then set its title to the value
   returned by the <code id="history-traversal:document.title"><a href="dom.html#document.title">document.title</a></code> IDL attribute.</p></li><li><p>If appropriate, update the <a href="browsers.html#current-entry" id="history-traversal:current-entry-2">current entry</a> in the <a href="browsers.html#browsing-context" id="history-traversal:browsing-context-2">browsing
   context</a>'s <code id="history-traversal:document-3"><a href="dom.html#document">Document</a></code> object's <code id="history-traversal:history-3"><a href="browsers.html#history-3">History</a></code> object to reflect any state
   that the user agent wishes to persist. The entry is then said to be <a href="browsers.html#an-entry-with-persisted-user-state" id="history-traversal:an-entry-with-persisted-user-state">an entry with persisted
   user state</a>.</p></li><li><p>If the <var>specified entry</var> has a different <code id="history-traversal:document-4"><a href="dom.html#document">Document</a></code> object
   than the <a href="browsers.html#current-entry" id="history-traversal:current-entry-3">current entry</a>, then run the following substeps:</p>

    <ol><li><p>Remove any <a href="webappapis.html#concept-task" id="history-traversal:concept-task">tasks</a> queued by the <a href="webappapis.html#history-traversal-task-source" id="history-traversal:history-traversal-task-source">history traversal
     task source</a> that are associated with any <code id="history-traversal:document-5"><a href="dom.html#document">Document</a></code> objects in the
     <a href="browsers.html#top-level-browsing-context" id="history-traversal:top-level-browsing-context">top-level browsing context</a>'s <a href="browsers.html#document-family" id="history-traversal:document-family">document family</a>.</p></li><li>

      <p>If the <a href="browsers.html#origin-2" id="history-traversal:origin-2">origin</a> of the <code id="history-traversal:document-6"><a href="dom.html#document">Document</a></code> of the <var>specified
      entry</var> is not the <a href="browsers.html#same-origin" id="history-traversal:same-origin">same</a> as the <a href="browsers.html#origin-2" id="history-traversal:origin-2-2">origin</a> of the
      <code id="history-traversal:document-7"><a href="dom.html#document">Document</a></code> of the <a href="browsers.html#current-entry" id="history-traversal:current-entry-4">current entry</a>, then run the following
      sub-sub-steps:</p>

      <ol><li><p>The current <a href="browsers.html#browsing-context-name" id="history-traversal:browsing-context-name">browsing context name</a> must be stored with all the entries in
       the history that are associated with <code id="history-traversal:document-8"><a href="dom.html#document">Document</a></code> objects with the <a href="browsers.html#same-origin" id="history-traversal:same-origin-2">same
       origin</a> as the <a href="browsers.html#active-document" id="history-traversal:active-document">active document</a> <em>and</em> that are contiguous with the
       <a href="browsers.html#current-entry" id="history-traversal:current-entry-5">current entry</a>.</p></li><li id="resetBCName"><p>If the browsing context is a <a href="browsers.html#top-level-browsing-context" id="history-traversal:top-level-browsing-context-2">top-level browsing context</a>,
       but not an <a href="browsers.html#auxiliary-browsing-context" id="history-traversal:auxiliary-browsing-context">auxiliary browsing context</a>, then the browsing context's
       <a href="browsers.html#browsing-context-name" id="history-traversal:browsing-context-name-2">browsing context name</a> must be unset.</p></li></ol>

     </li><li id="appcache-history-2"><p>Make the <var>specified entry</var>'s
     <code id="history-traversal:document-9"><a href="dom.html#document">Document</a></code> object the <a href="browsers.html#active-document" id="history-traversal:active-document-2">active document</a> of the <a href="browsers.html#browsing-context" id="history-traversal:browsing-context-3">browsing
     context</a>.</p></li><li>

      <p>If the <var>specified entry</var> has a <a href="browsers.html#browsing-context-name" id="history-traversal:browsing-context-name-3">browsing context name</a> stored
      with it, then run the following sub-sub-steps:</p>

      <ol><li><p>Set the browsing context's <a href="browsers.html#browsing-context-name" id="history-traversal:browsing-context-name-4">browsing context name</a> to the name stored with
       the specified entry.</p></li><li><p>Clear any <a href="browsers.html#browsing-context-name" id="history-traversal:browsing-context-name-5">browsing context names</a> stored
       with all entries in the history that are associated with <code id="history-traversal:document-10"><a href="dom.html#document">Document</a></code> objects with
       the <a href="browsers.html#same-origin" id="history-traversal:same-origin-3">same origin</a> as the new <a href="browsers.html#active-document" id="history-traversal:active-document-3">active document</a> and that are contiguous
       with the specified entry.</p></li></ol>

     </li><li id="history-autocomplete"><p>If the <var>specified entry</var>'s
     <code id="history-traversal:document-11"><a href="dom.html#document">Document</a></code> has any form controls whose <a href="semantics.html#autofill-field-name" id="history-traversal:autofill-field-name">autofill field name</a> is "<code id="history-traversal:attr-fe-autocomplete-off"><a href="semantics.html#attr-fe-autocomplete-off">off</a></code>", invoke the <a href="semantics.html#concept-form-reset-control" id="history-traversal:concept-form-reset-control">reset algorithm</a> of each of those elements.</p></li><li>

      <p>If the <a href="dom.html#current-document-readiness" id="history-traversal:current-document-readiness">current document readiness</a> of the <var>specified entry</var>'s
      <code id="history-traversal:document-12"><a href="dom.html#document">Document</a></code> is "<code>complete</code>", <a href="webappapis.html#queue-a-task" id="history-traversal:queue-a-task">queue a task</a> to run
      the following sub-sub-steps:</p>

      <ol><li><p>If the <code id="history-traversal:document-13"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#page-showing" id="history-traversal:page-showing">page showing</a> flag is true, then abort this
       task (i.e. don't fire the event below).</p></li><li><p>Set the <code id="history-traversal:document-14"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#page-showing" id="history-traversal:page-showing-2">page showing</a> flag to true.</p></li><li>

        <p>Run any <dfn id="session-history-document-visibility-change-steps">session history document visibility change steps</dfn> for <code id="history-traversal:document-15"><a href="dom.html#document">Document</a></code> that
        are defined by <a href="infrastructure.html#other-applicable-specifications" id="history-traversal:other-applicable-specifications">other applicable specifications</a>.</p>

        <p class="note">This is specifically intended for use by the Page Visibility specification. <a href="references.html#refsPAGEVIS">[PAGEVIS]</a></p>

       </li><li><p><a href="infrastructure.html#concept-event-fire" id="history-traversal:concept-event-fire">Fire</a> a <a href="infrastructure.html#concept-events-trusted" id="history-traversal:concept-events-trusted">trusted</a> event with the name <code id="history-traversal:event-pageshow"><a href="index.html#event-pageshow">pageshow</a></code> at the <code id="history-traversal:window"><a href="browsers.html#window">Window</a></code> object of that
       <code id="history-traversal:document-16"><a href="dom.html#document">Document</a></code>, with <i id="history-traversal:concept-event-target-override"><a href="infrastructure.html#concept-event-target-override">target override</a></i> set to the <code id="history-traversal:document-17"><a href="dom.html#document">Document</a></code>
       object,
       using the <code id="history-traversal:pagetransitionevent"><a href="browsers.html#pagetransitionevent">PageTransitionEvent</a></code> interface, with the <code id="history-traversal:dom-pagetransitionevent-persisted"><a href="browsers.html#dom-pagetransitionevent-persisted">persisted</a></code> attribute initialised to true.
       This event must not bubble, must not be cancelable, and has no default action.</p></li></ol>

      

     </li></ol>

   </li><li><p>Set <a id="history-traversal:the-document's-address" href="https://dom.spec.whatwg.org/#concept-document-url" data-x-internal="the-document's-address">the document's address</a> to the URL of the <var>specified
   entry</var>.</p></li><li><p>If the <var>specified entry</var> has a URL whose fragment identifier differs
   from that of the <a href="browsers.html#current-entry" id="history-traversal:current-entry-6">current entry</a>'s when compared in a <a href="infrastructure.html#case-sensitive" id="history-traversal:case-sensitive">case-sensitive</a>
   manner, and the two share the same <code id="history-traversal:document-18"><a href="dom.html#document">Document</a></code> object, then let <var>hash
   changed</var> be true, and let <var>old URL</var> be the URL of the <a href="browsers.html#current-entry" id="history-traversal:current-entry-7">current
   entry</a> and <var>new URL</var> be the URL of the <var>specified
   entry</var>. Otherwise, let <var>hash changed</var> be false.</p></li><li><p>If the traversal was initiated with <dfn id="replacement-enabled">replacement enabled</dfn>, remove the entry
   immediately before the <var>specified entry</var> in the session history.</p>

   </li><li><p>If the <var>specified entry</var> is not <a href="browsers.html#an-entry-with-persisted-user-state" id="history-traversal:an-entry-with-persisted-user-state-2">an entry with persisted user
   state</a>, but its URL has a fragment identifier, <a href="browsers.html#scroll-to-the-fragment-identifier" id="history-traversal:scroll-to-the-fragment-identifier">scroll to the fragment
   identifier</a>.</p></li><li>

    <p>If the entry is <a href="browsers.html#an-entry-with-persisted-user-state" id="history-traversal:an-entry-with-persisted-user-state-3">an entry with persisted user state</a>, the user agent may update
    aspects of the document and its rendering, for instance the scroll position or values of form
    fields, that it had previously recorded.</p>

    
    <p class="note">This can even include updating the <code id="history-traversal:the-dir-attribute"><a href="dom.html#the-dir-attribute">dir</a></code> attribute
    of <code id="history-traversal:the-textarea-element"><a href="semantics.html#the-textarea-element">textarea</a></code> elements or <code id="history-traversal:the-input-element"><a href="semantics.html#the-input-element">input</a></code> elements whose <code id="history-traversal:attr-input-type"><a href="semantics.html#attr-input-type">type</a></code> attribute is in either the <a href="semantics.html#text-(type=text)-state-and-search-state-(type=search)" id="history-traversal:text-(type=text)-state-and-search-state-(type=search)">Text</a> state or the <a href="semantics.html#text-(type=text)-state-and-search-state-(type=search)" id="history-traversal:text-(type=text)-state-and-search-state-(type=search)-2">Search</a> state, if the persisted state includes the
    directionality of user input in such controls.</p>

   </li><li><p>If the entry is a <a href="browsers.html#state-object" id="history-traversal:state-object">state object</a> entry, let <var>state</var> be a
   <a href="infrastructure.html#structured-clone" id="history-traversal:structured-clone">structured clone</a> of that state object. Otherwise, let <var>state</var> be
   null.</p></li><li><p>Set <code id="history-traversal:dom-history-state"><a href="browsers.html#dom-history-state">history.state</a></code> to <var>state</var>.</p></li><li><p>Let <var>state changed</var> be true if the <code id="history-traversal:document-19"><a href="dom.html#document">Document</a></code> of the <var>specified entry</var> has a <a href="browsers.html#latest-entry" id="history-traversal:latest-entry">latest entry</a>, and that entry is not the <var>specified entry</var>; otherwise let it be false.</p>

   </li><li><p>Let the <a href="browsers.html#latest-entry" id="history-traversal:latest-entry-2">latest entry</a> of the <code id="history-traversal:document-20"><a href="dom.html#document">Document</a></code> of the <var>specified entry</var> be the <var>specified entry</var>.</p></li><li>

    <p>If the <i>non-blocking events</i> flag is not set, then run the following steps
    <a href="infrastructure.html#immediately" id="history-traversal:immediately">immediately</a>. Otherwise, the <i>non-blocking events</i> flag is set; <a href="webappapis.html#queue-a-task" id="history-traversal:queue-a-task-2">queue a task</a>
    to run the following substeps instead.</p>

    <ol><li><p>If <var>state changed</var> is true, <a href="infrastructure.html#concept-event-fire" id="history-traversal:concept-event-fire-2">fire</a> a <a href="infrastructure.html#concept-events-trusted" id="history-traversal:concept-events-trusted-2">trusted</a>
     event with the name <code id="history-traversal:event-popstate"><a href="index.html#event-popstate">popstate</a></code> at the <code id="history-traversal:window-2"><a href="browsers.html#window">Window</a></code>
     object of the <code id="history-traversal:document-21"><a href="dom.html#document">Document</a></code>, using the <code id="history-traversal:popstateevent"><a href="browsers.html#popstateevent">PopStateEvent</a></code> interface, with the
     <code id="history-traversal:dom-popstateevent-state"><a href="browsers.html#dom-popstateevent-state">state</a></code> attribute initialised to the value of <var>state</var>. This event must bubble but not be cancelable and has no default
     action.</p></li><li><p>If <var>hash changed</var> is true, then <a href="infrastructure.html#concept-event-fire" id="history-traversal:concept-event-fire-3">fire</a> a <a href="infrastructure.html#concept-events-trusted" id="history-traversal:concept-events-trusted-3">trusted</a>
     event with the name <code id="history-traversal:event-hashchange"><a href="index.html#event-hashchange">hashchange</a></code> at the <a href="browsers.html#browsing-context" id="history-traversal:browsing-context-4">browsing
     context</a>'s <code id="history-traversal:window-3"><a href="browsers.html#window">Window</a></code> object, using the <code id="history-traversal:hashchangeevent"><a href="browsers.html#hashchangeevent">HashChangeEvent</a></code> interface,
     with the <code id="history-traversal:dom-hashchangeevent-oldurl"><a href="browsers.html#dom-hashchangeevent-oldurl">oldURL</a></code> attribute initialised to <var>old URL</var> and the <code id="history-traversal:dom-hashchangeevent-newurl"><a href="browsers.html#dom-hashchangeevent-newurl">newURL</a></code> attribute
     initialised to <var>new URL</var>. This event must bubble but not be cancelable and
     has no default action.</p></li></ol>

   </li><li><p>The <a href="browsers.html#current-entry" id="history-traversal:current-entry-8">current entry</a> is now the <var>specified entry</var>.</p></li></ol>

  <p>The <a href="webappapis.html#task-source" id="history-traversal:task-source">task source</a> for the tasks mentioned above is the <a href="webappapis.html#dom-manipulation-task-source" id="history-traversal:dom-manipulation-task-source">DOM manipulation task
  source</a>.</p>

  


  <section><h5 id="the-popstateevent-interface">6.6.10.1 The <code id="the-popstateevent-interface:popstateevent"><a href="browsers.html#popstateevent">PopStateEvent</a></code> interface</h5>

  <pre class="idl">[Constructor(DOMString type, optional <a href="browsers.html#popstateeventinit" id="the-popstateevent-interface:popstateeventinit">PopStateEventInit</a> eventInitDict), Exposed=(Window,Worker)]
interface <dfn id="popstateevent">PopStateEvent</dfn> : <a href="infrastructure.html#event" id="the-popstateevent-interface:event">Event</a> {
  readonly attribute any <a href="browsers.html#dom-popstateevent-state" id="the-popstateevent-interface:dom-popstateevent-state">state</a>;
};

dictionary <dfn id="popstateeventinit">PopStateEventInit</dfn> : <a href="infrastructure.html#eventinit" id="the-popstateevent-interface:eventinit">EventInit</a> {
  any state;
};</pre>

  <dl class="domintro"><dt><var>event</var> . <code id="the-popstateevent-interface:dom-popstateevent-state-2"><a href="browsers.html#dom-popstateevent-state">state</a></code></dt><dd>

    <p>Returns a copy of the information that was provided to <code id="the-popstateevent-interface:dom-history-pushstate"><a href="browsers.html#dom-history-pushstate">pushState()</a></code> or <code id="the-popstateevent-interface:dom-history-replacestate"><a href="browsers.html#dom-history-replacestate">replaceState()</a></code>.</p>

   </dd></dl>

  

  <p>The <dfn id="dom-popstateevent-state"><code>state</code></dfn> attribute must return the
  value it was initialised to. When the object is created, this attribute must be initialised to
  null. It represents the context information for the event, or null, if the state represented is
  the initial state of the <code id="the-popstateevent-interface:document"><a href="dom.html#document">Document</a></code>.</p></section>

  


  <section><h5 id="the-hashchangeevent-interface">6.6.10.2 The <code id="the-hashchangeevent-interface:hashchangeevent"><a href="browsers.html#hashchangeevent">HashChangeEvent</a></code> interface</h5>

  <pre class="idl">[Constructor(DOMString type, optional <a href="browsers.html#hashchangeeventinit" id="the-hashchangeevent-interface:hashchangeeventinit">HashChangeEventInit</a> eventInitDict), Exposed=(Window,Worker)]
interface <dfn id="hashchangeevent">HashChangeEvent</dfn> : <a href="infrastructure.html#event" id="the-hashchangeevent-interface:event">Event</a> {
  readonly attribute DOMString <a href="browsers.html#dom-hashchangeevent-oldurl" id="the-hashchangeevent-interface:dom-hashchangeevent-oldurl">oldURL</a>;
  readonly attribute DOMString <a href="browsers.html#dom-hashchangeevent-newurl" id="the-hashchangeevent-interface:dom-hashchangeevent-newurl">newURL</a>;
};

dictionary <dfn id="hashchangeeventinit">HashChangeEventInit</dfn> : <a href="infrastructure.html#eventinit" id="the-hashchangeevent-interface:eventinit">EventInit</a> {
  DOMString oldURL;
  DOMString newURL;
};</pre>

  <dl class="domintro"><dt><var>event</var> . <code id="the-hashchangeevent-interface:dom-hashchangeevent-oldurl-2"><a href="browsers.html#dom-hashchangeevent-oldurl">oldURL</a></code></dt><dd>

    <p>Returns the <a href="infrastructure.html#url" id="the-hashchangeevent-interface:url">URL</a> of the <a href="browsers.html#session-history-entry" id="the-hashchangeevent-interface:session-history-entry">session history entry</a> that was previously
    current.</p>

   </dd><dt><var>event</var> . <code id="the-hashchangeevent-interface:dom-hashchangeevent-newurl-2"><a href="browsers.html#dom-hashchangeevent-newurl">newURL</a></code></dt><dd>

    <p>Returns the <a href="infrastructure.html#url" id="the-hashchangeevent-interface:url-2">URL</a> of the <a href="browsers.html#session-history-entry" id="the-hashchangeevent-interface:session-history-entry-2">session history entry</a> that is now
    current.</p>

   </dd></dl>

  

  <p>The <dfn id="dom-hashchangeevent-oldurl"><code>oldURL</code></dfn> attribute must return the
  value it was initialised to. When the object is created, this attribute must be initialised to
  null. It represents context information for the event, specifically the URL of the <a href="browsers.html#session-history-entry" id="the-hashchangeevent-interface:session-history-entry-3">session
  history entry</a> that was traversed from.</p>

  <p>The <dfn id="dom-hashchangeevent-newurl"><code>newURL</code></dfn> attribute must return the
  value it was initialised to. When the object is created, this attribute must be initialised to
  null. It represents context information for the event, specifically the URL of the <a href="browsers.html#session-history-entry" id="the-hashchangeevent-interface:session-history-entry-4">session
  history entry</a> that was traversed to.</p></section>

  


  <section><h5 id="the-pagetransitionevent-interface">6.6.10.3 The <code id="the-pagetransitionevent-interface:pagetransitionevent"><a href="browsers.html#pagetransitionevent">PageTransitionEvent</a></code> interface</h5>

  <pre class="idl">[Constructor(DOMString type, optional <a href="browsers.html#pagetransitioneventinit" id="the-pagetransitionevent-interface:pagetransitioneventinit">PageTransitionEventInit</a> eventInitDict), Exposed=(Window,Worker)]
interface <dfn id="pagetransitionevent">PageTransitionEvent</dfn> : <a href="infrastructure.html#event" id="the-pagetransitionevent-interface:event">Event</a> {
  readonly attribute boolean <a href="browsers.html#dom-pagetransitionevent-persisted" id="the-pagetransitionevent-interface:dom-pagetransitionevent-persisted">persisted</a>;
};

dictionary <dfn id="pagetransitioneventinit">PageTransitionEventInit</dfn> : <a href="infrastructure.html#eventinit" id="the-pagetransitionevent-interface:eventinit">EventInit</a> {
  boolean persisted;
};</pre>

  <dl class="domintro"><dt><var>event</var> . <code id="the-pagetransitionevent-interface:dom-pagetransitionevent-persisted-2"><a href="browsers.html#dom-pagetransitionevent-persisted">persisted</a></code></dt><dd>

    <p>For the <code id="the-pagetransitionevent-interface:event-pageshow"><a href="index.html#event-pageshow">pageshow</a></code> event, returns false if the page is
    newly being loaded (and the <code id="the-pagetransitionevent-interface:event-load"><a href="index.html#event-load">load</a></code> event will fire). Otherwise,
    returns true.</p>

    <p>For the <code id="the-pagetransitionevent-interface:event-pagehide"><a href="index.html#event-pagehide">pagehide</a></code> event, returns false if the page is
    going away for the last time. Otherwise, returns true, meaning that (if nothing conspires to
    make the page unsalvageable) the page might be reused if the user navigates back to this
    page.</p>

    <p>Things that can cause the page to be unsalvageable include:</p>

    <ul class="brief"><li><code id="the-pagetransitionevent-interface:dom-document-open"><a href="webappapis.html#dom-document-open">document.open()</a></code>
     </li><li>Listening for <code id="the-pagetransitionevent-interface:event-beforeunload"><a href="index.html#event-beforeunload">beforeunload</a></code> events
     </li><li>Listening for <code id="the-pagetransitionevent-interface:event-unload"><a href="index.html#event-unload">unload</a></code> events
     </li><li>Having <code id="the-pagetransitionevent-interface:the-iframe-element"><a href="semantics.html#the-iframe-element">iframe</a></code>s that are not salvageable
     </li><li>Active <code id="the-pagetransitionevent-interface:websocket"><a href="http://www.w3.org/TR/websockets/#websocket">WebSocket</a></code> objects
     </li><li><a href="browsers.html#abort-a-document" id="the-pagetransitionevent-interface:abort-a-document">Aborting a <code>Document</code></a>
    </li></ul>

   </dd></dl>

  

  <p>The <dfn id="dom-pagetransitionevent-persisted"><code>persisted</code></dfn> attribute must
  return the value it was initialised to. When the object is created, this attribute must be
  initialised to false. It represents the context information for the event.</p></section></section>

  



  <section><h4 id="unloading-documents">6.6.11 Unloading documents</h4>

  

  <p>A <code id="unloading-documents:document"><a href="dom.html#document">Document</a></code> has a <dfn id="concept-document-salvageable"><i>salvageable</i></dfn> state, which must initially be
  true, a <dfn id="fired-unload">fired unload</dfn> flag, which must initially be false, and a <dfn id="page-showing">page showing</dfn>
  flag, which must initially be false. The <a href="browsers.html#page-showing" id="unloading-documents:page-showing">page showing</a> flag is used to ensure that
  scripts receive <code id="unloading-documents:event-pageshow"><a href="index.html#event-pageshow">pageshow</a></code> and <code id="unloading-documents:event-pagehide"><a href="index.html#event-pagehide">pagehide</a></code> events in a consistent manner (e.g. that they never
  receive two <code id="unloading-documents:event-pagehide-2"><a href="index.html#event-pagehide">pagehide</a></code> events in a row without an intervening
  <code id="unloading-documents:event-pageshow-2"><a href="index.html#event-pageshow">pageshow</a></code>, or vice versa).</p>

  <p><a href="webappapis.html#event-loop" id="unloading-documents:event-loop">Event loops</a> have a <dfn id="termination-nesting-level">termination nesting level</dfn>
  counter, which must initially be zero.</p>

  <p>When a user agent is to <dfn id="prompt-to-unload-a-document">prompt to unload a document</dfn>, it must run the following
  steps.</p>

  <ol><li><p>Increase the <a href="webappapis.html#event-loop" id="unloading-documents:event-loop-2">event loop</a>'s <a href="browsers.html#termination-nesting-level" id="unloading-documents:termination-nesting-level">termination nesting level</a> by
   one.</p></li><li><p>Increase the <code id="unloading-documents:document-2"><a href="dom.html#document">Document</a></code>'s <a href="webappapis.html#ignore-opens-during-unload-counter" id="unloading-documents:ignore-opens-during-unload-counter">ignore-opens-during-unload counter</a> by
   one.</p></li><li><p>Let <var>event</var> be a new <a href="infrastructure.html#concept-events-trusted" id="unloading-documents:concept-events-trusted">trusted</a>
   <code id="unloading-documents:beforeunloadevent"><a href="browsers.html#beforeunloadevent">BeforeUnloadEvent</a></code> event object with the name <code id="unloading-documents:event-beforeunload"><a href="index.html#event-beforeunload">beforeunload</a></code>, which does not bubble but is cancelable.</p></li><li><p><i>Dispatch</i>: <a href="infrastructure.html#concept-event-dispatch" id="unloading-documents:concept-event-dispatch">Dispatch</a> <var>event</var> at the <code id="unloading-documents:document-3"><a href="dom.html#document">Document</a></code>'s <code id="unloading-documents:window"><a href="browsers.html#window">Window</a></code> object.</p></li><li><p>Decrease the <a href="webappapis.html#event-loop" id="unloading-documents:event-loop-3">event loop</a>'s <a href="browsers.html#termination-nesting-level" id="unloading-documents:termination-nesting-level-2">termination nesting level</a> by
   one.</p></li><li><p>Release the <a href="webappapis.html#storage-mutex" id="unloading-documents:storage-mutex">storage mutex</a>.</p></li><li><p>If any event listeners were triggered by the earlier <i>dispatch</i> step, then set the
   <code id="unloading-documents:document-4"><a href="dom.html#document">Document</a></code>'s <i id="unloading-documents:concept-document-salvageable"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state to
   false.</p></li><li>

    <p>If the <code id="unloading-documents:dom-beforeunloadevent-returnvalue"><a href="browsers.html#dom-beforeunloadevent-returnvalue">returnValue</a></code> attribute of the
    <var>event</var> object is not the empty string, or if the event was canceled, then the
    user agent should ask the user to confirm that they wish to unload the document.</p>

    <p>The prompt shown by the user agent may include the string of the <code id="unloading-documents:dom-beforeunloadevent-returnvalue-2"><a href="browsers.html#dom-beforeunloadevent-returnvalue">returnValue</a></code> attribute, or some leading subset
    thereof. (A user agent may want to truncate the string to 1024 characters for display, for
    instance.)</p>

    <p>The user agent must <a href="webappapis.html#pause" id="unloading-documents:pause">pause</a> while waiting for the user's response.</p>

    <p>If the user did not confirm the page navigation, then the user agent <dfn id="refused-to-allow-the-document-to-be-unloaded">refused to allow
    the document to be unloaded</dfn>.</p>

   </li><li><p>If this algorithm was invoked by another instance of the "prompt to unload a document"
   algorithm (i.e. through the steps below that invoke this algorithm for all descendant browsing
   contexts), then jump to the step labeled <i>end</i>.</p></li><li><p>Let <var>descendants</var> be the <a href="browsers.html#list-of-the-descendant-browsing-contexts" id="unloading-documents:list-of-the-descendant-browsing-contexts">list of the descendant browsing
   contexts</a> of the <code id="unloading-documents:document-5"><a href="dom.html#document">Document</a></code>.</p></li><li>

    <p>If <var>descendants</var> is not an empty list, then for each <a href="browsers.html#browsing-context" id="unloading-documents:browsing-context">browsing
    context</a> <var>b</var> in <var>descendants</var> run the following
    substeps:</p>

    <ol><li><p><a href="browsers.html#prompt-to-unload-a-document" id="unloading-documents:prompt-to-unload-a-document">Prompt to unload</a> the <a href="browsers.html#active-document" id="unloading-documents:active-document">active
     document</a> of the <a href="browsers.html#browsing-context" id="unloading-documents:browsing-context-2">browsing context</a> <var>b</var>. If the user
     <a href="browsers.html#refused-to-allow-the-document-to-be-unloaded" id="unloading-documents:refused-to-allow-the-document-to-be-unloaded">refused to allow the document to be unloaded</a>, then the user implicitly also <a href="browsers.html#refused-to-allow-the-document-to-be-unloaded" id="unloading-documents:refused-to-allow-the-document-to-be-unloaded-2">refused to allow <em>this</em> document to
     be unloaded</a>; jump to the step labeled <i>end</i>.</p>

     </li><li><p>If the <i id="unloading-documents:concept-document-salvageable-2"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state of the <a href="browsers.html#active-document" id="unloading-documents:active-document-2">active
     document</a> of the <a href="browsers.html#browsing-context" id="unloading-documents:browsing-context-3">browsing context</a> <var>b</var> is false, then set
     the <i id="unloading-documents:concept-document-salvageable-3"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state of <em>this</em> document to
     false also.</p></li></ol>

   </li><li><p><i>End</i>: Decrease the <code id="unloading-documents:document-6"><a href="dom.html#document">Document</a></code>'s <a href="webappapis.html#ignore-opens-during-unload-counter" id="unloading-documents:ignore-opens-during-unload-counter-2">ignore-opens-during-unload
   counter</a> by one.</p></li></ol>

  <p>When a user agent is to <dfn id="unload-a-document">unload a document</dfn>, it must run the following steps. These
  steps are passed an argument, <var>recycle</var>, which is either true or false,
  indicating whether the <code id="unloading-documents:document-7"><a href="dom.html#document">Document</a></code> object is going to be re-used. (This is set by the
  <code id="unloading-documents:dom-document-open"><a href="webappapis.html#dom-document-open">document.open()</a></code> method.)</p>

  <ol><li><p>Increase the <a href="webappapis.html#event-loop" id="unloading-documents:event-loop-4">event loop</a>'s <a href="browsers.html#termination-nesting-level" id="unloading-documents:termination-nesting-level-3">termination nesting level</a> by
   one.</p></li><li><p>Increase the <code id="unloading-documents:document-8"><a href="dom.html#document">Document</a></code>'s <a href="webappapis.html#ignore-opens-during-unload-counter" id="unloading-documents:ignore-opens-during-unload-counter-3">ignore-opens-during-unload counter</a> by
   one.</p></li><li><p>If the <code id="unloading-documents:document-9"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#page-showing" id="unloading-documents:page-showing-2">page showing</a> flag is false, then jump to the
   step labeled <i>unload event</i> below (i.e. skip firing the <code id="unloading-documents:event-pagehide-3"><a href="index.html#event-pagehide">pagehide</a></code> event and don't rerun the <a href="browsers.html#unloading-document-visibility-change-steps" id="unloading-documents:unloading-document-visibility-change-steps">unloading document
   visibility change steps</a>).</p></li><li><p>Set the <code id="unloading-documents:document-10"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#page-showing" id="unloading-documents:page-showing-3">page showing</a> flag to false.</p></li><li><p><a href="infrastructure.html#concept-event-fire" id="unloading-documents:concept-event-fire">Fire</a> a <a href="infrastructure.html#concept-events-trusted" id="unloading-documents:concept-events-trusted-2">trusted</a> event with the name <code id="unloading-documents:event-pagehide-4"><a href="index.html#event-pagehide">pagehide</a></code> at the <code id="unloading-documents:window-2"><a href="browsers.html#window">Window</a></code> object of the
   <code id="unloading-documents:document-11"><a href="dom.html#document">Document</a></code>, with <i id="unloading-documents:concept-event-target-override"><a href="infrastructure.html#concept-event-target-override">target override</a></i> set to the <code id="unloading-documents:document-12"><a href="dom.html#document">Document</a></code>
   object, using the <code id="unloading-documents:pagetransitionevent"><a href="browsers.html#pagetransitionevent">PageTransitionEvent</a></code> interface,
   with the <code id="unloading-documents:dom-pagetransitionevent-persisted"><a href="browsers.html#dom-pagetransitionevent-persisted">persisted</a></code> attribute initialised
   to true if the <code id="unloading-documents:document-13"><a href="dom.html#document">Document</a></code> object's <i id="unloading-documents:concept-document-salvageable-4"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state is true, and false otherwise. This
   event must not bubble, must not be cancelable, and has no default action.</p></li><li>

    <p>Run any <dfn id="unloading-document-visibility-change-steps">unloading document visibility change steps</dfn> for <code id="unloading-documents:document-14"><a href="dom.html#document">Document</a></code> that
    are defined by <a href="infrastructure.html#other-applicable-specifications" id="unloading-documents:other-applicable-specifications">other applicable specifications</a>.</p>

    <p class="note">This is specifically intended for use by the Page Visibility specification. <a href="references.html#refsPAGEVIS">[PAGEVIS]</a></p>

   </li><li><p><i>Unload event</i>: If the <code id="unloading-documents:document-15"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#fired-unload" id="unloading-documents:fired-unload">fired unload</a> flag is
   false, <a href="webappapis.html#fire-a-simple-event" id="unloading-documents:fire-a-simple-event">fire a simple event</a> named <code id="unloading-documents:event-unload"><a href="index.html#event-unload">unload</a></code> at the
   <code id="unloading-documents:document-16"><a href="dom.html#document">Document</a></code>'s <code id="unloading-documents:window-3"><a href="browsers.html#window">Window</a></code> object, with <i id="unloading-documents:concept-event-target-override-2"><a href="infrastructure.html#concept-event-target-override">target override</a></i> set to the
   <code id="unloading-documents:document-17"><a href="dom.html#document">Document</a></code> object.</p></li><li><p>Decrease the <a href="webappapis.html#event-loop" id="unloading-documents:event-loop-5">event loop</a>'s <a href="browsers.html#termination-nesting-level" id="unloading-documents:termination-nesting-level-4">termination nesting level</a> by
   one.</p></li><li><p>Release the <a href="webappapis.html#storage-mutex" id="unloading-documents:storage-mutex-2">storage mutex</a>.</p></li><li><p>If any event listeners were triggered by the earlier <i>unload event</i> step, then set
   the <code id="unloading-documents:document-18"><a href="dom.html#document">Document</a></code> object's <i id="unloading-documents:concept-document-salvageable-5"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state
   to false and set the <code id="unloading-documents:document-19"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#fired-unload" id="unloading-documents:fired-unload-2">fired unload</a> flag to true.</p></li><li><p>Run any <a href="browsers.html#unloading-document-cleanup-steps" id="unloading-documents:unloading-document-cleanup-steps">unloading document cleanup steps</a> for <code id="unloading-documents:document-20"><a href="dom.html#document">Document</a></code> that are
   defined by this specification and <a href="infrastructure.html#other-applicable-specifications" id="unloading-documents:other-applicable-specifications-2">other applicable specifications</a>.</p></li><li><p>If this algorithm was invoked by another instance of the "unload a document" algorithm
   (i.e. by the steps below that invoke this algorithm for all descendant browsing contexts), then
   jump to the step labeled <i>end</i>.</p></li><li><p>Let <var>descendants</var> be the <a href="browsers.html#list-of-the-descendant-browsing-contexts" id="unloading-documents:list-of-the-descendant-browsing-contexts-2">list of the descendant browsing
   contexts</a> of the <code id="unloading-documents:document-21"><a href="dom.html#document">Document</a></code>.</p></li><li>

    <p>If <var>descendants</var> is not an empty list, then for each <a href="browsers.html#browsing-context" id="unloading-documents:browsing-context-4">browsing
    context</a> <var>b</var> in <var>descendants</var> run the following
    substeps:</p>

    <ol><li><p><a href="browsers.html#unload-a-document" id="unloading-documents:unload-a-document">Unload</a> the <a href="browsers.html#active-document" id="unloading-documents:active-document-3">active document</a> of the
     <a href="browsers.html#browsing-context" id="unloading-documents:browsing-context-5">browsing context</a> <var>b</var> with the <var>recycle</var>
     parameter set to false.</p></li><li><p>If the <i id="unloading-documents:concept-document-salvageable-6"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state of the <a href="browsers.html#active-document" id="unloading-documents:active-document-4">active
     document</a> of the <a href="browsers.html#browsing-context" id="unloading-documents:browsing-context-6">browsing context</a> <var>b</var> is false, then set
     the <i id="unloading-documents:concept-document-salvageable-7"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state of <em>this</em> document to
     false also.</p></li></ol>

   </li><li><p>If both the <code id="unloading-documents:document-22"><a href="dom.html#document">Document</a></code>'s <i id="unloading-documents:concept-document-salvageable-8"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state and <var>recycle</var> are
   false, then the <code id="unloading-documents:document-23"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#browsing-context" id="unloading-documents:browsing-context-7">browsing context</a> must <a href="browsers.html#discard-a-document" id="unloading-documents:discard-a-document">discard the <code>Document</code></a>.</p></li><li><p><i>End</i>: Decrease the <code id="unloading-documents:document-24"><a href="dom.html#document">Document</a></code>'s <a href="webappapis.html#ignore-opens-during-unload-counter" id="unloading-documents:ignore-opens-during-unload-counter-4">ignore-opens-during-unload
   counter</a> by one.</p></li></ol>

  <p>This specification defines the following <dfn id="unloading-document-cleanup-steps">unloading document cleanup steps</dfn>. Other
  specifications can define more.</p>

  <ol><li>

    <p><a href="http://www.w3.org/TR/websockets/#make-disappear" id="unloading-documents:make-disappear">Make disappear</a> any <code id="unloading-documents:websocket"><a href="http://www.w3.org/TR/websockets/#websocket">WebSocket</a></code> objects that were created by the <code id="unloading-documents:dom-websocket"><a href="http://www.w3.org/TR/websockets/#dom-websocket">WebSocket()</a></code> constructor from the
    <code id="unloading-documents:document-25"><a href="dom.html#document">Document</a></code>'s <code id="unloading-documents:window-4"><a href="browsers.html#window">Window</a></code> object.</p>

    <p>If this affected any <code id="unloading-documents:websocket-2"><a href="http://www.w3.org/TR/websockets/#websocket">WebSocket</a></code> objects, then set <code id="unloading-documents:document-26"><a href="dom.html#document">Document</a></code>'s <i id="unloading-documents:concept-document-salvageable-9"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state to false.</p>

   </li><li><p>If the <code id="unloading-documents:document-27"><a href="dom.html#document">Document</a></code>'s <i id="unloading-documents:concept-document-salvageable-10"><a href="browsers.html#concept-document-salvageable">salvageable</a></i>
   state is false, <a href="http://www.w3.org/TR/eventsource/#concept-eventsource-forcibly-close" id="unloading-documents:concept-eventsource-forcibly-close">forcibly close</a> any
   <code id="unloading-documents:eventsource"><a href="http://www.w3.org/TR/eventsource/#eventsource">EventSource</a></code> objects that whose constructor was invoked from the
   <code id="unloading-documents:document-28"><a href="dom.html#document">Document</a></code>'s <code id="unloading-documents:window-5"><a href="browsers.html#window">Window</a></code> object.</p></li><li><p>If the <code id="unloading-documents:document-29"><a href="dom.html#document">Document</a></code>'s <i id="unloading-documents:concept-document-salvageable-11"><a href="browsers.html#concept-document-salvageable">salvageable</a></i>
   state is false, empty the <code id="unloading-documents:document-30"><a href="dom.html#document">Document</a></code>'s <code id="unloading-documents:window-6"><a href="browsers.html#window">Window</a></code>'s <a href="webappapis.html#list-of-active-timers" id="unloading-documents:list-of-active-timers">list of active
   timers</a>.</p></li></ol>

  



  <section><h5 id="the-beforeunloadevent-interface">6.6.11.1 The <code id="the-beforeunloadevent-interface:beforeunloadevent"><a href="browsers.html#beforeunloadevent">BeforeUnloadEvent</a></code> interface</h5>

  <pre class="idl">interface <dfn id="beforeunloadevent">BeforeUnloadEvent</dfn> : <a href="infrastructure.html#event" id="the-beforeunloadevent-interface:event">Event</a> {
  attribute DOMString <a href="browsers.html#dom-beforeunloadevent-returnvalue" id="the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue">returnValue</a>;
};</pre>

  <dl class="domintro"><dt><var>event</var> . <code id="the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue-2"><a href="browsers.html#dom-beforeunloadevent-returnvalue">returnValue</a></code> [ = <var>value</var> ]</dt><dd>

    <p>Returns the current return value of the event (the message to show the user).</p>

    <p>Can be set, to update the message.</p>

   </dd></dl>

  <p class="note">There are no <code id="the-beforeunloadevent-interface:beforeunloadevent-2"><a href="browsers.html#beforeunloadevent">BeforeUnloadEvent</a></code>-specific initialisation methods.</p>

  

  <p>The <dfn id="dom-beforeunloadevent-returnvalue"><code>returnValue</code></dfn> attribute
  represents the message to show the user. When the event is created, the attribute must be set to
  the empty string. On getting, it must return the last value it was set to. On setting, the
  attribute must be set to the new value.</p></section></section>

  


  

  <section><h4 id="aborting-a-document-load">6.6.12 Aborting a document load</h4>

  <p>If a <code id="aborting-a-document-load:document"><a href="dom.html#document">Document</a></code> is <dfn id="abort-a-document">aborted</dfn>, the user agent must
  run the following steps:</p>

  <ol><li><p><a href="browsers.html#abort-a-document" id="aborting-a-document-load:abort-a-document">Abort</a> the <a href="browsers.html#active-document" id="aborting-a-document-load:active-document">active
   documents</a> of every <a href="browsers.html#child-browsing-context" id="aborting-a-document-load:child-browsing-context">child browsing context</a>. If this results in any of those
   <code id="aborting-a-document-load:document-2"><a href="dom.html#document">Document</a></code> objects having their <i id="aborting-a-document-load:concept-document-salvageable"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state set to false, then set this
   <code id="aborting-a-document-load:document-3"><a href="dom.html#document">Document</a></code>'s <i id="aborting-a-document-load:concept-document-salvageable-2"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state to false
   also.</p></li><li><p>Cancel any instances of the <a href="infrastructure.html#fetch" id="aborting-a-document-load:fetch">fetch</a> algorithm in the context of
   this <code id="aborting-a-document-load:document-4"><a href="dom.html#document">Document</a></code>, discarding any <a href="webappapis.html#concept-task" id="aborting-a-document-load:concept-task">tasks</a> <a href="webappapis.html#queue-a-task" id="aborting-a-document-load:queue-a-task">queued</a> for them, and discarding any further data received from the
   network for them. If this resulted in any instances of the <a href="infrastructure.html#fetch" id="aborting-a-document-load:fetch-2">fetch</a>
   algorithm being canceled or any <a href="webappapis.html#queue-a-task" id="aborting-a-document-load:queue-a-task-2">queued</a> <a href="webappapis.html#concept-task" id="aborting-a-document-load:concept-task-2">tasks</a> or any network data getting discarded, then set the
   <code id="aborting-a-document-load:document-5"><a href="dom.html#document">Document</a></code>'s <i id="aborting-a-document-load:concept-document-salvageable-3"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state to
   false.</p></li><li><p>If the <code id="aborting-a-document-load:document-6"><a href="dom.html#document">Document</a></code> has an <a href="dom.html#active-parser" id="aborting-a-document-load:active-parser">active parser</a>, then <a href="syntax.html#abort-a-parser" id="aborting-a-document-load:abort-a-parser">abort that parser</a> and set the <code id="aborting-a-document-load:document-7"><a href="dom.html#document">Document</a></code>'s <i id="aborting-a-document-load:concept-document-salvageable-4"><a href="browsers.html#concept-document-salvageable">salvageable</a></i> state to false.</p></li></ol>

  <p>User agents may allow users to explicitly invoke the <a href="browsers.html#abort-a-document" id="aborting-a-document-load:abort-a-document-2">abort a
  document</a> algorithm for a <code id="aborting-a-document-load:document-8"><a href="dom.html#document">Document</a></code>. If the user does so, then, if that
  <code id="aborting-a-document-load:document-9"><a href="dom.html#document">Document</a></code> is an <a href="browsers.html#active-document" id="aborting-a-document-load:active-document-2">active document</a>, the user agent should <a href="webappapis.html#queue-a-task" id="aborting-a-document-load:queue-a-task-3">queue a
  task</a> to <a href="webappapis.html#fire-a-simple-event" id="aborting-a-document-load:fire-a-simple-event">fire a simple event</a> named <code id="aborting-a-document-load:event-abort"><a href="index.html#event-abort">abort</a></code> at
  that <code id="aborting-a-document-load:document-10"><a href="dom.html#document">Document</a></code>'s <code id="aborting-a-document-load:window"><a href="browsers.html#window">Window</a></code> object before invoking the <a href="browsers.html#abort-a-document" id="aborting-a-document-load:abort-a-document-3">abort</a> algorithm.</p></section></section>

  

  



  <section><h3 id="offline">6.7 Offline Web applications</h3> 

  

  <section><h4 id="introduction-10">6.7.1 Introduction</h4>

  <p><i>This section is non-normative.</i></p>

  <p>In order to enable users to continue interacting with Web applications and documents even when
  their network connection is unavailable — for instance, because they are traveling outside
  of their ISP's coverage area — authors can provide a manifest which lists the files that are
  needed for the Web application to work offline and which causes the user's browser to keep a copy
  of the files for use offline.</p>

  <p>To illustrate this, consider a simple clock applet consisting of an HTML page "<code>clock.html</code>", a CSS style sheet "<code>clock.css</code>", and a JavaScript
  script "<code>clock.js</code>".</p>

  <p>Before adding the manifest, these three files might look like this:</p>

  <pre>&lt;!-- clock.html --&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;Clock&lt;/title&gt;
  &lt;script src="clock.js"&gt;&lt;/script&gt;
  &lt;link rel="stylesheet" href="clock.css"&gt;
 &lt;/head&gt;
 &lt;body&gt;
  &lt;p&gt;The time is: &lt;output id="clock"&gt;&lt;/output&gt;&lt;/p&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>
  <pre>/* clock.css */
output { font: 2em sans-serif; }</pre>
  <pre>/* clock.js */
setInterval(function () {
    document.getElementById('clock').value = new Date();
}, 1000);</pre>

  <p>If the user tries to open the "<code>clock.html</code>" page while offline, though,
  the user agent (unless it happens to have it still in the local cache) will fail with an
  error.</p>

  <p>The author can instead provide a manifest of the three files, say "<code>clock.appcache</code>":</p>

  <pre>CACHE MANIFEST
clock.html
clock.css
clock.js
</pre>

  <p>With a small change to the HTML file, the manifest (served as <code id="introduction-10:text/cache-manifest"><a href="iana.html#text/cache-manifest">text/cache-manifest</a></code>)
  is linked to the application:</p>

  <pre>&lt;!-- clock.html --&gt;
&lt;!DOCTYPE HTML&gt;
&lt;html manifest="clock.appcache"&gt;
 &lt;head&gt;
  &lt;title&gt;Clock&lt;/title&gt;
  &lt;script src="clock.js"&gt;&lt;/script&gt;
  &lt;link rel="stylesheet" href="clock.css"&gt;
 &lt;/head&gt;
 &lt;body&gt;
  &lt;p&gt;The time is: &lt;output id="clock"&gt;&lt;/output&gt;&lt;/p&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>

  <p>Now, if the user goes to the page, the browser will cache the files and make them available
  even when the user is offline.</p>

  <p class="note">Authors are encouraged to include the main page in the manifest also, but in
  practice the page that referenced the manifest is automatically cached even if it isn't explicitly
  mentioned.</p>

  <p class="note">With the exception of "no-store" directive, HTTP cache headers and restrictions on
  caching pages served over TLS (encrypted, using <code id="introduction-10:https-protocol"><a data-x-internal="https-protocol" href="http://tools.ietf.org/html/rfc7230#section-2.7.2">https:</a></code>) are
  overridden by manifests. Thus, pages will not expire from an application cache before the user
  agent has updated it, and even applications served over TLS can be made to work offline.</p>

  <p><a href="https://whatwg.org/demos/offline/clock/live-demo/clock.html">View this example online</a>.</p>



  <section><h5 id="supporting-offline-caching-for-legacy-applications">6.7.1.1 Supporting offline caching for legacy applications</h5>

  <p><i>This section is non-normative.</i></p>

  <p>The application cache feature works best if the application logic is separate from the
  application and user data, with the logic (markup, scripts, style sheets, images, etc) listed in
  the manifest and stored in the application cache, with a finite number of static HTML pages for
  the application, and with the application and user data stored in Web Storage or a client-side
  Indexed Database, updated dynamically using Web Sockets, <code id="supporting-offline-caching-for-legacy-applications:xmlhttprequest"><a href="infrastructure.html#xmlhttprequest">XMLHttpRequest</a></code>, server-sent
  events, or some other similar mechanism.</p>

  <p>This model results in a fast experience for the user: the application immediately loads, and
  fresh data is obtained as fast as the network will allow it (possibly while stale data shows).</p>

  <p>Legacy applications, however, tend to be designed so that the user data and the logic are mixed
  together in the HTML, with each operation resulting in a new HTML page from the server.</p>

  <div class="example">

   <p>For example, consider a news application. The typical architecture of such an application,
   when not using the application cache feature, is that the user fetches the main page, and the
   server returns a dynamically-generated page with the current headlines and the user interface
   logic mixed together.</p>

   <p>A news application designed for the application cache feature, however, would instead have the
   main page just consist of the logic, and would then have the main page fetch the data separately
   from the server, e.g. using <code id="supporting-offline-caching-for-legacy-applications:xmlhttprequest-2"><a href="infrastructure.html#xmlhttprequest">XMLHttpRequest</a></code>.</p>

  </div>

  <p>The mixed-content model does not work well with the application cache feature: since the
  content is cached, it would result in the user always seeing the stale data from the previous time
  the cache was updated.</p>

  <p>While there is no way to make the legacy model work as fast as the separated model, it
  <em>can</em> at least be retrofitted for offline use using the <a href="browsers.html#concept-appcache-mode-prefer-online" id="supporting-offline-caching-for-legacy-applications:concept-appcache-mode-prefer-online">prefer-online</a> <a href="browsers.html#concept-appcache-mode" id="supporting-offline-caching-for-legacy-applications:concept-appcache-mode">application cache mode</a>. To do so, list all the static
  resources used by the HTML page you want to have work offline in an <a href="browsers.html#concept-appcache-manifest" id="supporting-offline-caching-for-legacy-applications:concept-appcache-manifest">application cache manifest</a>, use the <code id="supporting-offline-caching-for-legacy-applications:attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute to select that manifest from the HTML file,
  and then add the following line at the bottom of the manifest:</p>

  <pre>SETTINGS:
prefer-online
NETWORK:
*</pre>

  <p>This causes the <a href="browsers.html#application-cache" id="supporting-offline-caching-for-legacy-applications:application-cache">application cache</a> to only be used for <a href="browsers.html#concept-appcache-master" id="supporting-offline-caching-for-legacy-applications:concept-appcache-master">master entries</a> when the user is offline, and causes the
  application cache to be used as an atomic HTTP cache (essentially pinning resources listed in the
  manifest), while allowing all resources not listed in the manifest to be accessed normally when
  the user is online.</p></section>



  <section><h5 id="appcacheevents">6.7.1.2 Event summary</h5>

  <p><i>This section is non-normative.</i></p>

  <p>When the user visits a page that declares a manifest, the browser will try to update the cache.
  It does this by fetching a copy of the manifest and, if the manifest has changed since the user
  agent last saw it, redownloading all the resources it mentions and caching them anew.</p>

  <p>As this is going on, a number of events get fired on the <code id="appcacheevents:applicationcache"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object
  to keep the script updated as to the state of the cache update, so that the user can be notified
  appropriately. The events are as follows:</p>

  <table><thead><tr><th> Event name
     </th><th> Interface
     </th><th> Fired when...
     </th><th> Next events
   </th></tr></thead><tbody><tr><td> <dfn id="event-appcache-checking"><code>checking</code></dfn>
     </td><td> <code id="appcacheevents:event"><a href="infrastructure.html#event">Event</a></code>
     </td><td> The user agent is checking for an update, or attempting to download the manifest for the
          first time. <strong>This is always the first event in the sequence.</strong>
     </td><td> <code id="appcacheevents:event-appcache-noupdate"><a href="browsers.html#event-appcache-noupdate">noupdate</a></code>, <code id="appcacheevents:event-appcache-downloading"><a href="browsers.html#event-appcache-downloading">downloading</a></code>, <code id="appcacheevents:event-appcache-obsolete"><a href="browsers.html#event-appcache-obsolete">obsolete</a></code>, <code id="appcacheevents:event-appcache-error"><a href="browsers.html#event-appcache-error">error</a></code>

    </td></tr><tr><td> <dfn id="event-appcache-noupdate"><code>noupdate</code></dfn>
     </td><td> <code id="appcacheevents:event-2"><a href="infrastructure.html#event">Event</a></code>
     </td><td> The manifest hadn't changed.
     </td><td> Last event in sequence.

    </td></tr><tr><td> <dfn id="event-appcache-downloading"><code>downloading</code></dfn>
     </td><td> <code id="appcacheevents:event-3"><a href="infrastructure.html#event">Event</a></code>
     </td><td> The user agent has found an update and is fetching it, or is downloading the resources
          listed by the manifest for the first time.
     </td><td> <code id="appcacheevents:event-appcache-progress"><a href="browsers.html#event-appcache-progress">progress</a></code>, <code id="appcacheevents:event-appcache-error-2"><a href="browsers.html#event-appcache-error">error</a></code>, <code id="appcacheevents:event-appcache-cached"><a href="browsers.html#event-appcache-cached">cached</a></code>, <code id="appcacheevents:event-appcache-updateready"><a href="browsers.html#event-appcache-updateready">updateready</a></code>

    </td></tr><tr><td> <dfn id="event-appcache-progress"><code>progress</code></dfn>
     </td><td> <code id="appcacheevents:progressevent"><a href="infrastructure.html#progressevent">ProgressEvent</a></code>
     </td><td> The user agent is downloading resources listed by the manifest.
          The event object's <code id="appcacheevents:dom-progressevent-total"><a href="infrastructure.html#dom-progressevent-total">total</a></code> attribute returns the total number of files to be downloaded.
          The event object's <code id="appcacheevents:dom-progressevent-loaded"><a href="infrastructure.html#dom-progressevent-loaded">loaded</a></code> attribute returns the number of files processed so far.
     </td><td> <code id="appcacheevents:event-appcache-progress-2"><a href="browsers.html#event-appcache-progress">progress</a></code>, <code id="appcacheevents:event-appcache-error-3"><a href="browsers.html#event-appcache-error">error</a></code>, <code id="appcacheevents:event-appcache-cached-2"><a href="browsers.html#event-appcache-cached">cached</a></code>, <code id="appcacheevents:event-appcache-updateready-2"><a href="browsers.html#event-appcache-updateready">updateready</a></code>

    </td></tr><tr><td> <dfn id="event-appcache-cached"><code>cached</code></dfn>
     </td><td> <code id="appcacheevents:event-4"><a href="infrastructure.html#event">Event</a></code>
     </td><td> The resources listed in the manifest have been downloaded, and the application is now cached.
     </td><td> Last event in sequence.

    </td></tr><tr><td> <dfn id="event-appcache-updateready"><code>updateready</code></dfn>
     </td><td> <code id="appcacheevents:event-5"><a href="infrastructure.html#event">Event</a></code>
     </td><td> The resources listed in the manifest have been newly redownloaded, and the script can use
          <code id="appcacheevents:dom-appcache-swapcache"><a href="browsers.html#dom-appcache-swapcache">swapCache()</a></code> to switch to the new cache.
     </td><td> Last event in sequence.

    </td></tr><tr><td> <dfn id="event-appcache-obsolete"><code>obsolete</code></dfn>
     </td><td> <code id="appcacheevents:event-6"><a href="infrastructure.html#event">Event</a></code>
     </td><td> The manifest was found to have become a 404 or 410 page, so the application cache is being deleted.
     </td><td> Last event in sequence.

    </td></tr><tr><td rowspan="4"> <dfn id="event-appcache-error"><code>error</code></dfn>
     </td><td rowspan="4"> <code id="appcacheevents:event-7"><a href="infrastructure.html#event">Event</a></code>
     </td><td> The manifest was a 404 or 410 page, so the attempt to cache the application has been aborted.
     </td><td rowspan="3"> Last event in sequence.

    </td></tr><tr><td> The manifest hadn't changed, but the page referencing the manifest failed to download properly.

    </td></tr><tr><td> A fatal error occurred while fetching the resources listed in the manifest.

    </td></tr><tr><td> The manifest changed while the update was being run.
     </td><td> The user agent will try fetching the files again momentarily.

  </td></tr></tbody></table>

  <p>These events are cancelable; their default action is for the user agent to show download
  progress information. If the page shows its own update UI, canceling the events will prevent the
  user agent from showing redundant progress information.</p></section></section>



  

  <section><h4 id="appcache">6.7.2 Application caches</h4> 

  <p>An <dfn id="application-cache">application cache</dfn> is a set of cached resources consisting of:</p>

  <ul><li>

    <p>One or more resources (including their out-of-band metadata, such as HTTP headers, if any),
    identified by URLs, each falling into one (or more) of the following categories:</p>

    <dl><dt><dfn id="concept-appcache-master">Master entries</dfn>

     </dt><dd><p class="note">These are documents that were added to the cache because a <a href="browsers.html#browsing-context" id="appcache:browsing-context">browsing
     context</a> was <a href="browsers.html#navigate" id="appcache:navigate">navigated</a> to that document and the document
     indicated that this was its cache, using the <code id="appcache:attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code>
     attribute.</p>


     </dd><dt><dfn id="concept-appcache-manifest">The manifest</dfn>

     </dt><dd><p class="note">This is the resource corresponding to the URL that was given in a master
     entry's <code id="appcache:the-html-element"><a href="semantics.html#the-html-element">html</a></code> element's <code id="appcache:attr-html-manifest-2"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute.
     The manifest is fetched and processed during the <a href="browsers.html#application-cache-download-process" id="appcache:application-cache-download-process">application cache download
     process</a>. All the <a href="browsers.html#concept-appcache-master" id="appcache:concept-appcache-master">master entries</a> have the
     <a href="browsers.html#same-origin" id="appcache:same-origin">same origin</a> as the manifest.</p>


     </dd><dt><dfn id="concept-appcache-explicit">Explicit entries</dfn>

     </dt><dd><p class="note">These are the resources that were listed in the cache's <a href="browsers.html#concept-appcache-manifest" id="appcache:concept-appcache-manifest">manifest</a> in an <a href="browsers.html#concept-appcache-manifest-explicit" id="appcache:concept-appcache-manifest-explicit">explicit section</a>.</p>


     </dd><dt><dfn id="concept-appcache-fallback">Fallback entries</dfn>

     </dt><dd><p class="note">These are the resources that were listed in the cache's <a href="browsers.html#concept-appcache-manifest" id="appcache:concept-appcache-manifest-2">manifest</a> in a <a href="browsers.html#concept-appcache-manifest-fallback" id="appcache:concept-appcache-manifest-fallback">fallback section</a>.</p>


    </dd></dl>

    <p><a href="browsers.html#concept-appcache-explicit" id="appcache:concept-appcache-explicit">Explicit entries</a> and <a href="browsers.html#concept-appcache-fallback" id="appcache:concept-appcache-fallback">Fallback entries</a> can be marked as <dfn id="concept-appcache-foreign">foreign</dfn>, which means that they have a <code id="appcache:attr-html-manifest-3"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute but that it doesn't point at this cache's
    <a href="browsers.html#concept-appcache-manifest" id="appcache:concept-appcache-manifest-3">manifest</a>.</p>

    <p class="note">A URL in the list can be flagged with multiple different types, and thus an
    entry can end up being categorised as multiple entries. For example, an entry can be a manifest
    entry and an explicit entry at the same time, if the manifest is listed within the manifest.</p>

   </li><li>

    <p>Zero or more <dfn id="concept-appcache-fallback-ns">fallback namespaces</dfn>, each of
    which is mapped to a <a href="browsers.html#concept-appcache-fallback" id="appcache:concept-appcache-fallback-2">fallback entry</a>.</p>

    <p class="note">These are URLs used as <a href="browsers.html#concept-appcache-matches-fallback" id="appcache:concept-appcache-matches-fallback">prefix
    match patterns</a> for resources that are to be fetched from the network if possible, or to
    be replaced by the corresponding <a href="browsers.html#concept-appcache-fallback" id="appcache:concept-appcache-fallback-3">fallback entry</a>
    if not. Each namespace URL has the <a href="browsers.html#same-origin" id="appcache:same-origin-2">same origin</a> as <a href="browsers.html#concept-appcache-manifest" id="appcache:concept-appcache-manifest-4">the manifest</a>.</p>

   </li><li>

    <p>Zero or more URLs that form the <dfn id="concept-appcache-onlinewhitelist">online
    whitelist namespaces</dfn>.</p>

    <p class="note">These are used as prefix match patterns, and declare URLs for which the user
    agent will ignore the application cache, instead fetching them normally (i.e. from the network
    or local HTTP cache as appropriate).</p>

   </li><li>

    <p>An <dfn id="concept-appcache-onlinewhitelist-wildcard">online whitelist wildcard
    flag</dfn>, which is either <i>open</i> or <i>blocking</i>.</p>

    <p class="note">The <i>open</i> state indicates that any URL not listed as cached is to
    be implicitly treated as being in the <a href="browsers.html#concept-appcache-onlinewhitelist" id="appcache:concept-appcache-onlinewhitelist">online
    whitelist namespaces</a>; the <i>blocking</i> state indicates that URLs not listed
    explicitly in the manifest are to be treated as unavailable.</p>

   </li><li>

    <p>A <dfn id="concept-appcache-mode">cache mode flag</dfn>, which is either in the <dfn id="concept-appcache-mode-fast"><i>fast</i></dfn> state or the <dfn id="concept-appcache-mode-prefer-online"><i>prefer-online</i></dfn> state.</p>

   </li></ul>

  <p>Each <a href="browsers.html#application-cache" id="appcache:application-cache">application cache</a> has a <dfn id="concept-appcache-completeness">completeness flag</dfn>, which is either <i>complete</i> or
  <i>incomplete</i>.</p>

  <hr>

  <p>An <dfn id="application-cache-group">application cache group</dfn> is a group of <a href="browsers.html#application-cache" id="appcache:application-cache-2">application
  caches</a>, identified by the <a href="infrastructure.html#absolute-url" id="appcache:absolute-url">absolute URL</a> of a resource <a href="browsers.html#concept-appcache-manifest" id="appcache:concept-appcache-manifest-5">manifest</a> which is used to populate the caches in the
  group.</p>

  <p>An <a href="browsers.html#application-cache" id="appcache:application-cache-3">application cache</a> is <dfn id="concept-appcache-newer">newer</dfn> than
  another if it was created after the other (in other words, <a href="browsers.html#application-cache" id="appcache:application-cache-4">application caches</a> in an <a href="browsers.html#application-cache-group" id="appcache:application-cache-group">application cache group</a> have a chronological
  order).</p>

  <p>Only the newest <a href="browsers.html#application-cache" id="appcache:application-cache-5">application cache</a> in an <a href="browsers.html#application-cache-group" id="appcache:application-cache-group-2">application cache group</a> can
  have its <a href="browsers.html#concept-appcache-completeness" id="appcache:concept-appcache-completeness">completeness flag</a> set to
  <i>incomplete</i>; the others are always all <i>complete</i>.</p>

  <p>Each <a href="browsers.html#application-cache-group" id="appcache:application-cache-group-3">application cache group</a> has an <dfn id="concept-appcache-status">update
  status</dfn>, which is one of the following: <i>idle</i>, <i>checking</i>, <i>downloading</i>.</p>

  <p>A <dfn id="relevant-application-cache">relevant application cache</dfn> is an <a href="browsers.html#application-cache" id="appcache:application-cache-6">application cache</a> that is the <a href="browsers.html#concept-appcache-newer" id="appcache:concept-appcache-newer">newest</a> in its <a href="browsers.html#application-cache-group" id="appcache:application-cache-group-4">group</a> to be <i>complete</i>.</p>

  <p>Each <a href="browsers.html#application-cache-group" id="appcache:application-cache-group-5">application cache group</a> has a <dfn id="concept-appcache-pending-masters">list of pending master entries</dfn>. Each entry in this
  list consists of a resource and a corresponding <code id="appcache:document"><a href="dom.html#document">Document</a></code> object. It is used during
  the <a href="browsers.html#application-cache-download-process" id="appcache:application-cache-download-process-2">application cache download process</a> to ensure that new master entries are cached
  even if the <a href="browsers.html#application-cache-download-process" id="appcache:application-cache-download-process-3">application cache download process</a> was already running for their
  <a href="browsers.html#application-cache-group" id="appcache:application-cache-group-6">application cache group</a> when they were loaded.</p>

  <p>An <a href="browsers.html#application-cache-group" id="appcache:application-cache-group-7">application cache group</a> can be marked as <dfn id="concept-appcache-obsolete">obsolete</dfn>, meaning that it must be ignored when looking at
  what <a href="browsers.html#application-cache-group" id="appcache:application-cache-group-8">application cache groups</a> exist.</p>

  <hr>

  <p>A <dfn id="cache-host">cache host</dfn> is a <code id="appcache:document-2"><a href="dom.html#document">Document</a></code> or a <code id="appcache:sharedworkerglobalscope"><a href="http://www.w3.org/TR/workers/#sharedworkerglobalscope">SharedWorkerGlobalScope</a></code>
  object. A <a href="browsers.html#cache-host" id="appcache:cache-host">cache host</a> can be associated with an <a href="browsers.html#application-cache" id="appcache:application-cache-7">application cache</a>.</p>

  <p>A <code id="appcache:document-3"><a href="dom.html#document">Document</a></code> initially is not associated with an <a href="browsers.html#application-cache" id="appcache:application-cache-8">application cache</a>, but
  can become associated with one early during the page load process, when steps <a href="syntax.html#parser-appcache">in the parser</a> and in the <a href="browsers.html#navigate" id="appcache:navigate-2">navigation</a>
  sections cause <a href="browsers.html#concept-appcache-init" id="appcache:concept-appcache-init">cache selection</a> to occur.</p>

  <p>A <code id="appcache:sharedworkerglobalscope-2"><a href="http://www.w3.org/TR/workers/#sharedworkerglobalscope">SharedWorkerGlobalScope</a></code> can be associated with an <a href="browsers.html#application-cache" id="appcache:application-cache-9">application cache</a>
  when it is created.</p>

  <p>Each <a href="browsers.html#cache-host" id="appcache:cache-host-2">cache host</a> has an associated <code id="appcache:applicationcache"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object.</p>

  <hr>

  <p>Multiple <a href="browsers.html#application-cache" id="appcache:application-cache-10">application caches</a> in different <a href="browsers.html#application-cache-group" id="appcache:application-cache-group-9">application cache groups</a> can contain the same resource,
  e.g. if the manifests all reference that resource. If the user agent is to <dfn id="concept-appcache-selection">select an application cache</dfn> from a list of <a href="browsers.html#relevant-application-cache" id="appcache:relevant-application-cache">relevant application caches</a> that contain a resource, the
  user agent must use the application cache that the user most likely wants to see the resource
  from, taking into account the following:</p>

  <ul><li>which application cache was most recently updated,

   </li><li>which application cache was being used to display the resource from which the user decided to
   look at the new resource, and

   </li><li>which application cache the user prefers.

  </li></ul>

  <hr>

  <p>A URL <dfn id="concept-appcache-matches-fallback">matches a fallback namespace</dfn> if
  there exists a <a href="browsers.html#relevant-application-cache" id="appcache:relevant-application-cache-2">relevant application cache</a> whose <a href="browsers.html#concept-appcache-manifest" id="appcache:concept-appcache-manifest-6">manifest</a>'s URL has the <a href="browsers.html#same-origin" id="appcache:same-origin-3">same origin</a> as the
  URL in question, and that has a <a href="browsers.html#concept-appcache-fallback-ns" id="appcache:concept-appcache-fallback-ns">fallback
  namespace</a> that is a <a href="infrastructure.html#prefix-match" id="appcache:prefix-match">prefix match</a> for the URL being examined. If multiple
  fallback namespaces match the same URL, the longest one is the one that matches. A URL looking for
  a fallback namespace can match more than one application cache at a time, but only matches one
  namespace in each cache.</p>

  <div class="example">

   <p>If a manifest <code>http://example.com/app1/manifest</code> declares that <code>http://example.com/resources/images</code> is a fallback namespace, and the user
   navigates to <code>HTTP://EXAMPLE.COM:80/resources/images/cat.png</code>, then the user
   agent will decide that the application cache identified by <code>http://example.com/app1/manifest</code> contains a namespace with a match for that
   URL.</p>

   

  </div></section>

  



  <section><h4 id="manifests">6.7.3 The cache manifest syntax</h4>


  <section><h5 id="some-sample-manifests">6.7.3.1 Some sample manifests</h5>

  <p><i>This section is non-normative.</i></p>

  <div class="example">

   <p>This example manifest requires two images and a style sheet to be cached and whitelists a CGI
   script.</p>

   <pre>CACHE MANIFEST
# the above line is required

# this is a comment
# there can be as many of these anywhere in the file
# they are all ignored
  # comments can have spaces before them
  # but must be alone on the line

# blank lines are ignored too

# these are files that need to be cached they can either be listed
# first, or a "CACHE:" header could be put before them, as is done
# lower down.
images/sound-icon.png
images/background.png
# note that each file has to be put on its own line

# here is a file for the online whitelist -- it isn't cached, and
# references to this file will bypass the cache, always hitting the
# network (or trying to, if the user is offline).
NETWORK:
comm.cgi

# here is another set of files to cache, this time just the CSS file.
CACHE:
style/default.css</pre>

   <p>It could equally well be written as follows:</p>

   <pre>CACHE MANIFEST
NETWORK:
comm.cgi
CACHE:
style/default.css
images/sound-icon.png
images/background.png</pre>

  </div>

  <div class="example">

   <p>Offline application cache manifests can use absolute paths or even absolute URLs:</p>

   <pre>CACHE MANIFEST

/main/home
/main/app.js
/settings/home
/settings/app.js
http://img.example.com/logo.png
http://img.example.com/check.png
http://img.example.com/cross.png</pre>

  </div>

  <div class="example">

   <p>The following manifest defines a catch-all error page that is displayed for any page on the
   site while the user is offline. It also specifies that the <a href="browsers.html#concept-appcache-onlinewhitelist-wildcard" id="some-sample-manifests:concept-appcache-onlinewhitelist-wildcard">online whitelist wildcard flag</a> is <i>open</i>, meaning that accesses to resources on other sites will not be blocked.
   (Resources on the same site are already not blocked because of the catch-all fallback
   namespace.)</p>

   <p>So long as all pages on the site reference this manifest, they will get cached locally as they
   are fetched, so that subsequent hits to the same page will load the page immediately from the
   cache. Until the manifest is changed, those pages will not be fetched from the server again. When
   the manifest changes, then all the files will be redownloaded.</p>

   <p>Subresources, such as style sheets, images, etc, would only be cached using the regular HTTP
   caching semantics, however.</p>

   <pre>CACHE MANIFEST
FALLBACK:
/ /offline.html
NETWORK:
*</pre>

  </div></section>



  <section><h5 id="writing-cache-manifests">6.7.3.2 Writing cache manifests</h5>

  <p>Manifests must be served using the <code id="writing-cache-manifests:text/cache-manifest"><a href="iana.html#text/cache-manifest">text/cache-manifest</a></code> <a href="infrastructure.html#mime-type" id="writing-cache-manifests:mime-type">MIME type</a>. All
  resources served using the <code id="writing-cache-manifests:text/cache-manifest-2"><a href="iana.html#text/cache-manifest">text/cache-manifest</a></code> <a href="infrastructure.html#mime-type" id="writing-cache-manifests:mime-type-2">MIME type</a> must follow the
  syntax of application cache manifests, as described in this section.</p>

  <p>An application cache manifest is a text file, whose text is encoded using UTF-8. Data in
  application cache manifests is line-based. Newlines must be represented by U+000A LINE FEED (LF)
  characters, U+000D CARRIAGE RETURN (CR) characters, or U+000D CARRIAGE RETURN (CR) U+000A LINE
  FEED (LF) pairs. <a href="references.html#refsENCODING">[ENCODING]</a></p>

  <p class="note">This is a <a href="introduction.html#willful-violation" id="writing-cache-manifests:willful-violation">willful violation</a> of RFC 2046, which requires all <code>text/*</code> types to only allow CRLF line breaks. This requirement, however, is
  outdated; the use of CR, LF, and CRLF line breaks is commonly supported and indeed sometimes CRLF
  is <em>not</em> supported by text editors. <a href="references.html#refsRFC2046">[RFC2046]</a></p>

  <p>The first line of an application cache manifest must consist of the string "CACHE", a single
  U+0020 SPACE character, the string "MANIFEST", and either a U+0020 SPACE character, a U+0009
  CHARACTER TABULATION (tab) character, a U+000A LINE FEED (LF) character, or a U+000D CARRIAGE
  RETURN (CR) character. The first line may optionally be preceded by a U+FEFF BYTE ORDER MARK (BOM)
  character. If any other text is found on the first line, it is ignored.</p>

  <p>Subsequent lines, if any, must all be one of the following:</p>

  <dl><dt>A blank line
   </dt><dd>
    <p>Blank lines must consist of zero or more U+0020 SPACE and
    U+0009 CHARACTER TABULATION (tab) characters only.</p>

   </dd><dt>A comment
   </dt><dd>
    <p>Comment lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
    characters, followed by a single U+0023 NUMBER SIGN character (#), followed by zero or more
    characters other than U+000A LINE FEED (LF) and U+000D CARRIAGE RETURN (CR) characters.</p>

    <p class="note">Comments must be on a line on their own. If they were to be included on a line
    with a URL, the "#" would be mistaken for part of a fragment identifier.</p>

   </dd><dt>A section header
   </dt><dd>

    <p>Section headers change the current section. There are four possible section headers:

    </p><dl><dt><code>CACHE:</code>
     </dt><dd>Switches to the <dfn id="concept-appcache-manifest-explicit">explicit section</dfn>.

     </dd><dt><code>FALLBACK:</code>
     </dt><dd>Switches to the <dfn id="concept-appcache-manifest-fallback">fallback section</dfn>.

     </dd><dt><code>NETWORK:</code>
     </dt><dd>Switches to the <dfn id="concept-appcache-manifest-network">online whitelist section</dfn>.

     </dd><dt><code>SETTINGS:</code>
     </dt><dd>Switches to the <dfn id="concept-appcache-manifest-settings">settings section</dfn>.

    </dd></dl>

    <p>Section header lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER
    TABULATION (tab) characters, followed by one of the names above (including the U+003A COLON
    character (:)) followed by zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
    characters.</p>

    <p>Ironically, by default, the current section is the <a href="browsers.html#concept-appcache-manifest-explicit" id="writing-cache-manifests:concept-appcache-manifest-explicit">explicit section</a>.</p>

   </dd><dt>Data for the current section
   </dt><dd>

    <p>The format that data lines must take depends on the current section.</p>

    <p>When the current section is the <a href="browsers.html#concept-appcache-manifest-explicit" id="writing-cache-manifests:concept-appcache-manifest-explicit-2">explicit
    section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER
    TABULATION (tab) characters, a <a href="infrastructure.html#valid-url" id="writing-cache-manifests:valid-url">valid URL</a> identifying a resource other than the
    manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab)
    characters.</p>

    <p>When the current section is the <a href="browsers.html#concept-appcache-manifest-fallback" id="writing-cache-manifests:concept-appcache-manifest-fallback">fallback
    section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER
    TABULATION (tab) characters, a <a href="infrastructure.html#valid-url" id="writing-cache-manifests:valid-url-2">valid URL</a> identifying a resource other than the
    manifest itself, one or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters,
    another <a href="infrastructure.html#valid-url" id="writing-cache-manifests:valid-url-3">valid URL</a> identifying a resource other than the manifest itself, and then
    zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>When the current section is the <a href="browsers.html#concept-appcache-manifest-network" id="writing-cache-manifests:concept-appcache-manifest-network">online
    whitelist section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009
    CHARACTER TABULATION (tab) characters, either a single U+002A ASTERISK character (*)  or a <a href="infrastructure.html#valid-url" id="writing-cache-manifests:valid-url-4">valid URL</a> identifying a resource
    other than the manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER
    TABULATION (tab) characters.</p>

    <p>When the current section is the <a href="browsers.html#concept-appcache-manifest-settings" id="writing-cache-manifests:concept-appcache-manifest-settings">settings
    section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER
    TABULATION (tab) characters, a <a href="browsers.html#concept-appcache-manifest-setting" id="writing-cache-manifests:concept-appcache-manifest-setting">setting</a>,
    and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>Currently only one <dfn id="concept-appcache-manifest-setting">setting</dfn> is
    defined:</p>

    <dl><dt>The cache mode setting</dt><dd>This consists of the string "<code>prefer-online</code>". It sets the <a href="browsers.html#concept-appcache-mode" id="writing-cache-manifests:concept-appcache-mode">cache mode</a> to <a href="browsers.html#concept-appcache-mode-prefer-online" id="writing-cache-manifests:concept-appcache-mode-prefer-online">prefer-online</a>. (The <a href="browsers.html#concept-appcache-mode" id="writing-cache-manifests:concept-appcache-mode-2">cache mode</a> defaults to <a href="browsers.html#concept-appcache-mode-fast" id="writing-cache-manifests:concept-appcache-mode-fast">fast</a>.)</dd></dl>

    <p>Within a <a href="browsers.html#concept-appcache-manifest-settings" id="writing-cache-manifests:concept-appcache-manifest-settings-2">settings section</a>, each <a href="browsers.html#concept-appcache-manifest-setting" id="writing-cache-manifests:concept-appcache-manifest-setting-2">setting</a> must occur no more than once.</p>



  </dd></dl>

  <p>Manifests may contain sections more than once. Sections may be empty.</p>

  <p>URLs that are to be fallback pages associated with <a href="browsers.html#concept-appcache-fallback-ns" id="writing-cache-manifests:concept-appcache-fallback-ns">fallback namespaces</a>, and those namespaces themselves,
  must be given in <a href="browsers.html#concept-appcache-manifest-fallback" id="writing-cache-manifests:concept-appcache-manifest-fallback-2">fallback sections</a>, with
  the namespace being the first URL of the data line, and the corresponding fallback page being the
  second URL. All the other pages to be cached must be listed in <a href="browsers.html#concept-appcache-manifest-explicit" id="writing-cache-manifests:concept-appcache-manifest-explicit-3">explicit sections</a>.</p>

  <p><a href="browsers.html#concept-appcache-fallback-ns" id="writing-cache-manifests:concept-appcache-fallback-ns-2">Fallback namespaces</a> and <a href="browsers.html#concept-appcache-fallback" id="writing-cache-manifests:concept-appcache-fallback">fallback entries</a> must have the <a href="browsers.html#same-origin" id="writing-cache-manifests:same-origin">same origin</a>
  as the manifest itself. <a href="browsers.html#concept-appcache-fallback-ns" id="writing-cache-manifests:concept-appcache-fallback-ns-3">Fallback namespaces</a>
  must also be <span>in the same path</span> as the manifest's URL.</p>

  <p>A <a href="browsers.html#concept-appcache-fallback-ns" id="writing-cache-manifests:concept-appcache-fallback-ns-4">fallback namespace</a> must not be listed more
  than once.</p>

  <p>Namespaces that the user agent is to put into the <a href="browsers.html#concept-appcache-onlinewhitelist" id="writing-cache-manifests:concept-appcache-onlinewhitelist">online whitelist</a> must all be specified in <a href="browsers.html#concept-appcache-manifest-network" id="writing-cache-manifests:concept-appcache-manifest-network-2">online whitelist sections</a>. (This is needed for
  any URL that the page is intending to use to communicate back to the server.) To specify that all
  URLs are automatically whitelisted in this way, a U+002A ASTERISK character (*) may be specified
  as one of the URLs. </p>

  <p>Authors should not include namespaces in the <a href="browsers.html#concept-appcache-onlinewhitelist" id="writing-cache-manifests:concept-appcache-onlinewhitelist-2">online whitelist</a> for which another namespace in
  the <a href="browsers.html#concept-appcache-onlinewhitelist" id="writing-cache-manifests:concept-appcache-onlinewhitelist-3">online whitelist</a> is a <a href="infrastructure.html#prefix-match" id="writing-cache-manifests:prefix-match">prefix
  match</a>.</p>

  <p><a href="infrastructure.html#relative-url" id="writing-cache-manifests:relative-url">Relative URLs</a> must be given relative to the manifest's own
  URL. All URLs in the manifest must have the same <a href="infrastructure.html#concept-url-scheme" id="writing-cache-manifests:concept-url-scheme">scheme</a> as
  the manifest itself (either explicitly or implicitly, through the use of <a href="infrastructure.html#relative-url" id="writing-cache-manifests:relative-url-2">relative URLs</a>). <a href="references.html#refsURL">[URL]</a></p>

  <p>URLs in manifests must not have fragment identifiers (i.e. the U+0023 NUMBER SIGN character
  isn't allowed in URLs in manifests).</p>

  <p><a href="browsers.html#concept-appcache-fallback-ns" id="writing-cache-manifests:concept-appcache-fallback-ns-5">Fallback namespaces</a> and namespaces in the
  <a href="browsers.html#concept-appcache-onlinewhitelist" id="writing-cache-manifests:concept-appcache-onlinewhitelist-4">online whitelist</a> are matched by <a href="infrastructure.html#prefix-match" id="writing-cache-manifests:prefix-match-2">prefix
  match</a>.</p></section>


  

  <section><h5 id="parsing-cache-manifests">6.7.3.3 Parsing cache manifests</h5>

  <p>When a user agent is to <dfn id="parse-a-manifest">parse a manifest</dfn>, it means that the user agent must run the
  following steps:</p>

  <ol><li>

    <p><a href="infrastructure.html#utf-8-decode" id="parsing-cache-manifests:utf-8-decode">UTF-8 decode</a> the byte stream corresponding with the manifest to be parsed.</p>

    <p class="note">The <a href="infrastructure.html#utf-8-decode" id="parsing-cache-manifests:utf-8-decode-2">UTF-8 decode</a> algorithm strips a leading BOM, if any.</p>

    

   </li><li><p>Let <var>base URL</var> be the <a href="infrastructure.html#absolute-url" id="parsing-cache-manifests:absolute-url">absolute URL</a> representing the
   manifest.</p></li><li><p>Apply the <a href="infrastructure.html#url-parser" id="parsing-cache-manifests:url-parser">URL parser</a> to <var>base URL</var>, and let <var>manifest path</var>
   be the <a href="infrastructure.html#concept-url-path" id="parsing-cache-manifests:concept-url-path">path</a> component thus obtained.</p></li><li><p>Remove all the characters in <var>manifest path</var> after the last U+002F SOLIDUS
   character (/), if any. (The first character and the last character in <var>manifest path</var>
   after this step will both be slashes, the URL path separator character.)</p></li><li><p>Apply the <a href="infrastructure.html#url-parser" id="parsing-cache-manifests:url-parser-2">URL parser</a> steps to the <var>base URL</var>, so that the
   components from its <a href="infrastructure.html#parsed-url" id="parsing-cache-manifests:parsed-url">parsed URL</a> can be used by the subseqent steps of this
   algorithm.</p></li><li><p>Let <var>explicit URLs</var> be an initially empty list of <a href="infrastructure.html#absolute-url" id="parsing-cache-manifests:absolute-url-2">absolute URLs</a> for <a href="browsers.html#concept-appcache-explicit" id="parsing-cache-manifests:concept-appcache-explicit">explicit
   entries</a>.</p></li><li><p>Let <var>fallback URLs</var> be an initially empty mapping of <a href="browsers.html#concept-appcache-fallback-ns" id="parsing-cache-manifests:concept-appcache-fallback-ns">fallback namespaces</a> to <a href="infrastructure.html#absolute-url" id="parsing-cache-manifests:absolute-url-3">absolute URLs</a> for <a href="browsers.html#concept-appcache-fallback" id="parsing-cache-manifests:concept-appcache-fallback">fallback
   entries</a>.</p></li><li><p>Let <var>online whitelist namespaces</var> be an initially empty list of <a href="infrastructure.html#absolute-url" id="parsing-cache-manifests:absolute-url-4">absolute URLs</a> for an <a href="browsers.html#concept-appcache-onlinewhitelist" id="parsing-cache-manifests:concept-appcache-onlinewhitelist">online whitelist</a>.</p></li><li><p>Let <var>online whitelist wildcard flag</var> be <i>blocking</i>. </p></li><li><p>Let <var>cache mode flag</var> be <i>fast</i>. </p></li><li><p>Let <var>input</var> be the decoded text of the manifest's byte stream.</p></li><li><p>Let <var>position</var> be a pointer into <var>input</var>, initially
   pointing at the first character.</p></li><li><p>If the characters starting from <var>position</var> are "CACHE", followed by a
   U+0020 SPACE character, followed by "MANIFEST", then advance <var>position</var> to the
   next character after those. Otherwise, this isn't a cache manifest; abort this algorithm with a
   failure while checking for the magic signature.</p></li><li><p>If the character at <var>position</var> is neither a U+0020 SPACE character, a
   U+0009 CHARACTER TABULATION (tab) character, U+000A LINE FEED (LF) character, nor a U+000D
   CARRIAGE RETURN (CR) character, then this isn't a cache manifest; abort this algorithm with a
   failure while checking for the magic signature.</p></li><li><p>This is a cache manifest. The algorithm cannot fail beyond
   this point (though bogus lines can get ignored).</p></li><li><p><a href="infrastructure.html#collect-a-sequence-of-characters" id="parsing-cache-manifests:collect-a-sequence-of-characters">Collect a sequence of characters</a> that are <em>not</em> U+000A LINE FEED (LF)
   or U+000D CARRIAGE RETURN (CR) characters, and ignore those characters. (Extra text on the first
   line, after the signature, is ignored.)</p></li><li><p>Let <var>mode</var> be "explicit".</p></li><li><p><i>Start of line</i>: If <var>position</var> is past the end of <var>input</var>, then jump to the last step. Otherwise, <a href="infrastructure.html#collect-a-sequence-of-characters" id="parsing-cache-manifests:collect-a-sequence-of-characters-2">collect a sequence of
   characters</a> that are U+000A LINE FEED (LF), U+000D CARRIAGE RETURN (CR), U+0020 SPACE, or
   U+0009 CHARACTER TABULATION (tab) characters.</p></li><li><p>Now, <a href="infrastructure.html#collect-a-sequence-of-characters" id="parsing-cache-manifests:collect-a-sequence-of-characters-3">collect a sequence of characters</a> that are <em>not</em> U+000A LINE FEED
   (LF) or U+000D CARRIAGE RETURN (CR) characters, and let the result be <var>line</var>.</p></li><li><p>Drop any trailing U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters at the end
   of <var>line</var>.</p></li><li><p>If <var>line</var> is the empty string, then jump back to the step labeled <i>start
   of line</i>.</p></li><li><p>If the first character in <var>line</var> is a U+0023 NUMBER SIGN character (#),
   then jump back to the step labeled <i>start of line</i>.</p></li><li><p>If <var>line</var> equals "CACHE:" (the word "CACHE" followed by a U+003A COLON
   character (:)), then set <var>mode</var> to "explicit" and jump back to the step labeled
   <i>start of line</i>.</p></li><li><p>If <var>line</var> equals "FALLBACK:" (the word "FALLBACK" followed by a U+003A
   COLON character (:)), then set <var>mode</var> to "fallback" and jump back to the step
   labeled <i>start of line</i>.</p></li><li><p>If <var>line</var> equals "NETWORK:" (the word "NETWORK" followed by a U+003A
   COLON character (:)), then set <var>mode</var> to "online whitelist" and jump back to
   the step labeled <i>start of line</i>.</p></li><li><p>If <var>line</var> equals "SETTINGS:" (the word "SETTINGS" followed by a U+003A
   COLON character (:)), then set <var>mode</var> to "settings" and jump back to the step
   labeled <i>start of line</i>.</p></li><li><p>If <var>line</var> ends with a U+003A COLON character (:), then set <var>mode</var> to "unknown" and jump back to the step labeled <i>start of line</i>.</p></li><li><p>This is either a data line or it is syntactically incorrect.</p></li><li><p>Let <var>position</var> be a pointer into <var>line</var>, initially
   pointing at the start of the string.</p></li><li><p>Let <var>tokens</var> be a list of strings, initially empty.</p></li><li>

    <p>While <var>position</var> doesn't point past the end of <var>line</var>:</p>

    <ol><li><p>Let <var>current token</var> be an empty string.</p></li><li><p>While <var>position</var> doesn't point past the end of <var>line</var> and the character at <var>position</var> is neither a U+0020 SPACE
     nor a U+0009 CHARACTER TABULATION (tab) character, add the character at <var>position</var> to <var>current token</var> and advance <var>position</var> to the next character in <var>input</var>.</p></li><li><p>Add <var>current token</var> to the <var>tokens</var> list.</p></li><li><p>While <var>position</var> doesn't point past the end of <var>line</var> and the character at <var>position</var> is either a U+0020 SPACE
     or a U+0009 CHARACTER TABULATION (tab) character, advance <var>position</var> to the
     next character in <var>input</var>.</p></li></ol>

   </li><li>

    <p>Process <var>tokens</var> as follows:</p>

    <dl class="switch"><dt>If <var>mode</var> is "explicit"</dt><dd>

      <p><a href="infrastructure.html#resolve-a-url" id="parsing-cache-manifests:resolve-a-url">Resolve</a> the first item in <var>tokens</var>,
      relative to <var>base URL</var>, with the URL character encoding set to UTF-8;
      ignore the rest.</p>

      <p>If this fails, then jump back to the step labeled <i>start of line</i>.</p>

      <p>If the resulting <a href="infrastructure.html#parsed-url" id="parsing-cache-manifests:parsed-url-2">parsed URL</a> has a different <a href="infrastructure.html#concept-url-scheme" id="parsing-cache-manifests:concept-url-scheme">scheme</a> component than <var>base URL</var> (the
      manifest's URL), then jump back to the step labeled <i>start of line</i>.</p>

      <p>Let <var>new URL</var> be the result of applying the <a href="infrastructure.html#concept-url-serialiser" id="parsing-cache-manifests:concept-url-serialiser">URL serialiser</a> algorithm to the resulting <a href="infrastructure.html#parsed-url" id="parsing-cache-manifests:parsed-url-3">parsed
      URL</a>, with the <i>exclude fragment flag</i> set.</p>

      <p>Add <var>new URL</var> to the <var>explicit URLs</var>.</p>

     </dd><dt>If <var>mode</var> is "fallback"</dt><dd>

      <p>Let <var>part one</var> be the first token in <var>tokens</var>, and let
      <var>part two</var> be the second token in <var>tokens</var>.</p>

      <p><a href="infrastructure.html#resolve-a-url" id="parsing-cache-manifests:resolve-a-url-2">Resolve</a> <var>part one</var> and <var>part two</var>, relative to <var>base URL</var>, with the URL character
      encoding set to UTF-8.</p>

      <p>If either fails, then jump back to the step labeled <i>start of line</i>.</p>


      <p>If the <a href="infrastructure.html#absolute-url" id="parsing-cache-manifests:absolute-url-5">absolute URL</a> corresponding to either <var>part one</var> or
      <var>part two</var> does not have the <a href="browsers.html#same-origin" id="parsing-cache-manifests:same-origin">same origin</a> as the manifest's URL,
      then jump back to the step labeled <i>start of line</i>.</p> 

      <p>Let <var>part one path</var> be the <a href="infrastructure.html#concept-url-path" id="parsing-cache-manifests:concept-url-path-2">path</a> component
      of the <a href="infrastructure.html#resulting-parsed-url" id="parsing-cache-manifests:resulting-parsed-url">resulting parsed URL</a> for <var>part one</var>.</p>

      <p>If <var>manifest path</var> is not a <a href="infrastructure.html#prefix-match" id="parsing-cache-manifests:prefix-match">prefix match</a> for <var>part one
      path</var>, then jump back to the step labeled <i>start of line</i>.</p> 


      <p>Let <var>part one</var> be the result of applying the <a href="infrastructure.html#concept-url-serialiser" id="parsing-cache-manifests:concept-url-serialiser-2">URL serialiser</a> algorithm to the first resulting
      <a href="infrastructure.html#parsed-url" id="parsing-cache-manifests:parsed-url-4">parsed URL</a>, with the <i>exclude fragment flag</i> set.</p>

      <p>Let <var>part two</var> be the result of applying the <a href="infrastructure.html#concept-url-serialiser" id="parsing-cache-manifests:concept-url-serialiser-3">URL serialiser</a> algorithm to the second resulting
      <a href="infrastructure.html#parsed-url" id="parsing-cache-manifests:parsed-url-5">parsed URL</a>, with the <i>exclude fragment flag</i> set.</p>

      <p>If <var>part one</var> is already in the <var>fallback URLs</var> mapping
      as a <a href="browsers.html#concept-appcache-fallback-ns" id="parsing-cache-manifests:concept-appcache-fallback-ns-2">fallback namespace</a>, then jump back to
      the step labeled <i>start of line</i>.</p>

      <p>Otherwise, add <var>part one</var> to the <var>fallback URLs</var>
      mapping as a <a href="browsers.html#concept-appcache-fallback-ns" id="parsing-cache-manifests:concept-appcache-fallback-ns-3">fallback namespace</a>, mapped to
      <var>part two</var> as the <a href="browsers.html#concept-appcache-fallback" id="parsing-cache-manifests:concept-appcache-fallback-2">fallback
      entry</a>.</p>

     </dd><dt>If <var>mode</var> is "online whitelist"</dt><dd>

      <p>If the first item in <var>tokens</var> is a U+002A ASTERISK character (*), then
      set <var>online whitelist wildcard flag</var> to <i>open</i> and jump back
      to the step labeled <i>start of line</i>.</p>

      <p>Otherwise, <a href="infrastructure.html#resolve-a-url" id="parsing-cache-manifests:resolve-a-url-3">resolve</a> the first item in <var>tokens</var>, relative to <var>base URL</var>, with the URL character
      encoding set to UTF-8; ignore the rest.</p>

      <p>If this fails, then jump back to the step labeled <i>start of line</i>.</p>

      <p>If the resulting <a href="infrastructure.html#parsed-url" id="parsing-cache-manifests:parsed-url-6">parsed URL</a> has a different <a href="infrastructure.html#concept-url-scheme" id="parsing-cache-manifests:concept-url-scheme-2">scheme</a> component than <var>base URL</var> (the
      manifest's URL), then jump back to the step labeled <i>start of line</i>.</p>

      <p>Let <var>new URL</var> be the result of applying the <a href="infrastructure.html#concept-url-serialiser" id="parsing-cache-manifests:concept-url-serialiser-4">URL serialiser</a> algorithm to the resulting <a href="infrastructure.html#parsed-url" id="parsing-cache-manifests:parsed-url-7">parsed
      URL</a>, with the <i>exclude fragment flag</i> set.</p>

      <p>Add <var>new URL</var> to the <var>online whitelist namespaces</var>.</p>

     </dd><dt>If <var>mode</var> is "settings"</dt><dd>

      <p>If <var>tokens</var> contains a single token, and that token is a
      <a href="infrastructure.html#case-sensitive" id="parsing-cache-manifests:case-sensitive">case-sensitive</a> match for the string "<code>prefer-online</code>", then
      set <var>cache mode flag</var> to <i>prefer-online</i> and jump back to the
      step labeled <i>start of line</i>.</p>

      <p>Otherwise, the line is an unsupported setting: do nothing; the line is ignored.</p>

     </dd><dt>If <var>mode</var> is "unknown"</dt><dd>

      <p>Do nothing. The line is ignored.</p>

     </dd></dl>

   </li><li><p>Jump back to the step labeled <i>start of line</i>. (That step jumps to the next, and last,
   step when the end of the file is reached.)</p></li><li><p>Return the <var>explicit URLs</var> list, the <var>fallback URLs</var>
   mapping, the <var>online whitelist namespaces</var>, the <var>online whitelist
   wildcard flag</var>, and the <var>cache mode flag</var>.</p></li></ol>

  <div class="note">

   <p>The resource that declares the manifest (with the <code id="parsing-cache-manifests:attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute) will always get taken from the cache,
   whether it is listed in the cache or not, even if it is listed in an <a href="browsers.html#concept-appcache-onlinewhitelist" id="parsing-cache-manifests:concept-appcache-onlinewhitelist-2">online whitelist namespace</a>.</p>

   <p>If a resource is listed in the <a href="browsers.html#concept-appcache-manifest-explicit" id="parsing-cache-manifests:concept-appcache-manifest-explicit">explicit
   section</a> or as a <a href="browsers.html#concept-appcache-fallback" id="parsing-cache-manifests:concept-appcache-fallback-3">fallback entry</a> in the <a href="browsers.html#concept-appcache-manifest-fallback" id="parsing-cache-manifests:concept-appcache-manifest-fallback">fallback section</a>, the resource will always be
   taken from the cache, regardless of any other matching entries in the <a href="browsers.html#concept-appcache-fallback-ns" id="parsing-cache-manifests:concept-appcache-fallback-ns-4">fallback namespaces</a> or <a href="browsers.html#concept-appcache-onlinewhitelist" id="parsing-cache-manifests:concept-appcache-onlinewhitelist-3">online whitelist namespaces</a>.</p>

   <p>When a <a href="browsers.html#concept-appcache-fallback-ns" id="parsing-cache-manifests:concept-appcache-fallback-ns-5">fallback namespace</a> and an <a href="browsers.html#concept-appcache-onlinewhitelist" id="parsing-cache-manifests:concept-appcache-onlinewhitelist-4">online whitelist namespace</a> overlap, the <a href="browsers.html#concept-appcache-onlinewhitelist" id="parsing-cache-manifests:concept-appcache-onlinewhitelist-5">online whitelist namespace</a> has priority.</p>

   <p>The <a href="browsers.html#concept-appcache-onlinewhitelist-wildcard" id="parsing-cache-manifests:concept-appcache-onlinewhitelist-wildcard">online whitelist wildcard
   flag</a> is applied last, only for URLs that match neither the <a href="browsers.html#concept-appcache-onlinewhitelist" id="parsing-cache-manifests:concept-appcache-onlinewhitelist-6">online whitelist namespace</a> nor the <a href="browsers.html#concept-appcache-fallback-ns" id="parsing-cache-manifests:concept-appcache-fallback-ns-6">fallback namespace</a> and that are not listed in the
   <a href="browsers.html#concept-appcache-manifest-explicit" id="parsing-cache-manifests:concept-appcache-manifest-explicit-2">explicit section</a>.</p>

  </div></section></section>


  <section><h4 id="downloading-or-updating-an-application-cache">6.7.4 Downloading or updating an application cache</h4>

  <p>When the user agent is required (by other parts of this specification) to start the
  <dfn id="application-cache-download-process">application cache download process</dfn> for an <a href="infrastructure.html#absolute-url" id="downloading-or-updating-an-application-cache:absolute-url">absolute URL</a> purported to
  identify a <a href="browsers.html#concept-appcache-manifest" id="downloading-or-updating-an-application-cache:concept-appcache-manifest">manifest</a>, or for an <a href="browsers.html#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group">application
  cache group</a>, potentially given a particular <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host">cache host</a>, and potentially given
  a <a href="browsers.html#concept-appcache-master" id="downloading-or-updating-an-application-cache:concept-appcache-master">master</a> resource, the user agent must run the steps
  below. These steps are always run <a href="infrastructure.html#in-parallel" id="downloading-or-updating-an-application-cache:in-parallel">in parallel</a> with the <a href="webappapis.html#event-loop" id="downloading-or-updating-an-application-cache:event-loop">event loop</a>
  <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task">tasks</a>.</p>

  <p>Some of these steps have requirements that only apply if the user agent <dfn id="shows-caching-progress">shows caching
  progress</dfn>. Support for this is optional. Caching progress UI could consist of a progress bar
  or message panel in the user agent's interface, or an overlay, or something else. Certain events
  fired during the <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process">application cache download process</a> allow the script to override the
  display of such an interface. (Such events are delayed until after the <code id="downloading-or-updating-an-application-cache:event-load"><a href="index.html#event-load">load</a></code> event has fired.)

  The goal of this is to allow Web applications to provide more
  seamless update mechanisms, hiding from the user the mechanics of the application cache mechanism.
  User agents may display user interfaces independent of this, but are encouraged to not show
  prominent update progress notifications for applications that cancel the relevant events.</p>

  <p>The <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-2">application cache download process</a> steps are as follows:

  </p><ol><li><p>Optionally, wait until the permission to start the <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-3">application cache download
   process</a> has been obtained from the user and until the user agent is confident that the
   network is available. This could include doing nothing until the user explicitly opts-in to
   caching the site, or could involve prompting the user for permission. The algorithm might never
   get past this point. (This step is particularly intended to be used by user agents running on
   severely space-constrained devices or in highly privacy-sensitive environments).</p></li><li>

    <p>Atomically, so as to avoid race conditions, perform the following substeps:</p>

    <ol><li>

      <p>Pick the appropriate substeps:</p>

      <dl class="switch"><dt>If these steps were invoked with an <a href="infrastructure.html#absolute-url" id="downloading-or-updating-an-application-cache:absolute-url-2">absolute URL</a> purported to identify a
       <a href="browsers.html#concept-appcache-manifest" id="downloading-or-updating-an-application-cache:concept-appcache-manifest-2">manifest</a></dt><dd>

        <p>Let <var>manifest URL</var> be that <a href="infrastructure.html#absolute-url" id="downloading-or-updating-an-application-cache:absolute-url-3">absolute URL</a>.</p>

        <p>If there is no <a href="browsers.html#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-2">application cache group</a> identified by <var>manifest
        URL</var>, then create a new <a href="browsers.html#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-3">application cache group</a> identified by <var>manifest URL</var>. Initially, it has no <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache">application caches</a>. One will be created later in this algorithm.</p>

       </dd><dt>If these steps were invoked with an <a href="browsers.html#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-4">application cache group</a></dt><dd>

        <p>Let <var>manifest URL</var> be the <a href="infrastructure.html#absolute-url" id="downloading-or-updating-an-application-cache:absolute-url-4">absolute URL</a> of the <a href="browsers.html#concept-appcache-manifest" id="downloading-or-updating-an-application-cache:concept-appcache-manifest-3">manifest</a> used to identify the <a href="browsers.html#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-5">application
        cache group</a> to be updated.</p>

        <p>If that <a href="browsers.html#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-6">application cache group</a> is <a href="browsers.html#concept-appcache-obsolete" id="downloading-or-updating-an-application-cache:concept-appcache-obsolete">obsolete</a>, then abort this instance of the
        <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-4">application cache download process</a>. This can happen if another instance of this
        algorithm found the manifest to be 404 or 410 while this algorithm was waiting in the first
        step above.</p>

       </dd></dl>

     </li><li><p>Let <var>cache group</var> be the <a href="browsers.html#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-7">application cache group</a>
     identified by <var>manifest URL</var>.</p></li><li><p>If these steps were invoked with a <a href="browsers.html#concept-appcache-master" id="downloading-or-updating-an-application-cache:concept-appcache-master-2">master</a>
     resource, then add the resource, along with the resource's <code id="downloading-or-updating-an-application-cache:document"><a href="dom.html#document">Document</a></code>, to <var>cache group</var>'s <a href="browsers.html#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters">list of pending
     master entries</a>.</p></li><li><p>If these steps were invoked with a <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-2">cache host</a>, and the <a href="browsers.html#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status">status</a> of <var>cache group</var> is
     <i>checking</i> or <i>downloading</i>, then <a href="browsers.html#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task">queue a post-load task</a> to <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event">fire a
     simple event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-checking"><a href="browsers.html#event-appcache-checking">checking</a></code> that is
     cancelable at the <code id="downloading-or-updating-an-application-cache:applicationcache"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of that <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-3">cache host</a>. The
     default action of this event must be, if the user agent <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress">shows caching progress</a>,
     the display of some sort of user interface indicating to the user that the user agent is
     checking to see if it can download the application.</p></li><li><p>If these steps were invoked with a <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-4">cache host</a>, and the <a href="browsers.html#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-2">status</a> of <var>cache group</var> is
     <i>downloading</i>, then also <a href="browsers.html#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-2">queue a post-load task</a> to <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-2">fire a simple
     event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-downloading"><a href="browsers.html#event-appcache-downloading">downloading</a></code> that is
     cancelable at the <code id="downloading-or-updating-an-application-cache:applicationcache-2"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of that <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-5">cache host</a>. The
     default action of this event must be, if the user agent <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-2">shows caching progress</a>,
     the display of some sort of user interface indicating to the user the application is being
     downloaded.</p></li><li><p>If the <a href="browsers.html#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-3">status</a> of the <var>cache
     group</var> is either <i>checking</i> or <i>downloading</i>, then abort this instance of the
     <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-5">application cache download process</a>, as an update is already in progress.</p></li><li><p>Set the <a href="browsers.html#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-4">status</a> of <var>cache
     group</var> to <i>checking</i>.</p>

     </li><li><p>For each <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-6">cache host</a> associated with an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-2">application cache</a> in
     <var>cache group</var>, <a href="browsers.html#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-3">queue a post-load task</a> to <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-3">fire a simple
     event</a> that is cancelable named <code id="downloading-or-updating-an-application-cache:event-appcache-checking-2"><a href="browsers.html#event-appcache-checking">checking</a></code> at
     the <code id="downloading-or-updating-an-application-cache:applicationcache-3"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of the <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-7">cache host</a>. The default action
     of these events must be, if the user agent <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-3">shows caching progress</a>, the display of
     some sort of user interface indicating to the user that the user agent is checking for the
     availability of updates.</p></li></ol>

    <p class="note">The remainder of the steps run <a href="infrastructure.html#in-parallel" id="downloading-or-updating-an-application-cache:in-parallel-2">in parallel</a>.</p>

    <p>If <var>cache group</var> already has an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-3">application cache</a> in it, then
    this is an <dfn id="concept-appcache-upgrade">upgrade attempt</dfn>. Otherwise, this is a
    <dfn id="concept-appcache-cache">cache attempt</dfn>.</p>

   </li><li><p>If this is a <a href="browsers.html#concept-appcache-cache" id="downloading-or-updating-an-application-cache:concept-appcache-cache">cache attempt</a>, then this
   algorithm was invoked with a <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-8">cache host</a>; <a href="browsers.html#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-4">queue a post-load task</a> to
   <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-4">fire a simple event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-checking-3"><a href="browsers.html#event-appcache-checking">checking</a></code> that
   is cancelable at the <code id="downloading-or-updating-an-application-cache:applicationcache-4"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of that <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-9">cache host</a>. The
   default action of this event must be, if the user agent <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-4">shows caching progress</a>, the
   display of some sort of user interface indicating to the user that the user agent is checking for
   the availability of updates.</p></li><li>

    <p><i>Fetching the manifest</i>: <a href="infrastructure.html#fetch" id="downloading-or-updating-an-application-cache:fetch">Fetch</a> the resource from <var>manifest URL</var> with the <i>blocking flag</i> set, and let <var>manifest</var> be that resource. HTTP caching semantics should be honored for this
    request. The <i>override referrer source</i> must be null.</p> 

    <p>Parse <var>manifest</var> according to the <a href="browsers.html#parse-a-manifest" id="downloading-or-updating-an-application-cache:parse-a-manifest">rules for
    parsing manifests</a>, obtaining a list of <a href="browsers.html#concept-appcache-explicit" id="downloading-or-updating-an-application-cache:concept-appcache-explicit">explicit
    entries</a>, <a href="browsers.html#concept-appcache-fallback" id="downloading-or-updating-an-application-cache:concept-appcache-fallback">fallback entries</a> and the <a href="browsers.html#concept-appcache-fallback-ns" id="downloading-or-updating-an-application-cache:concept-appcache-fallback-ns">fallback namespaces</a> that map to them, entries for
    the <a href="browsers.html#concept-appcache-onlinewhitelist" id="downloading-or-updating-an-application-cache:concept-appcache-onlinewhitelist">online whitelist</a>, and values for the
    <a href="browsers.html#concept-appcache-onlinewhitelist-wildcard" id="downloading-or-updating-an-application-cache:concept-appcache-onlinewhitelist-wildcard">online whitelist wildcard flag</a>
    and the <a href="browsers.html#concept-appcache-mode" id="downloading-or-updating-an-application-cache:concept-appcache-mode">cache mode flag</a>.</p>

    <p class="note">The <a href="infrastructure.html#mime-type" id="downloading-or-updating-an-application-cache:mime-type">MIME type</a> of the resource is ignored — it is assumed to
    be <code id="downloading-or-updating-an-application-cache:text/cache-manifest"><a href="iana.html#text/cache-manifest">text/cache-manifest</a></code>. In the future, if new manifest formats are supported, the
    different types will probably be distinguished on the basis of the file signatures (for the
    current format, that is the "<code>CACHE&nbsp;MANIFEST</code>" string at the top of the
    file).</p>

   </li><li>

    <p>If <i>fetching the manifest</i> fails due to a 404 or 410 response <a href="infrastructure.html#concept-http-equivalent-codes" id="downloading-or-updating-an-application-cache:concept-http-equivalent-codes">or equivalent</a>, then run these substeps:</p>

    <ol><li><p>Mark <var>cache group</var> as <a href="browsers.html#concept-appcache-obsolete" id="downloading-or-updating-an-application-cache:concept-appcache-obsolete-2">obsolete</a>. This <var>cache group</var> no
     longer exists for any purpose other than the processing of <code id="downloading-or-updating-an-application-cache:document-2"><a href="dom.html#document">Document</a></code> objects
     already associated with an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-4">application cache</a> in the <var>cache
     group</var>.</p></li><li><p>Let <var>task list</var> be an empty list of <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-2">tasks</a>.</p>

     </li><li><p>For each <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-10">cache host</a> associated with an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-5">application cache</a> in
     <var>cache group</var>, create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-3">task</a> to <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-5">fire
     a simple event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-obsolete"><a href="browsers.html#event-appcache-obsolete">obsolete</a></code> that is
     cancelable at the <code id="downloading-or-updating-an-application-cache:applicationcache-5"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of the <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-11">cache host</a>, and
     append it to <var>task list</var>. The default action of these events must be, if the
     user agent <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-5">shows caching progress</a>, the display of some sort of user interface
     indicating to the user that the application is no longer available for offline use.</p></li><li><p>For each entry in <var>cache group</var>'s <a href="browsers.html#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-2">list of pending master entries</a>, create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-4">task</a> to <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-6">fire a simple event</a> that is cancelable named
     <code id="downloading-or-updating-an-application-cache:event-appcache-error"><a href="browsers.html#event-appcache-error">error</a></code> (not <code id="downloading-or-updating-an-application-cache:event-appcache-obsolete-2"><a href="browsers.html#event-appcache-obsolete">obsolete</a></code>!) at the <code id="downloading-or-updating-an-application-cache:applicationcache-6"><a href="browsers.html#applicationcache">ApplicationCache</a></code>
     singleton of the <code id="downloading-or-updating-an-application-cache:document-3"><a href="dom.html#document">Document</a></code> for this entry, if there still is one, and append it to
     <var>task list</var>. The default action of this event must be, if the user agent
     <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-6">shows caching progress</a>, the display of some sort of user interface indicating to
     the user that the user agent failed to save the application for offline use.</p></li><li><p>If <var>cache group</var> has an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-6">application cache</a> whose <a href="browsers.html#concept-appcache-completeness" id="downloading-or-updating-an-application-cache:concept-appcache-completeness">completeness flag</a> is <i>incomplete</i>, then
     discard that <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-7">application cache</a>.</p>

     </li><li><p>If appropriate, remove any user interface indicating that an update for this cache is in
     progress.</p></li><li><p>Let the <a href="browsers.html#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-5">status</a> of <var>cache
     group</var> be <i>idle</i>.</p></li><li><p>For each <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-5">task</a> in <var>task list</var>, <a href="browsers.html#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-5">queue that task as a post-load task</a>.</p></li><li><p>Abort the <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-6">application cache download process</a>.</p></li></ol>

   </li><li>

    <p>Otherwise, if <i>fetching the manifest</i> fails in some other way (e.g. the server returns
    another 4xx or 5xx response <a href="infrastructure.html#concept-http-equivalent-codes" id="downloading-or-updating-an-application-cache:concept-http-equivalent-codes-2">or equivalent</a>, or
    there is a DNS error, or the connection times out, or the user cancels the download, or the
    parser for manifests fails when checking the magic signature), or if the server returned a
    redirect, then run the <a href="browsers.html#cache-failure-steps" id="downloading-or-updating-an-application-cache:cache-failure-steps">cache failure steps</a>. <a href="references.html#refsHTTP">[HTTP]</a></p>

   </li><li>

    <p>If this is an <a href="browsers.html#concept-appcache-upgrade" id="downloading-or-updating-an-application-cache:concept-appcache-upgrade">upgrade attempt</a> and the newly
    downloaded <var>manifest</var> is byte-for-byte identical to the manifest found in the
    <a href="browsers.html#concept-appcache-newer" id="downloading-or-updating-an-application-cache:concept-appcache-newer">newest</a> <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-8">application cache</a> in <var>cache group</var>, or the server reported it as "304 Not Modified" <a href="infrastructure.html#concept-http-equivalent-codes" id="downloading-or-updating-an-application-cache:concept-http-equivalent-codes-3">or equivalent</a>, then run these substeps:</p>

    <ol><li><p>Let <var>cache</var> be the <a href="browsers.html#concept-appcache-newer" id="downloading-or-updating-an-application-cache:concept-appcache-newer-2">newest</a>
     <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-9">application cache</a> in <var>cache group</var>.</p></li><li><p>Let <var>task list</var> be an empty list of <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-6">tasks</a>.</p>

     </li><li>

      <p>For each entry in <var>cache group</var>'s <a href="browsers.html#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-3">list of pending master entries</a>, wait for the
      resource for this entry to have either completely downloaded or failed.</p>

      <p>If the download failed (e.g. the server returns a 4xx or 5xx response <a href="infrastructure.html#concept-http-equivalent-codes" id="downloading-or-updating-an-application-cache:concept-http-equivalent-codes-4">or equivalent</a>, or there is a DNS error, the
      connection times out, or the user cancels the download), or if the resource is labeled with
      the "no-store" cache directive, then create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-7">task</a> to
      <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-7">fire a simple event</a> that is cancelable named <code id="downloading-or-updating-an-application-cache:event-appcache-error-2"><a href="browsers.html#event-appcache-error">error</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-7"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of
      the <code id="downloading-or-updating-an-application-cache:document-4"><a href="dom.html#document">Document</a></code> for this entry, if there still is one, and append it to <var>task list</var>. The default action of this event must be, if the user agent
      <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-7">shows caching progress</a>, the display of some sort of user interface indicating to
      the user that the user agent failed to save the application for offline use.</p>

      <p>Otherwise, associate the <code id="downloading-or-updating-an-application-cache:document-5"><a href="dom.html#document">Document</a></code> for this entry with <var>cache</var>; store the resource for this entry in <var>cache</var>, if it
      isn't already there, and categorise its entry as a <a href="browsers.html#concept-appcache-master" id="downloading-or-updating-an-application-cache:concept-appcache-master-3">master entry</a>. If applying the <a href="infrastructure.html#url-parser" id="downloading-or-updating-an-application-cache:url-parser">URL parser</a>
      algorithm to the resource's <a href="infrastructure.html#url" id="downloading-or-updating-an-application-cache:url">URL</a> results in a <a href="infrastructure.html#parsed-url" id="downloading-or-updating-an-application-cache:parsed-url">parsed URL</a> that has a
      non-null <a href="infrastructure.html#concept-url-fragment" id="downloading-or-updating-an-application-cache:concept-url-fragment">fragment</a> component, the <a href="infrastructure.html#url" id="downloading-or-updating-an-application-cache:url-2">URL</a>
      used for the entry in <var>cache</var> must instead be the <a href="infrastructure.html#absolute-url" id="downloading-or-updating-an-application-cache:absolute-url-5">absolute URL</a>
      obtained from applying the <a href="infrastructure.html#concept-url-serialiser" id="downloading-or-updating-an-application-cache:concept-url-serialiser">URL serialiser</a>
      algorithm to the <a href="infrastructure.html#parsed-url" id="downloading-or-updating-an-application-cache:parsed-url-2">parsed URL</a> with the <i>exclude fragment flag</i> set
      (application caches never include fragment identifiers).</p>

     </li><li><p>For each <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-12">cache host</a> associated with an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-10">application cache</a> in
     <var>cache group</var>, create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-8">task</a> to <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-8">fire
     a simple event</a> that is cancelable named <code id="downloading-or-updating-an-application-cache:event-appcache-noupdate"><a href="browsers.html#event-appcache-noupdate">noupdate</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-8"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton
     of the <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-13">cache host</a>, and append it to <var>task list</var>. The default
     action of these events must be, if the user agent <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-8">shows caching progress</a>, the
     display of some sort of user interface indicating to the user that the application is up to
     date.</p></li><li><p>Empty <var>cache group</var>'s <a href="browsers.html#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-4">list of pending master entries</a>.</p></li><li><p>If appropriate, remove any user interface indicating that an update for this cache is in
     progress.</p></li><li><p>Let the <a href="browsers.html#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-6">status</a> of <var>cache
     group</var> be <i>idle</i>.</p></li><li><p>For each <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-9">task</a> in <var>task list</var>, <a href="browsers.html#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-6">queue that task as a post-load task</a>.</p></li><li><p>Abort the <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-7">application cache download process</a>.</p></li></ol>

   </li><li><p>Let <var>new cache</var> be a newly created <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-11">application cache</a> in
   <var>cache group</var>. Set its <a href="browsers.html#concept-appcache-completeness" id="downloading-or-updating-an-application-cache:concept-appcache-completeness-2">completeness
   flag</a> to <i>incomplete</i>.</p></li><li><p>For each entry in <var>cache group</var>'s <a href="browsers.html#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-5">list of pending master entries</a>, associate the
   <code id="downloading-or-updating-an-application-cache:document-6"><a href="dom.html#document">Document</a></code> for this entry with <var>new cache</var>.</p></li><li><p>Set the <a href="browsers.html#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-7">status</a> of <var>cache
   group</var> to <i>downloading</i>.</p></li><li><p>For each <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-14">cache host</a> associated with an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-12">application cache</a> in <var>cache group</var>, <a href="browsers.html#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-7">queue a post-load task</a> to <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-9">fire a simple
   event</a> that is cancelable named <code id="downloading-or-updating-an-application-cache:event-appcache-downloading-2"><a href="browsers.html#event-appcache-downloading">downloading</a></code>
   at the <code id="downloading-or-updating-an-application-cache:applicationcache-9"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of the <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-15">cache host</a>. The default action
   of these events must be, if the user agent <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-9">shows caching progress</a>, the display of
   some sort of user interface indicating to the user that a new version is being
   downloaded.</p></li><li><p>Let <var>file list</var> be an empty list of URLs with flags.</p></li><li><p>Add all the URLs in the list of <a href="browsers.html#concept-appcache-explicit" id="downloading-or-updating-an-application-cache:concept-appcache-explicit-2">explicit
   entries</a> obtained by parsing <var>manifest</var> to <var>file list</var>,
   each flagged with "explicit entry".</p></li><li><p>Add all the URLs in the list of <a href="browsers.html#concept-appcache-fallback" id="downloading-or-updating-an-application-cache:concept-appcache-fallback-2">fallback
   entries</a> obtained by parsing <var>manifest</var> to <var>file list</var>,
   each flagged with "fallback entry".</p></li><li><p>If this is an <a href="browsers.html#concept-appcache-upgrade" id="downloading-or-updating-an-application-cache:concept-appcache-upgrade-2">upgrade attempt</a>, then add all
   the URLs of <a href="browsers.html#concept-appcache-master" id="downloading-or-updating-an-application-cache:concept-appcache-master-4">master entries</a> in the <a href="browsers.html#concept-appcache-newer" id="downloading-or-updating-an-application-cache:concept-appcache-newer-3">newest</a> <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-13">application cache</a> in <var>cache group</var> whose <a href="browsers.html#concept-appcache-completeness" id="downloading-or-updating-an-application-cache:concept-appcache-completeness-3">completeness
   flag</a> is <i>complete</i> to <var>file list</var>, each flagged with "master
   entry".</p></li><li><p>If any URL is in <var>file list</var> more than once, then merge the entries into
   one entry for that URL, that entry having all the flags that the original entries had.</p></li><li>

    <p>For each URL in <var>file list</var>, run the following steps. These steps may be
    run in parallel for two or more of the URLs at a time. If, while running these steps, the
    <code id="downloading-or-updating-an-application-cache:applicationcache-10"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <code id="downloading-or-updating-an-application-cache:dom-appcache-abort"><a href="browsers.html#dom-appcache-abort">abort()</a></code> method
    <a href="browsers.html#send-a-signal" id="downloading-or-updating-an-application-cache:send-a-signal">sends a signal</a> to this instance of the <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-8">application
    cache download process</a> algorithm, then run the <a href="browsers.html#cache-failure-steps" id="downloading-or-updating-an-application-cache:cache-failure-steps-2">cache failure steps</a>
    instead.</p>

    <ol><li>

      <p>If the resource URL being processed was flagged as neither an "explicit entry" nor or a
      "fallback entry", then the user agent may skip this URL.</p>

      <p class="note">This is intended to allow user agents to expire resources not listed in the
      manifest from the cache. Generally, implementors are urged to use an approach that expires
      lesser-used resources first.</p>

     </li><li><p>For each <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-16">cache host</a> associated with an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-14">application cache</a> in
     <var>cache group</var>, <a href="browsers.html#queue-a-progress-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-progress-post-load-task">queue a progress post-load task</a> to <a href="infrastructure.html#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire">fire</a> a <a href="infrastructure.html#concept-events-trusted" id="downloading-or-updating-an-application-cache:concept-events-trusted">trusted</a>
     event with the name <code id="downloading-or-updating-an-application-cache:event-appcache-progress"><a href="browsers.html#event-appcache-progress">progress</a></code>, which does not
     bubble, which is cancelable, and which uses the <code id="downloading-or-updating-an-application-cache:progressevent"><a href="infrastructure.html#progressevent">ProgressEvent</a></code> interface, at the
     <code id="downloading-or-updating-an-application-cache:applicationcache-11"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of the <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-17">cache host</a>. The <code id="downloading-or-updating-an-application-cache:dom-progressevent-lengthcomputable"><a href="infrastructure.html#dom-progressevent-lengthcomputable">lengthComputable</a></code> attribute must be set to
     true, the <code id="downloading-or-updating-an-application-cache:dom-progressevent-total"><a href="infrastructure.html#dom-progressevent-total">total</a></code> attribute must be set to the
     number of files in <var>file list</var>, and the <code id="downloading-or-updating-an-application-cache:dom-progressevent-loaded"><a href="infrastructure.html#dom-progressevent-loaded">loaded</a></code> attribute must be set to the number of files in
     <var>file list</var> that have been either downloaded or skipped so far. The default
     action of these events must be, if the user agent <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-10">shows caching progress</a>, the
     display of some sort of user interface indicating to the user that a file is being downloaded
     in preparation for updating the application. <a href="references.html#refsXHR">[XHR]</a></p></li><li>

      <p><a href="infrastructure.html#fetch" id="downloading-or-updating-an-application-cache:fetch-2">Fetch</a> the resource, from the <a href="browsers.html#origin-2" id="downloading-or-updating-an-application-cache:origin-2">origin</a> of the
      <a href="infrastructure.html#url" id="downloading-or-updating-an-application-cache:url-3">URL</a> <var>manifest URL</var>, with the <i>blocking flag</i> set and
      the <i>manual redirect flag</i> set. If this is an <a href="browsers.html#concept-appcache-upgrade" id="downloading-or-updating-an-application-cache:concept-appcache-upgrade-3">upgrade attempt</a>, then use the <a href="browsers.html#concept-appcache-newer" id="downloading-or-updating-an-application-cache:concept-appcache-newer-4">newest</a> <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-15">application cache</a> in <var>cache group</var> as an HTTP cache, and honor HTTP caching semantics (such as
      expiration, ETags, and so forth) with respect to that cache. User agents may also have other
      caches in place that are also honored. The <i>override referrer source</i> must be null.</p> 

      <p class="note">If the resource in question is already being downloaded for other reasons then
      the existing download process can sometimes be used for the purposes of this step, as defined
      by the <a href="infrastructure.html#fetch" id="downloading-or-updating-an-application-cache:fetch-3">fetching</a> algorithm.</p>

      <p class="example">An example of a resource that might already be being downloaded is a large
      image on a Web page that is being seen for the first time. The image would get downloaded to
      satisfy the <code id="downloading-or-updating-an-application-cache:the-img-element"><a href="semantics.html#the-img-element">img</a></code> element on the page, as well as being listed in the cache
      manifest. According to the rules for <a href="infrastructure.html#fetch" id="downloading-or-updating-an-application-cache:fetch-4">fetching</a> that image only need
      be downloaded once, and it can be used both for the cache and for the rendered Web page.</p>

     </li><li>

      <p>If the previous step fails (e.g. the server returns a 4xx or 5xx response <a href="infrastructure.html#concept-http-equivalent-codes" id="downloading-or-updating-an-application-cache:concept-http-equivalent-codes-5">or equivalent</a>, or there is a DNS error, or the
      connection times out, or the user cancels the download), or if the server returned a redirect,
      or if the resource is labeled with the "no-store" cache directive, then run the first
      appropriate step from the following list: <a href="references.html#refsHTTP">[HTTP]</a></p>

      <dl class="switch"><dt>If the URL being processed was flagged as an "explicit entry" or a "fallback entry"</dt><dd>

        <p>If these steps are being run in parallel for any other URLs in <var>file
        list</var>, then abort these steps for those other URLs. Run the <a href="browsers.html#cache-failure-steps" id="downloading-or-updating-an-application-cache:cache-failure-steps-3">cache failure
        steps</a>.</p>

        <p class="note">Redirects are fatal because they are either indicative of a network problem
        (e.g. a captive portal); or would allow resources to be added to the cache under URLs that
        differ from any URL that the networking model will allow access to, leaving orphan entries;
        or would allow resources to be stored under URLs different than their true URLs. All of
        these situations are bad.</p>

       </dd><dt>If the error was a 404 or 410 HTTP response <a href="infrastructure.html#concept-http-equivalent-codes" id="downloading-or-updating-an-application-cache:concept-http-equivalent-codes-6">or equivalent</a></dt><dt>If the resource was labeled with the "no-store" cache directive</dt><dd>

        <p>Skip this resource. It is dropped from the cache.</p>

       </dd><dt>Otherwise</dt><dd>

        <p>Copy the resource and its metadata from the <a href="browsers.html#concept-appcache-newer" id="downloading-or-updating-an-application-cache:concept-appcache-newer-5">newest</a> <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-16">application cache</a> in <var>cache group</var> whose <a href="browsers.html#concept-appcache-completeness" id="downloading-or-updating-an-application-cache:concept-appcache-completeness-4">completeness
        flag</a> is <i>complete</i>, and act as if that was the fetched resource, ignoring the
        resource obtained from the network.</p>

       </dd></dl>

      <p>User agents may warn the user of these errors as an aid to development.</p>

      <p class="note">These rules make errors for resources listed in the manifest fatal, while
      making it possible for other resources to be removed from caches when they are removed from
      the server, without errors, and making non-manifest resources survive server-side errors.</p>

      <p class="note">Except for the "no-store" directive, HTTP caching rules that would cause a
      file to be expired or otherwise not cached are ignored for the purposes of the
      <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-9">application cache download process</a>.</p>

     </li><li>

      <p>Otherwise, the fetching succeeded. Store the resource in the <var>new
      cache</var>.</p>

      <p>If the user agent is not able to store the resource (e.g. because of quota restrictions),
      the user agent may prompt the user or try to resolve the problem in some other manner (e.g.
      automatically pruning content in other caches). If the problem cannot be resolved, the user
      agent must run the <a href="browsers.html#cache-failure-steps" id="downloading-or-updating-an-application-cache:cache-failure-steps-4">cache failure steps</a>.</p>

     </li><li><p>If the URL being processed was flagged as an "explicit entry" in <var>file
     list</var>, then categorise the entry as an <a href="browsers.html#concept-appcache-explicit" id="downloading-or-updating-an-application-cache:concept-appcache-explicit-3">explicit
     entry</a>.</p></li><li><p>If the URL being processed was flagged as a "fallback entry" in <var>file
     list</var>, then categorise the entry as a <a href="browsers.html#concept-appcache-fallback" id="downloading-or-updating-an-application-cache:concept-appcache-fallback-3">fallback
     entry</a>.</p></li><li><p>If the URL being processed was flagged as an "master entry" in <var>file
     list</var>, then categorise the entry as a <a href="browsers.html#concept-appcache-master" id="downloading-or-updating-an-application-cache:concept-appcache-master-5">master
     entry</a>.</p></li><li><p>As an optimization, if the resource is an HTML or XML file whose root element is an
     <code id="downloading-or-updating-an-application-cache:the-html-element"><a href="semantics.html#the-html-element">html</a></code> element with a <code id="downloading-or-updating-an-application-cache:attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute
     whose value doesn't match the manifest URL of the application cache being processed, then the
     user agent should mark the entry as being <a href="browsers.html#concept-appcache-foreign" id="downloading-or-updating-an-application-cache:concept-appcache-foreign">foreign</a>.</p>

    </li></ol>

   </li><li><p>For each <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-18">cache host</a> associated with an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-17">application cache</a> in <var>cache group</var>, <a href="browsers.html#queue-a-progress-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-progress-post-load-task-2">queue a progress post-load task</a> to <a href="infrastructure.html#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-2">fire</a> a <a href="infrastructure.html#concept-events-trusted" id="downloading-or-updating-an-application-cache:concept-events-trusted-2">trusted</a>
   event with the name <code id="downloading-or-updating-an-application-cache:event-appcache-progress-2"><a href="browsers.html#event-appcache-progress">progress</a></code>, which does not bubble,
   which is cancelable, and which uses the <code id="downloading-or-updating-an-application-cache:progressevent-2"><a href="infrastructure.html#progressevent">ProgressEvent</a></code> interface, at the
   <code id="downloading-or-updating-an-application-cache:applicationcache-12"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of the <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-19">cache host</a>. The <code id="downloading-or-updating-an-application-cache:dom-progressevent-lengthcomputable-2"><a href="infrastructure.html#dom-progressevent-lengthcomputable">lengthComputable</a></code> attribute must be set to
   true, the <code id="downloading-or-updating-an-application-cache:dom-progressevent-total-2"><a href="infrastructure.html#dom-progressevent-total">total</a></code> and the <code id="downloading-or-updating-an-application-cache:dom-progressevent-loaded-2"><a href="infrastructure.html#dom-progressevent-loaded">loaded</a></code> attributes must be set to the number of files in
   <var>file list</var>. The default action of these events must be, if the user agent
   <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-11">shows caching progress</a>, the display of some sort of user interface indicating to the
   user that all the files have been downloaded. <a href="references.html#refsXHR">[XHR]</a></p></li><li><p>Store the list of <a href="browsers.html#concept-appcache-fallback-ns" id="downloading-or-updating-an-application-cache:concept-appcache-fallback-ns-2">fallback namespaces</a>,
   and the URLs of the <a href="browsers.html#concept-appcache-fallback" id="downloading-or-updating-an-application-cache:concept-appcache-fallback-4">fallback entries</a> that they map
   to, in <var>new cache</var>.</p></li><li><p>Store the URLs that form the new <a href="browsers.html#concept-appcache-onlinewhitelist" id="downloading-or-updating-an-application-cache:concept-appcache-onlinewhitelist-2">online
   whitelist</a> in <var>new cache</var>.</p></li><li><p>Store the value of the new <a href="browsers.html#concept-appcache-onlinewhitelist-wildcard" id="downloading-or-updating-an-application-cache:concept-appcache-onlinewhitelist-wildcard-2">online
   whitelist wildcard flag</a> in <var>new cache</var>.</p></li><li><p>Store the value of the new <a href="browsers.html#concept-appcache-mode" id="downloading-or-updating-an-application-cache:concept-appcache-mode-2">cache mode flag</a> in
   <var>new cache</var>.</p></li><li>

    <p>For each entry in <var>cache group</var>'s <a href="browsers.html#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-6">list of pending master entries</a>, wait for the
    resource for this entry to have either completely downloaded or failed.</p>

    <p>If the download failed (e.g. the server returns a 4xx or 5xx response <a href="infrastructure.html#concept-http-equivalent-codes" id="downloading-or-updating-an-application-cache:concept-http-equivalent-codes-7">or equivalent</a>, or there is a DNS error, the
    connection times out, or the user cancels the download), or if the resource is labeled with the
    "no-store" cache directive, then run these substeps:</p>

    <ol><li><p>Unassociate the <code id="downloading-or-updating-an-application-cache:document-7"><a href="dom.html#document">Document</a></code> for this entry from <var>new
     cache</var>.</p></li><li><p><a href="browsers.html#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-8">Queue a post-load task</a> to <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-10">fire a simple event</a> that is
     cancelable named <code id="downloading-or-updating-an-application-cache:event-appcache-error-3"><a href="browsers.html#event-appcache-error">error</a></code> at the
     <code id="downloading-or-updating-an-application-cache:applicationcache-13"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of the <code id="downloading-or-updating-an-application-cache:document-8"><a href="dom.html#document">Document</a></code> for this entry, if there
     still is one. The default action of this event must be, if the user agent <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-12">shows caching
     progress</a>, the display of some sort of user interface indicating to the user that the
     user agent failed to save the application for offline use.</p>

     </li><li>

      <p>If this is a <a href="browsers.html#concept-appcache-cache" id="downloading-or-updating-an-application-cache:concept-appcache-cache-2">cache attempt</a> and this entry is
      the last entry in <var>cache group</var>'s <a href="browsers.html#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-7">list of pending master entries</a>, then run these
      further substeps:</p>

      <ol><li><p>Discard <var>cache group</var> and its only <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-18">application cache</a>,
       <var>new cache</var>.</p>

       </li><li><p>If appropriate, remove any user interface indicating that an update for this cache is
       in progress.</p></li><li><p>Abort the <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-10">application cache download process</a>.</p></li></ol>

     </li><li><p>Otherwise, remove this entry from <var>cache group</var>'s <a href="browsers.html#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-8">list of pending master entries</a>.</p></li></ol>

    <p>Otherwise, store the resource for this entry in <var>new cache</var>, if it isn't
    already there, and categorise its entry as a <a href="browsers.html#concept-appcache-master" id="downloading-or-updating-an-application-cache:concept-appcache-master-6">master
    entry</a>.</p>

   </li><li>

    <p><a href="infrastructure.html#fetch" id="downloading-or-updating-an-application-cache:fetch-5">Fetch</a> the resource from <var>manifest URL</var> again, with
    the <i>blocking flag</i> set, and let <var>second manifest</var> be that resource.
    HTTP caching semantics should again be honored for this request. The <i>override referrer source</i> must be null.</p> 

    <p class="note">Since caching can be honored, authors are encouraged to avoid setting the cache
    headers on the manifest in such a way that the user agent would simply not contact the network
    for this second request; otherwise, the user agent would not notice if the cache had changed
    during the cache update process.</p>

   </li><li>

    <p>If the previous step failed for any reason, or if the fetching attempt involved a redirect,
    or if <var>second manifest</var> and <var>manifest</var> are not byte-for-byte
    identical, then schedule a rerun of the entire algorithm with the same parameters after a short
    delay, and run the <a href="browsers.html#cache-failure-steps" id="downloading-or-updating-an-application-cache:cache-failure-steps-5">cache failure steps</a>.</p>

   </li><li>

    <p>Otherwise, store <var>manifest</var> in <var>new cache</var>, if it's not
    there already, and categorise its entry as <a href="browsers.html#concept-appcache-manifest" id="downloading-or-updating-an-application-cache:concept-appcache-manifest-4">the
    manifest</a>.</p>

   </li><li><p>Set the <a href="browsers.html#concept-appcache-completeness" id="downloading-or-updating-an-application-cache:concept-appcache-completeness-5">completeness flag</a> of <var>new cache</var> to <i>complete</i>.</p></li><li><p>Let <var>task list</var> be an empty list of <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-10">tasks</a>.</p>

   </li><li>

    <p>If this is a <a href="browsers.html#concept-appcache-cache" id="downloading-or-updating-an-application-cache:concept-appcache-cache-3">cache attempt</a>, then for each
    <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-20">cache host</a> associated with an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-19">application cache</a> in <var>cache
    group</var>, create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-11">task</a> to <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-11">fire a simple event</a>
    that is cancelable named <code id="downloading-or-updating-an-application-cache:event-appcache-cached"><a href="browsers.html#event-appcache-cached">cached</a></code> at the
    <code id="downloading-or-updating-an-application-cache:applicationcache-14"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of the <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-21">cache host</a>, and append it to <var>task list</var>. The default action of these events must be, if the user agent
    <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-13">shows caching progress</a>, the display of some sort of user interface indicating to
    the user that the application has been cached and that they can now use it offline.</p>

    <p>Otherwise, it is an <a href="browsers.html#concept-appcache-upgrade" id="downloading-or-updating-an-application-cache:concept-appcache-upgrade-4">upgrade attempt</a>. For each
    <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-22">cache host</a> associated with an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-20">application cache</a> in <var>cache
    group</var>, create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-12">task</a> to <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-12">fire a simple event</a>
    that is cancelable named <code id="downloading-or-updating-an-application-cache:event-appcache-updateready"><a href="browsers.html#event-appcache-updateready">updateready</a></code> at the
    <code id="downloading-or-updating-an-application-cache:applicationcache-15"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of the <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-23">cache host</a>, and append it to <var>task list</var>. The default action of these events must be, if the user agent
    <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-14">shows caching progress</a>, the display of some sort of user interface indicating to
    the user that a new version is available and that they can activate it by reloading the
    page.</p>

   </li><li><p>If appropriate, remove any user interface indicating that an update for this cache is in
   progress.</p></li><li><p>Set the <a href="browsers.html#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-8">update status</a> of <var>cache
   group</var> to <i>idle</i>.</p></li><li><p>For each <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-13">task</a> in <var>task list</var>, <a href="browsers.html#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-9">queue that task as a post-load task</a>.</p></li></ol>

  <p>The <dfn id="cache-failure-steps">cache failure steps</dfn> are as follows:</p>

  <ol><li><p>Let <var>task list</var> be an empty list of <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-14">tasks</a>.</p>

   </li><li>

    <p>For each entry in <var>cache group</var>'s <a href="browsers.html#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-9">list of pending master entries</a>, run the
    following further substeps. These steps may be run in parallel for two or more entries at a
    time.</p>

    <ol><li><p>Wait for the resource for this entry to have either completely downloaded or failed.</p>

     </li><li><p>Unassociate the <code id="downloading-or-updating-an-application-cache:document-9"><a href="dom.html#document">Document</a></code> for this entry from its <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-21">application
     cache</a>, if it has one.</p></li><li><p>Create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-15">task</a> to <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-13">fire a simple event</a> that
     is cancelable named <code id="downloading-or-updating-an-application-cache:event-appcache-error-4"><a href="browsers.html#event-appcache-error">error</a></code> at the
     <code id="downloading-or-updating-an-application-cache:applicationcache-16"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of the <code id="downloading-or-updating-an-application-cache:document-10"><a href="dom.html#document">Document</a></code> for this entry, if there
     still is one, and append it to <var>task list</var>. The default action of these
     events must be, if the user agent <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-15">shows caching progress</a>, the display of some sort
     of user interface indicating to the user that the user agent failed to save the application for
     offline use.</p>

    </li></ol>

   </li><li><p>For each <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-24">cache host</a> still associated with an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-22">application cache</a>
   in <var>cache group</var>, create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-16">task</a> to <a href="webappapis.html#fire-a-simple-event" id="downloading-or-updating-an-application-cache:fire-a-simple-event-14">fire
   a simple event</a> that is cancelable named <code id="downloading-or-updating-an-application-cache:event-appcache-error-5"><a href="browsers.html#event-appcache-error">error</a></code> at
   the <code id="downloading-or-updating-an-application-cache:applicationcache-17"><a href="browsers.html#applicationcache">ApplicationCache</a></code> singleton of the <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-25">cache host</a>, and append it to <var>task list</var>. The default action of these events must be, if the user agent
   <a href="browsers.html#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-16">shows caching progress</a>, the display of some sort of user interface indicating to the
   user that the user agent failed to save the application for offline use.</p></li><li><p>Empty <var>cache group</var>'s <a href="browsers.html#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-10">list of pending master entries</a>.</p></li><li><p>If <var>cache group</var> has an <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-23">application cache</a> whose <a href="browsers.html#concept-appcache-completeness" id="downloading-or-updating-an-application-cache:concept-appcache-completeness-6">completeness flag</a> is <i>incomplete</i>, then discard
   that <a href="browsers.html#application-cache" id="downloading-or-updating-an-application-cache:application-cache-24">application cache</a>.</p>

   </li><li><p>If appropriate, remove any user interface indicating that an update for this cache is in
   progress.</p></li><li><p>Let the <a href="browsers.html#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-9">status</a> of <var>cache
   group</var> be <i>idle</i>.</p></li><li><p>If this was a <a href="browsers.html#concept-appcache-cache" id="downloading-or-updating-an-application-cache:concept-appcache-cache-4">cache attempt</a>, discard <var>cache group</var> altogether.</p>

   </li><li><p>For each <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-17">task</a> in <var>task list</var>, <a href="browsers.html#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-10">queue that task as a post-load task</a>.</p></li><li><p>Abort the <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-11">application cache download process</a>.</p></li></ol>

  <p>Attempts to <a href="infrastructure.html#fetch" id="downloading-or-updating-an-application-cache:fetch-6">fetch</a> resources as part of the <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-12">application cache download
  process</a> may be done with cache-defeating semantics, to avoid problems with stale or
  inconsistent intermediary caches.</p>

  <hr>

  <p>User agents may invoke the <a href="browsers.html#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-13">application cache download process</a>, in the background,
  for any <a href="browsers.html#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-8">application cache group</a>, at any time (with no <a href="browsers.html#cache-host" id="downloading-or-updating-an-application-cache:cache-host-26">cache host</a>). This
  allows user agents to keep caches primed and to update caches even before the user visits a
  site.</p>

  <hr>

  <p>Each <code id="downloading-or-updating-an-application-cache:document-11"><a href="dom.html#document">Document</a></code> has a list of <dfn id="pending-application-cache-download-process-tasks">pending application cache download process
  tasks</dfn> that is used to delay events fired by the algorithm above until the document's <code id="downloading-or-updating-an-application-cache:event-load-2"><a href="index.html#event-load">load</a></code> event has fired. When the <code id="downloading-or-updating-an-application-cache:document-12"><a href="dom.html#document">Document</a></code> is created, the
  list must be empty.</p>

  <p>When the steps above say to <dfn id="queue-a-post-load-task">queue a post-load task</dfn> <var>task</var>, where
  <var>task</var> is a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-18">task</a> that dispatches an event on a
  target <code id="downloading-or-updating-an-application-cache:applicationcache-18"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object <var>target</var>, the user agent must run
  the appropriate steps from the following list:</p>

  <dl><dt>If <var>target</var>'s <a id="downloading-or-updating-an-application-cache:node-document" href="https://dom.spec.whatwg.org/#concept-node-document" data-x-internal="node-document">node document</a> is
   <a href="syntax.html#ready-for-post-load-tasks" id="downloading-or-updating-an-application-cache:ready-for-post-load-tasks">ready for post-load tasks</a></dt><dd><p><a href="webappapis.html#queue-a-task" id="downloading-or-updating-an-application-cache:queue-a-task">Queue</a> the task <var>task</var>.</p></dd><dt>Otherwise</dt><dd><p>Add <var>task</var> to <var>target</var>'s <a id="downloading-or-updating-an-application-cache:node-document-2" href="https://dom.spec.whatwg.org/#concept-node-document" data-x-internal="node-document">node document</a>'s list
   of <a href="browsers.html#pending-application-cache-download-process-tasks" id="downloading-or-updating-an-application-cache:pending-application-cache-download-process-tasks">pending application cache download process tasks</a>.</p></dd></dl>

  <p>When the steps above say to <dfn id="queue-a-progress-post-load-task">queue a progress post-load task</dfn> <var>task</var>, where
  <var>task</var> is a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-19">task</a> that dispatches an event on a
  target <code id="downloading-or-updating-an-application-cache:applicationcache-19"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object <var>target</var>, the user agent must run
  the following steps:</p>

  <ol><li><p>If there is a <var>task</var> in <var>target</var>'s <a id="downloading-or-updating-an-application-cache:node-document-3" href="https://dom.spec.whatwg.org/#concept-node-document" data-x-internal="node-document">node document</a>'s list
   of <a href="browsers.html#pending-application-cache-download-process-tasks" id="downloading-or-updating-an-application-cache:pending-application-cache-download-process-tasks-2">pending application cache download process tasks</a> that is labeled as a
   <i>progress task</i>, then remove that task from the list.</p></li><li><p>Label <var>task</var> as a <i>progress task</i>.</p></li><li><p><a href="browsers.html#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-11">Queue a post-load task</a> <var>task</var>.</p></li></ol>

  <p>The <a href="webappapis.html#task-source" id="downloading-or-updating-an-application-cache:task-source">task source</a> for these <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-20">tasks</a> is the
  <a href="webappapis.html#networking-task-source" id="downloading-or-updating-an-application-cache:networking-task-source">networking task source</a>.</p></section>




  <section><h4 id="the-application-cache-selection-algorithm">6.7.5 The application cache selection algorithm</h4>

  <p>When the <dfn id="concept-appcache-init">application cache selection algorithm</dfn>
  algorithm is invoked with a <code id="the-application-cache-selection-algorithm:document"><a href="dom.html#document">Document</a></code> <var>document</var> and optionally a
  manifest <a href="infrastructure.html#url" id="the-application-cache-selection-algorithm:url">URL</a> <var>manifest URL</var>, the user agent must run the first
  applicable set of steps from the following list:</p>

  <dl class="switch"><dt>If there is a <var>manifest URL</var>, and <var>document</var> was loaded
   from an <a href="browsers.html#application-cache" id="the-application-cache-selection-algorithm:application-cache">application cache</a>, and the URL of the <a href="browsers.html#concept-appcache-manifest" id="the-application-cache-selection-algorithm:concept-appcache-manifest">manifest</a> of that cache's <a href="browsers.html#application-cache-group" id="the-application-cache-selection-algorithm:application-cache-group">application cache
   group</a> is <em>not</em> the same as <var>manifest URL</var></dt><dd>

    <p>Mark the entry for the resource from which <var>document</var> was taken in the
    <a href="browsers.html#application-cache" id="the-application-cache-selection-algorithm:application-cache-2">application cache</a> from which it was loaded as <a href="browsers.html#concept-appcache-foreign" id="the-application-cache-selection-algorithm:concept-appcache-foreign">foreign</a>.</p>

    <p>Restart the current navigation from the top of the <a href="browsers.html#navigate" id="the-application-cache-selection-algorithm:navigate">navigation
    algorithm</a>, undoing any changes that were made as part of the initial load (changes can be
    avoided by ensuring that the step to <a href="browsers.html#update-the-session-history-with-the-new-page" id="the-application-cache-selection-algorithm:update-the-session-history-with-the-new-page">update the session history with the new page</a>
    is only ever completed <em>after</em> this <a href="browsers.html#concept-appcache-init" id="the-application-cache-selection-algorithm:concept-appcache-init">application cache
    selection algorithm</a> is run, though this is not required).</p>

    <p class="note">The navigation will not result in the same resource being loaded, because
    "foreign" entries are never picked during navigation.</p>

    <p>User agents may notify the user of the inconsistency between the cache manifest and the
    document's own metadata, to aid in application development.</p>

   </dd><dt>If <var>document</var> was loaded from an <a href="browsers.html#application-cache" id="the-application-cache-selection-algorithm:application-cache-3">application cache</a>, and that
   <a href="browsers.html#application-cache" id="the-application-cache-selection-algorithm:application-cache-4">application cache</a> still exists (it is not now <a href="browsers.html#concept-appcache-obsolete" id="the-application-cache-selection-algorithm:concept-appcache-obsolete">obsolete</a>)</dt><dd>

    <p>Associate <var>document</var> with the <a href="browsers.html#application-cache" id="the-application-cache-selection-algorithm:application-cache-5">application cache</a> from which it
    was loaded. Invoke, in the background, the <a href="browsers.html#application-cache-download-process" id="the-application-cache-selection-algorithm:application-cache-download-process">application cache download process</a> for
    that <a href="browsers.html#application-cache" id="the-application-cache-selection-algorithm:application-cache-6">application cache</a>'s <a href="browsers.html#application-cache-group" id="the-application-cache-selection-algorithm:application-cache-group-2">application cache group</a>, with <var>document</var> as the <a href="browsers.html#cache-host" id="the-application-cache-selection-algorithm:cache-host">cache host</a>.</p>

   </dd><dt>If <var>document</var>  was loaded using HTTP GET <a href="infrastructure.html#concept-http-equivalent-get" id="the-application-cache-selection-algorithm:concept-http-equivalent-get">or
   equivalent</a>, and, there is a <var>manifest URL</var>, and <var>manifest
   URL</var> has the <a href="browsers.html#same-origin" id="the-application-cache-selection-algorithm:same-origin">same origin</a> as <var>document</var></dt><dd>

    <p>Invoke, in the background, the <a href="browsers.html#application-cache-download-process" id="the-application-cache-selection-algorithm:application-cache-download-process-2">application cache download process</a> for <var>manifest URL</var>, with <var>document</var> as the <a href="browsers.html#cache-host" id="the-application-cache-selection-algorithm:cache-host-2">cache host</a>
    and with the resource from which <var>document</var> was parsed as the <a href="browsers.html#concept-appcache-master" id="the-application-cache-selection-algorithm:concept-appcache-master">master</a> resource.</p>

    <p>If there are <a href="browsers.html#relevant-application-cache" id="the-application-cache-selection-algorithm:relevant-application-cache">relevant application caches</a> that
    are identified by a URL with the <a href="browsers.html#same-origin" id="the-application-cache-selection-algorithm:same-origin-2">same origin</a> as the URL of <var>document</var>, and that have this URL as one of their entries, excluding entries
    marked as <a href="browsers.html#concept-appcache-foreign" id="the-application-cache-selection-algorithm:concept-appcache-foreign-2">foreign</a>, then the user agent should use
    the <a href="browsers.html#concept-appcache-selection" id="the-application-cache-selection-algorithm:concept-appcache-selection">most appropriate application cache</a> of those
    that match as an HTTP cache for any subresource loads. User agents may also have other caches in
    place that are also honored.</p>

   </dd><dt>Otherwise</dt><dd>

    <p>The <code id="the-application-cache-selection-algorithm:document-2"><a href="dom.html#document">Document</a></code> is not associated with any <a href="browsers.html#application-cache" id="the-application-cache-selection-algorithm:application-cache-7">application cache</a>.</p>

    <p>If there was a <var>manifest URL</var>, the user agent may report to the user that
    it was ignored, to aid in application development.</p>

   </dd></dl></section>



  <section><h4 id="changesToNetworkingModel">6.7.6 Changes to the networking model</h4>

  <p>When a <a href="browsers.html#cache-host" id="changesToNetworkingModel:cache-host">cache host</a> is associated with an <a href="browsers.html#application-cache" id="changesToNetworkingModel:application-cache">application cache</a> whose <a href="browsers.html#concept-appcache-completeness" id="changesToNetworkingModel:concept-appcache-completeness">completeness flag</a> is <i>complete</i>, any and all
  loads for resources related to that <a href="browsers.html#cache-host" id="changesToNetworkingModel:cache-host-2">cache host</a> other than those for <a href="browsers.html#child-browsing-context" id="changesToNetworkingModel:child-browsing-context">child browsing contexts</a> must go through the following steps
  instead of immediately invoking the mechanisms appropriate to that resource's scheme:</p>

  <ol><li><p>If the resource is not to be fetched using the HTTP GET mechanism <a href="infrastructure.html#concept-http-equivalent-get" id="changesToNetworkingModel:concept-http-equivalent-get">or equivalent</a>, or if applying the <a href="infrastructure.html#url-parser" id="changesToNetworkingModel:url-parser">URL
   parser</a> algorithm to both its <a href="infrastructure.html#url" id="changesToNetworkingModel:url">URL</a> and the <a href="browsers.html#application-cache" id="changesToNetworkingModel:application-cache-2">application cache</a>'s
   <a href="browsers.html#concept-appcache-manifest" id="changesToNetworkingModel:concept-appcache-manifest">manifest</a>'s URL results in two <a href="infrastructure.html#parsed-url" id="changesToNetworkingModel:parsed-url">parsed URLs</a> with different <a href="infrastructure.html#concept-url-scheme" id="changesToNetworkingModel:concept-url-scheme">scheme</a> components,
   then <a href="infrastructure.html#fetch" id="changesToNetworkingModel:fetch">fetch</a> the resource normally and abort these steps.</p></li><li><p>If the resource's URL is <a href="browsers.html#concept-appcache-master" id="changesToNetworkingModel:concept-appcache-master">a master entry</a>,
   <a href="browsers.html#concept-appcache-manifest" id="changesToNetworkingModel:concept-appcache-manifest-2">the manifest</a>, <a href="browsers.html#concept-appcache-explicit" id="changesToNetworkingModel:concept-appcache-explicit">an explicit entry</a>, or <a href="browsers.html#concept-appcache-fallback" id="changesToNetworkingModel:concept-appcache-fallback">a fallback entry</a> in the <a href="browsers.html#application-cache" id="changesToNetworkingModel:application-cache-3">application cache</a>,
   then get the resource from the cache (instead of fetching it), and abort these steps.</p></li><li><p>If there is an entry in the <a href="browsers.html#application-cache" id="changesToNetworkingModel:application-cache-4">application cache</a>'s <a href="browsers.html#concept-appcache-onlinewhitelist" id="changesToNetworkingModel:concept-appcache-onlinewhitelist">online whitelist</a> that has the <a href="browsers.html#same-origin" id="changesToNetworkingModel:same-origin">same
   origin</a> as the resource's URL and that is a <a href="infrastructure.html#prefix-match" id="changesToNetworkingModel:prefix-match">prefix match</a> for the resource's
   URL, then <a href="infrastructure.html#fetch" id="changesToNetworkingModel:fetch-2">fetch</a> the resource normally and abort these steps.</p></li><li>

    <p>If the resource's URL has the <a href="browsers.html#same-origin" id="changesToNetworkingModel:same-origin-2">same origin</a> as the manifest's URL, and there is a
    <a href="browsers.html#concept-appcache-fallback-ns" id="changesToNetworkingModel:concept-appcache-fallback-ns">fallback namespace</a> <var>f</var> in
    the <a href="browsers.html#application-cache" id="changesToNetworkingModel:application-cache-5">application cache</a> that is a <a href="infrastructure.html#prefix-match" id="changesToNetworkingModel:prefix-match-2">prefix match</a> for the resource's URL,
    then:</p>

    <p><a href="infrastructure.html#fetch" id="changesToNetworkingModel:fetch-3">Fetch</a> the resource normally. If this results in a redirect to a resource with
    another <a href="browsers.html#origin-2" id="changesToNetworkingModel:origin-2">origin</a> (indicative of a captive portal), or a 4xx or 5xx status code <a href="infrastructure.html#concept-http-equivalent-codes" id="changesToNetworkingModel:concept-http-equivalent-codes">or equivalent</a>, or if there were network errors (but
    not if the user canceled the download), then instead get, from the cache, the resource of the
    <a href="browsers.html#concept-appcache-fallback" id="changesToNetworkingModel:concept-appcache-fallback-2">fallback entry</a> corresponding to the <a href="browsers.html#concept-appcache-fallback-ns" id="changesToNetworkingModel:concept-appcache-fallback-ns-2">fallback namespace</a> <var>f</var>. Abort
    these steps.</p>

   </li><li><p>If the <a href="browsers.html#application-cache" id="changesToNetworkingModel:application-cache-6">application cache</a>'s <a href="browsers.html#concept-appcache-onlinewhitelist-wildcard" id="changesToNetworkingModel:concept-appcache-onlinewhitelist-wildcard">online whitelist wildcard flag</a> is <i>open</i>, then <a href="infrastructure.html#fetch" id="changesToNetworkingModel:fetch-4">fetch</a> the resource normally and abort these steps.</p></li><li><p>Fail the resource load as if there had been a generic network error.</p></li></ol>

  <p class="note">The above algorithm ensures that so long as the <a href="browsers.html#concept-appcache-onlinewhitelist-wildcard" id="changesToNetworkingModel:concept-appcache-onlinewhitelist-wildcard-2">online whitelist wildcard flag</a> is <i>blocking</i>, resources that are not present in the <a href="browsers.html#concept-appcache-manifest" id="changesToNetworkingModel:concept-appcache-manifest-3">manifest</a> will always fail to load (at least, after the
  <a href="browsers.html#application-cache" id="changesToNetworkingModel:application-cache-7">application cache</a> has been primed the first time), making the testing of offline
  applications simpler.</p></section>

  


  

  <section><h4 id="expiring-application-caches">6.7.7 Expiring application caches</h4>

  <p>As a general rule, user agents should not expire application caches, except on request from the
  user, or after having been left unused for an extended period of time.</p>

  <p>Application caches and cookies have similar implications with respect to privacy (e.g. if the
  site can identify the user when providing the cache, it can store data in the cache that can be
  used for cookie resurrection). Implementors are therefore encouraged to expose application caches
  in a manner related to HTTP cookies, allowing caches to be expunged together with cookies and
  other origin-specific data.</p>

  <p class="example">For example, a user agent could have a "delete site-specific data" feature that
  clears all cookies, application caches, local storage, databases, etc, from an origin all at
  once.</p></section>

  


  

  <section><h4 id="disk-space">6.7.8 Disk space</h4>

  <p>User agents should consider applying constraints on disk usage of <a href="browsers.html#application-cache" id="disk-space:application-cache">application caches</a>, and care should be taken to ensure that the restrictions cannot
  be easily worked around using subdomains.</p>

  <p>User agents should allow users to see how much space each domain is using, and may offer the
  user the ability to delete specific <a href="browsers.html#application-cache" id="disk-space:application-cache-2">application caches</a>.</p>

  <p>For predictability, quotas should be based on the uncompressed size of data stored.</p>
  

  <p class="note">How quotas are presented to the user is not defined by this specification. User
  agents are encouraged to provide features such as allowing a user to indicate that certain sites
  are trusted to use more than the default quota, e.g. by presenting a non-modal user interface
  while a cache is being updated, or by having an explicit whitelist in the user agent's
  configuration interface.</p></section>

  



  <section><h4 id="security-concerns-with-offline-applications-caches">6.7.9 Security concerns with offline applications caches</h4>

  <p><i>This section is non-normative.</i></p>

  <p>The main risk introduced by offline application caches is that an injection attack can be
  elevated into persistent site-wide page replacement. This attack involves using an injection
  vulnerability to upload two files to the victim site. The first file is an application cache
  manifest consisting of just a fallback entry pointing to the second file, which is an HTML page
  whose manifest is declared as that first file. Once the user has been directed to that second
  file, all subsequent accesses to any file covered by the given fallback namespace while either the
  user or the site is offline will instead show that second file. Targetted denial-of-service
  attacks or cookie bombing attacks (where the client is made to send so many cookies that the
  server refuses to process the request) can be used to ensure that the site appears offline.</p>

  <p>To mitigate this, manifests can only specify fallbacks that are in the same path as the
  manifest itself. This means that a content injection upload vulnerability in a particular
  directory on a server can only be escalated to a take-over of that directory and its
  subdirectories. If there is no way to inject a file into the root directory, the entire site
  cannot be taken over.</p>

  <p>If a site has been attacked in this way, simply removing the offending manifest might eventually
  clear the problem, since the next time the manifest is updated, a 404 error will be seen, and the
  user agent will clear the cache. "Eventually" is the key word here, however; while the attack on
  the user or server is ongoing, such that connections from an affected user to the affected site
  are blocked, the user agent will simply assume that the user is offline and will continue to use
  the hostile manifest. Unfortunately, if a cookie bombing attack has also been used, merely
  removing the manifest is insufficient; in addition, the server has to be configured to return a
  404 or 410 response instead of the 413 "Request Entity Too Large" response.</p>

  <p>TLS does not inherently protect a site from this attack, since the attack relies on content
  being served from the server itself. Not using application caches also does not prevent this
  attack, since the attack relies on an attacker-provided manifest.</p></section>



  <section><h4 id="application-cache-api">6.7.10 Application cache API</h4>

  <pre class="idl">[Exposed=(Window,SharedWorker)]
interface <dfn id="applicationcache">ApplicationCache</dfn> : <a href="infrastructure.html#eventtarget" id="application-cache-api:eventtarget">EventTarget</a> {

  // <a href="browsers.html#concept-appcache-status" id="application-cache-api:concept-appcache-status">update status</a>
  const unsigned short <a href="browsers.html#dom-appcache-uncached" id="application-cache-api:dom-appcache-uncached">UNCACHED</a> = 0;
  const unsigned short <a href="browsers.html#dom-appcache-idle" id="application-cache-api:dom-appcache-idle">IDLE</a> = 1;
  const unsigned short <a href="browsers.html#dom-appcache-checking" id="application-cache-api:dom-appcache-checking">CHECKING</a> = 2;
  const unsigned short <a href="browsers.html#dom-appcache-downloading" id="application-cache-api:dom-appcache-downloading">DOWNLOADING</a> = 3;
  const unsigned short <a href="browsers.html#dom-appcache-updateready" id="application-cache-api:dom-appcache-updateready">UPDATEREADY</a> = 4;
  const unsigned short <a href="browsers.html#dom-appcache-obsolete" id="application-cache-api:dom-appcache-obsolete">OBSOLETE</a> = 5;
  readonly attribute unsigned short <a href="browsers.html#dom-appcache-status" id="application-cache-api:dom-appcache-status">status</a>;

  // updates
  void <a href="browsers.html#dom-appcache-update" id="application-cache-api:dom-appcache-update">update</a>();
  void <a href="browsers.html#dom-appcache-abort" id="application-cache-api:dom-appcache-abort">abort</a>();
  void <a href="browsers.html#dom-appcache-swapcache" id="application-cache-api:dom-appcache-swapcache">swapCache</a>();

  // events
  attribute <a href="webappapis.html#eventhandler" id="application-cache-api:eventhandler">EventHandler</a> <a href="browsers.html#handler-appcache-onchecking" id="application-cache-api:handler-appcache-onchecking">onchecking</a>;
  attribute <a href="webappapis.html#eventhandler" id="application-cache-api:eventhandler-2">EventHandler</a> <a href="browsers.html#handler-appcache-onerror" id="application-cache-api:handler-appcache-onerror">onerror</a>;
  attribute <a href="webappapis.html#eventhandler" id="application-cache-api:eventhandler-3">EventHandler</a> <a href="browsers.html#handler-appcache-onnoupdate" id="application-cache-api:handler-appcache-onnoupdate">onnoupdate</a>;
  attribute <a href="webappapis.html#eventhandler" id="application-cache-api:eventhandler-4">EventHandler</a> <a href="browsers.html#handler-appcache-ondownloading" id="application-cache-api:handler-appcache-ondownloading">ondownloading</a>;
  attribute <a href="webappapis.html#eventhandler" id="application-cache-api:eventhandler-5">EventHandler</a> <a href="browsers.html#handler-appcache-onprogress" id="application-cache-api:handler-appcache-onprogress">onprogress</a>;
  attribute <a href="webappapis.html#eventhandler" id="application-cache-api:eventhandler-6">EventHandler</a> <a href="browsers.html#handler-appcache-onupdateready" id="application-cache-api:handler-appcache-onupdateready">onupdateready</a>;
  attribute <a href="webappapis.html#eventhandler" id="application-cache-api:eventhandler-7">EventHandler</a> <a href="browsers.html#handler-appcache-oncached" id="application-cache-api:handler-appcache-oncached">oncached</a>;
  attribute <a href="webappapis.html#eventhandler" id="application-cache-api:eventhandler-8">EventHandler</a> <a href="browsers.html#handler-appcache-onobsolete" id="application-cache-api:handler-appcache-onobsolete">onobsolete</a>;
};</pre>

  <dl class="domintro"><dt><var>cache</var> = <var>window</var> . <code id="application-cache-api:dom-applicationcache"><a href="browsers.html#dom-applicationcache">applicationCache</a></code></dt><dd>

    <p>(In a window.) Returns the <code id="application-cache-api:applicationcache"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object that applies to the
    <a href="browsers.html#active-document" id="application-cache-api:active-document">active document</a> of that <code id="application-cache-api:window"><a href="browsers.html#window">Window</a></code>.</p>

   </dd><dt><var>cache</var> = <var>self</var> . <code id="application-cache-api:dom-applicationcache-2"><a href="browsers.html#dom-applicationcache">applicationCache</a></code></dt><dd>

    <p>(In a shared worker.) Returns the <code id="application-cache-api:applicationcache-2"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object that applies to the
    current shared worker.</p>

   </dd><dt><var>cache</var> . <code id="application-cache-api:dom-appcache-status-2"><a href="browsers.html#dom-appcache-status">status</a></code></dt><dd>

    <p>Returns the current status of the application cache, as given by the constants defined
    below.</p>

   </dd><dt><var>cache</var> . <code id="application-cache-api:dom-appcache-update-2"><a href="browsers.html#dom-appcache-update">update</a></code>()</dt><dd>

    <p>Invokes the <a href="browsers.html#application-cache-download-process" id="application-cache-api:application-cache-download-process">application cache download process</a>.</p>

    <p>Throws an <code id="application-cache-api:invalidstateerror"><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception if there is no application cache to
    update.</p>

    <p>Calling this method is not usually necessary, as user agents will generally take care of
    updating <a href="browsers.html#application-cache" id="application-cache-api:application-cache">application caches</a> automatically.</p>

    <p>The method can be useful in situations such as long-lived applications. For example, a Web
    mail application might stay open in a browser tab for weeks at a time. Such an application could
    want to test for updates each day.</p>

   </dd><dt><var>cache</var> . <code id="application-cache-api:dom-appcache-abort-2"><a href="browsers.html#dom-appcache-abort">abort</a></code>()</dt><dd>

    <p>Cancels the <a href="browsers.html#application-cache-download-process" id="application-cache-api:application-cache-download-process-2">application cache download process</a>.</p>

    <p>This method is intended to be used by Web application showing their own caching progress UI,
    in case the user wants to stop the update (e.g. because bandwidth is limited).</p>

   </dd><dt><var>cache</var> . <code id="application-cache-api:dom-appcache-swapcache-2"><a href="browsers.html#dom-appcache-swapcache">swapCache</a></code>()</dt><dd>

    <p>Switches to the most recent application cache, if there is a newer one. If there isn't,
    throws an <code id="application-cache-api:invalidstateerror-2"><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception.</p>

    <p>This does not cause previously-loaded resources to be reloaded; for example, images do not
    suddenly get reloaded and style sheets and scripts do not get reparsed or reevaluated. The only
    change is that subsequent requests for cached resources will obtain the newer copies.</p>

    <p>The <code id="application-cache-api:event-appcache-updateready"><a href="browsers.html#event-appcache-updateready">updateready</a></code> event will fire before this
    method can be called. Once it fires, the Web application can, at its leisure, call this method
    to switch the underlying cache to the one with the more recent updates. To make proper use of
    this, applications have to be able to bring the new features into play; for example, reloading
    scripts to enable new features.</p>

    <p>An easier alternative to <code id="application-cache-api:dom-appcache-swapcache-3"><a href="browsers.html#dom-appcache-swapcache">swapCache()</a></code> is just to
    reload the entire page at a time suitable for the user, using <code id="application-cache-api:dom-location-reload"><a href="browsers.html#dom-location-reload">location.reload()</a></code>.</p>

   </dd></dl>

  

  <p>There is a one-to-one mapping from <a href="browsers.html#cache-host" id="application-cache-api:cache-host">cache hosts</a> to
  <code id="application-cache-api:applicationcache-3"><a href="browsers.html#applicationcache">ApplicationCache</a></code> objects. The <dfn id="dom-applicationcache"><code>applicationCache</code></dfn> attribute on <code id="application-cache-api:window-2"><a href="browsers.html#window">Window</a></code>
  objects must return the <code id="application-cache-api:applicationcache-4"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object associated with the
  <code id="application-cache-api:window-3"><a href="browsers.html#window">Window</a></code> object's <a href="browsers.html#active-document" id="application-cache-api:active-document-2">active document</a>. The <dfn id="dom-sharedworkerglobalscope-applicationcache"><code>applicationCache</code></dfn> attribute
  on <code id="application-cache-api:sharedworkerglobalscope"><a href="http://www.w3.org/TR/workers/#sharedworkerglobalscope">SharedWorkerGlobalScope</a></code> objects must return the <code id="application-cache-api:applicationcache-5"><a href="browsers.html#applicationcache">ApplicationCache</a></code>
  object associated with the worker.</p>

  <p class="note">A <code id="application-cache-api:window-4"><a href="browsers.html#window">Window</a></code> or <code id="application-cache-api:sharedworkerglobalscope-2"><a href="http://www.w3.org/TR/workers/#sharedworkerglobalscope">SharedWorkerGlobalScope</a></code> object has an
  associated <code id="application-cache-api:applicationcache-6"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object even if that <a href="browsers.html#cache-host" id="application-cache-api:cache-host-2">cache host</a> has no actual
  <a href="browsers.html#application-cache" id="application-cache-api:application-cache-2">application cache</a>.</p>

  <hr>

  <p>The <dfn id="dom-appcache-status"><code>status</code></dfn> attribute, on getting, must
  return the current state of the <a href="browsers.html#application-cache" id="application-cache-api:application-cache-3">application cache</a> that the
  <code id="application-cache-api:applicationcache-7"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-3">cache host</a> is associated with, if any. This
  must be the appropriate value from the following list:</p>

  

  <dl><dt><dfn id="dom-appcache-uncached"><code>UNCACHED</code></dfn> (numeric value 0)</dt><dd><p>The <code id="application-cache-api:applicationcache-8"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-4">cache host</a> is not associated with
   an <a href="browsers.html#application-cache" id="application-cache-api:application-cache-4">application cache</a> at this time.</p></dd><dt><dfn id="dom-appcache-idle"><code>IDLE</code></dfn> (numeric value 1)</dt><dd><p>The <code id="application-cache-api:applicationcache-9"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-5">cache host</a> is associated with an
   <a href="browsers.html#application-cache" id="application-cache-api:application-cache-5">application cache</a> whose <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group">application cache group</a>'s <a href="browsers.html#concept-appcache-status" id="application-cache-api:concept-appcache-status-2">update status</a> is <i>idle</i>, and that <a href="browsers.html#application-cache" id="application-cache-api:application-cache-6">application
   cache</a> is the <a href="browsers.html#concept-appcache-newer" id="application-cache-api:concept-appcache-newer">newest</a> cache in its
   <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-2">application cache group</a>, and the <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-3">application cache group</a> is not marked
   as <a href="browsers.html#concept-appcache-obsolete" id="application-cache-api:concept-appcache-obsolete">obsolete</a>.</p></dd><dt><dfn id="dom-appcache-checking"><code>CHECKING</code></dfn> (numeric value 2)</dt><dd><p>The <code id="application-cache-api:applicationcache-10"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-6">cache host</a> is associated with an
   <a href="browsers.html#application-cache" id="application-cache-api:application-cache-7">application cache</a> whose <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-4">application cache group</a>'s <a href="browsers.html#concept-appcache-status" id="application-cache-api:concept-appcache-status-3">update status</a> is <i>checking</i>.</p></dd><dt><dfn id="dom-appcache-downloading"><code>DOWNLOADING</code></dfn> (numeric value 3)</dt><dd><p>The <code id="application-cache-api:applicationcache-11"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-7">cache host</a> is associated with an
   <a href="browsers.html#application-cache" id="application-cache-api:application-cache-8">application cache</a> whose <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-5">application cache group</a>'s <a href="browsers.html#concept-appcache-status" id="application-cache-api:concept-appcache-status-4">update status</a> is <i>downloading</i>.</p></dd><dt><dfn id="dom-appcache-updateready"><code>UPDATEREADY</code></dfn> (numeric value 4)</dt><dd><p>The <code id="application-cache-api:applicationcache-12"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-8">cache host</a> is associated with an
   <a href="browsers.html#application-cache" id="application-cache-api:application-cache-9">application cache</a> whose <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-6">application cache group</a>'s <a href="browsers.html#concept-appcache-status" id="application-cache-api:concept-appcache-status-5">update status</a> is <i>idle</i>, and whose <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-7">application
   cache group</a> is not marked as <a href="browsers.html#concept-appcache-obsolete" id="application-cache-api:concept-appcache-obsolete-2">obsolete</a>, but
   that <a href="browsers.html#application-cache" id="application-cache-api:application-cache-10">application cache</a> is <em>not</em> the <a href="browsers.html#concept-appcache-newer" id="application-cache-api:concept-appcache-newer-2">newest</a> cache in its group.</p></dd><dt><dfn id="dom-appcache-obsolete"><code>OBSOLETE</code></dfn> (numeric value 5)</dt><dd><p>The <code id="application-cache-api:applicationcache-13"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-9">cache host</a> is associated with an
   <a href="browsers.html#application-cache" id="application-cache-api:application-cache-11">application cache</a> whose <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-8">application cache group</a> is marked as <a href="browsers.html#concept-appcache-obsolete" id="application-cache-api:concept-appcache-obsolete-3">obsolete</a>.</p></dd></dl>

  

  <hr>

  <p>If the <dfn id="dom-appcache-update"><code>update()</code></dfn> method is invoked, the user
  agent must invoke the <a href="browsers.html#application-cache-download-process" id="application-cache-api:application-cache-download-process-3">application cache download process</a>, in the background, for the
  <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-9">application cache group</a> of the <a href="browsers.html#application-cache" id="application-cache-api:application-cache-12">application cache</a> with which the
  <code id="application-cache-api:applicationcache-14"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-10">cache host</a> is associated, but without giving
  that <a href="browsers.html#cache-host" id="application-cache-api:cache-host-11">cache host</a> to the algorithm. If there is no such <a href="browsers.html#application-cache" id="application-cache-api:application-cache-13">application cache</a>,
  or if its <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-10">application cache group</a> is marked as <a href="browsers.html#concept-appcache-obsolete" id="application-cache-api:concept-appcache-obsolete-4">obsolete</a>, then the method must throw an
  <code id="application-cache-api:invalidstateerror-3"><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception instead.</p>

  <p>If the <dfn id="dom-appcache-abort"><code>abort()</code></dfn> method is invoked, the user
  agent must <dfn id="send-a-signal">send a signal</dfn> to the current <a href="browsers.html#application-cache-download-process" id="application-cache-api:application-cache-download-process-4">application cache download process</a>
  for the <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-11">application cache group</a> of the <a href="browsers.html#application-cache" id="application-cache-api:application-cache-14">application cache</a> with which the
  <code id="application-cache-api:applicationcache-15"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-12">cache host</a> is associated, if any. If there is
  no such <a href="browsers.html#application-cache" id="application-cache-api:application-cache-15">application cache</a>, or it does not have a current <a href="browsers.html#application-cache-download-process" id="application-cache-api:application-cache-download-process-5">application cache
  download process</a>, then do nothing.</p>

  <p>If the <dfn id="dom-appcache-swapcache"><code>swapCache()</code></dfn> method is invoked,
  the user agent must run the following steps:

  </p><ol><li><p>Check that <code id="application-cache-api:applicationcache-16"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-13">cache host</a> is associated
   with an <a href="browsers.html#application-cache" id="application-cache-api:application-cache-16">application cache</a>. If it is not, then throw an
   <code id="application-cache-api:invalidstateerror-4"><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</p></li><li><p>Let <var>cache</var> be the <a href="browsers.html#application-cache" id="application-cache-api:application-cache-17">application cache</a> with which the
   <code id="application-cache-api:applicationcache-17"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-14">cache host</a> is associated. (By definition,
   this is the same as the one that was found in the previous step.)</p></li><li><p>If <var>cache</var>'s <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-12">application cache group</a> is marked as <a href="browsers.html#concept-appcache-obsolete" id="application-cache-api:concept-appcache-obsolete-5">obsolete</a>, then unassociate the
   <code id="application-cache-api:applicationcache-18"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-15">cache host</a> from <var>cache</var> and
   abort these steps. (Resources will now load from the network instead of the cache.)</p></li><li><p>Check that there is an application cache in the same <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-13">application cache group</a>
   as <var>cache</var> whose <a href="browsers.html#concept-appcache-completeness" id="application-cache-api:concept-appcache-completeness">completeness
   flag</a> is <i>complete</i> and that is <a href="browsers.html#concept-appcache-newer" id="application-cache-api:concept-appcache-newer-3">newer</a> than
   <var>cache</var>. If there is not, then throw an <code id="application-cache-api:invalidstateerror-5"><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code>
   exception and abort these steps.</p></li><li><p>Let <var>new cache</var> be the <a href="browsers.html#concept-appcache-newer" id="application-cache-api:concept-appcache-newer-4">newest</a> <a href="browsers.html#application-cache" id="application-cache-api:application-cache-18">application cache</a> in the same
   <a href="browsers.html#application-cache-group" id="application-cache-api:application-cache-group-14">application cache group</a> as <var>cache</var> whose <a href="browsers.html#concept-appcache-completeness" id="application-cache-api:concept-appcache-completeness-2">completeness flag</a> is <i>complete</i>.</p></li><li><p>Unassociate the <code id="application-cache-api:applicationcache-19"><a href="browsers.html#applicationcache">ApplicationCache</a></code> object's <a href="browsers.html#cache-host" id="application-cache-api:cache-host-16">cache host</a> from <var>cache</var> and instead associate it with <var>new cache</var>.</p></li></ol>

  <p>The following are the <a href="webappapis.html#event-handlers" id="application-cache-api:event-handlers">event handlers</a> (and their corresponding <a href="webappapis.html#event-handler-event-type" id="application-cache-api:event-handler-event-type">event handler event types</a>) that must be
  supported, as <a href="webappapis.html#event-handler-idl-attributes" id="application-cache-api:event-handler-idl-attributes">event handler IDL attributes</a>, by all objects implementing the
  <code id="application-cache-api:applicationcache-20"><a href="browsers.html#applicationcache">ApplicationCache</a></code> interface:</p>

  <table><thead><tr><th><a href="webappapis.html#event-handlers" id="application-cache-api:event-handlers-2">Event handler</a> </th><th><a href="webappapis.html#event-handler-event-type" id="application-cache-api:event-handler-event-type-2">Event handler event type</a>
   </th></tr></thead><tbody><tr><td><dfn id="handler-appcache-onchecking"><code>onchecking</code></dfn> </td><td> <code id="application-cache-api:event-appcache-checking"><a href="browsers.html#event-appcache-checking">checking</a></code>
    </td></tr><tr><td><dfn id="handler-appcache-onerror"><code>onerror</code></dfn> </td><td> <code id="application-cache-api:event-appcache-error"><a href="browsers.html#event-appcache-error">error</a></code>
    </td></tr><tr><td><dfn id="handler-appcache-onnoupdate"><code>onnoupdate</code></dfn> </td><td> <code id="application-cache-api:event-appcache-noupdate"><a href="browsers.html#event-appcache-noupdate">noupdate</a></code>
    </td></tr><tr><td><dfn id="handler-appcache-ondownloading"><code>ondownloading</code></dfn> </td><td> <code id="application-cache-api:event-appcache-downloading"><a href="browsers.html#event-appcache-downloading">downloading</a></code>
    </td></tr><tr><td><dfn id="handler-appcache-onprogress"><code>onprogress</code></dfn> </td><td> <code id="application-cache-api:event-appcache-progress"><a href="browsers.html#event-appcache-progress">progress</a></code>
    </td></tr><tr><td><dfn id="handler-appcache-onupdateready"><code>onupdateready</code></dfn> </td><td> <code id="application-cache-api:event-appcache-updateready-2"><a href="browsers.html#event-appcache-updateready">updateready</a></code>
    </td></tr><tr><td><dfn id="handler-appcache-oncached"><code>oncached</code></dfn> </td><td> <code id="application-cache-api:event-appcache-cached"><a href="browsers.html#event-appcache-cached">cached</a></code>
    </td></tr><tr><td><dfn id="handler-appcache-onobsolete"><code>onobsolete</code></dfn> </td><td> <code id="application-cache-api:event-appcache-obsolete"><a href="browsers.html#event-appcache-obsolete">obsolete</a></code>
  </td></tr></tbody></table></section>

  


  <section><h4 id="navigator.online">6.7.11 <span id="browser-state">Browser state</span></h4>

  <pre class="idl">[NoInterfaceObject, Exposed=(Window,Worker)]
interface <dfn id="navigatoronline">NavigatorOnLine</dfn> {
  readonly attribute boolean <a href="browsers.html#dom-navigator-online" id="navigator.online:dom-navigator-online">onLine</a>;
};</pre>

  <dl class="domintro"><dt><var>window</var> . <code id="navigator.online:dom-navigator"><a href="webappapis.html#dom-navigator">navigator</a></code> . <code id="navigator.online:dom-navigator-online-2"><a href="browsers.html#dom-navigator-online">onLine</a></code></dt><dd>

    <p>Returns false if the user agent is definitely offline (disconnected from the network).
    Returns true if the user agent might be online.</p>

    <p>The events <code id="navigator.online:event-online"><a href="index.html#event-online">online</a></code> and <code id="navigator.online:event-offline"><a href="index.html#event-offline">offline</a></code> are fired when the value of this attribute changes.</p>

   </dd></dl>

  

  <p>The <dfn id="dom-navigator-online"><code>navigator.onLine</code></dfn> attribute must return
  false if the user agent will not contact the network when the user follows links or when a script
  requests a remote page (or knows that such an attempt would fail), and must return true
  otherwise.</p>

  <p>When the value that would be returned by the <code id="navigator.online:dom-navigator-online-3"><a href="browsers.html#dom-navigator-online">navigator.onLine</a></code> attribute of a <code id="navigator.online:window"><a href="browsers.html#window">Window</a></code> or
  <code id="navigator.online:workerglobalscope"><a href="http://www.w3.org/TR/workers/#workerglobalscope">WorkerGlobalScope</a></code> changes from true to false, the user agent must <a href="webappapis.html#queue-a-task" id="navigator.online:queue-a-task">queue a
  task</a> to <a href="webappapis.html#fire-a-simple-event" id="navigator.online:fire-a-simple-event">fire a simple event</a> named <code id="navigator.online:event-offline-2"><a href="index.html#event-offline">offline</a></code>
  at the <code id="navigator.online:window-2"><a href="browsers.html#window">Window</a></code> or <code id="navigator.online:workerglobalscope-2"><a href="http://www.w3.org/TR/workers/#workerglobalscope">WorkerGlobalScope</a></code> object.</p>

  <p>On the other hand, when the value that would be returned by the <code id="navigator.online:dom-navigator-online-4"><a href="browsers.html#dom-navigator-online">navigator.onLine</a></code> attribute of a <code id="navigator.online:window-3"><a href="browsers.html#window">Window</a></code> or
  <code id="navigator.online:workerglobalscope-3"><a href="http://www.w3.org/TR/workers/#workerglobalscope">WorkerGlobalScope</a></code> changes from false to true, the user agent must <a href="webappapis.html#queue-a-task" id="navigator.online:queue-a-task-2">queue a
  task</a> to <a href="webappapis.html#fire-a-simple-event" id="navigator.online:fire-a-simple-event-2">fire a simple event</a> named <code id="navigator.online:event-online-2"><a href="index.html#event-online">online</a></code> at
  the <code id="navigator.online:window-4"><a href="browsers.html#window">Window</a></code> or <code id="navigator.online:workerglobalscope-4"><a href="http://www.w3.org/TR/workers/#workerglobalscope">WorkerGlobalScope</a></code> object.</p>

  <p>The <a href="webappapis.html#task-source" id="navigator.online:task-source">task source</a> for these <a href="webappapis.html#concept-task" id="navigator.online:concept-task">tasks</a> is the
  <a href="webappapis.html#networking-task-source" id="navigator.online:networking-task-source">networking task source</a>.</p>

  

  <p class="note">This attribute is inherently unreliable. A computer can be connected to a network
  without having Internet access.</p>

  <div class="example">

   <p>In this example, an indicator is updated as the browser goes online and offline.</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;Online status&lt;/title&gt;
  &lt;script&gt;
   function updateIndicator() {
     document.getElementById('indicator').textContent = navigator.onLine ? 'online' : 'offline';
   }
  &lt;/script&gt;
 &lt;/head&gt;
 &lt;body onload="updateIndicator()" ononline="updateIndicator()" onoffline="updateIndicator()"&gt;
  &lt;p&gt;The network is: &lt;span id="indicator"&gt;(state unknown)&lt;/span&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>

  </div></section></section></section>





  



  





  




  





  


  

  




  

  

  





  

  



  


  



  


  

  

 




<nav class="prev_next"><a href="editing.html#editing">← 5 User interaction</a> — <a href="Overview.html#contents">Table of contents</a> — <a href="webappapis.html#webappapis">7 Web application APIs →</a></nav><script src="redirection.js"></script></body></html>